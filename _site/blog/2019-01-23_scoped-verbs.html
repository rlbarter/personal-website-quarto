<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rebecca Barter">
<meta name="dcterms.date" content="2019-01-23">
<meta name="description" content="What’s the deal with these mutate_all(), select_if(), summarise_at(), functions? They seem so useful, but there doesn’t seem to be a decent explanation of how to use them anywhere on the internet. Turns out, they’re called ‘scoped verbs’ and hopefully this post will become one of many decent explanations of how to use them!">

<title>mutate_all(), select_if(), summarise_at()… what’s the deal with scoped verbs?! – Rebecca Barter</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-90929425-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>


<link rel="stylesheet" href="../styles.css">
<meta name="twitter:title" content="mutate_all(), select_if(), summarise_at()… what’s the deal with scoped verbs?! – Rebecca Barter">
<meta name="twitter:description" content="What’s the deal with these mutate_all(), select_if(), summarise_at(), functions? They seem so useful, but there doesn’t seem to be a decent explanation of how to use them anywhere on the internet. Turns out, they’re called ‘scoped verbs’ and hopefully this post will become one of many decent explanations of how to use them!">
<meta name="twitter:card" content="summary">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Rebecca Barter</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html"> 
<span class="menu-text">Blog archive</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../consulting.html"> 
<span class="menu-text">Workshops and consulting</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.vdsbook.com"> 
<span class="menu-text">Veridical Data Science</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About Rebecca</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rlbarter"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/rlbarter"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <div id="quarto-announcement" data-announcement-id="452e2dcf2035341fc8f24d4ca3181ef0" class="alert alert-info hidden"><i class="bi bi-info-circle quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p><strong>Learn Python with me!</strong> Join my full-day virtual workshop, <em>Python for R Users</em>, on November 13th hosted by Instats. <a href="https://instats.org/seminar/python-for-r-users2">Register now!</a></p>
</div><i class="bi bi-x-lg quarto-announcement-action"></i></div>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">mutate_all(), select_if(), summarise_at()… what’s the deal with scoped verbs?!</h1>
                  <div>
        <div class="description">
          What’s the deal with these mutate_all(), select_if(), summarise_at(), functions? They seem so useful, but there doesn’t seem to be a decent explanation of how to use them anywhere on the internet. Turns out, they’re called ‘scoped verbs’ and hopefully this post will become one of many decent explanations of how to use them!
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">dplyr</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">tidyverse</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Rebecca Barter </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 23, 2019</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#a-quick-useful-aside-using-shorthand-for-functions" id="toc-a-quick-useful-aside-using-shorthand-for-functions" class="nav-link active" data-scroll-target="#a-quick-useful-aside-using-shorthand-for-functions">A quick useful aside: Using shorthand for functions</a></li>
  <li><a href="#the-_if-scoped-variant-perform-an-operation-on-variables-that-satisfy-a-logical-criteria" id="toc-the-_if-scoped-variant-perform-an-operation-on-variables-that-satisfy-a-logical-criteria" class="nav-link" data-scroll-target="#the-_if-scoped-variant-perform-an-operation-on-variables-that-satisfy-a-logical-criteria">The _if() scoped variant: perform an operation on variables that satisfy a logical criteria</a>
  <ul class="collapse">
  <li><a href="#select_if" id="toc-select_if" class="nav-link" data-scroll-target="#select_if">select_if()</a></li>
  <li><a href="#rename_if" id="toc-rename_if" class="nav-link" data-scroll-target="#rename_if">rename_if()</a></li>
  <li><a href="#mutate_if" id="toc-mutate_if" class="nav-link" data-scroll-target="#mutate_if">mutate_if()</a></li>
  <li><a href="#summarise_if" id="toc-summarise_if" class="nav-link" data-scroll-target="#summarise_if">summarise_if()</a></li>
  </ul></li>
  <li><a href="#the-_at-scoped-variant-perform-an-operation-only-on-variables-specified-by-name" id="toc-the-_at-scoped-variant-perform-an-operation-only-on-variables-specified-by-name" class="nav-link" data-scroll-target="#the-_at-scoped-variant-perform-an-operation-only-on-variables-specified-by-name">The _at() scoped variant: perform an operation only on variables specified by name</a>
  <ul class="collapse">
  <li><a href="#select-helpers" id="toc-select-helpers" class="nav-link" data-scroll-target="#select-helpers">Select helpers</a></li>
  <li><a href="#rename_at" id="toc-rename_at" class="nav-link" data-scroll-target="#rename_at">rename_at()</a></li>
  <li><a href="#mutate_at" id="toc-mutate_at" class="nav-link" data-scroll-target="#mutate_at">mutate_at()</a></li>
  <li><a href="#summarise_at" id="toc-summarise_at" class="nav-link" data-scroll-target="#summarise_at">summarise_at()</a></li>
  </ul></li>
  <li><a href="#the-_all-scoped-variant-perform-an-operation-on-all-variables-at-once" id="toc-the-_all-scoped-variant-perform-an-operation-on-all-variables-at-once" class="nav-link" data-scroll-target="#the-_all-scoped-variant-perform-an-operation-on-all-variables-at-once">The _all() scoped variant: perform an operation on all variables at once</a>
  <ul class="collapse">
  <li><a href="#rename_all" id="toc-rename_all" class="nav-link" data-scroll-target="#rename_all">rename_all()</a></li>
  <li><a href="#mutate_all" id="toc-mutate_all" class="nav-link" data-scroll-target="#mutate_all">mutate_all()</a></li>
  <li><a href="#summarise_all" id="toc-summarise_all" class="nav-link" data-scroll-target="#summarise_all">summarise_all()</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Note: Scoped verbs have now essentially been superseded by <code>accross()</code> (soon to be available in dplyr 1.0.0). See <a href="http://www.rebeccabarter.com/blog/2020-07-09-across/">http://www.rebeccabarter.com/blog/2020-07-09-across/</a> for details.</p>
<p>I often find myself wishing that I could apply the same <code>mutate</code> function to several columns in a data frame at once, such as convert all factors to characters, or do something to all columns that have missing values, or select all variables whose names end with <code>_important</code>. When I first googled these problems around a year ago, I started to see solutions that use weird extensions of the basic <code>mutate()</code>, <code>select()</code>, <code>rename()</code>, and <code>summarise()</code> dplyr functions that look like <code>summarise_all()</code>, <code>filter_at()</code>, <code>mutate_if()</code>, and so on. I have since learned that these functions are called <strong>“scoped verbs”</strong> (where “scoped” means that they operate only on a selection of variables).</p>
<p>Unfortunately, despite my extensive googling, I never really found a satisfactory description of <em>how</em> to use these functions in general, I think primarily because the documentation for these functions is not particularly useful (try <code>?mutate_at()</code>).</p>
<p>Fortunately, I recently attended a series of lightening talks hosted by the RLadies SF chapter where Sara Altman pointed us towards a <a href="https://dcl-2017-04.github.io/curriculum/manip-scoped.html">summary document</a> that Hadley Wickham wrote for the Data Science class he helped create at Stanford in 2017 (this class is now taught by Sara Altman herself).</p>
<p>To summarise what I will demonstrate below, there are three scoped variants of the standard <code>mutate</code>, <code>summarise</code>, <code>rename</code> and <code>select</code> (and <code>transmute</code>) dplyr functions that can be specified by the following suffixes:</p>
<ul>
<li><p><code>_if</code>: allows you to pick variables that satisfy some logical criteria such as <code>is.numeric()</code> or <code>is.character()</code> (e.g.&nbsp;summarising only the numeric columns)</p></li>
<li><p><code>_at</code>: allows you to perform an operation only on variables specified by name (e.g.&nbsp;mutating only the columns whose name ends with “_date”)</p></li>
<li><p><code>_all</code>: allows you to perform an operation on all variables at once (e.g.&nbsp;calculating the number of missing values in every column)</p></li>
</ul>
<p>To explain how these functions all work, I will use the dataset from a survey of 800 Pittsburgh residents on whether or not they approve of self-driving car companies testing their autonomous vehicles on the streets of Pittsburgh (there have several articles on this issue in recent times in case you missed them: <a href="https://www.wired.com/story/uber-returns-self-driving-after-deadly-crash/">1</a>, <a href="https://www.nytimes.com/2018/12/05/technology/uber-self-driving-cars.html">2</a>). The data can usually be downloaded from data.gov (but is currently unavailable due to the current Government Shutdown - I will update this with an actual link to the data one day). For now you can download the data from <a href="../data/bikepghpublic.csv">here</a>.</p>
<p>A random sample of 10 rows of this dataset is shown below. To make it easy to see what’s going on, I’ll restrict my analysis below to these 10 rows</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load in the only library you ever really need</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load in survey data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>av_survey <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/bikepghpublic.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">45679</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="ot">&lt;-</span> av_survey <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select jsut a few columns and give some more intuitive column names</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">id =</span> <span class="st">`</span><span class="at">Response ID</span><span class="st">`</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">start_date =</span> <span class="st">`</span><span class="at">Start Date</span><span class="st">`</span>, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">end_date =</span> <span class="st">`</span><span class="at">End Date</span><span class="st">`</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">interacted_with_av_as_pedestrian =</span> InteractPedestrian,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">interacted_with_av_as_cyclist =</span> InteractBicycle,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">circumstanses_of_interaction =</span> CircumstancesCoded, <span class="co"># lol @ typo in data</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">approve_av_testing_pgh =</span> FeelingsProvingGround) <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># take a random sample of 10 rows</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make data frame so that we view the whole thing</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>av_survey_sample</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id                 start_date                   end_date
1  260381029  02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2  260822947  03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3  260907069  03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4  261099035  03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5  260332379  02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  260355021 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7  260350676  02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  261092370 03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9  260332519  02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10 260351560  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST
   interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   circumstanses_of_interaction approve_av_testing_pgh
1                             2                Approve
2                             4             Disapprove
3                            NA                Approve
4                             3       Somewhat Approve
5                            NA       Somewhat Approve
6                             1                Approve
7                            NA                Approve
8                            NA    Somewhat Disapprove
9                             2                Approve
10                           NA    Somewhat Disapprove</code></pre>
</div>
</div>
<section id="a-quick-useful-aside-using-shorthand-for-functions" class="level1">
<h1>A quick useful aside: Using shorthand for functions</h1>
<p>For many of the examples below, I will be using the <code>~fun(.x)</code> shorthand for writing temporary functions. If you’ve never seen this shorthand before it’s incredibly useful. As an example, here are three ways of counting the number of missing values in each column of a data frame.</p>
<p>The first approach uses the traditional <code>sapply()</code> function and temporary function syntax.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using apply and the normal temporary function syntax</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(av_survey_sample, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              id                       start_date 
                               0                                0 
                        end_date interacted_with_av_as_pedestrian 
                               0                                0 
   interacted_with_av_as_cyclist     circumstanses_of_interaction 
                               0                                5 
          approve_av_testing_pgh 
                               0 </code></pre>
</div>
</div>
<p>The second still uses the temporary function syntax, but is using the <code>map_dbl()</code> function from the <code>purrr</code> package instead of the old-school <code>sapply()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using purrr::map_dbl and the normal temporary function syntax</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> <span class="fu">map_dbl</span>(<span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              id                       start_date 
                               0                                0 
                        end_date interacted_with_av_as_pedestrian 
                               0                                0 
   interacted_with_av_as_cyclist     circumstanses_of_interaction 
                               0                                5 
          approve_av_testing_pgh 
                               0 </code></pre>
</div>
</div>
<p>The third uses the <code>map_dbl()</code> function with the <code>~fun(.x)</code> syntax.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using purrr::map_dbl and the `~fun(.x)` temporary function syntax</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> <span class="fu">map_dbl</span>(<span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              id                       start_date 
                               0                                0 
                        end_date interacted_with_av_as_pedestrian 
                               0                                0 
   interacted_with_av_as_cyclist     circumstanses_of_interaction 
                               0                                5 
          approve_av_testing_pgh 
                               0 </code></pre>
</div>
</div>
</section>
<section id="the-_if-scoped-variant-perform-an-operation-on-variables-that-satisfy-a-logical-criteria" class="level1">
<h1>The _if() scoped variant: perform an operation on variables that satisfy a logical criteria</h1>
<p><code>_if</code> allows you to perform an operation on variables that satisfy some logical criteria such as <code>is.numeric()</code> or <code>is.character()</code>.</p>
<section id="select_if" class="level2">
<h2 class="anchored" data-anchor-id="select_if">select_if()</h2>
<p>For instance, we can use <code>select_if()</code> to extract the numeric columns of the tibble only.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id circumstanses_of_interaction
1  260381029                            2
2  260822947                            4
3  260907069                           NA
4  261099035                            3
5  260332379                           NA
6  260355021                            1
7  260350676                           NA
8  261092370                           NA
9  260332519                            2
10 260351560                           NA</code></pre>
</div>
</div>
<p>We could also apply use more complex logical statements, for example by selecting columns that have at least one missing value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select columns with at least one NA</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the expression evaluates to TRUE if there is one or more missing values</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_if</span>(<span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.x)) <span class="sc">&gt;</span> <span class="dv">0</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   circumstanses_of_interaction
1                             2
2                             4
3                            NA
4                             3
5                            NA
6                             1
7                            NA
8                            NA
9                             2
10                           NA</code></pre>
</div>
</div>
</section>
<section id="rename_if" class="level2">
<h2 class="anchored" data-anchor-id="rename_if">rename_if()</h2>
<p>We could rename columns that satisfy a logical expression using <code>rename_if()</code>. For instance, we can add a <code>num_</code> prefix to all numeric column names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># only rename numeric columns by adding a "num_" prefix</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_if</span>(is.numeric, <span class="sc">~</span><span class="fu">paste0</span>(<span class="st">"num_"</span>, .x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      num_id                 start_date                   end_date
1  260381029  02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2  260822947  03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3  260907069  03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4  261099035  03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5  260332379  02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  260355021 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7  260350676  02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  261092370 03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9  260332519  02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10 260351560  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST
   interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   num_circumstanses_of_interaction approve_av_testing_pgh
1                                 2                Approve
2                                 4             Disapprove
3                                NA                Approve
4                                 3       Somewhat Approve
5                                NA       Somewhat Approve
6                                 1                Approve
7                                NA                Approve
8                                NA    Somewhat Disapprove
9                                 2                Approve
10                               NA    Somewhat Disapprove</code></pre>
</div>
</div>
</section>
<section id="mutate_if" class="level2">
<h2 class="anchored" data-anchor-id="mutate_if">mutate_if()</h2>
<p>We could similarly use <code>mutate_if()</code> to mutate columns that satisfy specified logical conditions. In the example below, we mutate all columns that have at least one missing value by replacing <code>NA</code> with <code>"missing"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># only mutate columns with at least one NA</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># replace each NA value with the character "missing"</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(<span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.x)) <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span><span class="fu">if_else</span>(<span class="fu">is.na</span>(.x), <span class="st">"missing"</span>, <span class="fu">as.character</span>(.x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id                 start_date                   end_date
1  260381029  02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2  260822947  03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3  260907069  03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4  261099035  03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5  260332379  02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  260355021 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7  260350676  02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  261092370 03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9  260332519  02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10 260351560  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST
   interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   circumstanses_of_interaction approve_av_testing_pgh
1                             2                Approve
2                             4             Disapprove
3                       missing                Approve
4                             3       Somewhat Approve
5                       missing       Somewhat Approve
6                             1                Approve
7                       missing                Approve
8                       missing    Somewhat Disapprove
9                             2                Approve
10                      missing    Somewhat Disapprove</code></pre>
</div>
</div>
</section>
<section id="summarise_if" class="level2">
<h2 class="anchored" data-anchor-id="summarise_if">summarise_if()</h2>
<p>Similarly, <code>summarise_if()</code> will summarise columns that satisfy the specified logical conditions. Below, we summarise each character column by reporting the most common value (but for some reason there is no <code>mode()</code> function in R, so we need to write our own).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to calculate the mode (most common) observation</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>mode <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">table</span>(x)))[<span class="dv">1</span>]</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># summarise character</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_if</span>(is.character, mode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  start_date                   end_date
1 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
  interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                         Not sure                      Not sure
  approve_av_testing_pgh
1             Disapprove</code></pre>
</div>
</div>
</section>
</section>
<section id="the-_at-scoped-variant-perform-an-operation-only-on-variables-specified-by-name" class="level1">
<h1>The _at() scoped variant: perform an operation only on variables specified by name</h1>
<p><code>_at</code> allows you to perform an operation only on variables specified by name.</p>
<p>To specify which variables you want to operate on, you need to include the variable names inside the <code>vars()</code> function as the first argument. I think of as like <code>vars()</code> like <code>c()</code> to provide multiple values (in this case variable names) as a single argument. For example <code>av_survey_sample %&gt;% mutate_at(vars(start_date, end_date), mdy_hms)</code> will only mutate the <code>start_date</code> and <code>end_date</code> variables by converting them to lubridate format using the <code>mdy_hms</code> function.</p>
<p>These variables can be specified explicitly by name within the <code>vars()</code> function, or using the <strong>select_helpers</strong> within the <code>vars()</code> function.</p>
<section id="select-helpers" class="level2">
<h2 class="anchored" data-anchor-id="select-helpers">Select helpers</h2>
<p>Select helpers are functions that you can use within <code>select()</code> to help specify which variables you want to select. The options are</p>
<ul>
<li><p><code>starts_with()</code>: select all variables that start with a specified character string</p></li>
<li><p><code>ends_with()</code>: select all variables that end with a specified character string</p></li>
<li><p><code>contains()</code>: select all variables that contain a specified character string</p></li>
<li><p><code>matches()</code>: select variables that match a specified character string</p></li>
<li><p><code>one_of()</code>: selects variables that match any entries in the specified character vector</p></li>
<li><p><code>num_range()</code>: selects variables that are numbered (e.g.&nbsp;columns named <code>V1</code>, <code>V2</code>, <code>V3</code> would be selected by <code>select(num_range("V", 1:3))</code>)</p></li>
</ul>
<p>There are many ways that we could select the <code>date</code> variables using the <code>ends_with()</code> and <code>contains()</code> select helpers:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># selecting the date columns by providing their names</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> <span class="fu">select</span>(start_date, end_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   start_date                   end_date
1   02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2   03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3   03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4   03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5   02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7   02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9   02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># selecting the columns that end with "_date"</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">"_date"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   start_date                   end_date
1   02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2   03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3   03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4   03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5   02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7   02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9   02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># selecting the columns that contain "date"</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"date"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   start_date                   end_date
1   02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2   03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3   03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4   03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5   02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7   02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9   02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST</code></pre>
</div>
</div>
<p>If you ever find yourself wanting to provide variable names as characters, the <code>matches()</code> and <code>one_of()</code> select helpers can help you do that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># provide matches with a single character variables</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">"start_date"</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(variable))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   start_date
1   02/24/2017 3:14:19 AM PST
2   03/03/2017 7:08:33 AM PST
3   03/06/2017 5:57:07 PM PST
4   03/08/2017 3:05:41 PM PST
5   02/23/2017 9:09:11 AM PST
6  02/23/2017 10:11:52 PM PST
7   02/23/2017 6:10:42 PM PST
8  03/08/2017 11:22:43 AM PST
9   02/23/2017 9:16:14 AM PST
10  02/23/2017 6:40:54 PM PST</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># provide one_of with a vector of character variables</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>variables <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"start_date"</span>, <span class="st">"end_date"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">one_of</span>(variables))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   start_date                   end_date
1   02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2   03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3   03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4   03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5   02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7   02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9   02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST</code></pre>
</div>
</div>
<p>Note that technically there does exist a <code>select_at()</code> function that requires a <code>vars()</code> input, but I can’t really think of a good use of this function…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this is the same as av_survey_sample %&gt;% select(start_date, end_date)</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_at</span>(<span class="fu">vars</span>(start_date, end_date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   start_date                   end_date
1   02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2   03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3   03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4   03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5   02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7   02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9   02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST</code></pre>
</div>
</div>
<p>The syntax of this <code>select_at()</code> example though can be useful for understanding how the <code>vars()</code> function can be used in the other <code>_at()</code> functions).</p>
</section>
<section id="rename_at" class="level2">
<h2 class="anchored" data-anchor-id="rename_at">rename_at()</h2>
<p>You can rename specified variables using the <code>rename_at()</code> function. For instance, we could replace all column names that contain the character string “av” with the same column name but an uppercase “AV” instead of the original lowercase “av”.</p>
<p>To do this, we use the select helper <code>contains()</code> within the <code>vars()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use a select helper to only apply to columns whose name contains "av"</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># then rename these columns with "AV" in place of "av"</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">contains</span>(<span class="st">"av"</span>)), </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"av"</span>, <span class="st">"AV"</span>, .x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id                 start_date                   end_date
1  260381029  02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2  260822947  03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3  260907069  03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4  261099035  03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5  260332379  02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  260355021 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7  260350676  02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  261092370 03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9  260332519  02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10 260351560  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST
   interacted_with_AV_as_pedestrian interacted_with_AV_as_cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   circumstanses_of_interaction approve_AV_testing_pgh
1                             2                Approve
2                             4             Disapprove
3                            NA                Approve
4                             3       Somewhat Approve
5                            NA       Somewhat Approve
6                             1                Approve
7                            NA                Approve
8                            NA    Somewhat Disapprove
9                             2                Approve
10                           NA    Somewhat Disapprove</code></pre>
</div>
</div>
</section>
<section id="mutate_at" class="level2">
<h2 class="anchored" data-anchor-id="mutate_at">mutate_at()</h2>
<p>To mutate only the date variables, normally we would do the <code>mdy_hms()</code> transformation to each variable separately as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use the standard (unscoped) approach</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">start_date =</span> <span class="fu">mdy_hms</span>(start_date),</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">end_date =</span> <span class="fu">mdy_hms</span>(end_date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id          start_date            end_date
1  260381029 2017-02-24 03:14:19 2017-02-24 03:18:05
2  260822947 2017-03-03 07:08:33 2017-03-03 07:19:15
3  260907069 2017-03-06 17:57:07 2017-03-06 17:59:08
4  261099035 2017-03-08 15:05:41 2017-03-09 07:17:53
5  260332379 2017-02-23 09:09:11 2017-02-23 09:11:07
6  260355021 2017-02-23 22:11:52 2017-02-23 22:20:02
7  260350676 2017-02-23 18:10:42 2017-02-23 18:13:59
8  261092370 2017-03-08 11:22:43 2017-03-08 11:25:22
9  260332519 2017-02-23 09:16:14 2017-02-23 09:21:40
10 260351560 2017-02-23 18:40:54 2017-02-23 18:42:02
   interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   circumstanses_of_interaction approve_av_testing_pgh
1                             2                Approve
2                             4             Disapprove
3                            NA                Approve
4                             3       Somewhat Approve
5                            NA       Somewhat Approve
6                             1                Approve
7                            NA                Approve
8                            NA    Somewhat Disapprove
9                             2                Approve
10                           NA    Somewhat Disapprove</code></pre>
</div>
</div>
<p>However, using <code>mutate_at()</code> and supplying these column names as arguments to the <code>vars()</code> function, we could specify the function only once.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># specifying specific variables to apply the same function to</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(start_date, end_date), mdy_hms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id          start_date            end_date
1  260381029 2017-02-24 03:14:19 2017-02-24 03:18:05
2  260822947 2017-03-03 07:08:33 2017-03-03 07:19:15
3  260907069 2017-03-06 17:57:07 2017-03-06 17:59:08
4  261099035 2017-03-08 15:05:41 2017-03-09 07:17:53
5  260332379 2017-02-23 09:09:11 2017-02-23 09:11:07
6  260355021 2017-02-23 22:11:52 2017-02-23 22:20:02
7  260350676 2017-02-23 18:10:42 2017-02-23 18:13:59
8  261092370 2017-03-08 11:22:43 2017-03-08 11:25:22
9  260332519 2017-02-23 09:16:14 2017-02-23 09:21:40
10 260351560 2017-02-23 18:40:54 2017-02-23 18:42:02
   interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   circumstanses_of_interaction approve_av_testing_pgh
1                             2                Approve
2                             4             Disapprove
3                            NA                Approve
4                             3       Somewhat Approve
5                            NA       Somewhat Approve
6                             1                Approve
7                            NA                Approve
8                            NA    Somewhat Disapprove
9                             2                Approve
10                           NA    Somewhat Disapprove</code></pre>
</div>
</div>
<p>Moreover, we can use the select helpers to specify which columns we want to mutate, without having to write out the entire column names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use a "select helper" to specify the variables that end with "_date"</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">ends_with</span>(<span class="st">"_date"</span>)), mdy_hms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id          start_date            end_date
1  260381029 2017-02-24 03:14:19 2017-02-24 03:18:05
2  260822947 2017-03-03 07:08:33 2017-03-03 07:19:15
3  260907069 2017-03-06 17:57:07 2017-03-06 17:59:08
4  261099035 2017-03-08 15:05:41 2017-03-09 07:17:53
5  260332379 2017-02-23 09:09:11 2017-02-23 09:11:07
6  260355021 2017-02-23 22:11:52 2017-02-23 22:20:02
7  260350676 2017-02-23 18:10:42 2017-02-23 18:13:59
8  261092370 2017-03-08 11:22:43 2017-03-08 11:25:22
9  260332519 2017-02-23 09:16:14 2017-02-23 09:21:40
10 260351560 2017-02-23 18:40:54 2017-02-23 18:42:02
   interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   circumstanses_of_interaction approve_av_testing_pgh
1                             2                Approve
2                             4             Disapprove
3                            NA                Approve
4                             3       Somewhat Approve
5                            NA       Somewhat Approve
6                             1                Approve
7                            NA                Approve
8                            NA    Somewhat Disapprove
9                             2                Approve
10                           NA    Somewhat Disapprove</code></pre>
</div>
</div>
</section>
<section id="summarise_at" class="level2">
<h2 class="anchored" data-anchor-id="summarise_at">summarise_at()</h2>
<p>The <code>summarise_at()</code> scoped verb behaves very similarly to the <code>mutate_at()</code> scoped verb, in that we can easily specify <em>which</em> variables we want to apply the same summary function to.</p>
<p>For instance, the following example summarises all variables that contain the word “interacted” by counting the number of “Yes” entries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(<span class="fu">vars</span>(<span class="fu">contains</span>(<span class="st">"interacted"</span>)), <span class="sc">~</span><span class="fu">sum</span>(.x <span class="sc">==</span> <span class="st">"Yes"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                                4                             6</code></pre>
</div>
</div>
</section>
</section>
<section id="the-_all-scoped-variant-perform-an-operation-on-all-variables-at-once" class="level1">
<h1>The _all() scoped variant: perform an operation on all variables at once</h1>
<p><code>_all</code> allows you to perform an operation on all variables at once (e.g.&nbsp;calculating the number of missing values in every column).</p>
<section id="rename_all" class="level2">
<h2 class="anchored" data-anchor-id="rename_all">rename_all()</h2>
<p>The <code>select_all()</code> would is quite redundant (it would simply return all columns). Its friend <code>rename_all()</code>, however can be very useful.</p>
<p>For instance, we could rename all variables by replacing underscores <code>_</code> with dots <code>.</code> (although I would advise against this: underscores are way better than dots!).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_all</span>(<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"_"</span>, <span class="st">"."</span>, .x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id                 start.date                   end.date
1  260381029  02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2  260822947  03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3  260907069  03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4  261099035  03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5  260332379  02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  260355021 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7  260350676  02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  261092370 03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9  260332519  02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10 260351560  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST
   interacted.with.av.as.pedestrian interacted.with.av.as.cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   circumstanses.of.interaction approve.av.testing.pgh
1                             2                Approve
2                             4             Disapprove
3                            NA                Approve
4                             3       Somewhat Approve
5                            NA       Somewhat Approve
6                             1                Approve
7                            NA                Approve
8                            NA    Somewhat Disapprove
9                             2                Approve
10                           NA    Somewhat Disapprove</code></pre>
</div>
</div>
</section>
<section id="mutate_all" class="level2">
<h2 class="anchored" data-anchor-id="mutate_all">mutate_all()</h2>
<p>We could apply the same mutate function to every column at once using <code>mutate_all()</code>. For instance, the code below converts every column to a numeric (although this results in mostly missing values for the character variables)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(as.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id start_date end_date interacted_with_av_as_pedestrian
1  260381029         NA       NA                               NA
2  260822947         NA       NA                               NA
3  260907069         NA       NA                               NA
4  261099035         NA       NA                               NA
5  260332379         NA       NA                               NA
6  260355021         NA       NA                               NA
7  260350676         NA       NA                               NA
8  261092370         NA       NA                               NA
9  260332519         NA       NA                               NA
10 260351560         NA       NA                               NA
   interacted_with_av_as_cyclist circumstanses_of_interaction
1                             NA                            2
2                             NA                            4
3                             NA                           NA
4                             NA                            3
5                             NA                           NA
6                             NA                            1
7                             NA                           NA
8                             NA                           NA
9                             NA                            2
10                            NA                           NA
   approve_av_testing_pgh
1                      NA
2                      NA
3                      NA
4                      NA
5                      NA
6                      NA
7                      NA
8                      NA
9                      NA
10                     NA</code></pre>
</div>
</div>
</section>
<section id="summarise_all" class="level2">
<h2 class="anchored" data-anchor-id="summarise_all">summarise_all()</h2>
<p>We could also apply the same summary function to every column at once using <code>summarise_all()</code>. For instance, the example below calculates the number of distinct entries in each column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>av_survey_sample <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(n_distinct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id start_date end_date interacted_with_av_as_pedestrian
1 10         10       10                                3
  interacted_with_av_as_cyclist circumstanses_of_interaction
1                             3                            5
  approve_av_testing_pgh
1                      4</code></pre>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Hopefully this summary is useful to you in your data manipulation adventures!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.rebeccabarter\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="rlbarter/blog_comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->




</body></html>