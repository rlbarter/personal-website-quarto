<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Rebecca Barter</title>
<link>https://www.rebeccabarter.com/blog.html</link>
<atom:link href="https://www.rebeccabarter.com/blog.xml" rel="self" type="application/rss+xml"/>
<description>Rebecca Barter&#39;s blog</description>
<generator>quarto-1.5.56</generator>
<lastBuildDate>Mon, 14 Oct 2024 07:00:00 GMT</lastBuildDate>
<item>
  <title>Code Like a Pro with AI using GitHub Copilot</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2024-10-14-copilot.html</link>
  <description><![CDATA[ 





<p align="center">
<img src="https://www.rebeccabarter.com/blog/img/copilot/copilot_logo.png" style="width:95.0%;height:70.0%" alt="The GitHub Copilot Logo">
</p>
<p>I’ve been wanting to produce some helpful content about how to use GitHub Copilot for a while, but unfortunately, it doesn’t lend itself well to a written medium. Fortunately for me, I was asked by Shannon Pileggi and and Jenny Luong to give a presentation on GitHub Copilot for R Ladies Philly! So rather than writing a blog post, I am sharing the recording of that hour-long session.</p>
<p>In this talk, I’ll demonstrate Copilot’s powerful AI tools, including advanced code completion (it can write entire multi-line functions from a single comment!) and a chatbot that can “see” your whole code file. Copilot can save you time and brain juice, even if you’re already an R pro. While GitHub Copilot is proprietary software owned by Microsoft, meaning it comes with a cost and is only fully available in VS Code (which is also owned by Microsoft), a “light” version with more limited functionality is supported in RStudio. To get started, you’ll need a GitHub account, you should have VS Code and RStudio installed, and have an active GitHub Copilot subscription. During the live demo, I’ll also provide resources to help you kick off your Copilot journey.</p>
<p>The GitHub repo containing the materials I cover in the talk can be found <a href="https://github.com/rlbarter/ai-copilot-demo">here</a>.</p>
<div style="text-align: center;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/Lihg6il9SzE?si=IxILtexQupQCk5zi" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="">
</iframe>
</div>



 ]]></description>
  <category>data science</category>
  <category>AI</category>
  <category>GitHub Copilot</category>
  <category>R</category>
  <guid>https://www.rebeccabarter.com/blog/2024-10-14-copilot.html</guid>
  <pubDate>Mon, 14 Oct 2024 07:00:00 GMT</pubDate>
  <media:content url="https://www.rebeccabarter.com/blog/img/copilot/copilot_logo.png" medium="image" type="image/png" height="31" width="144"/>
</item>
<item>
  <title>AI Tutorial: Using Text Embeddings to Label Synthetic Doctor’s Notes Generated with ChatGPT</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2024-04-11-labeling_doctors_notes.html</link>
  <description><![CDATA[ 





<p align="center">
<img src="https://www.rebeccabarter.com/blog/img/openai_ehr/doctors_notes_ai.png" style="width:70.0%;height:70.0%" alt="An image created by dall-e-3 using the name of this blog post as the prompt. The image contains a brain in the center connected using circuitry to a code console, with various viruses and other things floating around, and a doctor conducting a medical exam of what seems to be another doctor">
</p>
<blockquote class="blockquote">
<p><strong>Warning:</strong> If you’re reading this post more than 3 hours after it was posted, some (maybe all) of the information it contains will probably be out of date.</p>
</blockquote>
<p>Hello friends, welcome to the new rapidly evolving world of AI. Even the wacky image that you see at the top of this blog was created using AI (specifically, using dall-e-3), just for this blog post!</p>
<p>Like me, I’m sure you’re dwelling on the question of whether AI is going to take all of our jobs. I think, for now, I’ve settled on the opinion that for those of us who adapt and learn to work <em>with</em> AI, our jobs are pretty safe. However, there is no question that AI is going to fundamentally <em>change</em> our jobs, hopefully for the better. In my day-to-day I have already found that GitHub Copilot has boosted my coding efficiency, chatGPT has boosted my efficiency for mundane writing tasks, and the various other ways that AI has snuck into my workday are probably helping me out in other ways too.</p>
<p>And, as you’ll see in this blog post, using the tools provided by OpenAI, NLP tasks like generating synthetic text, and labeling mass amounts of text data are now fairly straightforward too.</p>
<p>In this blog post, I will walk through an example of generating a small collection of synthetic doctor’s notes using chatGPT and then using text OpenAI’s embedding models to automatically label these doctor’s notes in terms of whether they correspond to a patient experiencing a chronic or an acute event. Fortunately, the <a href="https://platform.openai.com/docs/overview">documentation provided on the OpenAI website</a> is very good, and that will certainly be the best point of reference.</p>
<p>Note that, for now, if you want to use these tools effectively, you’ll want to be fairly proficient in Python (if you’re an R user who is interested in learning Python, check out my <a href="https://rebeccabarter.com/blog/2023-09-11-from_r_to_python">“An introduction to Python for R Users”</a> blog post).</p>
<section id="getting-set-up" class="level2">
<h2 class="anchored" data-anchor-id="getting-set-up">Getting set up</h2>
<p>As usual, the first thing you’ll want to do is to import the libraries you’ll need.</p>
<div id="617a0085" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.spatial.distance <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> cosine</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb1-4"></span>
<span id="cb1-5">pd.set_option(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'display.max_colwidth'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span></code></pre></div>
</div>
<p>Then you’ll need to set up your OpenAI API key. An API key is literally a jumble of letters that OpenAI uses to identify you so that they can track your usage. After you create an OpenAI account, see the <a href="https://platform.openai.com/api-keys">OpenAI API keys website</a> for information on creating an API key.</p>
<p>Once you have created an API key, and you have saved it somewhere on your computer, say in a file called “api_key.txt”, you will need to use it to connect to the OpenAI client.</p>
<p>To do this, either create a local variable called <code>your_key</code> or read in your key from your text file using code like the following:</p>
<div id="f1308200" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'api_key.txt'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>:</span>
<span id="cb2-2">  your_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>.read().strip()</span></code></pre></div>
</div>
<p>Then you can set up your OpenAI client which is how you will connect to the OpenAI API:</p>
<div id="964ce1d8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define a local variable called `your_key` that contains your OpenAI key.</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Try really hard to avoid writing your key in your notebook</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># And when you do, try even harder to avoid uploading it to GitHub</span></span>
<span id="cb3-4">client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>your_key)</span></code></pre></div>
</div>
<p>Note that it is <strong>really, really important</strong> that you do not write your API key in plain text in your notebook file, especially if you are going to upload your notebook publicly to GitHub. This would allow someone else to pretend to be you and use your OpenAI account.</p>
<p>Instead, you will want to only ever define your key in a local variable (that is not saved in your code) or load it in from a file that should <em>not</em> be uploaded to GitHub!</p>
<p>Once you’re set up, let’s generate some fake doctor’s notes to analyze!</p>
</section>
<section id="creating-synthetic-doctors-notes-with-chatgpt" class="level2">
<h2 class="anchored" data-anchor-id="creating-synthetic-doctors-notes-with-chatgpt">Creating synthetic doctor’s notes with chatGPT</h2>
<p>The first thing I did was use chatGPT-4 to create a collection of synthetic doctor’s notes.</p>
<p>Note that at the time of writing, you have to pay to access chatGPT-4 through the API. If you don’t want to pay OpenAI, you can replace <code>model="gpt-4"</code> with <code>model="gpt-3.5-turbo"</code>, which is currently free (but is also less good).</p>
<p>The following code uses chatGPT-4 to generate 50 doctor’s notes using the prompt:</p>
<blockquote class="blockquote">
<p>“Provide a collection of 50 doctors notes that resemble the kind that you would enter into an EHR for your patients on a day-to-day basis. Each note should have around 3 sentences. Each note should appear on a new line. Do not add any numbers or superfluous text.”</p>
</blockquote>
<div id="3acd968d" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">completion <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(</span>
<span id="cb4-2">  model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4"</span>,</span>
<span id="cb4-3">  messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb4-4">    {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>, </span>
<span id="cb4-5">     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"You are a doctor working in a large hospital."</span>},</span>
<span id="cb4-6">    {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>,</span>
<span id="cb4-7">     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""Provide a collection of 50 doctors notes that </span></span>
<span id="cb4-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                   resemble the kind that you would enter into an </span></span>
<span id="cb4-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                   EHR for your patients on a day-to-day basis. </span></span>
<span id="cb4-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                   Each note should have around 3 sentences. </span></span>
<span id="cb4-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                   Each note should appear on a new line.</span></span>
<span id="cb4-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                   Do not add any numbers or superfluous text."""</span>}</span>
<span id="cb4-13">  ]</span>
<span id="cb4-14">)</span></code></pre></div>
</div>
<p>The text created by ChatGPT can be extracted using <code>completion.choices[0].message.content</code>. But since this is just one big string value, I want to use the <code>.split</code> method to separate each note into a list element.</p>
<div id="a2324cee" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># extract the notes and place them in a list, where each list element is detected by the presence of a line break ('\n')</span></span>
<span id="cb5-2">notes_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> completion.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message.content.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span></code></pre></div>
</div>
<p>Since the output provided tended to add additional blank lines between the notes (even when I asked it not to), I used the following code to remove any entries in my <code>notes_list</code> that contain blank strings:</p>
<div id="e40c54e0" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove any empty notes</span></span>
<span id="cb6-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># may or may not be required for you</span></span>
<span id="cb6-3">notes_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [note <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> note <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> notes_list <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> note <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>]</span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># place the notes in a DataFrame</span></span>
<span id="cb6-5">notes_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'notes'</span>: notes_list}) </span></code></pre></div>
</div>
<p>Let’s take a look at the notes it created:</p>
<div id="4a30dead" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># look at the first 5</span></span>
<span id="cb7-2">notes_df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Patient presented signs of common cold; symptoms include a runny nose and mild fever. Advised rest, hydration, and over-the-counter medication to manage symptoms.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Patient reports difficulty sleeping. Exhibiting signs of insomnia characterized by frequent night time awakenings. Recommended a sleep study to find underlying cause.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Patient came in with complaints of stomachache. Upon examination, no obvious signs of appendicitis or gallstones were found. Recommended patient to undergo an ultrasound to assess internal organs.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Hypertensive patient presented with higher blood pressure at 160/100. Adjusted medications and emphasized importance of diet and exercise.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Examined patient for frequent headaches. No alarming neurological signs detected. Recommended reducing caffeine intake and keeping hydrated.</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>However, since chatGPT returns a different collection of notes every time, you can load the notes I created above using the following code (if you prefer to follow along with my doctor’s notes, that is):</p>
<div id="77c934b2" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">notes_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/rlbarter/personal-website-quarto/main/blog/data/doctors_notes.csv"</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
</div>
<p>If you just loaded the notes using the URL above, take a look at the first 5 notes.</p>
<div id="4a76b0ab" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># look at the first 5</span></span>
<span id="cb9-2">notes_df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Patient presented signs of common cold; symptoms include a runny nose and mild fever. Advised rest, hydration, and over-the-counter medication to manage symptoms.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Patient reports difficulty sleeping. Exhibiting signs of insomnia characterized by frequent night time awakenings. Recommended a sleep study to find underlying cause.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Patient came in with complaints of stomachache. Upon examination, no obvious signs of appendicitis or gallstones were found. Recommended patient to undergo an ultrasound to assess internal organs.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Hypertensive patient presented with higher blood pressure at 160/100. Adjusted medications and emphasized importance of diet and exercise.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Examined patient for frequent headaches. No alarming neurological signs detected. Recommended reducing caffeine intake and keeping hydrated.</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="computing-text-embeddings" class="level2">
<h2 class="anchored" data-anchor-id="computing-text-embeddings">Computing text embeddings</h2>
<p>My goal in the rest of this post will be to identify whether each note corresponds to a patient with a <em>chronic</em> condition (which I define as a condition that they have been experiencing for more than one month) or an <em>acute</em> condition (e.g., a new condition).</p>
<p>To do this, I will use something called <strong>text embeddings</strong>. The idea is that I will use OpenAI’s pre-trained text embedding models to embed each note into a numeric 1,536-dimensional that somehow approximately respects semantic distance.</p>
<p>The equivalent of this in a two-dimensional world would be taking each individual doctor’s note and placing it on a scatterplot so that notes that we might intuitively consider to be more “similar” to one another are closer together in the plot, and notes that we might consider to be more “different” from one another are further apart. Unfortunately, it is unlikely that we would be able to come up with any two quantifiable values that we could use to define the two axes of our scatterplot, such that when we place each note in the scatterplot we achieve our desired property that “similar” notes are closer together. But it turns out that once your space has, say, 1,536 dimensions, this task somehow becomes possible (although what each dimension/axis represents is not necessarily going to be meaningful to us).</p>
<p>Fortunately, OpenAI has already trained some general text embedding models that we can use to embed each of the doctor’s notes in such a 1,536-dimensional space. In this post, I will be using the “<em>text-embedding-3-small</em>” OpenAI model to compute the text embeddings.</p>
<p>After computing the embeddings, our task becomes determining how close each doctor’s note is to the embedding of the following text: <em><strong>“Patient presenting with ongoing chronic condition defined as ongoing for more than one month”</strong></em>, which I will call the <strong>target</strong>. The closer a note’s embedding is to the target’s embedding, the more likely the note corresponds to a patient who is presenting with a chronic condition!</p>
<p>I hear you. That sounds crazy, right? But it works… eerily well! Let me show you.</p>
<p>First, I need to compute the embeddings for each of the chatGPT-generated doctor’s notes. I can do that using this custom function <code>get_embedding()</code> function that I literally just copy-and-pasted from the OpenAI documentation:</p>
<div id="743d99c1" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_embedding(text, model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-small"</span>):</span>
<span id="cb10-2">   text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> text.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>)</span>
<span id="cb10-3">   <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> client.embeddings.create(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [text], model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>model).data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].embedding</span></code></pre></div>
</div>
<p>This function basically takes a string <code>text</code>, and uses the “text-embedding-3-small” model to create a list of 1,536 numbers corresponding to the 1,536-dimensional embedding of the text entry.</p>
<p>For example, the following code creates an embedding of the text “hello, how are you”:</p>
<div id="b2a63cff" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">get_embedding(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'hello, how are you'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>[0.020681990310549736,
 -0.03974681720137596,
 -0.000452458014478907,
 0.029285797849297523,
 -0.013973292894661427,
 -0.059632860124111176,
 0.0007248803740367293,
 0.02625361829996109,
 0.0012578805908560753,
 -0.039999499917030334,
 0.004143978469073772,
 -0.032242171466350555,
 -0.011370671913027763,
 -0.04505313187837601,
 -0.005956968758255243,
 0.06473702937364578,
 -0.02131369337439537,
 0.05190080404281616,
 -0.0056916531175374985,
 0.02920999377965927,
 0.058015696704387665,
 0.01499665342271328,
 0.009684022516012192,
 0.04065646976232529,
 0.0349964015185833,
 0.025268161669373512,
 0.023827875033020973,
 0.01146542839705944,
 0.02449748106300831,
 -0.017624542117118835,
 0.05356850102543831,
 -0.03800331428647041,
 0.012665665708482265,
 0.013291052542626858,
 0.002278872299939394,
 0.013834318146109581,
 -0.0029911184683442116,
 0.009267098270356655,
 -0.001953544793650508,
 -0.060896266251802444,
 -0.006733964662998915,
 -0.01929224096238613,
 0.0412629060447216,
 0.016411669552326202,
 0.01106745470315218,
 0.0036165055353194475,
 0.003145886119455099,
 -0.018572097644209862,
 0.04836326092481613,
 0.020088188350200653,
 0.02371416985988617,
 -0.01297520101070404,
 0.014529192820191383,
 0.13715557754039764,
 0.04500259459018707,
 -0.04282953217625618,
 0.036563027650117874,
 0.00012782136036548764,
 0.005268411710858345,
 0.03388460353016853,
 0.002237811451777816,
 -0.04341069981455803,
 0.01293729804456234,
 0.027264345437288284,
 -0.0006838195840828121,
 -0.030422866344451904,
 -0.013758513145148754,
 0.012728836387395859,
 -0.016828594729304314,
 3.400344212423079e-05,
 0.02913418971002102,
 0.04070700705051422,
 -0.008610125631093979,
 -0.018572097644209862,
 -0.03648722544312477,
 0.016007380560040474,
 -0.0004595646751113236,
 -0.032823339104652405,
 0.01567889377474785,
 0.02673371322453022,
 -0.0628671869635582,
 -0.023524656891822815,
 -0.03421308845281601,
 -0.006399161648005247,
 -0.032444316893815994,
 0.010827407240867615,
 -0.014794507995247841,
 0.01747293397784233,
 0.005975920241326094,
 0.004292428959161043,
 -0.02663264237344265,
 0.012634080834686756,
 -0.02045457623898983,
 0.005565312225371599,
 0.022488662973046303,
 -0.04763048142194748,
 4.67115496576298e-05,
 0.02693585865199566,
 0.036360882222652435,
 -0.00024103456235025078,
 0.05119329318404198,
 -0.02443431131541729,
 -0.0230319295078516,
 -0.002187275094911456,
 0.05336635559797287,
 0.03901404142379761,
 0.021717984229326248,
 -0.020290333777666092,
 -0.014124901965260506,
 0.011219063773751259,
 -0.10142640024423599,
 -0.002395737450569868,
 -0.012570910155773163,
 0.006550770718604326,
 0.04090915247797966,
 0.03982262313365936,
 0.05958232283592224,
 -0.04581117630004883,
 0.025470305234193802,
 -0.02701166458427906,
 0.007056133821606636,
 -0.015982111915946007,
 0.03939306363463402,
 -0.04042905569076538,
 -0.061755385249853134,
 -0.010941113345324993,
 -0.014491289854049683,
 0.02185695990920067,
 -0.03727053850889206,
 -0.006525502540171146,
 -0.008875441737473011,
 0.023082464933395386,
 0.009854583069682121,
 0.0023704692721366882,
 -0.028376145288348198,
 0.013152077794075012,
 -0.020745160058140755,
 0.03964574262499809,
 -0.045659568160772324,
 0.014327047392725945,
 0.061654310673475266,
 -0.04992988705635071,
 -0.013632172718644142,
 0.01441548578441143,
 0.005697970278561115,
 -0.06215967610478401,
 -0.0039228820241987705,
 0.04992988705635071,
 0.010953747667372227,
 -0.014251242391765118,
 0.03524908423423767,
 0.012861493974924088,
 -0.0747937560081482,
 0.023309879004955292,
 0.002479438204318285,
 0.008066860027611256,
 0.030448133125901222,
 -0.021086279302835464,
 -0.023486755788326263,
 0.03287387639284134,
 0.013000468723475933,
 0.0094060730189085,
 -0.03125671669840813,
 -0.04914657399058342,
 -0.029285797849297523,
 0.00018635268497746438,
 -0.021490570157766342,
 0.04257684946060181,
 0.0014047517906874418,
 0.017422396689653397,
 -0.03153466433286667,
 0.03924145549535751,
 -0.04664502665400505,
 -0.02923526242375374,
 0.0100061921402812,
 -0.02749175950884819,
 0.028805702924728394,
 -0.01360690500587225,
 -0.05020783469080925,
 0.003398567670956254,
 0.023865777999162674,
 0.02221071347594261,
 0.019608093425631523,
 -0.015249335207045078,
 -0.013291052542626858,
 0.016310598701238632,
 -0.025167088955640793,
 0.010656846687197685,
 -0.028199266642332077,
 0.017460299655795097,
 0.010770553722977638,
 0.0555899553000927,
 0.004349282011389732,
 0.018799511715769768,
 0.025697719305753708,
 -0.04399186745285988,
 0.07878612726926804,
 -0.0081489821895957,
 -0.04550795629620552,
 0.023385683074593544,
 -0.008824905380606651,
 -0.008212151937186718,
 0.00013364487676881254,
 -0.02683478593826294,
 0.0020340869668871164,
 0.007744691334664822,
 -0.02515445463359356,
 0.06332200765609741,
 0.008654344826936722,
 -0.0013494776794686913,
 0.04816111549735069,
 -0.020568283274769783,
 0.003951308783143759,
 0.04667029157280922,
 -0.009046001359820366,
 -0.03171154111623764,
 0.04404240474104881,
 0.03380879759788513,
 0.00862907711416483,
 0.004924132954329252,
 -0.06377683579921722,
 0.04295587167143822,
 0.08070650696754456,
 -0.02221071347594261,
 0.026278886944055557,
 0.012071863748133183,
 0.027087468653917313,
 0.005540044046938419,
 0.013316321186721325,
 -0.003521749982610345,
 0.007605716586112976,
 0.028780434280633926,
 0.025621915236115456,
 -0.021440034732222557,
 -0.03997423127293587,
 0.011484378948807716,
 0.015779966488480568,
 -0.04282953217625618,
 0.019140630960464478,
 -0.00490834005177021,
 -0.021819056943058968,
 -0.026657909154891968,
 -0.02341095171868801,
 0.017510835081338882,
 0.03393514081835747,
 -0.005634800065308809,
 0.021149450913071632,
 -0.0350722074508667,
 -0.00835744384676218,
 0.011901304125785828,
 -0.003910247702151537,
 0.01939331367611885,
 0.014781873673200607,
 -0.041338711977005005,
 -0.003625981044024229,
 -0.002013556659221649,
 -0.008231103420257568,
 0.004658817313611507,
 0.00835744384676218,
 -0.02357519418001175,
 -0.028881506994366646,
 -0.037523217499256134,
 -0.008104762993752956,
 -0.03054920583963394,
 -0.021149450913071632,
 -0.045836444944143295,
 -0.015552553348243237,
 0.01571679674088955,
 0.012002376839518547,
 0.02059355191886425,
 0.04214729368686676,
 -0.0374726839363575,
 0.03459211066365242,
 0.01058735977858305,
 -0.022981392219662666,
 0.02759283222258091,
 0.02728961408138275,
 0.008679613471031189,
 0.03075135126709938,
 -0.008603808470070362,
 -0.0325959287583828,
 -0.009791412390768528,
 0.003357506822794676,
 -0.02835087664425373,
 -0.043056946247816086,
 0.030877692624926567,
 -0.024901771917939186,
 -0.02213490940630436,
 0.035678643733263016,
 0.019191168248653412,
 0.01446602214127779,
 -0.00023274344857782125,
 -0.002964271232485771,
 -0.028805702924728394,
 0.0007979211513884366,
 0.01111799106001854,
 0.036739904433488846,
 -0.049980420619249344,
 0.01627269573509693,
 -0.012949932366609573,
 0.052456703037023544,
 0.004175563808530569,
 0.013240516185760498,
 -0.01747293397784233,
 -0.0157546978443861,
 0.04368865117430687,
 0.021402131766080856,
 -0.0054516056552529335,
 0.0010115160839632154,
 0.0004481150535866618,
 -0.03982262313365936,
 0.03297495096921921,
 0.05766194313764572,
 -0.02741595357656479,
 -0.014604996889829636,
 -0.010833724401891232,
 0.02855302207171917,
 0.0026926384307444096,
 0.004750414285808802,
 -0.034263625741004944,
 0.020201895385980606,
 -0.0313577875494957,
 -0.016866497695446014,
 -0.018812146037817,
 -0.032444316893815994,
 -0.014289145357906818,
 0.024825967848300934,
 -0.003780748462304473,
 -0.04176827147603035,
 -0.021490570157766342,
 -0.0008843856048770249,
 -0.06908315420150757,
 0.006279137916862965,
 -0.005394752137362957,
 0.04414347559213638,
 0.008717515505850315,
 -0.03236851468682289,
 0.033303435891866684,
 0.002240970032289624,
 0.014920849353075027,
 -0.015186164528131485,
 -0.0399489626288414,
 -0.019936578348279,
 -0.051218561828136444,
 -0.003907089587301016,
 -0.019090095534920692,
 0.01955755613744259,
 0.002414688700810075,
 -0.031281981617212296,
 -0.021920129656791687,
 0.018989022821187973,
 0.01154754962772131,
 -0.0017545579466968775,
 -0.027643367648124695,
 -0.012659348547458649,
 -0.0206314530223608,
 0.07332820445299149,
 -0.0028174000326544046,
 -0.013253150507807732,
 0.025280794128775597,
 0.0007900248165242374,
 -0.008420614525675774,
 2.5046078008017503e-05,
 -0.024067923426628113,
 0.04245050996541977,
 0.022804515436291695,
 -0.06023929640650749,
 -0.008572223596274853,
 0.018445758149027824,
 0.049197107553482056,
 0.025204990059137344,
 0.0005176024860702455,
 0.0021714826580137014,
 0.03476898744702339,
 -0.06498970836400986,
 0.02979116141796112,
 0.037220001220703125,
 0.004434562288224697,
 0.0020909402519464493,
 0.011724426411092281,
 0.0931384414434433,
 0.03727053850889206,
 -0.013948025181889534,
 -0.025722987949848175,
 0.027062200009822845,
 0.00029196569812484086,
 -0.009791412390768528,
 -0.006696062628179789,
 -0.03974681720137596,
 0.033758264034986496,
 0.08611389249563217,
 -0.012867811135947704,
 0.015514650382101536,
 -0.037801168859004974,
 0.0338340662419796,
 0.007668886799365282,
 0.028022389858961105,
 0.0259756688028574,
 -0.04942452162504196,
 -0.04308221489191055,
 0.03171154111623764,
 -0.055135127156972885,
 0.009551364928483963,
 -0.004949401132762432,
 0.014807142317295074,
 0.035880789160728455,
 -0.03792750835418701,
 -0.011105356737971306,
 0.04760521650314331,
 0.012166619300842285,
 -0.0026942177210003138,
 -0.05745979771018028,
 0.03643668815493584,
 0.060694120824337006,
 -0.010220970958471298,
 -0.018281513825058937,
 -0.027820244431495667,
 -0.02971535734832287,
 -0.0034522623755037785,
 -0.0050504738464951515,
 0.025167088955640793,
 0.012318228371441364,
 0.026607373729348183,
 0.02683478593826294,
 -0.031004033982753754,
 0.019026925787329674,
 0.025760889053344727,
 -0.04502786323428154,
 0.03600712865591049,
 -0.06888100504875183,
 -0.03355611860752106,
 0.0016124245012179017,
 0.009835631586611271,
 0.014327047392725945,
 0.009785095229744911,
 -0.017864590510725975,
 0.02855302207171917,
 0.015640990808606148,
 0.013569002039730549,
 0.003704944159835577,
 0.029563747346401215,
 -0.027087468653917313,
 -0.037801168859004974,
 -0.048060040920972824,
 -0.009349219501018524,
 -0.01725815422832966,
 0.004706195089966059,
 0.020151358097791672,
 -0.01653801091015339,
 -0.012810957618057728,
 -0.039797354489564896,
 0.03161047026515007,
 0.013303686864674091,
 0.018243612721562386,
 0.00651918537914753,
 0.01388485450297594,
 -0.027138004079461098,
 -0.006377052050083876,
 0.017662445083260536,
 -0.005874847527593374,
 -0.0029579540714621544,
 -0.00447878148406744,
 -0.034920599311590195,
 0.06140163168311119,
 0.00862907711416483,
 -0.008003690280020237,
 -0.012539324350655079,
 -0.004687243606895208,
 -0.005878006108105183,
 -0.011730743572115898,
 0.003411201760172844,
 0.003979735542088747,
 0.044320352375507355,
 0.013960658572614193,
 -0.03719473257660866,
 -0.03140832483768463,
 -0.027466490864753723,
 0.020543014630675316,
 0.013240516185760498,
 -0.02327197603881359,
 -0.013695343397557735,
 0.02025243081152439,
 0.0024004753213375807,
 0.04816111549735069,
 -0.01360690500587225,
 0.019519655033946037,
 -0.002253604121506214,
 0.014832410030066967,
 -0.06049197539687157,
 0.03178734704852104,
 0.018129905685782433,
 0.045634299516677856,
 0.04022691026329994,
 -0.013695343397557735,
 -0.03676517307758331,
 0.05013203248381615,
 -0.03724526986479759,
 -0.00802895799279213,
 -0.007321449462324381,
 -0.019759701564908028,
 -0.00988616794347763,
 -0.024585921317338943,
 -0.000546818773727864,
 0.002975326031446457,
 0.07534965872764587,
 0.019987115636467934,
 -0.007908934727311134,
 -0.02797185443341732,
 0.004289270378649235,
 -0.04237470403313637,
 0.005915908142924309,
 0.006209650542587042,
 -0.02289295382797718,
 -0.016222158446907997,
 -0.007005597464740276,
 0.02595040202140808,
 0.01771298050880432,
 0.03219163790345192,
 -0.010239922441542149,
 -0.050814270973205566,
 0.025647183880209923,
 0.010378897190093994,
 0.018824780359864235,
 -0.013392125256359577,
 -0.02563454955816269,
 0.006449698004871607,
 -0.05948125198483467,
 -0.027921317145228386,
 -0.01785195618867874,
 0.018167806789278984,
 0.014693435281515121,
 -0.03727053850889206,
 -0.02776970900595188,
 0.012596177868545055,
 -0.00855958927422762,
 -0.013569002039730549,
 0.055893171578645706,
 -0.02739068679511547,
 0.006822403520345688,
 -0.06468649208545685,
 0.014314413070678711,
 0.04141451418399811,
 -0.003040075534954667,
 -0.014377583749592304,
 -0.007902617566287518,
 0.01255827583372593,
 0.01733395829796791,
 -0.013720611110329628,
 0.014554460532963276,
 0.014440753497183323,
 0.018951119855046272,
 -0.0007438315078616142,
 -0.015097726136446,
 0.004245051182806492,
 0.004570378456264734,
 0.006569721736013889,
 -0.02741595357656479,
 -0.03168627247214317,
 0.023688901215791702,
 0.03547649830579758,
 -0.03229270875453949,
 -0.014743971638381481,
 -0.005846420768648386,
 0.0059853955172002316,
 0.006525502540171146,
 0.04712511971592903,
 -0.0026926384307444096,
 -0.0008496419177390635,
 -0.004990461748093367,
 -0.011692841537296772,
 -0.04543215408921242,
 0.0009396597160957754,
 -0.013177345506846905,
 -0.08060543239116669,
 0.03340451046824455,
 0.007706788834184408,
 0.00399868655949831,
 0.021187352016568184,
 -0.02203383669257164,
 0.016121085733175278,
 -0.012463520281016827,
 -0.03840760514140129,
 -0.022147543728351593,
 0.0014797666808590293,
 -0.03643668815493584,
 0.030448133125901222,
 0.0022630796302109957,
 0.014655533246695995,
 0.028856240212917328,
 0.05250723659992218,
 0.0012602495262399316,
 -0.0028237169608473778,
 0.029058385640382767,
 -0.02749175950884819,
 0.015640990808606148,
 -0.04328436031937599,
 -0.032722268253564835,
 -0.02883097156882286,
 -0.006446539424359798,
 0.011162210255861282,
 -0.023082464933395386,
 -0.0059032742865383625,
 -0.0058053601533174515,
 -0.0521029494702816,
 0.02055564895272255,
 -0.003995527978986502,
 -0.019759701564908028,
 0.009317634627223015,
 -0.024585921317338943,
 -0.049879349768161774,
 -0.021048378199338913,
 -0.003600712865591049,
 0.01647484116256237,
 -0.04368865117430687,
 0.0026452606543898582,
 0.019671263173222542,
 -0.019683897495269775,
 0.013227881863713264,
 -0.0014758185716345906,
 -0.0006309144082479179,
 -0.042399972677230835,
 0.009159708395600319,
 0.016424303874373436,
 0.021528473123908043,
 0.03423835709691048,
 0.01139594055712223,
 -0.018685804679989815,
 -0.019279606640338898,
 -0.03843287378549576,
 0.016904398798942566,
 0.01715708151459694,
 0.01257722731679678,
 0.00628861365839839,
 -0.01911536417901516,
 -0.008332176133990288,
 -0.012387716211378574,
 0.0033827750012278557,
 -0.02645576372742653,
 0.04495205730199814,
 -0.03269699960947037,
 0.024863870814442635,
 0.0015310925664380193,
 0.019443849101662636,
 -0.023448852822184563,
 0.029816430062055588,
 0.006396003067493439,
 -0.013922756537795067,
 0.0100061921402812,
 -0.016386402770876884,
 -0.01237508188933134,
 0.031105106696486473,
 -0.026379959657788277,
 -0.020025016739964485,
 -0.028502484783530235,
 0.004845169838517904,
 0.021098913624882698,
 -0.042197827249765396,
 0.019848139956593513,
 -0.0049367668107151985,
 0.0067402818240225315,
 0.014743971638381481,
 0.03734634071588516,
 0.013126809149980545,
 0.007195108570158482,
 -0.005631641484797001,
 0.019709166139364243,
 0.028325608000159264,
 -0.012962566688656807,
 -0.006165431346744299,
 -0.01204659603536129,
 -0.013758513145148754,
 -0.004668292589485645,
 0.05265884846448898,
 -0.037017855793237686,
 0.036259811371564865,
 -0.014301778748631477,
 -0.014390217140316963,
 -0.0026373642031103373,
 -0.0060296147130429745,
 -0.023549925535917282,
 -0.03661356493830681,
 0.018205709755420685,
 -0.034162554889917374,
 -0.002649998292326927,
 0.0009459767607040703,
 0.038938235491514206,
 0.06498970836400986,
 -0.016727522015571594,
 -0.02779497765004635,
 0.0223370548337698,
 -0.018951119855046272,
 -0.0023657316341996193,
 0.0200123842805624,
 0.020429307594895363,
 0.029487943276762962,
 0.01567889377474785,
 0.023284610360860825,
 0.030827155336737633,
 0.03724526986479759,
 -0.01245720311999321,
 -0.014339681714773178,
 -0.05020783469080925,
 0.009159708395600319,
 -0.003430152777582407,
 0.003888138337060809,
 -0.0002218860317952931,
 -0.028376145288348198,
 0.017346592620015144,
 0.023966850712895393,
 0.05291152745485306,
 -0.017763517796993256,
 0.015236700884997845,
 -0.0033038121182471514,
 -0.005919066723436117,
 -0.004374550189822912,
 0.019001657143235207,
 -0.0017719297902658582,
 -0.016790693625807762,
 0.005116802640259266,
 -0.007984738796949387,
 -0.011503330431878567,
 -0.0035185914020985365,
 -0.03388460353016853,
 -0.026986395940184593,
 0.005028363782912493,
 -0.02523025870323181,
 -0.03229270875453949,
 -0.021124182268977165,
 0.013430027291178703,
 -0.013164712116122246,
 0.010707383044064045,
 -0.0272138100117445,
 0.01049892045557499,
 0.02409319207072258,
 0.020163992419838905,
 0.012640397064387798,
 -0.009551364928483963,
 -0.00644338084384799,
 -0.03633561357855797,
 -0.029260531067848206,
 -0.008142665028572083,
 0.015742063522338867,
 0.020366137847304344,
 0.0010249398183077574,
 0.010606310330331326,
 0.011225380003452301,
 0.007624667603522539,
 0.009747193194925785,
 -0.03181261569261551,
 -0.012804640457034111,
 0.004769365303218365,
 0.00830690748989582,
 -0.020947305485606194,
 0.022842416539788246,
 -0.011743377894163132,
 -0.04894442856311798,
 0.01647484116256237,
 0.009494511410593987,
 0.011143258772790432,
 0.014150169678032398,
 0.01977233588695526,
 0.018963754177093506,
 -0.0009965130593627691,
 0.006702379789203405,
 -0.002929527312517166,
 0.011452794075012207,
 -0.028856240212917328,
 0.004219783004373312,
 -0.022867685183882713,
 0.03294968232512474,
 0.05508458986878395,
 -0.022349689155817032,
 -0.006557087879627943,
 -0.024901771917939186,
 0.04502786323428154,
 -0.017447665333747864,
 -0.021819056943058968,
 0.02011345513164997,
 -0.040681738406419754,
 -0.0010296775726601481,
 0.022943489253520966,
 0.019671263173222542,
 -0.0050346809439361095,
 0.021263157948851585,
 -0.0057074460200965405,
 -0.012090815231204033,
 -0.0011962894350290298,
 -0.012292960658669472,
 0.029159458354115486,
 -0.0006060410523787141,
 0.02031560055911541,
 -0.01542621199041605,
 0.015502016991376877,
 -0.044118206948041916,
 -0.007409888319671154,
 0.022589735686779022,
 0.007814179174602032,
 -0.009412390179932117,
 -0.0090586356818676,
 0.02271607704460621,
 -0.028224535286426544,
 -0.004188197664916515,
 0.002675266470760107,
 -0.015224066562950611,
 0.019949212670326233,
 -0.01637376844882965,
 -0.0326717309653759,
 0.011073771864175797,
 0.012103448621928692,
 -0.02059355191886425,
 -0.00830690748989582,
 0.014604996889829636,
 -0.015565186738967896,
 0.024762798100709915,
 0.014402851462364197,
 -0.03178734704852104,
 0.020429307594895363,
 0.004017637576907873,
 0.037624292075634,
 0.00696769542992115,
 0.057813551276922226,
 0.016310598701238632,
 -0.032722268253564835,
 0.004052381496876478,
 0.0035312254913151264,
 0.006816086359322071,
 0.00017786415992304683,
 -0.030726084485650063,
 -0.01891321875154972,
 -0.020126089453697205,
 0.009715607389807701,
 -0.013948025181889534,
 -0.011332769878208637,
 -0.00497782789170742,
 0.0064812833443284035,
 0.03570391237735748,
 -0.013177345506846905,
 -0.002182537456974387,
 -0.015552553348243237,
 -0.013442661613225937,
 0.002740016207098961,
 -0.017182350158691406,
 0.0411112979054451,
 -0.008654344826936722,
 -0.01685386337339878,
 0.041237637400627136,
 0.006301247514784336,
 -0.036840979009866714,
 0.003932357300072908,
 0.009980923496186733,
 -0.005675860680639744,
 0.02089676819741726,
 0.06493917107582092,
 0.01785195618867874,
 -0.009153391234576702,
 0.007460424676537514,
 -0.029083652421832085,
 -0.014200706034898758,
 0.035602837800979614,
 -0.018989022821187973,
 -0.017750883474946022,
 0.022021202370524406,
 0.03292441368103027,
 -0.005682177841663361,
 0.017359226942062378,
 -0.01637376844882965,
 -0.00912812352180481,
 -0.016007380560040474,
 -0.016121085733175278,
 0.027744440361857414,
 -0.02701166458427906,
 0.0036607247311621904,
 -0.02069462463259697,
 -0.024990210309624672,
 0.02817399986088276,
 0.03666410222649574,
 -0.04495205730199814,
 0.005634800065308809,
 -0.03342977538704872,
 -0.020568283274769783,
 0.033859334886074066,
 -0.0026547361630946398,
 0.010113581083714962,
 0.014781873673200607,
 0.007371985819190741,
 -0.004090283531695604,
 0.038255997002124786,
 0.03350558131933212,
 -0.0020656720735132694,
 0.016209525987505913,
 0.033859334886074066,
 -0.0010202019475400448,
 -0.010922162793576717,
 -0.001951965386979282,
 0.013910122215747833,
 -0.00596328591927886,
 -0.05569102615118027,
 -0.0019803920295089483,
 -0.021010475233197212,
 0.00425452645868063,
 -0.0124256182461977,
 0.003106404561549425,
 -0.03075135126709938,
 -0.022905588150024414,
 0.003079557092860341,
 0.01771298050880432,
 0.004879913758486509,
 0.01921643689274788,
 0.011762328445911407,
 -0.006784501019865274,
 -0.025520842522382736,
 -0.03901404142379761,
 0.033202365040779114,
 0.03651249408721924,
 -0.01949438638985157,
 0.056853361427783966,
 -0.015363042242825031,
 0.015312505885958672,
 0.0073530348017811775,
 -0.015186164528131485,
 -0.004355599172413349,
 0.008591175079345703,
 0.00958926696330309,
 0.011534915305674076,
 0.020985208451747894,
 -0.01925433799624443,
 -0.02549557387828827,
 0.026127278804779053,
 -0.0447499118745327,
 0.01547674834728241,
 -0.0005452395416796207,
 0.034920599311590195,
 -0.0223370548337698,
 0.030245987698435783,
 0.04232417047023773,
 0.015742063522338867,
 -0.007100353017449379,
 0.018850047141313553,
 -0.019418582320213318,
 -0.021528473123908043,
 -0.018925853073596954,
 0.025242893025279045,
 0.018951119855046272,
 0.031105106696486473,
 0.03782643750309944,
 0.014213340356945992,
 -0.0230319295078516,
 0.0040207961574196815,
 0.0049367668107151985,
 -0.013733245432376862,
 -0.010170434601604939,
 0.03380879759788513,
 0.008660661987960339,
 0.02573562227189541,
 -0.01134540420025587,
 -0.025861961767077446,
 0.049980420619249344,
 -0.005249460227787495,
 0.010890576988458633,
 0.03858448192477226,
 -0.014743971638381481,
 -0.011263282969594002,
 -0.022589735686779022,
 -0.003392250509932637,
 -0.02824980393052101,
 0.008869124576449394,
 -0.00402395473793149,
 0.00573271419852972,
 0.0229561235755682,
 0.0387108214199543,
 -0.022084372118115425,
 0.003357506822794676,
 0.008534321561455727,
 -0.007409888319671154,
 0.027163272723555565,
 -0.01154754962772131,
 0.007270913105458021,
 0.016045281663537025,
 0.025647183880209923,
 -0.014263876713812351,
 0.03254539147019386,
 0.025242893025279045,
 0.03461737930774689,
 0.014478656463325024,
 -0.036461956799030304,
 0.00034664757549762726,
 0.0006245973636396229,
 0.026102010160684586,
 -0.013316321186721325,
 -0.012261374853551388,
 0.004469305742532015,
 -0.011768645606935024,
 0.02317090332508087,
 0.02327197603881359,
 -0.011206429451704025,
 -0.01527460291981697,
 -0.00888807512819767,
 -0.02693585865199566,
 0.017308689653873444,
 0.006279137916862965,
 ...]</code></pre>
</div>
</div>
<p>Next, I can apply this function to each of the notes stored in the <code>notes</code> column of the <code>notes_df</code> DataFrame, and save it in a new column of the DataFrame called <code>embedding</code>:</p>
<div id="37e646e5" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">notes_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'embedding'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> notes_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'notes'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: get_embedding(x))</span></code></pre></div>
</div>
<p>Below, I show the first 5 rows. You can see that there is a new column containing a collection of 1,536-length lists corresponding to the note’s embedding.</p>
<div id="a766c6a6" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">notes_df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">notes</th>
<th data-quarto-table-cell-role="th">embedding</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Patient presented signs of common cold; symptoms include a runny nose and mild fever. Advised rest, hydration, and over-the-counter medication to manage symptoms.</td>
<td>[0.007875490933656693, -0.0006737920339219272, -0.048676371574401855, 0.016742711886763573, -0.01964789256453514, 0.007379627320915461, -0.0036548112984746695, 0.01582098752260208, -0.00981811247766018, 0.05731024220585823, -0.05661020055413246, 0.05338999629020691, -0.0089722266420722, 0.005787027534097433, 0.009333916008472443, 0.002053461503237486, 0.020791297778487206, -0.013055814430117607, -0.03626226261258125, 0.06151050329208374, -0.0013227908639237285, 0.06081046164035797, 0.021164653822779655, 0.0037043977063149214, -0.004646540153771639, 0.009497258812189102, 0.006889596581459045, -0.02360313944518566, 0.04398607835173607, -0.06272391229867935, 0.02380148507654667, -0.01809612847864628, 0.003272704314440489, -0.017582762986421585, 0.030848590657114983, 0.023124776780605316, 0.022611411288380623, -0.046296220272779465, -0.006352896336466074, -0.006597911473363638, -0.023031437769532204, -0.01648602820932865, -0.01208742056041956, -0.006551241967827082, -0.030731918290257454, 0.0008546366589143872, 0.04699626564979553, -0.018119463697075844, 0.004751546308398247, -0.02417484112083912, 0.010763171128928661, -0.026694998145103455, 0.006452069152146578, 0.008348020724952221, 0.010535657405853271, 0.02921515703201294, 0.02755838632583618, 0.012624121271073818, -0.013405836187303066, 0.0015488466015085578, 0.0514298751950264, -0.03217867389321327, 0.02334645763039589, 0.013347499072551727, -0.004766130819916725, -0.013499175198376179, 0.03761567920446396, 0.01333583239465952, 0.026461651548743248, 0.010774838738143444, 0.006154550705105066, -0.028328433632850647, 0.025574930012226105, 0.003345625475049019, -0.025994954630732536, 0.04412608593702316, 0.019204530864953995, -0.041139233857393265, 0.024034833535552025, 0.014700917527079582, 0.0011288204696029425, -0.012075753882527351, 0.043052684515714645, -0.0011660102754831314, -0.023159777745604515, -0.05987706780433655, -0.033765438944101334, -0.023778149858117104, 0.027441712096333504, -0.031735312193632126, 0.031525298953056335, 0.03994916006922722, 0.006761255208402872, -0.028771795332431793, -0.013347499072551727, -0.02634497731924057, 0.02550492435693741, 0.02359147183597088, -0.03294872120022774, 0.03000853955745697, ...]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Patient reports difficulty sleeping. Exhibiting signs of insomnia characterized by frequent night time awakenings. Recommended a sleep study to find underlying cause.</td>
<td>[-0.0345405712723732, -0.010776856914162636, -0.010913430713117123, 0.01344623975455761, -0.0371975414454937, 0.01843736506998539, 0.022373152896761894, -0.01380629651248455, 0.06128406524658203, -0.0055250017903745174, -0.02246006391942501, 0.03488821163773537, -0.060837097465991974, 0.019294051453471184, -0.005022164434194565, 0.017419274896383286, 0.014824386686086655, -0.016761241480708122, -0.030120572075247765, 0.0056708864867687225, 0.036700911819934845, 0.03622911125421524, -0.006679664831608534, -0.0573606938123703, 0.024992873892188072, 0.01998933218419552, 0.030319223180413246, -0.023142928257584572, 0.029872257262468338, -0.03113866224884987, 0.004680731799453497, -0.020436298102140427, 0.014042195864021778, -0.020846018567681313, -0.02521635591983795, 0.04705563187599182, 0.04226315766572952, 0.006909355986863375, -0.010733402334153652, -0.015283768996596336, -0.006704496685415506, -0.02394995093345642, 0.01163354329764843, -0.01688539795577526, -0.030865514650940895, -0.037445854395627975, -0.023502985015511513, -0.040425632148981094, 0.07345148175954819, 0.03406877443194389, -0.022149669006466866, 0.016016297042369843, 0.0220627598464489, -0.022075176239013672, 0.038935743272304535, -0.040624283254146576, 0.05368563532829285, 0.010013289749622345, -0.003945099655538797, 0.031188324093818665, 0.03250439092516899, 0.03357214480638504, 0.04186585545539856, 0.007896406576037407, 0.0016187013825401664, -0.0722595751285553, 0.01103137992322445, 0.01600388064980507, 0.008777923882007599, 0.043728217482566833, -0.005543625447899103, 0.010950678028166294, 0.005773316603153944, 0.05368563532829285, 0.01149076223373413, 0.024744559079408646, 0.006235802546143532, -0.028754839673638344, -0.00626994576305151, 0.009876716881990433, -0.02686764858663082, 0.006273049861192703, 0.009839469566941261, 0.046385183930397034, 0.0031737720128148794, -0.02080877125263214, -0.047105297446250916, -0.06217799708247185, 0.01106862723827362, -0.05676473677158356, 0.021963434293866158, -0.0022767353802919388, -0.00857306458055973, 0.015159611590206623, 0.005546729080379009, -0.050954174250364304, -0.0011461274698376656, 0.02709113247692585, -0.00894553679972887, 0.04352956265211105, ...]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Patient came in with complaints of stomachache. Upon examination, no obvious signs of appendicitis or gallstones were found. Recommended patient to undergo an ultrasound to assess internal organs.</td>
<td>[-0.017208361998200417, 0.006888406351208687, -0.005633207969367504, 0.04822390526533127, -0.014728333801031113, 0.025873279199004173, -0.03370814397931099, -0.0009527865331619978, 0.03423452004790306, -0.010254159569740295, -0.04486321285367012, -0.008685161359608173, 0.01806878112256527, 0.019941454753279686, 0.028039507567882538, 0.016347944736480713, 0.0295174028724432, -0.05652441084384918, -0.020892975851893425, 0.009252025745809078, 0.053163718432188034, 0.015467280521988869, 0.02342361770570278, -0.0332222618162632, 0.04615890234708786, -0.051422636955976486, 0.01870650239288807, -0.00034986119135282934, -0.023038960993289948, -0.024010727182030678, 0.047697532922029495, -0.0066960775293409824, 0.03565167635679245, -0.026075730100274086, -0.035894621163606644, 0.06778070330619812, 0.03374863415956497, 0.0055269212462008, -0.015720345079898834, -0.02858612686395645, 0.009727786295115948, 0.024597834795713425, 0.019010178744792938, -0.020235009491443634, -0.007941152900457382, 0.025245679542422295, 0.008472587913274765, -0.02548862062394619, 0.02113591879606247, 0.0035783271305263042, 0.0027204395737499, 0.03320201858878136, 0.021115673705935478, -0.01451575942337513, 0.006088723428547382, -0.05980411916971207, -0.02872784249484539, -0.0322909876704216, 0.03806084766983986, 0.025144454091787338, 0.004529848229140043, 0.03957923501729965, 0.06259794533252716, 0.05907529592514038, -0.010821023024618626, -0.07883454114198685, 0.05713176354765892, 0.040915410965681076, 0.044458311051130295, -0.02583278901875019, 0.013078355230391026, 0.02773583121597767, -0.010238975286483765, 0.02148008532822132, 0.07474502921104431, 0.00839666835963726, 0.08215474337339401, -0.026865290477871895, 0.010861513204872608, -0.0009135616128332913, 0.004243885632604361, 0.019081037491559982, 0.005435817874968052, 0.03941727057099342, 0.014819436706602573, 0.02615671046078205, -0.0274321548640728, -0.034760892391204834, 0.02696651592850685, 0.00028643698897212744, 0.001967573771253228, 0.011448622681200504, 0.04247428849339485, -0.0023927215952426195, -0.006756812799721956, -0.03441672399640083, 0.001920756883919239, 0.03672466799616814, -0.031015543267130852, 0.02471930719912052, ...]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Hypertensive patient presented with higher blood pressure at 160/100. Adjusted medications and emphasized importance of diet and exercise.</td>
<td>[-0.01908160373568535, -0.007425420451909304, 0.017478106543421745, 0.0633997693657875, -0.03739846125245094, 0.0564923994243145, -0.014924848452210426, 0.03949534147977829, -0.022670967504382133, -0.008227168582379818, 0.0023235275875777006, 0.01861288957297802, -0.05338408425450325, 0.021585524082183838, 0.032809995114803314, 0.0043664430268108845, 0.05175592005252838, -0.01282796822488308, -0.01846487447619438, 0.010040352120995522, -0.01032404787838459, -0.01255044061690569, 0.03727511689066887, -0.03327871114015579, -0.01349403616040945, -0.02069743350148201, 0.026494689285755157, -0.05005374550819397, 0.042801011353731155, -0.04746348410844803, 0.04080280661582947, -0.02429913356900215, 0.025137884542346, 0.0548148974776268, -0.005189776886254549, -0.0036479535046964884, 0.0019658245146274567, -0.0015927032800391316, 0.022905325517058372, 0.0035554443020373583, -0.0008025189745239913, -0.028912268579006195, -0.020956460386514664, 0.0659160241484642, -0.03490687534213066, 0.02893693745136261, 0.017613787204027176, -0.03764515370130539, 0.0155539121478796, 0.02130182832479477, -0.019982028752565384, 0.010428891517221928, -0.023115012794733047, 0.019328294321894646, 0.03290867432951927, 0.015183874405920506, 0.03014572709798813, 0.020487746223807335, -0.007838629186153412, 0.031132493168115616, 0.014184772968292236, -0.013975084759294987, 0.022300930693745613, 0.025729944929480553, -0.04578598216176033, -0.02073443867266178, 0.015072863548994064, -0.011446495540440083, 0.03140385448932648, 0.021425174549221992, -0.014949517324566841, -0.030022380873560905, -0.030269071459770203, 0.05358143895864487, -0.0035708623472601175, -0.022892991080880165, -0.005436468403786421, -0.03009638749063015, -0.003157653845846653, 0.055308278650045395, -0.029603004455566406, -0.02204190380871296, -0.009065920487046242, 0.04381244629621506, 0.009756657294929028, -0.06902433931827545, 0.0014246446080505848, 9.824304288486019e-05, -0.005482723005115986, -0.08269105851650238, 0.0053686280734837055, 0.005710912868380547, -0.0006240529473870993, 0.004471287131309509, -0.03041708655655384, 0.003200824838131666, -0.04183891415596008, 0.03251396492123604, -0.0017438019858673215, -0.0027629469987004995, ...]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Examined patient for frequent headaches. No alarming neurological signs detected. Recommended reducing caffeine intake and keeping hydrated.</td>
<td>[-0.010823288932442665, 0.03450469672679901, -0.0003536372387316078, 0.01706509292125702, -0.033481039106845856, 0.030859481543302536, -0.00017135703819803894, 0.05228135362267494, -0.010186624713242054, 0.017614372074604034, 0.003529740497469902, 0.021334487944841385, -0.02444290742278099, 0.054828010499477386, -0.012496092356741428, -0.005037136375904083, 0.008351534605026245, -0.02938641607761383, -0.005436611827462912, 0.02893700636923313, 0.03158353269100189, 0.06366640329360962, 0.05123273283243179, 0.015329872258007526, 0.0488358773291111, 0.01000561285763979, 0.010242801159620285, -0.041695255786180496, 0.03263215348124504, -0.022308209910988808, 0.02629048004746437, -0.00510579627007246, -0.018038814887404442, 0.03467946499586105, -0.005889142397791147, 0.022645266726613045, 0.025504013523459435, -0.004253789782524109, -0.013145240023732185, -0.0078896414488554, 0.016728036105632782, -0.020210962742567062, 0.016815422102808952, 0.01926220953464508, -0.015641963109374046, -0.046139419078826904, 0.02104736492037773, -0.03822481259703636, 0.051582273095846176, 0.006853501312434673, -0.039173565804958344, 0.012858116999268532, 0.02134697139263153, 0.013245109468698502, 0.014643273316323757, -0.010473747737705708, 0.003486047964543104, -0.024005981162190437, 0.06111975014209747, 0.02057298831641674, 0.052980437874794006, -0.003170836716890335, 0.02688969485461712, 0.030260268598794937, -0.03732599318027496, -0.037800367921590805, 0.03233254700899124, -0.04114597663283348, 0.06072027608752251, -0.013956675305962563, -0.019536849111318588, 0.005062103737145662, 0.04409210756421089, 0.004054052289575338, 0.008794702589511871, -0.013170207850635052, 0.05472814291715622, -0.06970847398042679, -0.025416627526283264, 0.05397912487387657, -0.0226327832788229, 0.025591399520635605, 0.008863362483680248, 0.04014728590846062, -0.012508576735854149, -0.05412892997264862, -0.029186679050326347, -0.03198300674557686, -0.015254970639944077, -0.03430495783686638, -0.024230685085058212, 0.012764490209519863, 0.010411330498754978, 0.012957986444234848, -0.016128823161125183, -0.012021715752780437, 0.015854183584451675, 0.00357655412517488, -0.015666930004954338, 0.02527930773794651, ...]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Since I will want to compute the cosine distance to the “target” (<em>“Patient presenting with ongoing chronic condition defined as ongoing for more than one month”</em>), I will also need to compute the embedding of the label.</p>
<div id="64fc6f16" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Patient presenting with ongoing chronic condition defined as ongoing for more than one month'</span></span>
<span id="cb15-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute embedding of the target</span></span>
<span id="cb15-3">target_embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_embedding(target)</span></code></pre></div>
</div>
</section>
<section id="computing-the-cosine-distance-from-the-target" class="level2">
<h2 class="anchored" data-anchor-id="computing-the-cosine-distance-from-the-target">Computing the cosine distance from the target</h2>
<p>Now that I have all of my embeddings, I need to compute the <em>cosine distance</em> from each doctor’s note’s embedding to this target embedding. Below, I compute and save this cosine distance in a new column of <code>notes_df</code> called <code>cosine_dist</code> (note that a <em>lower</em> <code>cosine_dist</code> value corresponds to a doctor’s note that is more similar to the target: <em>“Patient presenting with ongoing chronic condition defined as ongoing for more than one month”</em>).</p>
<div id="c472bd7e" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">notes_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cosine_dist'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> notes_df.embedding.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: cosine(x, target_embedding))</span></code></pre></div>
</div>
<p>You can see that the final column in <code>notes_df</code> is now the cosine distance:</p>
<div id="2824d660" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">notes_df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">notes</th>
<th data-quarto-table-cell-role="th">embedding</th>
<th data-quarto-table-cell-role="th">cosine_dist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Patient presented signs of common cold; symptoms include a runny nose and mild fever. Advised rest, hydration, and over-the-counter medication to manage symptoms.</td>
<td>[0.007875490933656693, -0.0006737920339219272, -0.048676371574401855, 0.016742711886763573, -0.01964789256453514, 0.007379627320915461, -0.0036548112984746695, 0.01582098752260208, -0.00981811247766018, 0.05731024220585823, -0.05661020055413246, 0.05338999629020691, -0.0089722266420722, 0.005787027534097433, 0.009333916008472443, 0.002053461503237486, 0.020791297778487206, -0.013055814430117607, -0.03626226261258125, 0.06151050329208374, -0.0013227908639237285, 0.06081046164035797, 0.021164653822779655, 0.0037043977063149214, -0.004646540153771639, 0.009497258812189102, 0.006889596581459045, -0.02360313944518566, 0.04398607835173607, -0.06272391229867935, 0.02380148507654667, -0.01809612847864628, 0.003272704314440489, -0.017582762986421585, 0.030848590657114983, 0.023124776780605316, 0.022611411288380623, -0.046296220272779465, -0.006352896336466074, -0.006597911473363638, -0.023031437769532204, -0.01648602820932865, -0.01208742056041956, -0.006551241967827082, -0.030731918290257454, 0.0008546366589143872, 0.04699626564979553, -0.018119463697075844, 0.004751546308398247, -0.02417484112083912, 0.010763171128928661, -0.026694998145103455, 0.006452069152146578, 0.008348020724952221, 0.010535657405853271, 0.02921515703201294, 0.02755838632583618, 0.012624121271073818, -0.013405836187303066, 0.0015488466015085578, 0.0514298751950264, -0.03217867389321327, 0.02334645763039589, 0.013347499072551727, -0.004766130819916725, -0.013499175198376179, 0.03761567920446396, 0.01333583239465952, 0.026461651548743248, 0.010774838738143444, 0.006154550705105066, -0.028328433632850647, 0.025574930012226105, 0.003345625475049019, -0.025994954630732536, 0.04412608593702316, 0.019204530864953995, -0.041139233857393265, 0.024034833535552025, 0.014700917527079582, 0.0011288204696029425, -0.012075753882527351, 0.043052684515714645, -0.0011660102754831314, -0.023159777745604515, -0.05987706780433655, -0.033765438944101334, -0.023778149858117104, 0.027441712096333504, -0.031735312193632126, 0.031525298953056335, 0.03994916006922722, 0.006761255208402872, -0.028771795332431793, -0.013347499072551727, -0.02634497731924057, 0.02550492435693741, 0.02359147183597088, -0.03294872120022774, 0.03000853955745697, ...]</td>
<td>0.697187</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Patient reports difficulty sleeping. Exhibiting signs of insomnia characterized by frequent night time awakenings. Recommended a sleep study to find underlying cause.</td>
<td>[-0.0345405712723732, -0.010776856914162636, -0.010913430713117123, 0.01344623975455761, -0.0371975414454937, 0.01843736506998539, 0.022373152896761894, -0.01380629651248455, 0.06128406524658203, -0.0055250017903745174, -0.02246006391942501, 0.03488821163773537, -0.060837097465991974, 0.019294051453471184, -0.005022164434194565, 0.017419274896383286, 0.014824386686086655, -0.016761241480708122, -0.030120572075247765, 0.0056708864867687225, 0.036700911819934845, 0.03622911125421524, -0.006679664831608534, -0.0573606938123703, 0.024992873892188072, 0.01998933218419552, 0.030319223180413246, -0.023142928257584572, 0.029872257262468338, -0.03113866224884987, 0.004680731799453497, -0.020436298102140427, 0.014042195864021778, -0.020846018567681313, -0.02521635591983795, 0.04705563187599182, 0.04226315766572952, 0.006909355986863375, -0.010733402334153652, -0.015283768996596336, -0.006704496685415506, -0.02394995093345642, 0.01163354329764843, -0.01688539795577526, -0.030865514650940895, -0.037445854395627975, -0.023502985015511513, -0.040425632148981094, 0.07345148175954819, 0.03406877443194389, -0.022149669006466866, 0.016016297042369843, 0.0220627598464489, -0.022075176239013672, 0.038935743272304535, -0.040624283254146576, 0.05368563532829285, 0.010013289749622345, -0.003945099655538797, 0.031188324093818665, 0.03250439092516899, 0.03357214480638504, 0.04186585545539856, 0.007896406576037407, 0.0016187013825401664, -0.0722595751285553, 0.01103137992322445, 0.01600388064980507, 0.008777923882007599, 0.043728217482566833, -0.005543625447899103, 0.010950678028166294, 0.005773316603153944, 0.05368563532829285, 0.01149076223373413, 0.024744559079408646, 0.006235802546143532, -0.028754839673638344, -0.00626994576305151, 0.009876716881990433, -0.02686764858663082, 0.006273049861192703, 0.009839469566941261, 0.046385183930397034, 0.0031737720128148794, -0.02080877125263214, -0.047105297446250916, -0.06217799708247185, 0.01106862723827362, -0.05676473677158356, 0.021963434293866158, -0.0022767353802919388, -0.00857306458055973, 0.015159611590206623, 0.005546729080379009, -0.050954174250364304, -0.0011461274698376656, 0.02709113247692585, -0.00894553679972887, 0.04352956265211105, ...]</td>
<td>0.583531</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Patient came in with complaints of stomachache. Upon examination, no obvious signs of appendicitis or gallstones were found. Recommended patient to undergo an ultrasound to assess internal organs.</td>
<td>[-0.017208361998200417, 0.006888406351208687, -0.005633207969367504, 0.04822390526533127, -0.014728333801031113, 0.025873279199004173, -0.03370814397931099, -0.0009527865331619978, 0.03423452004790306, -0.010254159569740295, -0.04486321285367012, -0.008685161359608173, 0.01806878112256527, 0.019941454753279686, 0.028039507567882538, 0.016347944736480713, 0.0295174028724432, -0.05652441084384918, -0.020892975851893425, 0.009252025745809078, 0.053163718432188034, 0.015467280521988869, 0.02342361770570278, -0.0332222618162632, 0.04615890234708786, -0.051422636955976486, 0.01870650239288807, -0.00034986119135282934, -0.023038960993289948, -0.024010727182030678, 0.047697532922029495, -0.0066960775293409824, 0.03565167635679245, -0.026075730100274086, -0.035894621163606644, 0.06778070330619812, 0.03374863415956497, 0.0055269212462008, -0.015720345079898834, -0.02858612686395645, 0.009727786295115948, 0.024597834795713425, 0.019010178744792938, -0.020235009491443634, -0.007941152900457382, 0.025245679542422295, 0.008472587913274765, -0.02548862062394619, 0.02113591879606247, 0.0035783271305263042, 0.0027204395737499, 0.03320201858878136, 0.021115673705935478, -0.01451575942337513, 0.006088723428547382, -0.05980411916971207, -0.02872784249484539, -0.0322909876704216, 0.03806084766983986, 0.025144454091787338, 0.004529848229140043, 0.03957923501729965, 0.06259794533252716, 0.05907529592514038, -0.010821023024618626, -0.07883454114198685, 0.05713176354765892, 0.040915410965681076, 0.044458311051130295, -0.02583278901875019, 0.013078355230391026, 0.02773583121597767, -0.010238975286483765, 0.02148008532822132, 0.07474502921104431, 0.00839666835963726, 0.08215474337339401, -0.026865290477871895, 0.010861513204872608, -0.0009135616128332913, 0.004243885632604361, 0.019081037491559982, 0.005435817874968052, 0.03941727057099342, 0.014819436706602573, 0.02615671046078205, -0.0274321548640728, -0.034760892391204834, 0.02696651592850685, 0.00028643698897212744, 0.001967573771253228, 0.011448622681200504, 0.04247428849339485, -0.0023927215952426195, -0.006756812799721956, -0.03441672399640083, 0.001920756883919239, 0.03672466799616814, -0.031015543267130852, 0.02471930719912052, ...]</td>
<td>0.748090</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Hypertensive patient presented with higher blood pressure at 160/100. Adjusted medications and emphasized importance of diet and exercise.</td>
<td>[-0.01908160373568535, -0.007425420451909304, 0.017478106543421745, 0.0633997693657875, -0.03739846125245094, 0.0564923994243145, -0.014924848452210426, 0.03949534147977829, -0.022670967504382133, -0.008227168582379818, 0.0023235275875777006, 0.01861288957297802, -0.05338408425450325, 0.021585524082183838, 0.032809995114803314, 0.0043664430268108845, 0.05175592005252838, -0.01282796822488308, -0.01846487447619438, 0.010040352120995522, -0.01032404787838459, -0.01255044061690569, 0.03727511689066887, -0.03327871114015579, -0.01349403616040945, -0.02069743350148201, 0.026494689285755157, -0.05005374550819397, 0.042801011353731155, -0.04746348410844803, 0.04080280661582947, -0.02429913356900215, 0.025137884542346, 0.0548148974776268, -0.005189776886254549, -0.0036479535046964884, 0.0019658245146274567, -0.0015927032800391316, 0.022905325517058372, 0.0035554443020373583, -0.0008025189745239913, -0.028912268579006195, -0.020956460386514664, 0.0659160241484642, -0.03490687534213066, 0.02893693745136261, 0.017613787204027176, -0.03764515370130539, 0.0155539121478796, 0.02130182832479477, -0.019982028752565384, 0.010428891517221928, -0.023115012794733047, 0.019328294321894646, 0.03290867432951927, 0.015183874405920506, 0.03014572709798813, 0.020487746223807335, -0.007838629186153412, 0.031132493168115616, 0.014184772968292236, -0.013975084759294987, 0.022300930693745613, 0.025729944929480553, -0.04578598216176033, -0.02073443867266178, 0.015072863548994064, -0.011446495540440083, 0.03140385448932648, 0.021425174549221992, -0.014949517324566841, -0.030022380873560905, -0.030269071459770203, 0.05358143895864487, -0.0035708623472601175, -0.022892991080880165, -0.005436468403786421, -0.03009638749063015, -0.003157653845846653, 0.055308278650045395, -0.029603004455566406, -0.02204190380871296, -0.009065920487046242, 0.04381244629621506, 0.009756657294929028, -0.06902433931827545, 0.0014246446080505848, 9.824304288486019e-05, -0.005482723005115986, -0.08269105851650238, 0.0053686280734837055, 0.005710912868380547, -0.0006240529473870993, 0.004471287131309509, -0.03041708655655384, 0.003200824838131666, -0.04183891415596008, 0.03251396492123604, -0.0017438019858673215, -0.0027629469987004995, ...]</td>
<td>0.644881</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Examined patient for frequent headaches. No alarming neurological signs detected. Recommended reducing caffeine intake and keeping hydrated.</td>
<td>[-0.010823288932442665, 0.03450469672679901, -0.0003536372387316078, 0.01706509292125702, -0.033481039106845856, 0.030859481543302536, -0.00017135703819803894, 0.05228135362267494, -0.010186624713242054, 0.017614372074604034, 0.003529740497469902, 0.021334487944841385, -0.02444290742278099, 0.054828010499477386, -0.012496092356741428, -0.005037136375904083, 0.008351534605026245, -0.02938641607761383, -0.005436611827462912, 0.02893700636923313, 0.03158353269100189, 0.06366640329360962, 0.05123273283243179, 0.015329872258007526, 0.0488358773291111, 0.01000561285763979, 0.010242801159620285, -0.041695255786180496, 0.03263215348124504, -0.022308209910988808, 0.02629048004746437, -0.00510579627007246, -0.018038814887404442, 0.03467946499586105, -0.005889142397791147, 0.022645266726613045, 0.025504013523459435, -0.004253789782524109, -0.013145240023732185, -0.0078896414488554, 0.016728036105632782, -0.020210962742567062, 0.016815422102808952, 0.01926220953464508, -0.015641963109374046, -0.046139419078826904, 0.02104736492037773, -0.03822481259703636, 0.051582273095846176, 0.006853501312434673, -0.039173565804958344, 0.012858116999268532, 0.02134697139263153, 0.013245109468698502, 0.014643273316323757, -0.010473747737705708, 0.003486047964543104, -0.024005981162190437, 0.06111975014209747, 0.02057298831641674, 0.052980437874794006, -0.003170836716890335, 0.02688969485461712, 0.030260268598794937, -0.03732599318027496, -0.037800367921590805, 0.03233254700899124, -0.04114597663283348, 0.06072027608752251, -0.013956675305962563, -0.019536849111318588, 0.005062103737145662, 0.04409210756421089, 0.004054052289575338, 0.008794702589511871, -0.013170207850635052, 0.05472814291715622, -0.06970847398042679, -0.025416627526283264, 0.05397912487387657, -0.0226327832788229, 0.025591399520635605, 0.008863362483680248, 0.04014728590846062, -0.012508576735854149, -0.05412892997264862, -0.029186679050326347, -0.03198300674557686, -0.015254970639944077, -0.03430495783686638, -0.024230685085058212, 0.012764490209519863, 0.010411330498754978, 0.012957986444234848, -0.016128823161125183, -0.012021715752780437, 0.015854183584451675, 0.00357655412517488, -0.015666930004954338, 0.02527930773794651, ...]</td>
<td>0.688291</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>And that’s it! Let’s take a look at the notes in order of smallest to largest <code>cosine_dist</code>.</p>
<p>Ideally, I will see that the notes at the top of the rearranged DataFrame correspond to patients with chronic conditions, and the notes at the bottom correspond to patients with acute conditions.</p>
<p>The top 5 notes are:</p>
<div id="12207d28" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">pd.set_option(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'display.max_colwidth'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb18-2">notes_df.sort_values(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cosine_dist'</span>)[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'notes'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cosine_dist'</span>]].head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">notes</th>
<th data-quarto-table-cell-role="th">cosine_dist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">43</td>
<td>Patient with chronic bronchitis showed increasingly frequent flare-ups. Reinforced importance of smoking cessation and upgraded prescribed inhalers.</td>
<td>0.483188</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>Patient visited for follow-up on hypertension medication. Blood pressure readings stable. Emphasized continued adherence to treatment.</td>
<td>0.547638</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27</td>
<td>Patient reported persistent cough and difficulty breathing. Referred for radiological imaging to rule out pneumonia or tuberculosis.</td>
<td>0.550634</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">22</td>
<td>Patient with a history of heart disease complained of palpitations. Recommended further cardiology work-up and emphasized continued adherence to treatment.</td>
<td>0.558663</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>Chronic back pain patient showed improvement after physiotherapy. Recommended continuing sessions and daily exercises at home.</td>
<td>0.565519</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Those all seem like patients with chronic conditions to me!</p>
<p>And the bottom 5 notes are:</p>
<div id="5fc2f589" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">notes_df.sort_values(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cosine_dist'</span>)[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'notes'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cosine_dist'</span>]].tail(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">notes</th>
<th data-quarto-table-cell-role="th">cosine_dist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">39</td>
<td>Child patient presented with red, itchy eyes. Diagnosed as viral conjunctivitis. Instructed parents about proper eye care and hand hygiene.</td>
<td>0.743466</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>Patient suffered a minor burn in the kitchen. Prescribed topical ointment and advised on wound care.</td>
<td>0.745391</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>Patient presented with severe knee pain. Suspected ligament tear. Recommended MRI scan.</td>
<td>0.746433</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>Patient came in with complaints of stomachache. Upon examination, no obvious signs of appendicitis or gallstones were found. Recommended patient to undergo an ultrasound to assess internal organs.</td>
<td>0.748090</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">49</td>
<td>Patient presented with dislocated shoulder. After successful relocation, advised sling use and gentle mobility exercises for rehabilitation.</td>
<td>0.748190</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>These definitely seem like new/acute conditions!</p>
<p>If you’re interested in looking at all of the distances, see the following output (remember that the smaller the distance, the closer the note to the chronic condition target):</p>
<div id="6e83479f" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">notes_df.sort_values(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cosine_dist'</span>)[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'notes'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cosine_dist'</span>]]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">notes</th>
<th data-quarto-table-cell-role="th">cosine_dist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">43</td>
<td>Patient with chronic bronchitis showed increasingly frequent flare-ups. Reinforced importance of smoking cessation and upgraded prescribed inhalers.</td>
<td>0.483188</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>Patient visited for follow-up on hypertension medication. Blood pressure readings stable. Emphasized continued adherence to treatment.</td>
<td>0.547638</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27</td>
<td>Patient reported persistent cough and difficulty breathing. Referred for radiological imaging to rule out pneumonia or tuberculosis.</td>
<td>0.550634</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">22</td>
<td>Patient with a history of heart disease complained of palpitations. Recommended further cardiology work-up and emphasized continued adherence to treatment.</td>
<td>0.558663</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>Chronic back pain patient showed improvement after physiotherapy. Recommended continuing sessions and daily exercises at home.</td>
<td>0.565519</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>Asthmatic patient presented with increased shortness of breath. Stepped-up asthma control medication.</td>
<td>0.578419</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>Patient admitted for chronic fatigue. Bloodwork ordered to rule out anemia, thyroid disorders, and diabetes. Recommended nutritional counseling.</td>
<td>0.580687</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Patient reports difficulty sleeping. Exhibiting signs of insomnia characterized by frequent night time awakenings. Recommended a sleep study to find underlying cause.</td>
<td>0.583531</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>Patient came in for annual physical. All markers within normal limits. Encouraged to continue healthy lifestyle for prevention of non-communicable diseases.</td>
<td>0.592007</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>Patient managing COPD came in for routine check-up. Oxygen levels stable. Expressed importance of avoiding respiratory irritants.</td>
<td>0.597322</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35</td>
<td>Patient presented with swollen (oedemic) ankles. Adjusted diuretic medication dosage and recommended follow-up visit next week.</td>
<td>0.598728</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30</td>
<td>Elderly patient presented with signs of Parkinson's disease. Referred to a neurologist for specialized care and management.</td>
<td>0.601647</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">51</td>
<td>Patient complained of periodic blurry vision. Referred to ophthalmology for proper ocular examination and management.</td>
<td>0.607228</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>Patient managed for rheumatoid arthritis reported increased inflammation in joints. Adjusted medication and recommended physiotherapy for managing symptoms.</td>
<td>0.610967</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>Patient presented with severe migraine episodes. Prescribed stronger painkillers and referred to a neurologist for a complete neurological work-up.</td>
<td>0.613839</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>Patient presented with painful and swollen joints. Diagnosed as gout and recommended dietary adjustment along with pain management.</td>
<td>0.618245</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25</td>
<td>Elderly patient with a history of diabetes complained of numbness in feet. Diagnosed peripheral neuropathy, referred to podiatrist for further management.</td>
<td>0.619704</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>Elderly patient exhibited signs of Alzheimer's. Informed family and referred to neurology specialist for comprehensive management.</td>
<td>0.619889</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>Patient presented with chest pain. Preliminary assessment ruled out heart conditions. Recommended gastroenterology consult to check for possible reflux disease.</td>
<td>0.625152</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">46</td>
<td>Patient with anxiety showed improvement with recent medication schedule. Encouraged continued therapy and stress management techniques.</td>
<td>0.626963</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>Patient reports persistent vertigo. Referred to an Ear, Nose, and Throat (ENT) specialist for detailed evaluation to rule out Meniere's disease.</td>
<td>0.628280</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">42</td>
<td>Patient reported sleep apnea symptoms. Advised to undergo a sleep study, prescribed initial treatment using CPAP device at night during sleep.</td>
<td>0.636255</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>Child patient presented with symptoms of ADHD. Referred to pediatric psychiatrist for cognitive and behavioral evaluation plus treatment.</td>
<td>0.636682</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">44</td>
<td>Patient with history of stroke presented with dizziness. Follow-up brain scan scheduled to rule out recurrence.</td>
<td>0.637395</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>Patient came in for weight management consultation. Diet plan adjusted and encouraged increased physical activity.</td>
<td>0.639904</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Hypertensive patient presented with higher blood pressure at 160/100. Adjusted medications and emphasized importance of diet and exercise.</td>
<td>0.644881</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>Historically anxious patient reported increased panic attacks recently. Referred to psychiatrist for therapeutic support, prescribed low-dose anxiolytic.</td>
<td>0.645849</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>Patient reported feeling low, indicating depression. Counseled and referred to mental health services for further treatment and support.</td>
<td>0.647704</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>Elderly patient with poor vision due to cataracts. Scheduled for ophthalmology consultation.</td>
<td>0.648220</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38</td>
<td>Patient with history of irritable bowel syndrome showed signs of relief with diet modification. Reinforced importance of hydration and fiber intake.</td>
<td>0.657894</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>Teenage patient came in with signs of acne. Prescribed topical retinoid and advised consistent skin care routine.</td>
<td>0.658439</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Patient returned for post-operative wound check. Incision healing well with no signs of infection. Advised continued wound care protocol and scheduled follow-up in a week.</td>
<td>0.660693</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Arthritic patient reports increased joint pain. Advised gentle physical therapy and adjustment of pain medication.</td>
<td>0.661807</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>Patient presented with signs of depression. Recommended seeking a psychologist for cognitive behavioral therapy and prescribed low dose antidepressant.</td>
<td>0.666589</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>Elderly patient with hearing difficulty. Scheduled an appointment for audiology consultation and potential hearing aids.</td>
<td>0.667571</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>Routine consultation with patient managing type II diabetes. Blood glucose levels fairly controlled. Advised to keep monitoring sugar levels and follow diet regimen.</td>
<td>0.669839</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>Patient has concerning mole on the back. Scheduled for dermatology consult to rule out potential skin cancer.</td>
<td>0.675400</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>Patient suffering from high fevers and weight loss. Ordered comprehensive bloodwork to assess for possible infectious disease.</td>
<td>0.676904</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">53</td>
<td>Patient presented with signs of Bell's Palsy. Referred to neurologist and prescribed corticosteroid medication to reduce inflammation.</td>
<td>0.682327</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Examined patient for frequent headaches. No alarming neurological signs detected. Recommended reducing caffeine intake and keeping hydrated.</td>
<td>0.688291</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50</td>
<td>Pregnant patient at full term demonstrated normal signs. Advised to prepare for labor and familiarize with signs of onset.</td>
<td>0.696364</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>Patient presented signs of common cold; symptoms include a runny nose and mild fever. Advised rest, hydration, and over-the-counter medication to manage symptoms.</td>
<td>0.697187</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">33</td>
<td>Pregnant patient showed normal progression in second trimester. Advised rest, proper nutrition and regular exercise.</td>
<td>0.702353</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>Type 1 diabetic patient showed increased blood sugar levels. Insulin doses were adjusted, advised dietary check.</td>
<td>0.707895</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>Patient showed symptoms of urinary tract infection. Collected sample for testing and started preliminary antibiotic treatment.</td>
<td>0.710449</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Patient presented with symptoms of influenza including fever, cough, and body aches. Prescribed antiviral medication and recommended rest and plenty of fluids.</td>
<td>0.715153</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">23</td>
<td>Post-surgical patient reported redness and discomfort around stitches. Diagnosed with a mild post-operative infection. Prescribed antibiotics and wound care guidance.</td>
<td>0.726964</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>Rash observed on patient's arm. Allergenic contact dermatitis suspected. Prescribed topical steroid and recommended patch test.</td>
<td>0.730986</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>Postnatal patient showed healthy recovery from C-section. Wound healing well without signs of infection.</td>
<td>0.742733</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>Child patient presented with red, itchy eyes. Diagnosed as viral conjunctivitis. Instructed parents about proper eye care and hand hygiene.</td>
<td>0.743466</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>Patient suffered a minor burn in the kitchen. Prescribed topical ointment and advised on wound care.</td>
<td>0.745391</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>Patient presented with severe knee pain. Suspected ligament tear. Recommended MRI scan.</td>
<td>0.746433</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Patient came in with complaints of stomachache. Upon examination, no obvious signs of appendicitis or gallstones were found. Recommended patient to undergo an ultrasound to assess internal organs.</td>
<td>0.748090</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>Patient presented with dislocated shoulder. After successful relocation, advised sling use and gentle mobility exercises for rehabilitation.</td>
<td>0.748190</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>It definitely seems like it did a pretty good job here (although to be fair, OpenAI did all the hard lifting!)</p>
</section>
<section id="zero-shot-binary-classification" class="level2">
<h2 class="anchored" data-anchor-id="zero-shot-binary-classification">Zero-shot Binary classification</h2>
<p>The above approach provides each doctor’s note with a score (cosine distance) relative to a target (<em>“Patient presenting with ongoing chronic condition defined as ongoing for more than one month”</em>). But if I wanted to use this to create a binary label, I would need to come up with a threshold so that everyone whose cosine distance to the target is below, say 0.6, is classified as “presenting with a chronic condition”, in which case, everyone whose cosine distance to the target is above 0.6 is classified as “presenting with an acute condition”.</p>
<p>That approach sounds okay, but it turns out that there’s a (hypothetically) better way.</p>
<p>Instead of just computing the distance to a single target, I can compute two distances for each doctor’s note:</p>
<ol type="1">
<li><p>the distance to a positive label (corresponding to the original target: <em>“Patient presenting with ongoing chronic condition defined as ongoing for more than one month”</em>)</p></li>
<li><p>the distance to a negative label (<em>“Patient presenting with acute or new condition”</em>)</p></li>
</ol>
<p>Then, each note is classified based on which label text its embedding is closest to.</p>
<p>The code for doing this is very similar to the code above.</p>
<p>Fortunately, I don’t need to recompute the embeddings for the notes, but I do need to compute the embedding for the new negative label.</p>
<div id="2e7d35b3" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb21-2">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Patient presenting with ongoing chronic condition defined as ongoing for more than one month'</span>,</span>
<span id="cb21-3">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Patient presenting with acute or new condition'</span></span>
<span id="cb21-4">]</span>
<span id="cb21-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute embedding of the labels</span></span>
<span id="cb21-6">label_embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [get_embedding(label) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> label <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> labels]</span></code></pre></div>
</div>
<p>Then I need to compute the difference between the cosine distance to the first label and the cosine distance to the second label (to determine which label the note is closest to).</p>
<div id="07a57747" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compute the difference in the cosine distances to the two labels for each note</span></span>
<span id="cb22-2">notes_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cosine_score_binary'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [cosine(x, label_embeddings[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> cosine(x, label_embeddings[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> notes_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'embedding'</span>]]</span></code></pre></div>
</div>
<p>I have saved this <code>cosine_score_binary</code> in a new column in the DataFrame:</p>
<div id="c320562d" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">notes_df[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'notes'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cosine_score_binary'</span>]].head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">notes</th>
<th data-quarto-table-cell-role="th">cosine_score_binary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Patient presented signs of common cold; symptoms include a runny nose and mild fever. Advised rest, hydration, and over-the-counter medication to manage symptoms.</td>
<td>-0.097242</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Patient reports difficulty sleeping. Exhibiting signs of insomnia characterized by frequent night time awakenings. Recommended a sleep study to find underlying cause.</td>
<td>0.061629</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Patient came in with complaints of stomachache. Upon examination, no obvious signs of appendicitis or gallstones were found. Recommended patient to undergo an ultrasound to assess internal organs.</td>
<td>-0.074738</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Hypertensive patient presented with higher blood pressure at 160/100. Adjusted medications and emphasized importance of diet and exercise.</td>
<td>-0.009268</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Examined patient for frequent headaches. No alarming neurological signs detected. Recommended reducing caffeine intake and keeping hydrated.</td>
<td>-0.013830</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>A positive <code>cosine_score_binary</code> value means that the note is closer to the first label, <em>“Patient presenting with ongoing chronic condition defined as ongoing for more than one month”</em> (i.e., the distance to the second label is greater than the distance to the first label), and a negative value means that the note is closer to the second label, <em>“Patient presenting with acute or new condition”</em>.</p>
<p>I can use this to create a binary classification for each note.</p>
<div id="ec23a536" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">notes_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chronic_assessment'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chronic'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'acute'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> score <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> notes_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cosine_score_binary'</span>]]</span></code></pre></div>
</div>
<p>Then I can view the results in descending order of the <code>cosine_score_binary</code> so that the first notes are those that are deemed most <em>chronic</em> and least <em>acute</em>:</p>
<div id="4a2a2395" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">notes_df[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'notes'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cosine_score_binary'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'chronic_assessment'</span>]].sort_values(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cosine_score_binary'</span>, ascending<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">notes</th>
<th data-quarto-table-cell-role="th">cosine_score_binary</th>
<th data-quarto-table-cell-role="th">chronic_assessment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>Chronic back pain patient showed improvement after physiotherapy. Recommended continuing sessions and daily exercises at home.</td>
<td>0.110414</td>
<td>chronic</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>Patient with chronic bronchitis showed increasingly frequent flare-ups. Reinforced importance of smoking cessation and upgraded prescribed inhalers.</td>
<td>0.091766</td>
<td>chronic</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>Patient visited for follow-up on hypertension medication. Blood pressure readings stable. Emphasized continued adherence to treatment.</td>
<td>0.081715</td>
<td>chronic</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Patient reports difficulty sleeping. Exhibiting signs of insomnia characterized by frequent night time awakenings. Recommended a sleep study to find underlying cause.</td>
<td>0.061629</td>
<td>chronic</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Routine consultation with patient managing type II diabetes. Blood glucose levels fairly controlled. Advised to keep monitoring sugar levels and follow diet regimen.</td>
<td>0.055009</td>
<td>chronic</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>Patient admitted for chronic fatigue. Bloodwork ordered to rule out anemia, thyroid disorders, and diabetes. Recommended nutritional counseling.</td>
<td>0.053559</td>
<td>chronic</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">51</td>
<td>Patient complained of periodic blurry vision. Referred to ophthalmology for proper ocular examination and management.</td>
<td>0.049252</td>
<td>chronic</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Patient came in for annual physical. All markers within normal limits. Encouraged to continue healthy lifestyle for prevention of non-communicable diseases.</td>
<td>0.045713</td>
<td>chronic</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25</td>
<td>Elderly patient with a history of diabetes complained of numbness in feet. Diagnosed peripheral neuropathy, referred to podiatrist for further management.</td>
<td>0.037681</td>
<td>chronic</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>Patient managing COPD came in for routine check-up. Oxygen levels stable. Expressed importance of avoiding respiratory irritants.</td>
<td>0.035781</td>
<td>chronic</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27</td>
<td>Patient reported persistent cough and difficulty breathing. Referred for radiological imaging to rule out pneumonia or tuberculosis.</td>
<td>0.030508</td>
<td>chronic</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>Patient reports persistent vertigo. Referred to an Ear, Nose, and Throat (ENT) specialist for detailed evaluation to rule out Meniere's disease.</td>
<td>0.028819</td>
<td>chronic</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>Patient managed for rheumatoid arthritis reported increased inflammation in joints. Adjusted medication and recommended physiotherapy for managing symptoms.</td>
<td>0.026801</td>
<td>chronic</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30</td>
<td>Elderly patient presented with signs of Parkinson's disease. Referred to a neurologist for specialized care and management.</td>
<td>0.019938</td>
<td>chronic</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>Patient returned for post-operative wound check. Incision healing well with no signs of infection. Advised continued wound care protocol and scheduled follow-up in a week.</td>
<td>0.018720</td>
<td>chronic</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">42</td>
<td>Patient reported sleep apnea symptoms. Advised to undergo a sleep study, prescribed initial treatment using CPAP device at night during sleep.</td>
<td>0.014099</td>
<td>chronic</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>Patient with a history of heart disease complained of palpitations. Recommended further cardiology work-up and emphasized continued adherence to treatment.</td>
<td>0.009364</td>
<td>chronic</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>Elderly patient exhibited signs of Alzheimer's. Informed family and referred to neurology specialist for comprehensive management.</td>
<td>0.007949</td>
<td>chronic</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>Asthmatic patient presented with increased shortness of breath. Stepped-up asthma control medication.</td>
<td>0.002814</td>
<td>chronic</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">32</td>
<td>Patient came in for weight management consultation. Diet plan adjusted and encouraged increased physical activity.</td>
<td>0.001463</td>
<td>chronic</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">33</td>
<td>Pregnant patient showed normal progression in second trimester. Advised rest, proper nutrition and regular exercise.</td>
<td>0.000649</td>
<td>chronic</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>Elderly patient with poor vision due to cataracts. Scheduled for ophthalmology consultation.</td>
<td>-0.000179</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>Teenage patient came in with signs of acne. Prescribed topical retinoid and advised consistent skin care routine.</td>
<td>-0.000709</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>Patient presented with painful and swollen joints. Diagnosed as gout and recommended dietary adjustment along with pain management.</td>
<td>-0.004671</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>Patient has concerning mole on the back. Scheduled for dermatology consult to rule out potential skin cancer.</td>
<td>-0.007328</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Hypertensive patient presented with higher blood pressure at 160/100. Adjusted medications and emphasized importance of diet and exercise.</td>
<td>-0.009268</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>Patient with history of irritable bowel syndrome showed signs of relief with diet modification. Reinforced importance of hydration and fiber intake.</td>
<td>-0.011980</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Examined patient for frequent headaches. No alarming neurological signs detected. Recommended reducing caffeine intake and keeping hydrated.</td>
<td>-0.013830</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>Patient presented with severe migraine episodes. Prescribed stronger painkillers and referred to a neurologist for a complete neurological work-up.</td>
<td>-0.015010</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">52</td>
<td>Elderly patient with hearing difficulty. Scheduled an appointment for audiology consultation and potential hearing aids.</td>
<td>-0.015633</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">45</td>
<td>Patient reported feeling low, indicating depression. Counseled and referred to mental health services for further treatment and support.</td>
<td>-0.018623</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>Patient presented with swollen (oedemic) ankles. Adjusted diuretic medication dosage and recommended follow-up visit next week.</td>
<td>-0.020730</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">47</td>
<td>Type 1 diabetic patient showed increased blood sugar levels. Insulin doses were adjusted, advised dietary check.</td>
<td>-0.020986</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>Rash observed on patient's arm. Allergenic contact dermatitis suspected. Prescribed topical steroid and recommended patch test.</td>
<td>-0.030286</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>Postnatal patient showed healthy recovery from C-section. Wound healing well without signs of infection.</td>
<td>-0.032995</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>Arthritic patient reports increased joint pain. Advised gentle physical therapy and adjustment of pain medication.</td>
<td>-0.033021</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>Child patient presented with symptoms of ADHD. Referred to pediatric psychiatrist for cognitive and behavioral evaluation plus treatment.</td>
<td>-0.038751</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>Patient presented with signs of Bell's Palsy. Referred to neurologist and prescribed corticosteroid medication to reduce inflammation.</td>
<td>-0.042732</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>Patient with anxiety showed improvement with recent medication schedule. Encouraged continued therapy and stress management techniques.</td>
<td>-0.048093</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">44</td>
<td>Patient with history of stroke presented with dizziness. Follow-up brain scan scheduled to rule out recurrence.</td>
<td>-0.053002</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>Patient presented with signs of depression. Recommended seeking a psychologist for cognitive behavioral therapy and prescribed low dose antidepressant.</td>
<td>-0.057786</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>Patient suffering from high fevers and weight loss. Ordered comprehensive bloodwork to assess for possible infectious disease.</td>
<td>-0.059315</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>Patient suffered a minor burn in the kitchen. Prescribed topical ointment and advised on wound care.</td>
<td>-0.062896</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>Post-surgical patient reported redness and discomfort around stitches. Diagnosed with a mild post-operative infection. Prescribed antibiotics and wound care guidance.</td>
<td>-0.068201</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Patient came in with complaints of stomachache. Upon examination, no obvious signs of appendicitis or gallstones were found. Recommended patient to undergo an ultrasound to assess internal organs.</td>
<td>-0.074738</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>Child patient presented with red, itchy eyes. Diagnosed as viral conjunctivitis. Instructed parents about proper eye care and hand hygiene.</td>
<td>-0.077558</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>Patient presented with chest pain. Preliminary assessment ruled out heart conditions. Recommended gastroenterology consult to check for possible reflux disease.</td>
<td>-0.080826</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>Patient presented with severe knee pain. Suspected ligament tear. Recommended MRI scan.</td>
<td>-0.081825</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>Historically anxious patient reported increased panic attacks recently. Referred to psychiatrist for therapeutic support, prescribed low-dose anxiolytic.</td>
<td>-0.083702</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>Patient presented with dislocated shoulder. After successful relocation, advised sling use and gentle mobility exercises for rehabilitation.</td>
<td>-0.091579</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Patient presented signs of common cold; symptoms include a runny nose and mild fever. Advised rest, hydration, and over-the-counter medication to manage symptoms.</td>
<td>-0.097242</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Patient presented with symptoms of influenza including fever, cough, and body aches. Prescribed antiviral medication and recommended rest and plenty of fluids.</td>
<td>-0.100791</td>
<td>acute</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>Patient showed symptoms of urinary tract infection. Collected sample for testing and started preliminary antibiotic treatment.</td>
<td>-0.101196</td>
<td>acute</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50</td>
<td>Pregnant patient at full term demonstrated normal signs. Advised to prepare for labor and familiarize with signs of onset.</td>
<td>-0.101702</td>
<td>acute</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>While the results aren’t perfect, they’re certainly pretty impressive! Especially given how little code we had to write to achieve it!</p>
<p>Hopefully, this tutorial has given you some ideas to try in your own work. But keep in mind that this is a rapidly evolving field, and the specific pieces of code used here may or may not work in the future as things continue to shift.</p>


</section>

 ]]></description>
  <category>data science</category>
  <category>generative AI</category>
  <category>ChatGPT</category>
  <category>OpenAI</category>
  <category>machine learning</category>
  <guid>https://www.rebeccabarter.com/blog/2024-04-11-labeling_doctors_notes.html</guid>
  <pubDate>Thu, 11 Apr 2024 07:00:00 GMT</pubDate>
  <media:content url="https://www.rebeccabarter.com/blog/img/openai_ehr/doctors_notes_ai.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>An introduction to Python for R Users</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2023-09-11-from_r_to_python.html</link>
  <description><![CDATA[ 





<p><img src="https://www.rebeccabarter.com/blog/img/python/rubaitul-azad-ZIPFteu-R8k-unsplash.jpg" class="img-fluid" alt="The python logo on a floating disc"></p>
<p>I have a confession to make: I am now a Python user. To be fair, I’ve used Python here and there over the years, but it was never my primary language (that has always been R). This year was the first time I had to actually sit down and really <em>use</em> Python for real projects. In fact, not only did I have to use Python, but I also had to <em>teach</em> Python. For those of you who teach, you’ll know that the best way to make sure you know something really well is to teach it. The end result is that I now consider myself a Python user. (But don’t worry, I’m still an R Lady at heart.)</p>
<p>Why did I decide to learn Python? I’ve been using R my whole data science life, and while I still think that R (with the tidyverse) is still the best language for data wrangling and data visualization, there is no denying that as a data scientist these days, Python is a required skill. If you’re doing machine learning, Python is still light-years ahead of R. If you’re working with software engineers, they’re going to be much happier working with you if you use Python. If you’re looking for a job, you’re going to be much more employable if you’re already comfortable with Python.</p>
<p>While there are certainly similarities between R and Python, don’t assume that knowing how to use one will automatically mean that you know how to use the other. That said, already knowing R does mean that the learning curve for learning Python won’t be too steep (but it will still take a few months of regular use to reach competence).</p>
<p>In this post, I’m going to introduce you to the world of data analysis with Python from an R perspective. Obviously this post won’t be exhaustive, but if you’re a tidyverse R user who is looking to learn Python, this post can hopefully serve as a helpful launching point and will provide some relatable context on your Python journey.</p>
<p>Note that this blog post will focus on <em>working with data</em> in Python using <strong>pandas</strong>. I won’t be talking too much about things like SciPy, arrays, or scikit-learn here.</p>
<section id="helpful-resources" class="level2">
<h2 class="anchored" data-anchor-id="helpful-resources">Helpful resources</h2>
<p>There are a lot of resources out there for learning Python. The one that I found most useful was Wes McKinney’s <a href="https://wesmckinney.com/book/">Python for Data Analysis</a> book (Wes is the creator of pandas). There is a lot of information in there, and to be fair, you can skip a lot of it when you’re starting out (like the stuff about sets, tuples, and arrays). These are important things to know about to be a well-rounded Python programmer, but for just doing simple data analysis with pandas data frames, these needn’t be the focus.</p>
</section>
<section id="installing-python-and-vs-code" class="level2">
<h2 class="anchored" data-anchor-id="installing-python-and-vs-code">Installing Python and VS Code</h2>
<p>Managing Python installations on my computer used to give me a headache. While I used to use Python in Jupyter notebooks via the Jupyter notebook IDE installed using anaconda, I’ve found that the simplest approach to getting Python up and running is now to <a href="https://www.python.org/downloads/">install the latest version of Python directly from the python website</a> and <a href="https://code.visualstudio.com/">install the Visual Studio Code IDE</a>. Then you can select your preferred python installation within VS code and you’re good to go. (You might want to watch a couple of YouTube videos to get started with VS code if you’ve never seen it before. It definitely took me a minute to orient myself.)</p>
<section id="jupyter-notebooks" class="level3">
<h3 class="anchored" data-anchor-id="jupyter-notebooks">Jupyter notebooks</h3>
<p>While, these days, you can use Python together with quarto within RStudio, this isn’t really what Python users do (yet…). So if you want to fit in with the cool Python kids, I’d recommend working with Jupyter notebooks (.ipynb files) <em>in the Visual Studio Code IDE</em>. You can install a jupyter notebook extension within the VS Code IDE (fortunately, there is <em>no need</em> to install jupyter notebooks or anaconda separately).</p>
</section>
</section>
<section id="libraries" class="level2">
<h2 class="anchored" data-anchor-id="libraries">Libraries</h2>
<p>Like R, Python is mostly useful for data science because of the add-on libraries that some very smart people wrote to help us work with data. The main python libraries you’ll need to start with are <em>NumPy</em> and <em>pandas</em>.</p>
<section id="installing-libraries" class="level3">
<h3 class="anchored" data-anchor-id="installing-libraries">Installing libraries</h3>
<p>Like with R, you need to install a library before you can use it.</p>
<p>There are many ways to install python libraries, but if you installed python in the same way that I did above, the way that I usually install libraries is in the <em>terminal on my computer</em>, where I write:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">python3</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> pip install pandas</span></code></pre></div>
</div>
<p>which will install the pandas library, for example. You may have a different preferred way of installing python libraries. That’s fine. Your way is probably better than mine.</p>
</section>
<section id="loading-libraries" class="level3">
<h3 class="anchored" data-anchor-id="loading-libraries">Loading libraries</h3>
<p>One difference between R and Python is that once you have loaded a package into R, you can use the functions from the package without having to specify which library the package comes from every time you use it like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># I can use `filter()` from dplyr without having to specify that it comes from dplyr</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(iris, Species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"virginica"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
1           6.3         3.3          6.0         2.5 virginica
2           5.8         2.7          5.1         1.9 virginica
3           7.1         3.0          5.9         2.1 virginica
4           6.3         2.9          5.6         1.8 virginica
5           6.5         3.0          5.8         2.2 virginica
6           7.6         3.0          6.6         2.1 virginica
7           4.9         2.5          4.5         1.7 virginica
8           7.3         2.9          6.3         1.8 virginica
9           6.7         2.5          5.8         1.8 virginica
10          7.2         3.6          6.1         2.5 virginica
11          6.5         3.2          5.1         2.0 virginica
12          6.4         2.7          5.3         1.9 virginica
13          6.8         3.0          5.5         2.1 virginica
14          5.7         2.5          5.0         2.0 virginica
15          5.8         2.8          5.1         2.4 virginica
16          6.4         3.2          5.3         2.3 virginica
17          6.5         3.0          5.5         1.8 virginica
18          7.7         3.8          6.7         2.2 virginica
19          7.7         2.6          6.9         2.3 virginica
20          6.0         2.2          5.0         1.5 virginica
21          6.9         3.2          5.7         2.3 virginica
22          5.6         2.8          4.9         2.0 virginica
23          7.7         2.8          6.7         2.0 virginica
24          6.3         2.7          4.9         1.8 virginica
25          6.7         3.3          5.7         2.1 virginica
26          7.2         3.2          6.0         1.8 virginica
27          6.2         2.8          4.8         1.8 virginica
28          6.1         3.0          4.9         1.8 virginica
29          6.4         2.8          5.6         2.1 virginica
30          7.2         3.0          5.8         1.6 virginica
31          7.4         2.8          6.1         1.9 virginica
32          7.9         3.8          6.4         2.0 virginica
33          6.4         2.8          5.6         2.2 virginica
34          6.3         2.8          5.1         1.5 virginica
35          6.1         2.6          5.6         1.4 virginica
36          7.7         3.0          6.1         2.3 virginica
37          6.3         3.4          5.6         2.4 virginica
38          6.4         3.1          5.5         1.8 virginica
39          6.0         3.0          4.8         1.8 virginica
40          6.9         3.1          5.4         2.1 virginica
41          6.7         3.1          5.6         2.4 virginica
42          6.9         3.1          5.1         2.3 virginica
43          5.8         2.7          5.1         1.9 virginica
44          6.8         3.2          5.9         2.3 virginica
45          6.7         3.3          5.7         2.5 virginica
46          6.7         3.0          5.2         2.3 virginica
47          6.3         2.5          5.0         1.9 virginica
48          6.5         3.0          5.2         2.0 virginica
49          6.2         3.4          5.4         2.3 virginica
50          5.9         3.0          5.1         1.8 virginica</code></pre>
</div>
</div>
<p>I could choose to explicitly specify that <code>filter()</code> comes from dplyr using <code>::</code> like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># I can explicitly specify that `filter()` comes from dplyr using `::`</span></span>
<span id="cb5-2">dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(iris, Species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"virginica"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
1           6.3         3.3          6.0         2.5 virginica
2           5.8         2.7          5.1         1.9 virginica
3           7.1         3.0          5.9         2.1 virginica
4           6.3         2.9          5.6         1.8 virginica
5           6.5         3.0          5.8         2.2 virginica
6           7.6         3.0          6.6         2.1 virginica
7           4.9         2.5          4.5         1.7 virginica
8           7.3         2.9          6.3         1.8 virginica
9           6.7         2.5          5.8         1.8 virginica
10          7.2         3.6          6.1         2.5 virginica
11          6.5         3.2          5.1         2.0 virginica
12          6.4         2.7          5.3         1.9 virginica
13          6.8         3.0          5.5         2.1 virginica
14          5.7         2.5          5.0         2.0 virginica
15          5.8         2.8          5.1         2.4 virginica
16          6.4         3.2          5.3         2.3 virginica
17          6.5         3.0          5.5         1.8 virginica
18          7.7         3.8          6.7         2.2 virginica
19          7.7         2.6          6.9         2.3 virginica
20          6.0         2.2          5.0         1.5 virginica
21          6.9         3.2          5.7         2.3 virginica
22          5.6         2.8          4.9         2.0 virginica
23          7.7         2.8          6.7         2.0 virginica
24          6.3         2.7          4.9         1.8 virginica
25          6.7         3.3          5.7         2.1 virginica
26          7.2         3.2          6.0         1.8 virginica
27          6.2         2.8          4.8         1.8 virginica
28          6.1         3.0          4.9         1.8 virginica
29          6.4         2.8          5.6         2.1 virginica
30          7.2         3.0          5.8         1.6 virginica
31          7.4         2.8          6.1         1.9 virginica
32          7.9         3.8          6.4         2.0 virginica
33          6.4         2.8          5.6         2.2 virginica
34          6.3         2.8          5.1         1.5 virginica
35          6.1         2.6          5.6         1.4 virginica
36          7.7         3.0          6.1         2.3 virginica
37          6.3         3.4          5.6         2.4 virginica
38          6.4         3.1          5.5         1.8 virginica
39          6.0         3.0          4.8         1.8 virginica
40          6.9         3.1          5.4         2.1 virginica
41          6.7         3.1          5.6         2.4 virginica
42          6.9         3.1          5.1         2.3 virginica
43          5.8         2.7          5.1         1.9 virginica
44          6.8         3.2          5.9         2.3 virginica
45          6.7         3.3          5.7         2.5 virginica
46          6.7         3.0          5.2         2.3 virginica
47          6.3         2.5          5.0         1.9 virginica
48          6.5         3.0          5.2         2.0 virginica
49          6.2         3.4          5.4         2.3 virginica
50          5.9         3.0          5.1         1.8 virginica</code></pre>
</div>
</div>
<p>But I don’t need to.</p>
<p>In Python, however, you <em>do</em> need to specify which library the functions you are using come from, even after importing them. This is why every time you import a python library, you should give it a nickname so you don’t have to type out the entire library name each time you want to use a function from it. Fortunately, there are some generally agreed-upon nicknames that everyone uses. E.g. pandas’ nickname is “pd”, and NumPy’s nickname is “np”. (In Python people usually say ‘library’ instead of ‘package’.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb7-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb7-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span></code></pre></div>
</div>
<p>So to use a function from the NumPy library, such as <code>log()</code>, you need to first specify the library nickname and then the function name, separated by a dot: <code>np.log()</code>. The following code will compute the logarithm of 7 using the <code>log()</code> function from the NumPy library whose nickname is <code>np</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">np.log(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1.9459101490553132</code></pre>
</div>
</div>
<p>That’s another thing about Python: common mathematical functions like <code>log()</code>, <code>sqrt()</code>, and <code>exp()</code> all need to be imported from the NumPy library (unlike in R, where “native” versions of these functions exist).</p>
</section>
</section>
<section id="pandas-data-frames" class="level2">
<h2 class="anchored" data-anchor-id="pandas-data-frames">Pandas data frames</h2>
<p>In R, the building block of data science is the data frame. In Python, the building block of data science is also the DataFrame (but they spell it as one word with camel case). While R contains a native data frame, python’s DataFrame comes from the “pandas” library (whose nickname is “pd”).</p>
<p>In R, we can create a toy data frame like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">r_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb10-2">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>))</span>
<span id="cb10-3">r_df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  a b
1 1 5
2 2 6
3 3 7
4 4 8</code></pre>
</div>
</div>
<p>And in Python, we can create a toy DataFrame like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">pandas_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>], </span>
<span id="cb12-2">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>]})</span>
<span id="cb12-3">pandas_df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   a  b
0  1  5
1  2  6
2  3  7
3  4  8</code></pre>
</div>
</div>
<p>In the R version above we provided <em>two</em> arguments to the <code>data.frame()</code> function, each of which contained an R vector (<code>c(1, 2, 3, 4)</code> and <code>c(5, 6, 7, 8)</code>) of the values that will form a column. The syntax for the python version, however, involves a <em>single argument</em> corresponding to a type of object called a <strong>dictionary</strong> (a dictionary is defined with curly brackets) whose named entries each contain a python <strong>list</strong> (<code>[1,2,3,4]</code> and <code>[5,6,7,8]</code>) of the values that will form a column.</p>
<section id="lists-in-python" class="level3">
<h3 class="anchored" data-anchor-id="lists-in-python">Lists in python</h3>
<p>A <strong>list</strong> in python is actually a lot like a list in R, in that it can contain a variety of object types. Lists in python are created using square brackets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">my_py_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>,[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]]</span>
<span id="cb14-2">my_py_list</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1, 'a', [3, 4]]</code></pre>
</div>
</div>
<p>Note that in general, python users tend to use fewer spaces than R users, assignment is always done with <code>=</code> (there is no <code>&lt;-</code> operator in python), and there is a general preference for single quotes <code>'</code> over double quotes <code>"</code> (though I might have imagined that one).</p>
<p>You can change the first entry of a python list similarly to how you would do it in R, except that <strong>python uses zero-indexing</strong>, which means that the first entry is in position 0, the second entry is in position 1, and so on:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">my_py_list[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">my_py_list[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one"</span></span>
<span id="cb18-2">my_py_list</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['one', 'a', [3, 4]]</code></pre>
</div>
</div>
</section>
<section id="dictionaries" class="level3">
<h3 class="anchored" data-anchor-id="dictionaries">Dictionaries</h3>
<p>A dictionary is kind of like a named list. In the example below, both of the entries in the dictionary are themselves lists:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">my_py_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>: [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Jane'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Joe'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Jerry'</span>],</span>
<span id="cb20-2">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'age'</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>]}</span>
<span id="cb20-3">my_py_dict</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'name': ['Jane', 'Joe', 'Jerry'], 'age': [13, 15, 12]}</code></pre>
</div>
</div>
<p>But while you cannot extract positional entries from it (<code>my_py_dict[0]</code> won’t work), you can extract named entries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1">my_py_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Jane', 'Joe', 'Jerry']</code></pre>
</div>
</div>
<p>I can extract the first (position 0) entry from the <code>name</code> dict entry of <code>my_py_dict</code> as you would expect:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">my_py_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'Jane'</code></pre>
</div>
</div>
<p>This is all super exciting, I’m sure, but I should probably point out that pretty much the only time I ever really use dictionaries is when I’m defining pandas DataFrames on the fly like I did above.</p>
</section>
<section id="column-and-row-indexing" class="level3">
<h3 class="anchored" data-anchor-id="column-and-row-indexing">Column and row Indexing</h3>
<p>While both the R and python/pandas data frame have column names, the way you extract them is different.</p>
<p>To extract the column names from the R data frame, we would use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print the R column names</span></span>
<span id="cb26-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(r_df)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a" "b"</code></pre>
</div>
</div>
<p>However, to extract the column names (or column <em>index</em>) from the pandas data frame, we use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print the pandas column names</span></span>
<span id="cb28-2">pandas_df.columns</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['a', 'b'], dtype='object')</code></pre>
</div>
</div>
<p>The output of which is an “index” type object.</p>
<p>There are two main uses of the syntax <code>object.xyz</code>. The first, which is being used here, is used to extract an “attribute” <code>xyz</code> from an object (e.g., here we are extracting the <code>columns</code> attribute from the <code>pandas_df</code> DataFrame object).</p>
<p>Another “attribute” that you can extract from a DataFrame is the shape (which is equivalent to <code>dim()</code> in R):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1">pandas_df.shape</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(4, 2)</code></pre>
</div>
</div>
<p>The <code>shape</code> output here has a “tuple” type (I won’t go into tuples here because I’m afraid of them).</p>
<p>Another important attribute of a DataFrame is its row index:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1">pandas_df.index</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RangeIndex(start=0, stop=4, step=1)</code></pre>
</div>
</div>
<p>This is a “RangeIndex” object that spans from 0 to 4 (<em>not inclusive</em>) with a step-size of 1 and corresponds to the row index of the DataFrame.</p>
<p>Both the column and row indexes of pandas DataFrames are special index objects that can be coerced to a python list using <code>list()</code> (which is a function in python for creating lists).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(pandas_df.index)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0, 1, 2, 3]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(pandas_df.columns)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['a', 'b']</code></pre>
</div>
</div>
<p>Whenever python objects display weirdly, I try and convert them to something simpler, like a list, to see what they actually contain. Sometimes I even succeed.</p>
</section>
<section id="methods" class="level3">
<h3 class="anchored" data-anchor-id="methods">Methods</h3>
<p>Extracting attributes is not the only use of the <code>object.xyz</code> dot syntax. Similar syntax also lets you apply object-specific <em>functions</em> to the object using the <code>object.fun()</code> dot syntax.</p>
<p>Note that functions that are applied using the <code>object.fun()</code> (syntax where the function name comes after the dot) are called <strong>methods</strong>. These are functions that are specific to the type of object it is being applied to.</p>
<p>For example, we can apply the <code>mean()</code> and <code>sum()</code> DataFrame <em>methods</em> to our <code>pandas_df</code> DataFrame object to compute the mean and sum of each column in the data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1">pandas_df.mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>a    2.5
b    6.5
dtype: float64</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1">pandas_df.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>a    10
b    26
dtype: int64</code></pre>
</div>
</div>
<p>Note that the output of these functions are pandas “Series” type objects, which is like a single column of a data frame. More on Series’ objects below.</p>
<p>It is important to note that these <code>mean()</code> and <code>sum()</code> methods are not standalone functions. If we try to apply them to our DataFrame as we would do for regular functions, we get errors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1">mean(pandas_df)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NameError: name 'mean' is not defined</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(pandas_df)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TypeError: unsupported operand type(s) for +: 'int' and 'str'</code></pre>
</div>
</div>
<p>Since they are “methods”, these <code>mean()</code> and <code>sum()</code> method functions are specific to the DataFrame type object and must be applied using the <code>pandas_df.fun()</code> dot syntax.</p>
<p>Moreover, since these method functions are specific to DataFrame objects, they also won’t work on non-DataFrame objects, including lists:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1">py_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]</span>
<span id="cb46-2">py_list.mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AttributeError: 'list' object has no attribute 'mean'</code></pre>
</div>
</div>
<p>Sometimes the errors in Python are even helpful! Thanks Python!</p>
<p>Coming from R where a function is always just a function, this method vs function thing was quite confusing at first. Don’t be scare. You’ll get used to it. I hope.</p>
</section>
<section id="extracting-columns" class="level3">
<h3 class="anchored" data-anchor-id="extracting-columns">Extracting columns</h3>
<p>While you can create a pandas DataFrame using a dictionary containing list entries (as we did earlier), the columns of a DataFrame themselves, when extracted, are a “Series” type object (rather than a list).</p>
<p>For example, the column <code>'a'</code> can be extracted using <code>[]</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1">pandas_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0    1
1    2
2    3
3    4
Name: a, dtype: int64</code></pre>
</div>
</div>
<p>which is the same as in R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1">r_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  a
1 1
2 2
3 3
4 4</code></pre>
</div>
</div>
<p>Note that the columns of a DataFrame are also “attributes” of the data frame and can be extracted using the <code>df.col</code> dot syntax:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1">pandas_df.a</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0    1
1    2
2    3
3    4
Name: a, dtype: int64</code></pre>
</div>
</div>
<p>The output above is the same as from the <code>pandas_df['a']</code> syntax: both outputs are a pandas Series object.</p>
<p>We can check the type of an object in python using the <code>type()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span>(pandas_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.series.Series'&gt;</code></pre>
</div>
</div>
<p>which tells us that this column is a pandas “Series” object.</p>
</section>
<section id="series" class="level3">
<h3 class="anchored" data-anchor-id="series">Series</h3>
<p>A pandas <strong>Series</strong> is like a one-dimensional DataFrame, and you can recognize that your object is a Series because there will be has two attributes printed out at the bottom: the <code>Name</code> (if indeed there is a name) and <code>dtype</code> (type).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1">pandas_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0    1
1    2
2    3
3    4
Name: a, dtype: int64</code></pre>
</div>
</div>
<p>A series object has a row index but no columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1">pandas_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>].index</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RangeIndex(start=0, stop=4, step=1)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1">pandas_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>].columns</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AttributeError: 'Series' object has no attribute 'columns'</code></pre>
</div>
</div>
</section>
<section id="adding-columns-to-a-dataframe" class="level3">
<h3 class="anchored" data-anchor-id="adding-columns-to-a-dataframe">Adding columns to a DataFrame</h3>
<p>You can add a column to a pandas DataFrame just as you would in base R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1">pandas_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'c'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>]</span>
<span id="cb62-2">pandas_df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   a  b   c
0  1  5   9
1  2  6  10
2  3  7  11
3  4  8  12</code></pre>
</div>
</div>
<p>However, if you define a new DataFrame using an existing data frame and then modify it, e.g., by adding a new column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define a new data frame using the original one</span></span>
<span id="cb64-2">pandas_df_new <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pandas_df</span>
<span id="cb64-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a new column to the new data frame</span></span>
<span id="cb64-4">pandas_df_new[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'d'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>]</span>
<span id="cb64-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print out the new data frame</span></span>
<span id="cb64-6">pandas_df_new</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   a  b   c   d
0  1  5   9  13
1  2  6  10  14
2  3  7  11  15
3  4  8  12  16</code></pre>
</div>
</div>
<p>Notice that the original DataFrame will also change:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1">pandas_df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   a  b   c   d
0  1  5   9  13
1  2  6  10  14
2  3  7  11  15
3  4  8  12  16</code></pre>
</div>
</div>
<p><strong>This is very different from what would happen in R</strong>, where the <code>pandas_df_new</code> object would be a separate object from the original <code>pandas_df</code> object, and making modifications to the new object would not be reflected in the original one.</p>
</section>
<section id="dont-forget-to-.copy" class="level3">
<h3 class="anchored" data-anchor-id="dont-forget-to-.copy">Don’t forget to .copy()</h3>
<p>This is because in python when you define a new object to be an existing object (<code>pandas_df_new = pandas_df</code>), you are actually creating a new “pointer” to the same underlying object being pointed to by the original name <code>pandas_df</code>. <code>pandas_df_new</code> becomes like an “alias” for <code>pandas_df</code>, rather than an entirely new object.</p>
<p>To avoid this issue, when defining a new DataFrame based on an existing DataFrame, you need to explicitly create a new object using the <code>copy()</code> method:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># redefine the original pandas DataFrame:</span></span>
<span id="cb68-2">pandas_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>], </span>
<span id="cb68-3">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>]})</span>
<span id="cb68-4">pandas_df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   a  b
0  1  5
1  2  6
2  3  7
3  4  8</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define pandas_df_new as a "copy" of pandas_df:</span></span>
<span id="cb70-2">pandas_df_new <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pandas_df.copy()</span>
<span id="cb70-3">pandas_df_new[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'c'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>]</span>
<span id="cb70-4">pandas_df_new</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   a  b   c
0  1  5   9
1  2  6  10
2  3  7  11
3  4  8  12</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check that pandas_df did not change this time</span></span>
<span id="cb72-2">pandas_df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   a  b
0  1  5
1  2  6
2  3  7
3  4  8</code></pre>
</div>
</div>
<p>This issue of unintentionally creating an alias or a “view” of an object, rather than a new object itself is another confusing thing about python. You will undoubtedly run into issues with it when you’re starting out (I certainly did). When in doubt, just <code>copy()</code>.</p>
</section>
<section id="filtering" class="level3">
<h3 class="anchored" data-anchor-id="filtering">Filtering</h3>
<p>Pandas Series objects act like vectors in R in that you can ask logical questions of them (<em>side-note: this does not work with python lists, but it does with with pandas Series objects</em>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ask which entries in the column "a" are greater than 1</span></span>
<span id="cb74-2">pandas_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0    False
1     True
2     True
3     True
Name: a, dtype: bool</code></pre>
</div>
</div>
<p>Which is very similar to the R version:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ask which entries in the column "a" are greater than 1</span></span>
<span id="cb76-2">r_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         a
[1,] FALSE
[2,]  TRUE
[3,]  TRUE
[4,]  TRUE</code></pre>
</div>
</div>
<p>In base R, we can use this to “filter” our data frame to the rows where the condition above is true (the first row):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1">r_df[r_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  a b
2 2 6
3 3 7
4 4 8</code></pre>
</div>
</div>
<p>This syntax doesn’t work for the pandas DataFrame, however, but if we make a few syntax modifications where we:</p>
<ol type="1">
<li><p>employ the <code>.loc</code> method and</p></li>
<li><p>provide <code>:</code> to the column dimension (which says to “return all of the columns”),</p></li>
</ol>
<p>then we get the expected result:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1">pandas_df.loc[pandas_df.a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,:]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   a  b
1  2  6
2  3  7
3  4  8</code></pre>
</div>
</div>
<p>Note that <code>loc</code> isn’t a normal function per se in that it is not followed by <em>round</em> parentheses <code>()</code>, but it is followed by the square indexing parentheses <code>[]</code>.</p>
<p>If we wanted to just return the second column, we would provide the second column’s name (<code>'b'</code>) into the second dimension of the <code>.loc[,]</code> square parentheses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1">pandas_df.loc[pandas_df.a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1    6
2    7
3    8
Name: b, dtype: int64</code></pre>
</div>
</div>
<p>However, <code>loc</code> expects either a Boolean series or a name in its index. The <code>iloc</code> method, on the other hand, takes <em>integer</em> index positions. The following code will extract the second, third, and fourth rows of the second column (remember zero-indexing!).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1">pandas_df.iloc[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>],<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1    6
2    7
3    8
Name: b, dtype: int64</code></pre>
</div>
</div>
<p>Again, the output is a pandas Series (as is almost always the case when the output of your code involves a single column).</p>
<p>It’s a bit annoying that you can’t use the same syntax to do both named (<code>.loc</code>) and integer (<code>.iloc</code>) indexing for pandas DataFrames, but such is life.</p>
<section id="the-query-method" class="level4">
<h4 class="anchored" data-anchor-id="the-query-method">The query() method</h4>
<p>Since this type of square bracket syntax for indexing feels clunky both in R and Python, you can alternatively use the <code>query()</code> method of a pandas DataFrame similar to the <code>filter()</code> dplyr function in the tidyverse.</p>
<p>Recall that with the pipe, the <code>filter()</code> syntax in R looks like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1">r_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  a b
1 2 6
2 3 7
3 4 8</code></pre>
</div>
</div>
<p>For pandas DataFrame, the <code>query()</code> syntax looks like</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1">pandas_df.query(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a &gt; 1'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   a  b
1  2  6
2  3  7
3  4  8</code></pre>
</div>
</div>
<p>Note that there is no “tidy eval” in python, so you need to provide a quoted string (“string” is the python word for “character”) argument to the <code>query()</code> method.</p>
<p>If you want to use an external variable, you need to access it using <code>@</code> within the query argument:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1">thresh <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb90-2">pandas_df.query(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a &gt; @thresh'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   a  b
1  2  6
2  3  7
3  4  8</code></pre>
</div>
</div>
</section>
</section>
<section id="grouping-data-frames" class="level3">
<h3 class="anchored" data-anchor-id="grouping-data-frames">Grouping data frames</h3>
<p>One of the most powerful parts of the tidyverse is the ability to perform grouped operations on data frames. For example, if we wanted to add a categorical column to our R data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a new categorical column to r_df</span></span>
<span id="cb92-2">r_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cat"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yellow"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yellow"</span>)</span>
<span id="cb92-3">r_df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  a b    cat
1 1 5    red
2 2 6    red
3 3 7 yellow
4 4 8 yellow</code></pre>
</div>
</div>
<p>Then we could group by this new <code>cat</code> column and compute the mean of the values in column <code>a</code> in R as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1">r_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(cat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean_a =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(a))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  cat    mean_a
  &lt;chr&gt;   &lt;dbl&gt;
1 red       1.5
2 yellow    3.5</code></pre>
</div>
</div>
<p>We can do something very similar in Python with pandas DataFrames using the <code>groupby()</code> method. First, let’s add a column of color categories to our pandas DataFrame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a new categorical column to pandas_df</span></span>
<span id="cb96-2">pandas_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cat"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yellow"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yellow"</span>]</span>
<span id="cb96-3">pandas_df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   a  b     cat
0  1  5     red
1  2  6     red
2  3  7  yellow
3  4  8  yellow</code></pre>
</div>
</div>
<p>and then let’s group the data frame by the new categorical column, extract the column “a”, and then apply the mean method to the grouped column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1">pandas_df.groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cat'</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>].mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>cat
red       1.5
yellow    3.5
Name: a, dtype: float64</code></pre>
</div>
</div>
<p>The output is a Series object with the grouping variable values as the <em>row index</em>.</p>
<p>Note that if we didn’t extract the column “a”, we would be applying grouped mean to all columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1">pandas_df.groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cat'</span>).mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          a    b
cat             
red     1.5  5.5
yellow  3.5  7.5</code></pre>
</div>
</div>
<p>The output is now a DataFrame with the grouping variable values as the row index.</p>
</section>
</section>
<section id="chaining-functions-together" class="level2">
<h2 class="anchored" data-anchor-id="chaining-functions-together">Chaining functions together</h2>
<p>Note that python methods can be chained together using the <code>.</code> similarly to how we chain methods together in R using the pipe <code>|&gt;</code>.</p>
<p>For instance, if we wanted to filter to rows where <code>a</code> was greater than 1, then group by the ‘cat’ column, and then compute the mean of the column <code>b</code>, we would do this in R as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1">r_df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(cat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean_b =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(b))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  cat    mean_b
  &lt;chr&gt;   &lt;dbl&gt;
1 red       6  
2 yellow    7.5</code></pre>
</div>
</div>
<p>In python, we do a similar thing, but using <code>.</code> instead of <code>|&gt;</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1">pandas_df.query(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a &gt; 1'</span>).groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cat'</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>].mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>cat
red       6.0
yellow    7.5
Name: b, dtype: float64</code></pre>
</div>
</div>
<p>Note that the code up to the <code>mean()</code> part results in a “grouped Series”. Unlike in R, many objects in python don’t always display nicely when called:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1">pandas_df.query(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a &gt; 1'</span>).groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cat'</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;pandas.core.groupby.generic.SeriesGroupBy object at 0x11f377b50&gt;</code></pre>
</div>
</div>
<p>We can use the <code>pd.Series()</code> function to force the grouped Series object back into a regular ungrouped Series (<code>pd.Series()</code> is used to define Series objects on the fly just as <code>pd.DataFrame()</code> is used to define DataFrames on the fly – this is what I used at the beginning of this tutorial).</p>
<p>Let’s try to force the grouped Series object back into a regular pandas Series object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1">pd.Series(pandas_df.query(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a &gt; 1'</span>).groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cat'</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0          (red, [6])
1    (yellow, [7, 8])
dtype: object</code></pre>
</div>
</div>
<p>This Series contains tuples (I can tell from the round parentheses <code>()</code>), and I’m not going to lie, I’m afraid. But at least I can see what values the grouped Series contains.</p>
</section>
<section id="data-visualization" class="level2">
<h2 class="anchored" data-anchor-id="data-visualization">Data visualization</h2>
<p>Unlike in R, where ggplot is the clear “best” way to create data visualizations (at least in my opinion), in python there are many different libraries for doing data visualization. The two you are most likely to have heard of include matplotlib and seaborn.</p>
<p>Seaborn is a little prettier than matplotlib, but all I’m going to show in this tutorial is the inbuilt data visualization methods for pandas Series and DataFrame objects that are built on matplotlib.</p>
<p>To do some more interesting visualizations, let’s load the gapminder dataset (from a URL) into a pandas DataFrame using the <code>pd.read_csv()</code> pandas function. This <code>pd.read_csv()</code> function can also be used to load a local .csv file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1">gapminder <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/rlbarter/gapminder-data/main/gapminder.csv"</span>)</span></code></pre></div>
</div>
<p>Let’s use the <code>head()</code> DataFrame method to look at the first 6 rows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1">gapminder.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       country continent  year  lifeExp       pop   gdpPercap
0  Afghanistan      Asia  1952   28.801   8425333  779.445314
1  Afghanistan      Asia  1957   30.332   9240934  820.853030
2  Afghanistan      Asia  1962   31.997  10267083  853.100710
3  Afghanistan      Asia  1967   34.020  11537966  836.197138
4  Afghanistan      Asia  1972   36.088  13079460  739.981106</code></pre>
</div>
</div>
<p>Let’s practice some of our new python skills. The following code will filter to the data for Australia and compute the mean life expectancy:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1">gapminder.query(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'country == "Australia"'</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lifeExp'</span>].mean()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>74.66291666666667</code></pre>
</div>
</div>
<p>And the following will compute the average gdpPercap by continent:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1">gdp_by_continent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gapminder.groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'continent'</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gdpPercap'</span>].mean()</span>
<span id="cb115-2">gdp_by_continent</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>continent
Africa       2193.754578
Americas     7136.110356
Asia         7902.150428
Europe      14469.475533
Oceania     18621.609223
Name: gdpPercap, dtype: float64</code></pre>
</div>
</div>
<p>Notice that the output of this last piece of code is a Series object. Notice also that the (row) index is the continent:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1">gdp_by_continent.index</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['Africa', 'Americas', 'Asia', 'Europe', 'Oceania'], dtype='object', name='continent')</code></pre>
</div>
</div>
<p>What will happen if we apply the <code>plot()</code> method to this Series object?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1">gdp_by_continent.plot()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2023-09-11-from_r_to_python_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>By default a line plot is created and the row index is used as the x-axis labels by default. The DataFrame’s <code>plot()</code> method here acts as a wrapper for the matplotlib library’s plotting function.</p>
<p>If I wanted a bar chart instead of a line plot, I could create one using the <code>plot.bar()</code> method (instead of just the <code>plot()</code> method):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1">gdp_by_continent.plot.bar()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2023-09-11-from_r_to_python_files/figure-html/unnamed-chunk-61-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Again, the row index of the Series object is used as the x-axis labels by default.</p>
<p>We could similarly create a scatterplot of the <code>gdpPercap</code> and <code>lifeExp</code> columns from <code>gapminder</code> using the <code>plot.scatter()</code> method:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1">gapminder.plot.scatter(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gdpPercap'</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lifeExp'</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2023-09-11-from_r_to_python_files/figure-html/unnamed-chunk-62-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>While these built-in pandas plots are fine, I personally prefer the look of the seaborn library and the workflow of the plotly express library, neither of which I’ve covered in this post (and neither of which are as good as ggplot2 in my opinion). I recommend you look into both of these libraries (and more!) to figure out the data visualization workflow you prefer!</p>
</section>
<section id="wrapping-up" class="level2">
<h2 class="anchored" data-anchor-id="wrapping-up">Wrapping up</h2>
<p>Obviously, there’s a lot more to learn about Python, but I’ll leave it here for now. I hope this post has helped some of you R users get started on your Python journey!</p>


</section>

 ]]></description>
  <category>python</category>
  <guid>https://www.rebeccabarter.com/blog/2023-09-11-from_r_to_python.html</guid>
  <pubDate>Tue, 12 Sep 2023 07:00:00 GMT</pubDate>
  <media:content url="https://www.rebeccabarter.com/blog/img/python/rubaitul-azad-ZIPFteu-R8k-unsplash.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>A list of public data repositories</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2023-03-28-data_sources.html</link>
  <description><![CDATA[ 





<p><img src="https://www.rebeccabarter.com/blog/img/data/ivo-rainha-0rzUepBXHN0-unsplash.jpg" class="img-fluid" alt="A large, beautiful library"></p>
<p>I spend a lot of my time developing educational materials for data science, and since I always teach from a real-data perspective, this means that I spend a lot of my time looking for datasets. This blog post summarizes the first places I go when looking for a new dataset to play around with.</p>
<p>While there are big data repositories like Kaggle, UCI Machine Learning repository, and data.gov, I often find more useful datasets in smaller, more curated repositories, which are often compiled by just one person, rather than being a massive repository of open datasets.</p>
<section id="my-go-to-smaller-more-curated-repositories" class="level1">
<h1>My go-to smaller, more curated repositories</h1>
<section id="tidy-tuesday" class="level2">
<h2 class="anchored" data-anchor-id="tidy-tuesday">Tidy Tuesday</h2>
<p><a href="https://github.com/rfordatascience/tidytuesday"><img src="https://www.rebeccabarter.com/blog/img/data/tidy_tuesday.png" class="img-fluid" alt="Tidy Tuesday logo"></a></p>
<p>Link: <a href="https://github.com/rfordatascience/tidytuesday">https://github.com/rfordatascience/tidytuesday</a></p>
<p>Tidy Tuesday is much more than “just a data repository”. Tidy Tuesday is an entire community, originally brought together by <a href="https://themockup.blog/">Tom Mock</a> to help people improve their data analysis and visualization skills using R. Tidy Tuesday provides weekly data sets and data exploration challenges, with thousands of participants from all around the world sharing their work, offering feedback, and collaborating on projects. Whether you are a seasoned data professional or just starting out, Tidy Tuesday is an excellent resource for learning and growth in the data science field.</p>
</section>
<section id="data-is-plural" class="level2">
<h2 class="anchored" data-anchor-id="data-is-plural">Data is plural</h2>
<p><a href="https://www.data-is-plural.com/"><img src="https://www.rebeccabarter.com/blog/img/data/data_is_plural.png" class="img-fluid" alt="Data is plural homepage"></a></p>
<p>Link: <a href="https://www.data-is-plural.com/">https://www.data-is-plural.com/</a></p>
<p>“<em>Data is Plural</em>” is a weekly newsletter of “useful/curious datasets”, published by <a href="https://www.jsvine.com/">Jeremy Singer-Vine</a>. The Data is Plural newsletter is delivered each week straight to your inbox and typically features a curated collection of recent and relevant high-quality and diverse datasets from a wide range of domains, including economics, sports, politics, science, and more.</p>
</section>
<section id="flowingdata" class="level2">
<h2 class="anchored" data-anchor-id="flowingdata">FlowingData</h2>
<p><a href="https://flowingdata.com/"><img src="https://www.rebeccabarter.com/blog/img/data/flowing_data.png" class="img-fluid" alt="Flowing data homepage"></a></p>
<p>Link: <a href="https://flowingdata.com/">https://flowingdata.com/</a></p>
<p>While it is not technically a data repository, <a href="https://flowingdata.com/about">Nathan Yau’s</a> website <a href="https://flowingdata.com/">FlowingData</a> contains a range of detailed visualizations and analyses of a range of interesting datasets, and he always provides a reference to the datasets that underlie his articles. Yau also offers a range of courses and tutorials for readers who are intersted in improving their data visualization and analysis skills</p>
</section>
<section id="fivethirtyeight" class="level2">
<h2 class="anchored" data-anchor-id="fivethirtyeight">FiveThirtyEight</h2>
<p><a href="https://github.com/fivethirtyeight/data"><img src="https://www.rebeccabarter.com/blog/img/data/five_thirty_eight.jpg" class="img-fluid" alt="FiveThirtyEight Logo"></a></p>
<p>Link: <a href="https://data.fivethirtyeight.com/">https://data.fivethirtyeight.com/</a> (gihub repo: <a href="https://github.com/fivethirtyeight/data">https://github.com/fivethirtyeight/data</a>)</p>
<p><a href="https://fivethirtyeight.com/">FiveThirtyEight</a>, originally a blog created by Nate Silver, and now a large journalism site provides copies of the data that underlies their data-driven articles on <a href="https://github.com/fivethirtyeight/data">github</a>. Since FiveThirtyEight’s initial focus was political polls and elections (and I guess since Nate Silver is into sports), much of their data tends to be political and sports-related, but there are also other data goodies to be found in their repo too.</p>
</section>
<section id="propublica" class="level2">
<h2 class="anchored" data-anchor-id="propublica">ProPublica</h2>
<p><a href="https://www.propublica.org/datastore/"><img src="https://www.rebeccabarter.com/blog/img/data/pro_publica.png" class="img-fluid" alt="ProPublica Data Store homepage"></a></p>
<p>Link: <a href="https://www.propublica.org/datastore/datasets">https://www.propublica.org/datastore/datasets</a></p>
<p>ProPublica, a non-profit investigative journalism outfit, provides a large number of datasets for free (and even more for a premium membership fee). I honestly haven’t used this resource much myself, but I’ve been aware of it, and it seems to have some fairly interesting datasets at first glance!</p>
</section>
<section id="inbuilt-datasets-in-r" class="level2">
<h2 class="anchored" data-anchor-id="inbuilt-datasets-in-r">Inbuilt datasets in R</h2>
<p><a href="https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/00Index.html"><img src="https://www.rebeccabarter.com/blog/img/data/r.png" class="img-fluid" alt="The page displaying the list of datasets from the &quot;Datasets&quot; R package"></a></p>
<p>Link: <a href="https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/00Index.html">https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/00Index.html</a></p>
<p>Sometimes, when I need something quick-and-dirty, the inbuilt datasets in R will do the job! You can look at the list of datasets available in R by typing <code>data()</code> in R. They are also listed <a href="https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/00Index.html">here</a>.</p>
<p>There are also several packages that import datasets along with their functions, including ggplot2. You can look at the specific packages that are loaded with a package using the <code>package</code> argument in the <code>data()</code> function, for example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggplot2"</span>)</span></code></pre></div>
</div>
</section>
</section>
<section id="the-bigger-more-obvious-data-repositories" class="level1">
<h1>The bigger, more obvious data repositories</h1>
<p>In addition to these smaller more curated data repositories, there are also several very large data repositories created by Google, Amazon, etc. However, due to the sheer volume of data available on these websites, I personally find these resources to be the most helpful when I already know what I’m looking for.</p>
<section id="uci-machine-learning-repository" class="level2">
<h2 class="anchored" data-anchor-id="uci-machine-learning-repository">UCI Machine Learning repository</h2>
<p><a href="https://archive.ics.uci.edu/ml/index.php"><img src="https://www.rebeccabarter.com/blog/img/data/uci.png" class="img-fluid" alt="UCI Machine Learning Repository Logo"></a></p>
<p>Link: <a href="https://archive.ics.uci.edu/ml/index.php">https://archive.ics.uci.edu/ml/index.php</a></p>
<p>The UCI Machine Learning repository is a public dataset repository maintained by the Machine Learning Group at the University of California, Irvine. The datasets are typically organized into the type of machine learning problem they can be used for, but they come from various domains, including biology, finance, social sciences, and engineering. If I’m being honest, the UCI Machine Learning repository is fairly “old-school”, and much of what you can find on the UCI ML repository can also now be found on Kaggle.</p>
</section>
<section id="kaggle" class="level2">
<h2 class="anchored" data-anchor-id="kaggle">Kaggle</h2>
<p><a href="https://www.kaggle.com/"><img src="https://www.rebeccabarter.com/blog/img/data/kaggle.png" class="img-fluid" alt="Kaggle Logo"></a></p>
<p>Link: <a href="https://www.kaggle.com/">https://www.kaggle.com/</a></p>
<p>Kaggle began as a machine learning competition platform, and by nature of machine learning competitions, kaggle has also ended up being a place that hosts a wide range of datasets that are particularly well-suited to machine learning applications (the datasets for all past challenges can be downloaded from the Kaggle Website).</p>
</section>
<section id="google-dataset-search" class="level2">
<h2 class="anchored" data-anchor-id="google-dataset-search">Google Dataset Search</h2>
<p><a href="https://datasetsearch.research.google.com/"><img src="https://www.rebeccabarter.com/blog/img/data/google.png" class="img-fluid" alt="Google Dataset Searchbar"></a></p>
<p>Link: <a href="https://datasetsearch.research.google.com/">https://datasetsearch.research.google.com/</a></p>
<p>Google Dataset Search is… well… Google but for datasets. As a search engine specifically designed for finding datasets, it provides access to a wide range of datasets from various sources and domains, including research publications and government databases. My issue with Google Dataset Search, however, is that you basically already need to know what you’re looking for in order to search for it. It is a great resource for people looking for datasets on specific topics though.</p>
</section>
<section id="amazon-web-services-registry-of-open-data" class="level2">
<h2 class="anchored" data-anchor-id="amazon-web-services-registry-of-open-data">Amazon Web Services Registry of Open Data</h2>
<p><a href="https://registry.opendata.aws/"><img src="https://www.rebeccabarter.com/blog/img/data/amazon.png" class="img-fluid" alt="AWS logo"></a></p>
<p>Link: <a href="https://registry.opendata.aws/">https://registry.opendata.aws/</a></p>
<p>Amazon Web Services provides access to a large collection of public datasets that can be used for research and development projects. As far as I can tell, the focus is on medical and environmental datasets. These datasets are hosted on the Amazon cloud infrastructure, and can be accessed using Amazon Web Services tools.</p>
</section>
<section id="data.gov" class="level2">
<h2 class="anchored" data-anchor-id="data.gov">data.gov</h2>
<p><a href="https://data.gov/"><img src="https://www.rebeccabarter.com/blog/img/data/datagov.png" class="img-fluid" alt="Data.gov logo"></a></p>
<p>Link: <a href="https://data.gov/">https://data.gov/</a></p>
<p>data.gov is a government-owned online platform that provides public access to a vast collection of datasets from different federal agencies in the United States, which includes demographic data, weather data, environmental data, and economic data, among others.</p>
<!-- # Domain-specific datasets -->
<!-- ## Ecology -->
<!-- https://www.rforecology.com/post/top-five-ish-sources-of-ecological-data/ -->
<!-- ## Healthcare -->
<!-- CDC data -->
<!-- https://data.cdc.gov/  -->
<!-- NHANES data -->
<!-- https://wwwn.cdc.gov/nchs/nhanes/Default.aspx -->
<p>If you have some go-to resources for data that I haven’t mentioned here, let me know by leaving a comment below!</p>


</section>
</section>

 ]]></description>
  <category>data</category>
  <category>datasets</category>
  <guid>https://www.rebeccabarter.com/blog/2023-03-28-data_sources.html</guid>
  <pubDate>Tue, 28 Mar 2023 07:00:00 GMT</pubDate>
  <media:content url="https://www.rebeccabarter.com/blog/img/data/ivo-rainha-0rzUepBXHN0-unsplash.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Thanks, Quarto, for saving my blog!</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2023-03-21-quarto-website.html</link>
  <description><![CDATA[ 





<p><img src="https://www.rebeccabarter.com/blog/img/quarto/quarto.jpg" class="img-fluid" alt="Quarto logo"></p>
<p>Hello reader, it’s been a minute!</p>
<p>I’m sure you didn’t notice, but I’ve been kind of silent on here for the past three years. So silent, it’s almost deafening (to my ears, at least).</p>
<p>Fear not, there are good reasons for my absence in this space. I’ve actually spent the past three years writing a book called “<em>Veridical Data Science: the practice of responsible data analysis and decision making</em>”, together with my PhD and postdoc advisor, the Veridical Data Science pioneer, Bin Yu. And I was doing this more-or-less full-time (more on veridical data science to come).</p>
<p>Much to my dismay, it turns out that after a full day of book-writing<sup>1</sup>, it’s hard to summon the energy to do even more writing in the form of blog posts. Book-burnout is <em>real</em>. So what was I doing with my spare time<sup>2</sup> if I wasn’t blogging, you ask? Instead of writing blog posts, I was doing a lot of non-blogging things like weathering a pandemic, climbing dumb rocks, learning to draw, moving all around the country, and other non-blogging things like that.</p>
<p>But now that the book is “<em>done</em>” (as in, it’s been sent to the publishers, which, if you know anything about publishing, means that it’s actually very far from done), and I’ve settled into a new job as an Assistant Research Professor at the University of Utah, I finally feel ready to start blogging again! Hooray!</p>
<p>Except… not actually hooray. When I finally went to update my original blogdown website on my new work computer, R yelled at me. Loudly. <span style="color:red;">In red</span>. And I didn’t like it one bit. The day that I had long feared had finally arrived: I didn’t know how to update my own website without breaking it. Blogdown is fantastic until it’s not.</p>
<p>Fortunately, this happened at the best of possible times. Not only have substantially fewer people been following my website lately (that’ll happen when you don’t add anything new to it in three years…), so I’m not so afraid to make some breaking changes, but we are now living in the magical era of <strong>Quarto</strong>!</p>
<p>Perhaps you’re like me, and it’s taken you a while to realize why this new era of <strong>Quarto</strong> is so magic. My first impression of Quarto was that it’s pretty much R Markdown, but with a few extra features and slightly different syntax. This is true, and also not true.</p>
<p>After hearing so much about how much easier so many things (like making a blog, for instance) are with Quarto, I figured that I might as well give it a go and try to port my broken blogdown website over to Quarto. The alternative seems to be spending my life debugging blogdown, so what have I got to lose?</p>
<p>Now that I’m on the other side, I have to say. Wow. Just wow. I managed to re-create my entire website using quarto without running into a single issue in just 4 hours. For reference, when I originally created my blog using blogdown 5ish years ago, it took around 5 days and I had to try several different themes before I found one that was stable and didn’t break easily.</p>
<p>If you’re looking to make the transition yourself, fortunately there are already several useful resources out there, like <a href="https://albert-rapp.de/posts/13_quarto_blog_writing_guide/13_quarto_blog_writing_guide.html">Albert Rapp’s blog post</a> and <a href="https://www.njtierney.com/post/2022/04/11/rmd-to-qmd/">Nick Tierney’s blog post</a>. The <a href="https://quarto.org/docs/websites/website-blog.html">Quarto documentation</a> itself is also really helpful.</p>
<p>The end result of my 4-hours of effort is what you see here. My website looks a bit different (and I got rid of some of the less-visited sections that no one cares about), but I think it’s much cleaner and easier to navigate. I might do some fine-tuning down the line, but I’m in no rush.</p>
<p>Anyway, all this is to say: Welcome to my new website! I hope to be creating a lot more content for you in the near future. I’m excited to oil to my blogging gears, and get back on the road!</p>




<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>which mostly involves writing the same paragraph in five different ways before realizing that the point I’m trying to make is irrelevant and subsequently deleting the whole thing↩︎</p></li>
<li id="fn2"><p>I know that this implies that I only blog in my spare time, but if I’m being honest, I don’t think I’ve ever actually blogged in my spare time. I only ever blog during work hours, like the responsible employee that I am. I’m actually at work right now. But shhhh.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>blog</category>
  <guid>https://www.rebeccabarter.com/blog/2023-03-21-quarto-website.html</guid>
  <pubDate>Tue, 21 Mar 2023 07:00:00 GMT</pubDate>
  <media:content url="https://www.rebeccabarter.com/blog/img/quarto/quarto.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>It’s time for statistics departments to start supporting their applied students</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2020-07-30-applied-statistics-universities.html</link>
  <description><![CDATA[ 





<p>I graduated with a PhD from UC Berkeley’s statistics department in December. My PhD dissertation consisted of three 100% applied projects (one of which was a piece of open-source software). This is, unfortunately, incredibly rare.</p>
<p>Over the past few years, I’ve had a number of current and prospective statistics PhD students both at Berkeley and outside Berkeley get in touch with me to ask me how I made my way through a statistics PhD by working only on applied projects. My answer is always as follows: <em>I got lucky</em>. I ended up with an incredibly supportive and advisor, Bin Yu, who went out of her way to find applied projects for me, and was comfortable letting me spend time doing non-conventional things (like learn D3.js, work on my blog, and she even recruited me to be the co-author on a book on Data Science that she wanted to write based on her data science philosophy that she has developed throughout her career). I got a lot out of my PhD, and I’m incredibly grateful to Bin for her guidance. If you’re interested in Bin’s work, I recommend reading her paper, <a href="https://www.pnas.org/content/117/8/3920">Veridical Data Science</a>, which reflects the philosophy that underlies our book.</p>
<p>Unfortunately, my experience is definitely not the norm, even in my own department. I’ve had so many upsetting conversations with fellow applied stats grad students about how they feel lost and unsupported, about how they’re struggling to find applied projects to work on, and when they do finally find a project, they end up having to fight to justify that their project is “statistical enough” to count towards their dissertation. I’ve had these conversations with students from a wide range of statistics departments, not just my own. I actually think that the Berkeley statistics department is a little better than a many other statistics departments on this front - at least at Berkeley it’s <em>possible</em> to graduate with purely applied projects, even if it’s not easy.</p>
<p>While pretty much every statistics department is starting to realize that they need to embrace “Data Science” in order to remain up-to-date and relevant, they are often doing so in a way that is more performative than practical. They’re starting data science master’s programs, but these programs are often just theoretical statistics programs with a “data science” label slapped on it. They’re also trying to recruit more applied students, but they aren’t giving them any of the support they need to be successful. How can you expect your applied students to succeed if you don’t have any truly applied faculty to guide them? And when you do have applied faculty, you don’t give them tenure (because apparently they’re not “furthering the field of statistics”)? Who are these students going to work with? Who is going to show them that it’s possible to succeed as an applied statistician in a statistics department? Unfortunately, the vast majority of statistics departments are sending a strong message that there is no such thing as success in academia for truly applied statisticians. The end result is that applied students are being brought into statistics departments, chewed up a little, and then spat out, often with a fair amount of imposter syndrome, anxiety and depression, and sadly, often without their PhDs.</p>
<p>Maybe at this point you’re getting aggravated and saying: “but most statistics departments <em>do</em> have applied statisticians on their faculty!”. Well, yes, technically that’s true, if your definition of “applied statistics” involves <em>developing a method</em> (or even developing the underlying theory for a method) and then applying it to a nice, clean dataset to show that the method works. What about answering scientific questions and actually solving real-world problems? What about working with real, messy data? What about communication, exploration, and visualization? Are none of these things statistics?</p>
<p>In my view, this failure to embrace truly applied projects as applied statistics is the whole reason Data Science exists. Data Science is what “Applied Statistics” is supposed to be. Didn’t statistics come about in the first place because governments started collecting and analyzing <em>real data</em> to understand their citizens? Sure, they developed methods, but these methods were developed specifically because they were <em>needed</em> to solve <em>real</em> problems! Why is it that today, when grad students want to solve real problems, they’re told that they aren’t doing statistics?</p>
<p>I’m not saying that theory and methods aren’t an important part of statistics, or that having a theoretical background doesn’t help if you want to be an accomplished data scientist. What I’m saying is that theory shouldn’t always be the <em>focus</em>. If you want to support your applied statistics students (or data science students), then you need to have a track in your program that teaches students how to use real world (and messy!) data to ask scientific questions, and communicate about data and the subsequent scientific findings (I could do a whole post on how most statisticians can’t communicate, but I’ll leave that for another day). For that to happen, you need to hire <em>truly</em> applied faculty, who are working on real world problems with real, messy data.</p>
<p>Unfortunately, it’s a bit of a Catch-22. How can you hire more applied faculty if by the time us applied students get out of your programs, we’re so fed up with feeling like the under-class in statistics departments that we have no desire to go down the academic route whatsoever? Statistics, I’ll leave you with two pieces of advice:</p>
<ol type="1">
<li><p>Support your applied students. Let them do applied work, and help them find projects in collaboration with faculty in other departments. Let them graduate, and don’t make them fight for it. Give them a positive grad school experience, rather than leave them with nightmares.</p></li>
<li><p>Seek out applied faculty candidates. And when you hire them, actually <strong>give them f**king tenure</strong>.</p></li>
</ol>



 ]]></description>
  <category>statistics</category>
  <guid>https://www.rebeccabarter.com/blog/2020-07-30-applied-statistics-universities.html</guid>
  <pubDate>Thu, 30 Jul 2020 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Across (dplyr 1.0.0): applying dplyr functions simultaneously across multiple columns</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2020-07-09-across.html</link>
  <description><![CDATA[ 





<p>I often find that I want to use a dplyr function on multiple columns at once. For instance, perhaps I want to scale all of the numeric variables at once using a mutate function, or I want to provide the same summary for three of my variables.</p>
<p>While it’s been possible to do such tasks for a while using <a href="http://www.rebeccabarter.com/blog/2019-01-23_scoped-verbs/">scoped verbs</a>, it’s now even easier - and more consistent - using dplyr’s new <code>across()</code> function.</p>
<p>To demonstrate <code>across()</code>, I’m going to use Palmer’s Penguin dataset, which was originally collected and made available by Dr.&nbsp;Kristen Gorman and the Palmer Station, Antarctica LTER, but has recently been made popular in the R community by <a href="https://twitter.com/allison_horst">Allison Horst</a> as an alternative to the over-used Iris dataset.</p>
<p>To start with, let’s load the penguins dataset (via the <code>palmerpenguins</code> package) and the tidyverse package. If you’re new to the tidyverse (primarily to dplyr and piping, <code>%&gt;%</code>), I suggest taking a look at <a href="http://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse/">my post on the tidyverse</a> before reading this post.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remotes::install_github("allisonhorst/palmerpenguins")</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(palmerpenguins)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">penguins</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 8
   species island    bill_length_mm bill_depth_mm flipper_…¹ body_…² sex    year
   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;      &lt;int&gt;   &lt;int&gt; &lt;fct&gt; &lt;int&gt;
 1 Adelie  Torgersen           39.1          18.7        181    3750 male   2007
 2 Adelie  Torgersen           39.5          17.4        186    3800 fema…  2007
 3 Adelie  Torgersen           40.3          18          195    3250 fema…  2007
 4 Adelie  Torgersen           NA            NA           NA      NA &lt;NA&gt;   2007
 5 Adelie  Torgersen           36.7          19.3        193    3450 fema…  2007
 6 Adelie  Torgersen           39.3          20.6        190    3650 male   2007
 7 Adelie  Torgersen           38.9          17.8        181    3625 fema…  2007
 8 Adelie  Torgersen           39.2          19.6        195    4675 male   2007
 9 Adelie  Torgersen           34.1          18.1        193    3475 &lt;NA&gt;   2007
10 Adelie  Torgersen           42            20.2        190    4250 &lt;NA&gt;   2007
# … with 334 more rows, and abbreviated variable names ¹​flipper_length_mm,
#   ²​body_mass_g</code></pre>
</div>
</div>
<p>There are 344 rows in the penguins dataset, one for each penguin, and 7 columns. The first two columns, <code>species</code> and <code>island</code>, specify the species and island of the penguin, the next four specify numeric traits about the penguin, including the bill and flipper length, the bill depth and the body mass.</p>
<p>The new <code>across()</code> function turns all dplyr functions into “scoped” versions of themselves, which means you can specify multiple columns that your dplyr function will apply to.</p>
<p>Ordinarily, if we want to <code>summarise</code> a single column, such as <code>species</code>, by calculating the number of distinct entries (using <code>n_distinct()</code>) it contains, we would typically write</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">distinct_species =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n_distinct</span>(species))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  distinct_species
             &lt;int&gt;
1                3</code></pre>
</div>
</div>
<p>If we wanted to calculate <code>n_distinct()</code> not only across <code>species</code>, but also across <code>island</code> and <code>sex</code>, we would need to write out the <code>n_distinct</code> function three separate times:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">distinct_species =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n_distinct</span>(species),</span>
<span id="cb6-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">distinct_island =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n_distinct</span>(island),</span>
<span id="cb6-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">distinct_sex =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n_distinct</span>(sex))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  distinct_species distinct_island distinct_sex
             &lt;int&gt;           &lt;int&gt;        &lt;int&gt;
1                3               3            3</code></pre>
</div>
</div>
<p>Wouldn’t it be nice if we could just write which columns we want to apply <code>n_distinct()</code> to, and then specify <code>n_distinct()</code> once, rather than having to apply n_distinct to each column separately?</p>
<p>This is where <code>across()</code> comes in. It is used <em>inside</em> your favourite dplyr function and the syntax is <code>across(.cols, .fnd)</code>, where <code>.cols</code> specifies the columns that you want the dplyr function to act on. When dplyr functions involve external functions that you’re applying to columns e.g.&nbsp;<code>n_distinct()</code> in the example above, this external function is placed in the <code>.fnd</code> argument. For example, we would to apply <code>n_distinct()</code> to <code>species</code>, <code>island</code>, and <code>sex</code>, we would write <code>across(c(species, island, sex), n_distinct)</code> in the <code>summarise</code> parentheses.</p>
<p>Note that we are specifying which variables we want to involve in the <code>summarise</code> using <code>c()</code>, as if we’re listing the variable names in a vector, but because we’re in dplyr-land, we don’t need to put them in quotes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(species, island, sex), </span>
<span id="cb8-3">                   n_distinct))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  species island   sex
    &lt;int&gt;  &lt;int&gt; &lt;int&gt;
1       3      3     3</code></pre>
</div>
</div>
<p>Something else that’s really neat is that you can also use <code>!c()</code> to negate a set of variables (i.e.&nbsp;to apply the function to all variables <em>except</em> those that you specified in <code>c()</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(species, island, sex), </span>
<span id="cb10-3">                   n_distinct))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  bill_length_mm bill_depth_mm flipper_length_mm body_mass_g  year
           &lt;int&gt;         &lt;int&gt;             &lt;int&gt;       &lt;int&gt; &lt;int&gt;
1            165            81                56          95     3</code></pre>
</div>
</div>
<p>I want to emphasize here that the function <code>n_distinct()</code> <em>is an argument of <code>across()</code></em>, rather than being an argument of the dplyr function (<code>summarise</code>).</p>
<section id="select-helpers-selecting-columns-to-apply-the-function-to" class="level1">
<h1>Select helpers: selecting columns to apply the function to</h1>
<p>So far we’ve seen how to apply a dplyr function to a set of columns using a vector notation <code>c(col1, col2, col3, ...)</code>. However, there are many other ways to specify the columns that you want to apply the dplyr function to.</p>
<ul>
<li><code>everything()</code>: apply the function to all of the columns</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>(), n_distinct))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
  species island bill_length_mm bill_depth_mm flipper_leng…¹ body_…²   sex  year
    &lt;int&gt;  &lt;int&gt;          &lt;int&gt;         &lt;int&gt;          &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;
1       3      3            165            81             56      95     3     3
# … with abbreviated variable names ¹​flipper_length_mm, ²​body_mass_g</code></pre>
</div>
</div>
<ul>
<li><code>starts_with()</code>: apply the function to all columns whose name starts with a specific string</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bill"</span>), n_distinct))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  bill_length_mm bill_depth_mm
           &lt;int&gt;         &lt;int&gt;
1            165            81</code></pre>
</div>
</div>
<ul>
<li><code>contains()</code>: apply the function to all columns whose name contains a specific string</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contains</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"length"</span>), n_distinct))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  bill_length_mm flipper_length_mm
           &lt;int&gt;             &lt;int&gt;
1            165                56</code></pre>
</div>
</div>
<ul>
<li><code>where()</code> apply the function to all columns that satisfy a logical condition, such as <code>is.numeric()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric), n_distinct))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  bill_length_mm bill_depth_mm flipper_length_mm body_mass_g  year
           &lt;int&gt;         &lt;int&gt;             &lt;int&gt;       &lt;int&gt; &lt;int&gt;
1            165            81                56          95     3</code></pre>
</div>
</div>
<p>The full list of select helpers can be found <a href="https://dplyr.tidyverse.org/reference/select.html">here</a>.</p>
</section>
<section id="using-in-line-functions-with-across" class="level1">
<h1>Using in-line functions with across</h1>
<p>Let’s look at an example of summarizing the columns using a custom function (rather than <code>n_distinct()</code>). I usually do this using the tilde-dot shorthand for inline functions. The notation works by replacing</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) {</span>
<span id="cb20-2">  x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb20-3">}</span></code></pre></div>
</div>
<p>with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>{.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>}</span></code></pre></div>
</div>
<p><code>~</code> indicates that you have started an anonymous function, and the argument of the anonymous function can be referred to using <code>.x</code> (or simply <code>.</code>). Unlike normal function arguments that can be anything that you like, the tilde-dot function argument is always <code>.x</code>.</p>
<p>For instance, to identify how many missing values there are in every column, we could specify the inline function <code>~sum(is.na(.))</code>, which calculates how many <code>NA</code> values are in each column (where the column is represented by <code>.</code>) and adds them up:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>(), </span>
<span id="cb22-3">                   <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(.))))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
  species island bill_length_mm bill_depth_mm flipper_leng…¹ body_…²   sex  year
    &lt;int&gt;  &lt;int&gt;          &lt;int&gt;         &lt;int&gt;          &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;
1       0      0              2             2              2       2    11     0
# … with abbreviated variable names ¹​flipper_length_mm, ²​body_mass_g</code></pre>
</div>
</div>
<p>This shows that there are missing values in every column except for the first two (<code>species</code> and <code>island</code>).</p>
</section>
<section id="a-mutate-example" class="level1">
<h1>A mutate example</h1>
<p>What if we want to replace the missing values in the numeric columns with 0 (clearly a terrible choice)? Without the <code>across()</code> function, we would apply an <code>if_else()</code> function separately to each numeric column, which will replace all <code>NA</code> values with 0 and leave all non-<code>NA</code> values as they are:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">replace0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) {</span>
<span id="cb24-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">condition =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(x), </span>
<span id="cb24-3">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">true =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb24-4">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">false =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(x))</span>
<span id="cb24-5">}</span>
<span id="cb24-6">penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb24-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bill_length_mm =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replace0</span>(bill_length_mm),</span>
<span id="cb24-8">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bill_depth_mm =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replace0</span>(bill_depth_mm),</span>
<span id="cb24-9">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">flipper_length_mm =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replace0</span>(flipper_length_mm),</span>
<span id="cb24-10">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">body_mass_g =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replace0</span>(body_mass_g))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 8
   species island    bill_length_mm bill_depth_mm flipper_…¹ body_…² sex    year
   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt; &lt;int&gt;
 1 Adelie  Torgersen           39.1          18.7        181    3750 male   2007
 2 Adelie  Torgersen           39.5          17.4        186    3800 fema…  2007
 3 Adelie  Torgersen           40.3          18          195    3250 fema…  2007
 4 Adelie  Torgersen            0             0            0       0 &lt;NA&gt;   2007
 5 Adelie  Torgersen           36.7          19.3        193    3450 fema…  2007
 6 Adelie  Torgersen           39.3          20.6        190    3650 male   2007
 7 Adelie  Torgersen           38.9          17.8        181    3625 fema…  2007
 8 Adelie  Torgersen           39.2          19.6        195    4675 male   2007
 9 Adelie  Torgersen           34.1          18.1        193    3475 &lt;NA&gt;   2007
10 Adelie  Torgersen           42            20.2        190    4250 &lt;NA&gt;   2007
# … with 334 more rows, and abbreviated variable names ¹​flipper_length_mm,
#   ²​body_mass_g</code></pre>
</div>
</div>
<p>But fortunately, we can do this a lot more efficiently with <code>across()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define a function to replace NA with 0</span></span>
<span id="cb26-2"></span>
<span id="cb26-3">penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb26-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric), replace0))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 8
   species island    bill_length_mm bill_depth_mm flipper_…¹ body_…² sex    year
   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;
 1 Adelie  Torgersen           39.1          18.7        181    3750 male   2007
 2 Adelie  Torgersen           39.5          17.4        186    3800 fema…  2007
 3 Adelie  Torgersen           40.3          18          195    3250 fema…  2007
 4 Adelie  Torgersen            0             0            0       0 &lt;NA&gt;   2007
 5 Adelie  Torgersen           36.7          19.3        193    3450 fema…  2007
 6 Adelie  Torgersen           39.3          20.6        190    3650 male   2007
 7 Adelie  Torgersen           38.9          17.8        181    3625 fema…  2007
 8 Adelie  Torgersen           39.2          19.6        195    4675 male   2007
 9 Adelie  Torgersen           34.1          18.1        193    3475 &lt;NA&gt;   2007
10 Adelie  Torgersen           42            20.2        190    4250 &lt;NA&gt;   2007
# … with 334 more rows, and abbreviated variable names ¹​flipper_length_mm,
#   ²​body_mass_g</code></pre>
</div>
</div>
<p>Although obviously 0 isn’t a great choice, so perhaps we can replace the missing values with the mean value of the column. This time, rather than define a new function (in place of <code>replace0</code>), we’ll be a bit more concise and use the tilde-dot notation to specify the function we want to apply.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(.), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> T), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(.))))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 8
   species island    bill_length_mm bill_depth_mm flipper_…¹ body_…² sex    year
   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;
 1 Adelie  Torgersen           39.1          18.7       181    3750  male   2007
 2 Adelie  Torgersen           39.5          17.4       186    3800  fema…  2007
 3 Adelie  Torgersen           40.3          18         195    3250  fema…  2007
 4 Adelie  Torgersen           43.9          17.2       201.   4202. &lt;NA&gt;   2007
 5 Adelie  Torgersen           36.7          19.3       193    3450  fema…  2007
 6 Adelie  Torgersen           39.3          20.6       190    3650  male   2007
 7 Adelie  Torgersen           38.9          17.8       181    3625  fema…  2007
 8 Adelie  Torgersen           39.2          19.6       195    4675  male   2007
 9 Adelie  Torgersen           34.1          18.1       193    3475  &lt;NA&gt;   2007
10 Adelie  Torgersen           42            20.2       190    4250  &lt;NA&gt;   2007
# … with 334 more rows, and abbreviated variable names ¹​flipper_length_mm,
#   ²​body_mass_g</code></pre>
</div>
</div>
<p>Or better yet, perhaps we can replace the missing values with the average value within the relevant species and island.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb30-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(species, island) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb30-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric), </span>
<span id="cb30-4">                <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">condition =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(.), </span>
<span id="cb30-5">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">true =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> T), </span>
<span id="cb30-6">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">false =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(.)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb30-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 8
   species island    bill_length_mm bill_depth_mm flipper_…¹ body_…² sex    year
   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;
 1 Adelie  Torgersen           39.1          18.7       181    3750  male   2007
 2 Adelie  Torgersen           39.5          17.4       186    3800  fema…  2007
 3 Adelie  Torgersen           40.3          18         195    3250  fema…  2007
 4 Adelie  Torgersen           39.0          18.4       191.   3706. &lt;NA&gt;   2007
 5 Adelie  Torgersen           36.7          19.3       193    3450  fema…  2007
 6 Adelie  Torgersen           39.3          20.6       190    3650  male   2007
 7 Adelie  Torgersen           38.9          17.8       181    3625  fema…  2007
 8 Adelie  Torgersen           39.2          19.6       195    4675  male   2007
 9 Adelie  Torgersen           34.1          18.1       193    3475  &lt;NA&gt;   2007
10 Adelie  Torgersen           42            20.2       190    4250  &lt;NA&gt;   2007
# … with 334 more rows, and abbreviated variable names ¹​flipper_length_mm,
#   ²​body_mass_g</code></pre>
</div>
</div>
</section>
<section id="a-select-example" class="level1">
<h1>A select example</h1>
<p>When you’re using select, you don’t have to include the <code>across()</code> function, because the select helpers have always worked with <code>select()</code>. This means that you can just write</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 5
   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g  year
            &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;int&gt;
 1           39.1          18.7               181        3750  2007
 2           39.5          17.4               186        3800  2007
 3           40.3          18                 195        3250  2007
 4           NA            NA                  NA          NA  2007
 5           36.7          19.3               193        3450  2007
 6           39.3          20.6               190        3650  2007
 7           38.9          17.8               181        3625  2007
 8           39.2          19.6               195        4675  2007
 9           34.1          18.1               193        3475  2007
10           42            20.2               190        4250  2007
# … with 334 more rows</code></pre>
</div>
</div>
<p>rather than</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb34-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric)))</span></code></pre></div>
</div>
<p>which will throw an error.</p>
<p>Hopefully <code>across()</code> will make your life easier, as it has mine!</p>


</section>

 ]]></description>
  <category>R</category>
  <category>tidyverse</category>
  <category>dplyr</category>
  <guid>https://www.rebeccabarter.com/blog/2020-07-09-across.html</guid>
  <pubDate>Thu, 09 Jul 2020 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Tidymodels: tidy machine learning in R</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2020-03-25_machine_learning.html</link>
  <description><![CDATA[ 





<p>There’s a new modeling pipeline in town: tidymodels. Over the past few years, tidymodels has been gradually emerging as the tidyverse’s machine learning toolkit.</p>
<p>Why tidymodels? Well, it turns out that R has a consistency problem. Since everything was made by different people and using different principles, everything has a slightly different interface, and trying to keep everything in line can be frustrating. Several years ago, <a href="https://twitter.com/topepos">Max Kuhn</a> (formerly at Pfeizer, now at RStudio) developed the caret R package (see my <a href="http://www.rebeccabarter.com/blog/2017-11-17-caret_tutorial/">caret tutorial</a>) aimed at creating a uniform interface for the massive variety of machine learning models that exist in R. Caret was great in a lot of ways, but also limited in others. In my own use, I found it to be quite slow whenever I tried to use on problems of any kind of modest size.</p>
<p>That said, caret was a great starting point, so RStudio hired Max Kuhn to work on a tidy version of caret, and he and many other people have developed what has become tidymodels. Tidymodels has been in development for a few years, with snippets of it being released as they were developed (see my <a href="http://www.rebeccabarter.com/blog/2019-06-06_pre_processing/">post on the recipes package</a>). I’ve been holding off writing a post about tidymodels until it seemed as though the different pieces fit together sufficiently for it to all feel cohesive. I feel like they’re finally there - which means it is time for me to learn it! While caret isn’t going anywhere (you can continue to use caret, and your existing caret code isn’t going to stop working), tidymodels will eventually make it redundant.</p>
<p>The main resources I used to learn tidymodels were Alison Hill’s slides from <a href="https://education.rstudio.com/blog/2020/02/conf20-intro-ml/">Introduction to Machine Learning with the Tidyverse</a>, which contains all the slides for the course she prepared with Garrett Grolemund for RStudio::conf(2020), and Edgar Ruiz’s <a href="https://rviews.rstudio.com/2019/06/19/a-gentle-intro-to-tidymodels/">Gentle introduction to tidymodels</a> on the RStudio website.</p>
<p>Note that throughout this post I’ll be assuming basic tidyverse knowledge, primarily of dplyr (e.g.&nbsp;piping <code>%&gt;%</code> and function such as <code>mutate()</code>). Fortunately, for all you purrr-phobes out there, purrr is <em>not</em> required. If you’d like to brush up on your tidyverse skills, check out my <a href="http://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse/">Introduction to the Tidyverse</a> posts. If you’d like to learn purrr (purrr is very handy for working with tidymodels but is no longer a requirement), check out my <a href="http://www.rebeccabarter.com/blog/2019-08-19_purrr/">purrr post</a>.</p>
<section id="what-is-tidymodels" class="level1">
<h1>What is tidymodels</h1>
<p>Much like the tidyverse consists of many core packages, such as ggplot2 and dplyr, tidymodels also consists of several core packages, including</p>
<ul>
<li><p><code>rsample</code>: for sample splitting (e.g.&nbsp;train/test or cross-validation)</p></li>
<li><p><code>recipes</code>: for pre-processing</p></li>
<li><p><code>parsnip</code>: for specifying the model</p></li>
<li><p><code>yardstick</code>: for evaluating the model</p></li>
</ul>
<p>Similarly to how you can load the entire tidyverse suite of packages by typing <code>library(tidyverse)</code>, you can load the entire tidymodels suite of packages by typing <code>library(tidymodels)</code>.</p>
<p>We will also be using the <code>tune</code> package (for parameter tuning procedure) and the <code>workflows</code> package (for putting everything together) that I had thought were a part of CRAN’s tidymodels package bundle, but apparently they aren’t. These will need to be loaded separately for now.</p>
<p>Unlike in my <a href="http://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse/">tidyverse post</a>, I <em>won’t</em> base this post around the packages themselves, but I will mention the packages in passing.</p>
</section>
<section id="getting-set-up" class="level1">
<h1>Getting set up</h1>
<p>First we need to load some libraries: <code>tidymodels</code> and <code>tidyverse</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load the relevant tidymodels libraries</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidymodels)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(workflows)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tune)</span></code></pre></div>
</div>
<p>If you don’t already have the tidymodels library (or any of the other libraries) installed, then you’ll need to install it (once only) using <code>install.packages("tidymodels")</code>.</p>
<p>We will use the Pima Indian Women’s diabetes dataset which contains information on 768 Pima Indian women’s diabetes status, as well as many predictive features such as the number of pregnancies (pregnant), plasma glucose concentration (glucose), diastolic blood pressure (pressure), triceps skin fold thickness (triceps), 2-hour serum insulin (insulin), BMI (mass), diabetes pedigree function (pedigree), and their age (age). In case you were wondering, the <a href="https://en.wikipedia.org/wiki/Pima_people">Pima Indians</a> are a group of Native Americans living in an area consisting of what is now central and southern Arizona. The short name, “Pima” is believed to have come from a phrase meaning “I don’t know,” which they used repeatedly in their initial meetings with Spanish colonists. Thanks Wikipedia!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load the Pima Indians dataset from the mlbench dataset</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mlbench)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(PimaIndiansDiabetes)</span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rename dataset to have shorter name because lazy</span></span>
<span id="cb2-5">diabetes_orig <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> PimaIndiansDiabetes</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">diabetes_orig</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    pregnant glucose pressure triceps insulin mass pedigree age diabetes
1          6     148       72      35       0 33.6    0.627  50      pos
2          1      85       66      29       0 26.6    0.351  31      neg
3          8     183       64       0       0 23.3    0.672  32      pos
4          1      89       66      23      94 28.1    0.167  21      neg
5          0     137       40      35     168 43.1    2.288  33      pos
6          5     116       74       0       0 25.6    0.201  30      neg
7          3      78       50      32      88 31.0    0.248  26      pos
8         10     115        0       0       0 35.3    0.134  29      neg
9          2     197       70      45     543 30.5    0.158  53      pos
10         8     125       96       0       0  0.0    0.232  54      pos
11         4     110       92       0       0 37.6    0.191  30      neg
12        10     168       74       0       0 38.0    0.537  34      pos
13        10     139       80       0       0 27.1    1.441  57      neg
14         1     189       60      23     846 30.1    0.398  59      pos
15         5     166       72      19     175 25.8    0.587  51      pos
16         7     100        0       0       0 30.0    0.484  32      pos
17         0     118       84      47     230 45.8    0.551  31      pos
18         7     107       74       0       0 29.6    0.254  31      pos
19         1     103       30      38      83 43.3    0.183  33      neg
20         1     115       70      30      96 34.6    0.529  32      pos
21         3     126       88      41     235 39.3    0.704  27      neg
22         8      99       84       0       0 35.4    0.388  50      neg
23         7     196       90       0       0 39.8    0.451  41      pos
24         9     119       80      35       0 29.0    0.263  29      pos
25        11     143       94      33     146 36.6    0.254  51      pos
26        10     125       70      26     115 31.1    0.205  41      pos
27         7     147       76       0       0 39.4    0.257  43      pos
28         1      97       66      15     140 23.2    0.487  22      neg
29        13     145       82      19     110 22.2    0.245  57      neg
30         5     117       92       0       0 34.1    0.337  38      neg
31         5     109       75      26       0 36.0    0.546  60      neg
32         3     158       76      36     245 31.6    0.851  28      pos
33         3      88       58      11      54 24.8    0.267  22      neg
34         6      92       92       0       0 19.9    0.188  28      neg
35        10     122       78      31       0 27.6    0.512  45      neg
36         4     103       60      33     192 24.0    0.966  33      neg
37        11     138       76       0       0 33.2    0.420  35      neg
38         9     102       76      37       0 32.9    0.665  46      pos
39         2      90       68      42       0 38.2    0.503  27      pos
40         4     111       72      47     207 37.1    1.390  56      pos
41         3     180       64      25      70 34.0    0.271  26      neg
42         7     133       84       0       0 40.2    0.696  37      neg
43         7     106       92      18       0 22.7    0.235  48      neg
44         9     171      110      24     240 45.4    0.721  54      pos
45         7     159       64       0       0 27.4    0.294  40      neg
46         0     180       66      39       0 42.0    1.893  25      pos
47         1     146       56       0       0 29.7    0.564  29      neg
48         2      71       70      27       0 28.0    0.586  22      neg
49         7     103       66      32       0 39.1    0.344  31      pos
50         7     105        0       0       0  0.0    0.305  24      neg
51         1     103       80      11      82 19.4    0.491  22      neg
52         1     101       50      15      36 24.2    0.526  26      neg
53         5      88       66      21      23 24.4    0.342  30      neg
54         8     176       90      34     300 33.7    0.467  58      pos
55         7     150       66      42     342 34.7    0.718  42      neg
56         1      73       50      10       0 23.0    0.248  21      neg
57         7     187       68      39     304 37.7    0.254  41      pos
58         0     100       88      60     110 46.8    0.962  31      neg
59         0     146       82       0       0 40.5    1.781  44      neg
60         0     105       64      41     142 41.5    0.173  22      neg
61         2      84        0       0       0  0.0    0.304  21      neg
62         8     133       72       0       0 32.9    0.270  39      pos
63         5      44       62       0       0 25.0    0.587  36      neg
64         2     141       58      34     128 25.4    0.699  24      neg
65         7     114       66       0       0 32.8    0.258  42      pos
66         5      99       74      27       0 29.0    0.203  32      neg
67         0     109       88      30       0 32.5    0.855  38      pos
68         2     109       92       0       0 42.7    0.845  54      neg
69         1      95       66      13      38 19.6    0.334  25      neg
70         4     146       85      27     100 28.9    0.189  27      neg
71         2     100       66      20      90 32.9    0.867  28      pos
72         5     139       64      35     140 28.6    0.411  26      neg
73        13     126       90       0       0 43.4    0.583  42      pos
74         4     129       86      20     270 35.1    0.231  23      neg
75         1      79       75      30       0 32.0    0.396  22      neg
76         1       0       48      20       0 24.7    0.140  22      neg
77         7      62       78       0       0 32.6    0.391  41      neg
78         5      95       72      33       0 37.7    0.370  27      neg
79         0     131        0       0       0 43.2    0.270  26      pos
80         2     112       66      22       0 25.0    0.307  24      neg
81         3     113       44      13       0 22.4    0.140  22      neg
82         2      74        0       0       0  0.0    0.102  22      neg
83         7      83       78      26      71 29.3    0.767  36      neg
84         0     101       65      28       0 24.6    0.237  22      neg
85         5     137      108       0       0 48.8    0.227  37      pos
86         2     110       74      29     125 32.4    0.698  27      neg
87        13     106       72      54       0 36.6    0.178  45      neg
88         2     100       68      25      71 38.5    0.324  26      neg
89        15     136       70      32     110 37.1    0.153  43      pos
90         1     107       68      19       0 26.5    0.165  24      neg
91         1      80       55       0       0 19.1    0.258  21      neg
92         4     123       80      15     176 32.0    0.443  34      neg
93         7      81       78      40      48 46.7    0.261  42      neg
94         4     134       72       0       0 23.8    0.277  60      pos
95         2     142       82      18      64 24.7    0.761  21      neg
96         6     144       72      27     228 33.9    0.255  40      neg
97         2      92       62      28       0 31.6    0.130  24      neg
98         1      71       48      18      76 20.4    0.323  22      neg
99         6      93       50      30      64 28.7    0.356  23      neg
100        1     122       90      51     220 49.7    0.325  31      pos
101        1     163       72       0       0 39.0    1.222  33      pos
102        1     151       60       0       0 26.1    0.179  22      neg
103        0     125       96       0       0 22.5    0.262  21      neg
104        1      81       72      18      40 26.6    0.283  24      neg
105        2      85       65       0       0 39.6    0.930  27      neg
106        1     126       56      29     152 28.7    0.801  21      neg
107        1      96      122       0       0 22.4    0.207  27      neg
108        4     144       58      28     140 29.5    0.287  37      neg
109        3      83       58      31      18 34.3    0.336  25      neg
110        0      95       85      25      36 37.4    0.247  24      pos
111        3     171       72      33     135 33.3    0.199  24      pos
112        8     155       62      26     495 34.0    0.543  46      pos
113        1      89       76      34      37 31.2    0.192  23      neg
114        4      76       62       0       0 34.0    0.391  25      neg
115        7     160       54      32     175 30.5    0.588  39      pos
116        4     146       92       0       0 31.2    0.539  61      pos
117        5     124       74       0       0 34.0    0.220  38      pos
118        5      78       48       0       0 33.7    0.654  25      neg
119        4      97       60      23       0 28.2    0.443  22      neg
120        4      99       76      15      51 23.2    0.223  21      neg
121        0     162       76      56     100 53.2    0.759  25      pos
122        6     111       64      39       0 34.2    0.260  24      neg
123        2     107       74      30     100 33.6    0.404  23      neg
124        5     132       80       0       0 26.8    0.186  69      neg
125        0     113       76       0       0 33.3    0.278  23      pos
126        1      88       30      42      99 55.0    0.496  26      pos
127        3     120       70      30     135 42.9    0.452  30      neg
128        1     118       58      36      94 33.3    0.261  23      neg
129        1     117       88      24     145 34.5    0.403  40      pos
130        0     105       84       0       0 27.9    0.741  62      pos
131        4     173       70      14     168 29.7    0.361  33      pos
132        9     122       56       0       0 33.3    1.114  33      pos
133        3     170       64      37     225 34.5    0.356  30      pos
134        8      84       74      31       0 38.3    0.457  39      neg
135        2      96       68      13      49 21.1    0.647  26      neg
136        2     125       60      20     140 33.8    0.088  31      neg
137        0     100       70      26      50 30.8    0.597  21      neg
138        0      93       60      25      92 28.7    0.532  22      neg
139        0     129       80       0       0 31.2    0.703  29      neg
140        5     105       72      29     325 36.9    0.159  28      neg
141        3     128       78       0       0 21.1    0.268  55      neg
142        5     106       82      30       0 39.5    0.286  38      neg
143        2     108       52      26      63 32.5    0.318  22      neg
144       10     108       66       0       0 32.4    0.272  42      pos
145        4     154       62      31     284 32.8    0.237  23      neg
146        0     102       75      23       0  0.0    0.572  21      neg
147        9      57       80      37       0 32.8    0.096  41      neg
148        2     106       64      35     119 30.5    1.400  34      neg
149        5     147       78       0       0 33.7    0.218  65      neg
150        2      90       70      17       0 27.3    0.085  22      neg
151        1     136       74      50     204 37.4    0.399  24      neg
152        4     114       65       0       0 21.9    0.432  37      neg
153        9     156       86      28     155 34.3    1.189  42      pos
154        1     153       82      42     485 40.6    0.687  23      neg
155        8     188       78       0       0 47.9    0.137  43      pos
156        7     152       88      44       0 50.0    0.337  36      pos
157        2      99       52      15      94 24.6    0.637  21      neg
158        1     109       56      21     135 25.2    0.833  23      neg
159        2      88       74      19      53 29.0    0.229  22      neg
160       17     163       72      41     114 40.9    0.817  47      pos
161        4     151       90      38       0 29.7    0.294  36      neg
162        7     102       74      40     105 37.2    0.204  45      neg
163        0     114       80      34     285 44.2    0.167  27      neg
164        2     100       64      23       0 29.7    0.368  21      neg
165        0     131       88       0       0 31.6    0.743  32      pos
166        6     104       74      18     156 29.9    0.722  41      pos
167        3     148       66      25       0 32.5    0.256  22      neg
168        4     120       68       0       0 29.6    0.709  34      neg
169        4     110       66       0       0 31.9    0.471  29      neg
170        3     111       90      12      78 28.4    0.495  29      neg
171        6     102       82       0       0 30.8    0.180  36      pos
172        6     134       70      23     130 35.4    0.542  29      pos
173        2      87        0      23       0 28.9    0.773  25      neg
174        1      79       60      42      48 43.5    0.678  23      neg
175        2      75       64      24      55 29.7    0.370  33      neg
176        8     179       72      42     130 32.7    0.719  36      pos
177        6      85       78       0       0 31.2    0.382  42      neg
178        0     129      110      46     130 67.1    0.319  26      pos
179        5     143       78       0       0 45.0    0.190  47      neg
180        5     130       82       0       0 39.1    0.956  37      pos
181        6      87       80       0       0 23.2    0.084  32      neg
182        0     119       64      18      92 34.9    0.725  23      neg
183        1       0       74      20      23 27.7    0.299  21      neg
184        5      73       60       0       0 26.8    0.268  27      neg
185        4     141       74       0       0 27.6    0.244  40      neg
186        7     194       68      28       0 35.9    0.745  41      pos
187        8     181       68      36     495 30.1    0.615  60      pos
188        1     128       98      41      58 32.0    1.321  33      pos
189        8     109       76      39     114 27.9    0.640  31      pos
190        5     139       80      35     160 31.6    0.361  25      pos
191        3     111       62       0       0 22.6    0.142  21      neg
192        9     123       70      44      94 33.1    0.374  40      neg
193        7     159       66       0       0 30.4    0.383  36      pos
194       11     135        0       0       0 52.3    0.578  40      pos
195        8      85       55      20       0 24.4    0.136  42      neg
196        5     158       84      41     210 39.4    0.395  29      pos
197        1     105       58       0       0 24.3    0.187  21      neg
198        3     107       62      13      48 22.9    0.678  23      pos
199        4     109       64      44      99 34.8    0.905  26      pos
200        4     148       60      27     318 30.9    0.150  29      pos
201        0     113       80      16       0 31.0    0.874  21      neg
202        1     138       82       0       0 40.1    0.236  28      neg
203        0     108       68      20       0 27.3    0.787  32      neg
204        2      99       70      16      44 20.4    0.235  27      neg
205        6     103       72      32     190 37.7    0.324  55      neg
206        5     111       72      28       0 23.9    0.407  27      neg
207        8     196       76      29     280 37.5    0.605  57      pos
208        5     162      104       0       0 37.7    0.151  52      pos
209        1      96       64      27      87 33.2    0.289  21      neg
210        7     184       84      33       0 35.5    0.355  41      pos
211        2      81       60      22       0 27.7    0.290  25      neg
212        0     147       85      54       0 42.8    0.375  24      neg
213        7     179       95      31       0 34.2    0.164  60      neg
214        0     140       65      26     130 42.6    0.431  24      pos
215        9     112       82      32     175 34.2    0.260  36      pos
216       12     151       70      40     271 41.8    0.742  38      pos
217        5     109       62      41     129 35.8    0.514  25      pos
218        6     125       68      30     120 30.0    0.464  32      neg
219        5      85       74      22       0 29.0    1.224  32      pos
220        5     112       66       0       0 37.8    0.261  41      pos
221        0     177       60      29     478 34.6    1.072  21      pos
222        2     158       90       0       0 31.6    0.805  66      pos
223        7     119        0       0       0 25.2    0.209  37      neg
224        7     142       60      33     190 28.8    0.687  61      neg
225        1     100       66      15      56 23.6    0.666  26      neg
226        1      87       78      27      32 34.6    0.101  22      neg
227        0     101       76       0       0 35.7    0.198  26      neg
228        3     162       52      38       0 37.2    0.652  24      pos
229        4     197       70      39     744 36.7    2.329  31      neg
230        0     117       80      31      53 45.2    0.089  24      neg
231        4     142       86       0       0 44.0    0.645  22      pos
232        6     134       80      37     370 46.2    0.238  46      pos
233        1      79       80      25      37 25.4    0.583  22      neg
234        4     122       68       0       0 35.0    0.394  29      neg
235        3      74       68      28      45 29.7    0.293  23      neg
236        4     171       72       0       0 43.6    0.479  26      pos
237        7     181       84      21     192 35.9    0.586  51      pos
238        0     179       90      27       0 44.1    0.686  23      pos
239        9     164       84      21       0 30.8    0.831  32      pos
240        0     104       76       0       0 18.4    0.582  27      neg
241        1      91       64      24       0 29.2    0.192  21      neg
242        4      91       70      32      88 33.1    0.446  22      neg
243        3     139       54       0       0 25.6    0.402  22      pos
244        6     119       50      22     176 27.1    1.318  33      pos
245        2     146       76      35     194 38.2    0.329  29      neg
246        9     184       85      15       0 30.0    1.213  49      pos
247       10     122       68       0       0 31.2    0.258  41      neg
248        0     165       90      33     680 52.3    0.427  23      neg
249        9     124       70      33     402 35.4    0.282  34      neg
250        1     111       86      19       0 30.1    0.143  23      neg
251        9     106       52       0       0 31.2    0.380  42      neg
252        2     129       84       0       0 28.0    0.284  27      neg
253        2      90       80      14      55 24.4    0.249  24      neg
254        0      86       68      32       0 35.8    0.238  25      neg
255       12      92       62       7     258 27.6    0.926  44      pos
256        1     113       64      35       0 33.6    0.543  21      pos
257        3     111       56      39       0 30.1    0.557  30      neg
258        2     114       68      22       0 28.7    0.092  25      neg
259        1     193       50      16     375 25.9    0.655  24      neg
260       11     155       76      28     150 33.3    1.353  51      pos
261        3     191       68      15     130 30.9    0.299  34      neg
262        3     141        0       0       0 30.0    0.761  27      pos
263        4      95       70      32       0 32.1    0.612  24      neg
264        3     142       80      15       0 32.4    0.200  63      neg
265        4     123       62       0       0 32.0    0.226  35      pos
266        5      96       74      18      67 33.6    0.997  43      neg
267        0     138        0       0       0 36.3    0.933  25      pos
268        2     128       64      42       0 40.0    1.101  24      neg
269        0     102       52       0       0 25.1    0.078  21      neg
270        2     146        0       0       0 27.5    0.240  28      pos
271       10     101       86      37       0 45.6    1.136  38      pos
272        2     108       62      32      56 25.2    0.128  21      neg
273        3     122       78       0       0 23.0    0.254  40      neg
274        1      71       78      50      45 33.2    0.422  21      neg
275       13     106       70       0       0 34.2    0.251  52      neg
276        2     100       70      52      57 40.5    0.677  25      neg
277        7     106       60      24       0 26.5    0.296  29      pos
278        0     104       64      23     116 27.8    0.454  23      neg
279        5     114       74       0       0 24.9    0.744  57      neg
280        2     108       62      10     278 25.3    0.881  22      neg
281        0     146       70       0       0 37.9    0.334  28      pos
282       10     129       76      28     122 35.9    0.280  39      neg
283        7     133       88      15     155 32.4    0.262  37      neg
284        7     161       86       0       0 30.4    0.165  47      pos
285        2     108       80       0       0 27.0    0.259  52      pos
286        7     136       74      26     135 26.0    0.647  51      neg
287        5     155       84      44     545 38.7    0.619  34      neg
288        1     119       86      39     220 45.6    0.808  29      pos
289        4      96       56      17      49 20.8    0.340  26      neg
290        5     108       72      43      75 36.1    0.263  33      neg
291        0      78       88      29      40 36.9    0.434  21      neg
292        0     107       62      30      74 36.6    0.757  25      pos
293        2     128       78      37     182 43.3    1.224  31      pos
294        1     128       48      45     194 40.5    0.613  24      pos
295        0     161       50       0       0 21.9    0.254  65      neg
296        6     151       62      31     120 35.5    0.692  28      neg
297        2     146       70      38     360 28.0    0.337  29      pos
298        0     126       84      29     215 30.7    0.520  24      neg
299       14     100       78      25     184 36.6    0.412  46      pos
300        8     112       72       0       0 23.6    0.840  58      neg
301        0     167        0       0       0 32.3    0.839  30      pos
302        2     144       58      33     135 31.6    0.422  25      pos
303        5      77       82      41      42 35.8    0.156  35      neg
304        5     115       98       0       0 52.9    0.209  28      pos
305        3     150       76       0       0 21.0    0.207  37      neg
306        2     120       76      37     105 39.7    0.215  29      neg
307       10     161       68      23     132 25.5    0.326  47      pos
308        0     137       68      14     148 24.8    0.143  21      neg
309        0     128       68      19     180 30.5    1.391  25      pos
310        2     124       68      28     205 32.9    0.875  30      pos
311        6      80       66      30       0 26.2    0.313  41      neg
312        0     106       70      37     148 39.4    0.605  22      neg
313        2     155       74      17      96 26.6    0.433  27      pos
314        3     113       50      10      85 29.5    0.626  25      neg
315        7     109       80      31       0 35.9    1.127  43      pos
316        2     112       68      22      94 34.1    0.315  26      neg
317        3      99       80      11      64 19.3    0.284  30      neg
318        3     182       74       0       0 30.5    0.345  29      pos
319        3     115       66      39     140 38.1    0.150  28      neg
320        6     194       78       0       0 23.5    0.129  59      pos
321        4     129       60      12     231 27.5    0.527  31      neg
322        3     112       74      30       0 31.6    0.197  25      pos
323        0     124       70      20       0 27.4    0.254  36      pos
324       13     152       90      33      29 26.8    0.731  43      pos
325        2     112       75      32       0 35.7    0.148  21      neg
326        1     157       72      21     168 25.6    0.123  24      neg
327        1     122       64      32     156 35.1    0.692  30      pos
328       10     179       70       0       0 35.1    0.200  37      neg
329        2     102       86      36     120 45.5    0.127  23      pos
330        6     105       70      32      68 30.8    0.122  37      neg
331        8     118       72      19       0 23.1    1.476  46      neg
332        2      87       58      16      52 32.7    0.166  25      neg
333        1     180        0       0       0 43.3    0.282  41      pos
334       12     106       80       0       0 23.6    0.137  44      neg
335        1      95       60      18      58 23.9    0.260  22      neg
336        0     165       76      43     255 47.9    0.259  26      neg
337        0     117        0       0       0 33.8    0.932  44      neg
338        5     115       76       0       0 31.2    0.343  44      pos
339        9     152       78      34     171 34.2    0.893  33      pos
340        7     178       84       0       0 39.9    0.331  41      pos
341        1     130       70      13     105 25.9    0.472  22      neg
342        1      95       74      21      73 25.9    0.673  36      neg
343        1       0       68      35       0 32.0    0.389  22      neg
344        5     122       86       0       0 34.7    0.290  33      neg
345        8      95       72       0       0 36.8    0.485  57      neg
346        8     126       88      36     108 38.5    0.349  49      neg
347        1     139       46      19      83 28.7    0.654  22      neg
348        3     116        0       0       0 23.5    0.187  23      neg
349        3      99       62      19      74 21.8    0.279  26      neg
350        5       0       80      32       0 41.0    0.346  37      pos
351        4      92       80       0       0 42.2    0.237  29      neg
352        4     137       84       0       0 31.2    0.252  30      neg
353        3      61       82      28       0 34.4    0.243  46      neg
354        1      90       62      12      43 27.2    0.580  24      neg
355        3      90       78       0       0 42.7    0.559  21      neg
356        9     165       88       0       0 30.4    0.302  49      pos
357        1     125       50      40     167 33.3    0.962  28      pos
358       13     129        0      30       0 39.9    0.569  44      pos
359       12      88       74      40      54 35.3    0.378  48      neg
360        1     196       76      36     249 36.5    0.875  29      pos
361        5     189       64      33     325 31.2    0.583  29      pos
362        5     158       70       0       0 29.8    0.207  63      neg
363        5     103      108      37       0 39.2    0.305  65      neg
364        4     146       78       0       0 38.5    0.520  67      pos
365        4     147       74      25     293 34.9    0.385  30      neg
366        5      99       54      28      83 34.0    0.499  30      neg
367        6     124       72       0       0 27.6    0.368  29      pos
368        0     101       64      17       0 21.0    0.252  21      neg
369        3      81       86      16      66 27.5    0.306  22      neg
370        1     133      102      28     140 32.8    0.234  45      pos
371        3     173       82      48     465 38.4    2.137  25      pos
372        0     118       64      23      89  0.0    1.731  21      neg
373        0      84       64      22      66 35.8    0.545  21      neg
374        2     105       58      40      94 34.9    0.225  25      neg
375        2     122       52      43     158 36.2    0.816  28      neg
376       12     140       82      43     325 39.2    0.528  58      pos
377        0      98       82      15      84 25.2    0.299  22      neg
378        1      87       60      37      75 37.2    0.509  22      neg
379        4     156       75       0       0 48.3    0.238  32      pos
380        0      93      100      39      72 43.4    1.021  35      neg
381        1     107       72      30      82 30.8    0.821  24      neg
382        0     105       68      22       0 20.0    0.236  22      neg
383        1     109       60       8     182 25.4    0.947  21      neg
384        1      90       62      18      59 25.1    1.268  25      neg
385        1     125       70      24     110 24.3    0.221  25      neg
386        1     119       54      13      50 22.3    0.205  24      neg
387        5     116       74      29       0 32.3    0.660  35      pos
388        8     105      100      36       0 43.3    0.239  45      pos
389        5     144       82      26     285 32.0    0.452  58      pos
390        3     100       68      23      81 31.6    0.949  28      neg
391        1     100       66      29     196 32.0    0.444  42      neg
392        5     166       76       0       0 45.7    0.340  27      pos
393        1     131       64      14     415 23.7    0.389  21      neg
394        4     116       72      12      87 22.1    0.463  37      neg
395        4     158       78       0       0 32.9    0.803  31      pos
396        2     127       58      24     275 27.7    1.600  25      neg
397        3      96       56      34     115 24.7    0.944  39      neg
398        0     131       66      40       0 34.3    0.196  22      pos
399        3      82       70       0       0 21.1    0.389  25      neg
400        3     193       70      31       0 34.9    0.241  25      pos
401        4      95       64       0       0 32.0    0.161  31      pos
402        6     137       61       0       0 24.2    0.151  55      neg
403        5     136       84      41      88 35.0    0.286  35      pos
404        9      72       78      25       0 31.6    0.280  38      neg
405        5     168       64       0       0 32.9    0.135  41      pos
406        2     123       48      32     165 42.1    0.520  26      neg
407        4     115       72       0       0 28.9    0.376  46      pos
408        0     101       62       0       0 21.9    0.336  25      neg
409        8     197       74       0       0 25.9    1.191  39      pos
410        1     172       68      49     579 42.4    0.702  28      pos
411        6     102       90      39       0 35.7    0.674  28      neg
412        1     112       72      30     176 34.4    0.528  25      neg
413        1     143       84      23     310 42.4    1.076  22      neg
414        1     143       74      22      61 26.2    0.256  21      neg
415        0     138       60      35     167 34.6    0.534  21      pos
416        3     173       84      33     474 35.7    0.258  22      pos
417        1      97       68      21       0 27.2    1.095  22      neg
418        4     144       82      32       0 38.5    0.554  37      pos
419        1      83       68       0       0 18.2    0.624  27      neg
420        3     129       64      29     115 26.4    0.219  28      pos
421        1     119       88      41     170 45.3    0.507  26      neg
422        2      94       68      18      76 26.0    0.561  21      neg
423        0     102       64      46      78 40.6    0.496  21      neg
424        2     115       64      22       0 30.8    0.421  21      neg
425        8     151       78      32     210 42.9    0.516  36      pos
426        4     184       78      39     277 37.0    0.264  31      pos
427        0      94        0       0       0  0.0    0.256  25      neg
428        1     181       64      30     180 34.1    0.328  38      pos
429        0     135       94      46     145 40.6    0.284  26      neg
430        1      95       82      25     180 35.0    0.233  43      pos
431        2      99        0       0       0 22.2    0.108  23      neg
432        3      89       74      16      85 30.4    0.551  38      neg
433        1      80       74      11      60 30.0    0.527  22      neg
434        2     139       75       0       0 25.6    0.167  29      neg
435        1      90       68       8       0 24.5    1.138  36      neg
436        0     141        0       0       0 42.4    0.205  29      pos
437       12     140       85      33       0 37.4    0.244  41      neg
438        5     147       75       0       0 29.9    0.434  28      neg
439        1      97       70      15       0 18.2    0.147  21      neg
440        6     107       88       0       0 36.8    0.727  31      neg
441        0     189      104      25       0 34.3    0.435  41      pos
442        2      83       66      23      50 32.2    0.497  22      neg
443        4     117       64      27     120 33.2    0.230  24      neg
444        8     108       70       0       0 30.5    0.955  33      pos
445        4     117       62      12       0 29.7    0.380  30      pos
446        0     180       78      63      14 59.4    2.420  25      pos
447        1     100       72      12      70 25.3    0.658  28      neg
448        0      95       80      45      92 36.5    0.330  26      neg
449        0     104       64      37      64 33.6    0.510  22      pos
450        0     120       74      18      63 30.5    0.285  26      neg
451        1      82       64      13      95 21.2    0.415  23      neg
452        2     134       70       0       0 28.9    0.542  23      pos
453        0      91       68      32     210 39.9    0.381  25      neg
454        2     119        0       0       0 19.6    0.832  72      neg
455        2     100       54      28     105 37.8    0.498  24      neg
456       14     175       62      30       0 33.6    0.212  38      pos
457        1     135       54       0       0 26.7    0.687  62      neg
458        5      86       68      28      71 30.2    0.364  24      neg
459       10     148       84      48     237 37.6    1.001  51      pos
460        9     134       74      33      60 25.9    0.460  81      neg
461        9     120       72      22      56 20.8    0.733  48      neg
462        1      71       62       0       0 21.8    0.416  26      neg
463        8      74       70      40      49 35.3    0.705  39      neg
464        5      88       78      30       0 27.6    0.258  37      neg
465       10     115       98       0       0 24.0    1.022  34      neg
466        0     124       56      13     105 21.8    0.452  21      neg
467        0      74       52      10      36 27.8    0.269  22      neg
468        0      97       64      36     100 36.8    0.600  25      neg
469        8     120        0       0       0 30.0    0.183  38      pos
470        6     154       78      41     140 46.1    0.571  27      neg
471        1     144       82      40       0 41.3    0.607  28      neg
472        0     137       70      38       0 33.2    0.170  22      neg
473        0     119       66      27       0 38.8    0.259  22      neg
474        7     136       90       0       0 29.9    0.210  50      neg
475        4     114       64       0       0 28.9    0.126  24      neg
476        0     137       84      27       0 27.3    0.231  59      neg
477        2     105       80      45     191 33.7    0.711  29      pos
478        7     114       76      17     110 23.8    0.466  31      neg
479        8     126       74      38      75 25.9    0.162  39      neg
480        4     132       86      31       0 28.0    0.419  63      neg
481        3     158       70      30     328 35.5    0.344  35      pos
482        0     123       88      37       0 35.2    0.197  29      neg
483        4      85       58      22      49 27.8    0.306  28      neg
484        0      84       82      31     125 38.2    0.233  23      neg
485        0     145        0       0       0 44.2    0.630  31      pos
486        0     135       68      42     250 42.3    0.365  24      pos
487        1     139       62      41     480 40.7    0.536  21      neg
488        0     173       78      32     265 46.5    1.159  58      neg
489        4      99       72      17       0 25.6    0.294  28      neg
490        8     194       80       0       0 26.1    0.551  67      neg
491        2      83       65      28      66 36.8    0.629  24      neg
492        2      89       90      30       0 33.5    0.292  42      neg
493        4      99       68      38       0 32.8    0.145  33      neg
494        4     125       70      18     122 28.9    1.144  45      pos
495        3      80        0       0       0  0.0    0.174  22      neg
496        6     166       74       0       0 26.6    0.304  66      neg
497        5     110       68       0       0 26.0    0.292  30      neg
498        2      81       72      15      76 30.1    0.547  25      neg
499        7     195       70      33     145 25.1    0.163  55      pos
500        6     154       74      32     193 29.3    0.839  39      neg
501        2     117       90      19      71 25.2    0.313  21      neg
502        3      84       72      32       0 37.2    0.267  28      neg
503        6       0       68      41       0 39.0    0.727  41      pos
504        7      94       64      25      79 33.3    0.738  41      neg
505        3      96       78      39       0 37.3    0.238  40      neg
506       10      75       82       0       0 33.3    0.263  38      neg
507        0     180       90      26      90 36.5    0.314  35      pos
508        1     130       60      23     170 28.6    0.692  21      neg
509        2      84       50      23      76 30.4    0.968  21      neg
510        8     120       78       0       0 25.0    0.409  64      neg
511       12      84       72      31       0 29.7    0.297  46      pos
512        0     139       62      17     210 22.1    0.207  21      neg
513        9      91       68       0       0 24.2    0.200  58      neg
514        2      91       62       0       0 27.3    0.525  22      neg
515        3      99       54      19      86 25.6    0.154  24      neg
516        3     163       70      18     105 31.6    0.268  28      pos
517        9     145       88      34     165 30.3    0.771  53      pos
518        7     125       86       0       0 37.6    0.304  51      neg
519       13      76       60       0       0 32.8    0.180  41      neg
520        6     129       90       7     326 19.6    0.582  60      neg
521        2      68       70      32      66 25.0    0.187  25      neg
522        3     124       80      33     130 33.2    0.305  26      neg
523        6     114        0       0       0  0.0    0.189  26      neg
524        9     130       70       0       0 34.2    0.652  45      pos
525        3     125       58       0       0 31.6    0.151  24      neg
526        3      87       60      18       0 21.8    0.444  21      neg
527        1      97       64      19      82 18.2    0.299  21      neg
528        3     116       74      15     105 26.3    0.107  24      neg
529        0     117       66      31     188 30.8    0.493  22      neg
530        0     111       65       0       0 24.6    0.660  31      neg
531        2     122       60      18     106 29.8    0.717  22      neg
532        0     107       76       0       0 45.3    0.686  24      neg
533        1      86       66      52      65 41.3    0.917  29      neg
534        6      91        0       0       0 29.8    0.501  31      neg
535        1      77       56      30      56 33.3    1.251  24      neg
536        4     132        0       0       0 32.9    0.302  23      pos
537        0     105       90       0       0 29.6    0.197  46      neg
538        0      57       60       0       0 21.7    0.735  67      neg
539        0     127       80      37     210 36.3    0.804  23      neg
540        3     129       92      49     155 36.4    0.968  32      pos
541        8     100       74      40     215 39.4    0.661  43      pos
542        3     128       72      25     190 32.4    0.549  27      pos
543       10      90       85      32       0 34.9    0.825  56      pos
544        4      84       90      23      56 39.5    0.159  25      neg
545        1      88       78      29      76 32.0    0.365  29      neg
546        8     186       90      35     225 34.5    0.423  37      pos
547        5     187       76      27     207 43.6    1.034  53      pos
548        4     131       68      21     166 33.1    0.160  28      neg
549        1     164       82      43      67 32.8    0.341  50      neg
550        4     189      110      31       0 28.5    0.680  37      neg
551        1     116       70      28       0 27.4    0.204  21      neg
552        3      84       68      30     106 31.9    0.591  25      neg
553        6     114       88       0       0 27.8    0.247  66      neg
554        1      88       62      24      44 29.9    0.422  23      neg
555        1      84       64      23     115 36.9    0.471  28      neg
556        7     124       70      33     215 25.5    0.161  37      neg
557        1      97       70      40       0 38.1    0.218  30      neg
558        8     110       76       0       0 27.8    0.237  58      neg
559       11     103       68      40       0 46.2    0.126  42      neg
560       11      85       74       0       0 30.1    0.300  35      neg
561        6     125       76       0       0 33.8    0.121  54      pos
562        0     198       66      32     274 41.3    0.502  28      pos
563        1      87       68      34      77 37.6    0.401  24      neg
564        6      99       60      19      54 26.9    0.497  32      neg
565        0      91       80       0       0 32.4    0.601  27      neg
566        2      95       54      14      88 26.1    0.748  22      neg
567        1      99       72      30      18 38.6    0.412  21      neg
568        6      92       62      32     126 32.0    0.085  46      neg
569        4     154       72      29     126 31.3    0.338  37      neg
570        0     121       66      30     165 34.3    0.203  33      pos
571        3      78       70       0       0 32.5    0.270  39      neg
572        2     130       96       0       0 22.6    0.268  21      neg
573        3     111       58      31      44 29.5    0.430  22      neg
574        2      98       60      17     120 34.7    0.198  22      neg
575        1     143       86      30     330 30.1    0.892  23      neg
576        1     119       44      47      63 35.5    0.280  25      neg
577        6     108       44      20     130 24.0    0.813  35      neg
578        2     118       80       0       0 42.9    0.693  21      pos
579       10     133       68       0       0 27.0    0.245  36      neg
580        2     197       70      99       0 34.7    0.575  62      pos
581        0     151       90      46       0 42.1    0.371  21      pos
582        6     109       60      27       0 25.0    0.206  27      neg
583       12     121       78      17       0 26.5    0.259  62      neg
584        8     100       76       0       0 38.7    0.190  42      neg
585        8     124       76      24     600 28.7    0.687  52      pos
586        1      93       56      11       0 22.5    0.417  22      neg
587        8     143       66       0       0 34.9    0.129  41      pos
588        6     103       66       0       0 24.3    0.249  29      neg
589        3     176       86      27     156 33.3    1.154  52      pos
590        0      73        0       0       0 21.1    0.342  25      neg
591       11     111       84      40       0 46.8    0.925  45      pos
592        2     112       78      50     140 39.4    0.175  24      neg
593        3     132       80       0       0 34.4    0.402  44      pos
594        2      82       52      22     115 28.5    1.699  25      neg
595        6     123       72      45     230 33.6    0.733  34      neg
596        0     188       82      14     185 32.0    0.682  22      pos
597        0      67       76       0       0 45.3    0.194  46      neg
598        1      89       24      19      25 27.8    0.559  21      neg
599        1     173       74       0       0 36.8    0.088  38      pos
600        1     109       38      18     120 23.1    0.407  26      neg
601        1     108       88      19       0 27.1    0.400  24      neg
602        6      96        0       0       0 23.7    0.190  28      neg
603        1     124       74      36       0 27.8    0.100  30      neg
604        7     150       78      29     126 35.2    0.692  54      pos
605        4     183        0       0       0 28.4    0.212  36      pos
606        1     124       60      32       0 35.8    0.514  21      neg
607        1     181       78      42     293 40.0    1.258  22      pos
608        1      92       62      25      41 19.5    0.482  25      neg
609        0     152       82      39     272 41.5    0.270  27      neg
610        1     111       62      13     182 24.0    0.138  23      neg
611        3     106       54      21     158 30.9    0.292  24      neg
612        3     174       58      22     194 32.9    0.593  36      pos
613        7     168       88      42     321 38.2    0.787  40      pos
614        6     105       80      28       0 32.5    0.878  26      neg
615       11     138       74      26     144 36.1    0.557  50      pos
616        3     106       72       0       0 25.8    0.207  27      neg
617        6     117       96       0       0 28.7    0.157  30      neg
618        2      68       62      13      15 20.1    0.257  23      neg
619        9     112       82      24       0 28.2    1.282  50      pos
620        0     119        0       0       0 32.4    0.141  24      pos
621        2     112       86      42     160 38.4    0.246  28      neg
622        2      92       76      20       0 24.2    1.698  28      neg
623        6     183       94       0       0 40.8    1.461  45      neg
624        0      94       70      27     115 43.5    0.347  21      neg
625        2     108       64       0       0 30.8    0.158  21      neg
626        4      90       88      47      54 37.7    0.362  29      neg
627        0     125       68       0       0 24.7    0.206  21      neg
628        0     132       78       0       0 32.4    0.393  21      neg
629        5     128       80       0       0 34.6    0.144  45      neg
630        4      94       65      22       0 24.7    0.148  21      neg
631        7     114       64       0       0 27.4    0.732  34      pos
632        0     102       78      40      90 34.5    0.238  24      neg
633        2     111       60       0       0 26.2    0.343  23      neg
634        1     128       82      17     183 27.5    0.115  22      neg
635       10      92       62       0       0 25.9    0.167  31      neg
636       13     104       72       0       0 31.2    0.465  38      pos
637        5     104       74       0       0 28.8    0.153  48      neg
638        2      94       76      18      66 31.6    0.649  23      neg
639        7      97       76      32      91 40.9    0.871  32      pos
640        1     100       74      12      46 19.5    0.149  28      neg
641        0     102       86      17     105 29.3    0.695  27      neg
642        4     128       70       0       0 34.3    0.303  24      neg
643        6     147       80       0       0 29.5    0.178  50      pos
644        4      90        0       0       0 28.0    0.610  31      neg
645        3     103       72      30     152 27.6    0.730  27      neg
646        2     157       74      35     440 39.4    0.134  30      neg
647        1     167       74      17     144 23.4    0.447  33      pos
648        0     179       50      36     159 37.8    0.455  22      pos
649       11     136       84      35     130 28.3    0.260  42      pos
650        0     107       60      25       0 26.4    0.133  23      neg
651        1      91       54      25     100 25.2    0.234  23      neg
652        1     117       60      23     106 33.8    0.466  27      neg
653        5     123       74      40      77 34.1    0.269  28      neg
654        2     120       54       0       0 26.8    0.455  27      neg
655        1     106       70      28     135 34.2    0.142  22      neg
656        2     155       52      27     540 38.7    0.240  25      pos
657        2     101       58      35      90 21.8    0.155  22      neg
658        1     120       80      48     200 38.9    1.162  41      neg
659       11     127      106       0       0 39.0    0.190  51      neg
660        3      80       82      31      70 34.2    1.292  27      pos
661       10     162       84       0       0 27.7    0.182  54      neg
662        1     199       76      43       0 42.9    1.394  22      pos
663        8     167      106      46     231 37.6    0.165  43      pos
664        9     145       80      46     130 37.9    0.637  40      pos
665        6     115       60      39       0 33.7    0.245  40      pos
666        1     112       80      45     132 34.8    0.217  24      neg
667        4     145       82      18       0 32.5    0.235  70      pos
668       10     111       70      27       0 27.5    0.141  40      pos
669        6      98       58      33     190 34.0    0.430  43      neg
670        9     154       78      30     100 30.9    0.164  45      neg
671        6     165       68      26     168 33.6    0.631  49      neg
672        1      99       58      10       0 25.4    0.551  21      neg
673       10      68      106      23      49 35.5    0.285  47      neg
674        3     123      100      35     240 57.3    0.880  22      neg
675        8      91       82       0       0 35.6    0.587  68      neg
676        6     195       70       0       0 30.9    0.328  31      pos
677        9     156       86       0       0 24.8    0.230  53      pos
678        0      93       60       0       0 35.3    0.263  25      neg
679        3     121       52       0       0 36.0    0.127  25      pos
680        2     101       58      17     265 24.2    0.614  23      neg
681        2      56       56      28      45 24.2    0.332  22      neg
682        0     162       76      36       0 49.6    0.364  26      pos
683        0      95       64      39     105 44.6    0.366  22      neg
684        4     125       80       0       0 32.3    0.536  27      pos
685        5     136       82       0       0  0.0    0.640  69      neg
686        2     129       74      26     205 33.2    0.591  25      neg
687        3     130       64       0       0 23.1    0.314  22      neg
688        1     107       50      19       0 28.3    0.181  29      neg
689        1     140       74      26     180 24.1    0.828  23      neg
690        1     144       82      46     180 46.1    0.335  46      pos
691        8     107       80       0       0 24.6    0.856  34      neg
692       13     158      114       0       0 42.3    0.257  44      pos
693        2     121       70      32      95 39.1    0.886  23      neg
694        7     129       68      49     125 38.5    0.439  43      pos
695        2      90       60       0       0 23.5    0.191  25      neg
696        7     142       90      24     480 30.4    0.128  43      pos
697        3     169       74      19     125 29.9    0.268  31      pos
698        0      99        0       0       0 25.0    0.253  22      neg
699        4     127       88      11     155 34.5    0.598  28      neg
700        4     118       70       0       0 44.5    0.904  26      neg
701        2     122       76      27     200 35.9    0.483  26      neg
702        6     125       78      31       0 27.6    0.565  49      pos
703        1     168       88      29       0 35.0    0.905  52      pos
704        2     129        0       0       0 38.5    0.304  41      neg
705        4     110       76      20     100 28.4    0.118  27      neg
706        6      80       80      36       0 39.8    0.177  28      neg
707       10     115        0       0       0  0.0    0.261  30      pos
708        2     127       46      21     335 34.4    0.176  22      neg
709        9     164       78       0       0 32.8    0.148  45      pos
710        2      93       64      32     160 38.0    0.674  23      pos
711        3     158       64      13     387 31.2    0.295  24      neg
712        5     126       78      27      22 29.6    0.439  40      neg
713       10     129       62      36       0 41.2    0.441  38      pos
714        0     134       58      20     291 26.4    0.352  21      neg
715        3     102       74       0       0 29.5    0.121  32      neg
716        7     187       50      33     392 33.9    0.826  34      pos
717        3     173       78      39     185 33.8    0.970  31      pos
718       10      94       72      18       0 23.1    0.595  56      neg
719        1     108       60      46     178 35.5    0.415  24      neg
720        5      97       76      27       0 35.6    0.378  52      pos
721        4      83       86      19       0 29.3    0.317  34      neg
722        1     114       66      36     200 38.1    0.289  21      neg
723        1     149       68      29     127 29.3    0.349  42      pos
724        5     117       86      30     105 39.1    0.251  42      neg
725        1     111       94       0       0 32.8    0.265  45      neg
726        4     112       78      40       0 39.4    0.236  38      neg
727        1     116       78      29     180 36.1    0.496  25      neg
728        0     141       84      26       0 32.4    0.433  22      neg
729        2     175       88       0       0 22.9    0.326  22      neg
730        2      92       52       0       0 30.1    0.141  22      neg
731        3     130       78      23      79 28.4    0.323  34      pos
732        8     120       86       0       0 28.4    0.259  22      pos
733        2     174       88      37     120 44.5    0.646  24      pos
734        2     106       56      27     165 29.0    0.426  22      neg
735        2     105       75       0       0 23.3    0.560  53      neg
736        4      95       60      32       0 35.4    0.284  28      neg
737        0     126       86      27     120 27.4    0.515  21      neg
738        8      65       72      23       0 32.0    0.600  42      neg
739        2      99       60      17     160 36.6    0.453  21      neg
740        1     102       74       0       0 39.5    0.293  42      pos
741       11     120       80      37     150 42.3    0.785  48      pos
742        3     102       44      20      94 30.8    0.400  26      neg
743        1     109       58      18     116 28.5    0.219  22      neg
744        9     140       94       0       0 32.7    0.734  45      pos
745       13     153       88      37     140 40.6    1.174  39      neg
746       12     100       84      33     105 30.0    0.488  46      neg
747        1     147       94      41       0 49.3    0.358  27      pos
748        1      81       74      41      57 46.3    1.096  32      neg
749        3     187       70      22     200 36.4    0.408  36      pos
750        6     162       62       0       0 24.3    0.178  50      pos
751        4     136       70       0       0 31.2    1.182  22      pos
752        1     121       78      39      74 39.0    0.261  28      neg
753        3     108       62      24       0 26.0    0.223  25      neg
754        0     181       88      44     510 43.3    0.222  26      pos
755        8     154       78      32       0 32.4    0.443  45      pos
756        1     128       88      39     110 36.5    1.057  37      pos
757        7     137       90      41       0 32.0    0.391  39      neg
758        0     123       72       0       0 36.3    0.258  52      pos
759        1     106       76       0       0 37.5    0.197  26      neg
760        6     190       92       0       0 35.5    0.278  66      pos
761        2      88       58      26      16 28.4    0.766  22      neg
762        9     170       74      31       0 44.0    0.403  43      pos
763        9      89       62       0       0 22.5    0.142  33      neg
764       10     101       76      48     180 32.9    0.171  63      neg
765        2     122       70      27       0 36.8    0.340  27      neg
766        5     121       72      23     112 26.2    0.245  30      neg
767        1     126       60       0       0 30.1    0.349  47      pos
768        1      93       70      31       0 30.4    0.315  23      neg</code></pre>
</div>
</div>
<p>A quick exploration reveals that there are more zeros in the data than expected (especially since a BMI or tricep skin fold thickness of 0 is impossible), implying that missing values are recorded as zeros. See for instance the histogram of the tricep skin fold thickness, which has a number of 0 entries that are set apart from the other entries.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(diabetes_orig) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> triceps))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2020-03-25_machine_learning_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This phenomena can also seen in the glucose, pressure, insulin and mass variables. Thus, we convert the 0 entries in all variables (other than “pregnant”) to <code>NA</code>. To do that, we use the <code>mutate_at()</code> function (which will soon be superseded by <code>mutate()</code> with <code>across()</code>) to specify which variables we want to apply our mutating function to, and we use the <code>if_else()</code> function to specify what to replace the value with if the condition is true or false.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">diabetes_clean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diabetes_orig <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(triceps, glucose, pressure, insulin, mass), </span>
<span id="cb7-3">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(.var) { </span>
<span id="cb7-4">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">condition =</span> (.var <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># if true (i.e. the entry is 0)</span></span>
<span id="cb7-5">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">true =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># replace the value with NA</span></span>
<span id="cb7-6">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">false =</span> .var <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># otherwise leave it as it is</span></span>
<span id="cb7-7">                      )</span>
<span id="cb7-8">            })</span></code></pre></div>
</div>
<p>Our data is ready. Hopefully you’ve replenished your cup of tea (or coffee if you’re into that for some reason). Let’s start making some tidy models!</p>
</section>
<section id="split-into-traintest" class="level1">
<h1>Split into train/test</h1>
<p>First, let’s split our dataset into training and testing data. The training data will be used to fit our model and tune its parameters, where the testing data will be used to evaluate our final model’s performance.</p>
<p>This split can be done automatically using the <code>inital_split()</code> function (from <code>rsample</code>) which creates a special “split” object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">234589</span>)</span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># split the data into trainng (75%) and testing (25%)</span></span>
<span id="cb8-3">diabetes_split <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initial_split</span>(diabetes_clean, </span>
<span id="cb8-4">                                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prop =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb8-5">diabetes_split</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Training/Testing/Total&gt;
&lt;576/192/768&gt;</code></pre>
</div>
</div>
<p>The printed output of <code>diabetes_split</code>, our split object, tells us how many observations we have in the training set, the testing set, and overall: <code>&lt;train/test/total&gt;</code>.</p>
<p>The training and testing sets can be extracted from the “split” object using the <code>training()</code> and <code>testing()</code> functions. Although, we won’t actually use these objects in the pipeline (we will be using the <code>diabetes_split</code> object itself).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># extract training and testing sets</span></span>
<span id="cb10-2">diabetes_train <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">training</span>(diabetes_split)</span>
<span id="cb10-3">diabetes_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">testing</span>(diabetes_split)</span></code></pre></div>
</div>
<p>At some point we’re going to want to do some parameter tuning, and to do that we’re going to want to use cross-validation. So we can create a cross-validated version of the training set in preparation for that moment using <code>vfold_cv()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create CV object from training data</span></span>
<span id="cb11-2">diabetes_cv <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vfold_cv</span>(diabetes_train)</span></code></pre></div>
</div>
</section>
<section id="define-a-recipe" class="level1">
<h1>Define a recipe</h1>
<p>Recipes allow you to specify the role of each variable as an outcome or predictor variable (using a “formula”), and any pre-processing steps you want to conduct (such as normalization, imputation, PCA, etc).</p>
<p>Creating a recipe has two parts (layered on top of one another using pipes <code>%&gt;%</code>):</p>
<ol type="1">
<li><p><strong>Specify the formula</strong> (<code>recipe()</code>): specify the outcome variable and predictor variables</p></li>
<li><p><strong>Specify pre-processing steps</strong> (<code>step_zzz()</code>): define the pre-processing steps, such as imputation, creating dummy variables, scaling, and more</p></li>
</ol>
<p>For instance, we can define the following recipe</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define the recipe</span></span>
<span id="cb12-2">diabetes_recipe <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb12-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># which consists of the formula (outcome ~ predictors)</span></span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">recipe</span>(diabetes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> pregnant <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> glucose <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pressure <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> triceps <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-5">           insulin <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mass <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pedigree <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> age, </span>
<span id="cb12-6">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> diabetes_clean) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and some pre-processing steps</span></span>
<span id="cb12-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_normalize</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all_numeric</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_impute_knn</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all_predictors</span>())</span></code></pre></div>
</div>
<p>If you’ve ever seen formulas before (e.g.&nbsp;using the <code>lm()</code> function in R), you might have noticed that we could have written our formula much more efficiently using the formula short-hand where <code>.</code> represents all of the variables in the data: <code>outcome ~ .</code> will fit a model that predicts the outcome using <em>all other columns</em>.</p>
<p>The full list of pre-processing steps available can be found <a href="https://tidymodels.github.io/recipes/articles/Custom_Steps.html">here</a>. In the recipe steps above we used the functions <code>all_numeric()</code> and <code>all_predictors()</code> as arguments to the pre-processing steps. These are called “role selections”, and they specify that we want to apply the step to “all numeric” variables or “all predictor variables”. The list of all potential role selectors can be found by typing <code>?selections</code> into your console.</p>
<p>Note that we used the original <code>diabetes_clean</code> data object (we set <code>recipe(..., data = diabetes_clean)</code>), rather than the <code>diabetes_train</code> object or the <code>diabetes_split</code> object. It turns out we could have used any of these. All recipes takes from the data object at this point is the <em>names and roles</em> of the outcome and predictor variables. We will apply this recipe to specific datasets later. This means that for large data sets, the head of the data could be used to pass the recipe a smaller data set to save time and memory.</p>
<p>Indeed, if we print a summary of the <code>diabetes_recipe</code> object, it just shows us how many predictor variables we’ve specified and the steps we’ve specified (but it doesn’t actually implement them yet!).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">diabetes_recipe</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:   1
predictor: 8</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Centering and scaling for: all_numeric()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• K-nearest neighbor imputation for: all_predictors()</code></pre>
</div>
</div>
<p>If you want to extract the pre-processed dataset itself, you can first <code>prep()</code> the recipe for a specific dataset and <code>juice()</code> the prepped recipe to extract the pre-processed data. It turns out that extracting the pre-processed data isn’t actually necessary for the pipeline, since this will be done under the hood when the model is fit, but sometimes it’s useful anyway.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">diabetes_train_preprocessed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diabetes_recipe <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb24-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># apply the recipe to the training data</span></span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prep</span>(diabetes_train) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb24-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># extract the pre-processed training dataset</span></span>
<span id="cb24-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">juice</span>()</span>
<span id="cb24-6">diabetes_train_preprocessed</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 576 × 9
   pregnant glucose pressure triceps insulin     mass pedigree     age diabetes
      &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;   
 1   1.23   -0.390    0.262   0.892   -0.317 -0.656      0.502 -0.201  pos     
 2   0.0447  1.09    -0.0616 -0.0348  -0.219 -0.168     -0.400  0.301  neg     
 3   1.82    1.91    -0.224   0.595    0.146  0.379     -0.813  0.301  neg     
 4  -1.14   -0.0948  -0.710  -0.591   -0.522 -0.311      3.76  -1.04   neg     
 5  -0.548   0.233    0.424   0.706    0.239  1.56       2.25  -0.201  pos     
 6   0.637  -0.0620  -1.84   -0.683    0.190 -0.771      2.53  -0.0335 pos     
 7  -0.844  -1.64    -2.01   -1.05    -0.629 -1.73      -0.445 -0.953  neg     
 8  -0.548  -0.423   -1.68   -0.313   -0.735  0.00505   -0.460 -0.953  neg     
 9  -1.14    0.463   -0.386   1.17     0.796  1.41      -0.320 -0.786  pos     
10   1.53    1.41     0.424   0.150    0.877  0.0482    -0.968  0.969  pos     
# … with 566 more rows</code></pre>
</div>
</div>
<p>I wrote a much longer <a href="http://www.rebeccabarter.com/blog/2019-06-06_pre_processing/">post on recipes</a> if you’d like to check out more details. However, note that the preparation and bake steps described in that post are no longer necessary in the tidymodels pipeline, since they’re now implemented under the hood by the later model fitting functions in this pipeline.</p>
</section>
<section id="specify-the-model" class="level1">
<h1>Specify the model</h1>
<p>So far we’ve split our data into training/testing, and we’ve specified our pre-processing steps using a recipe. The next thing we want to specify is our model (using the <code>parsnip</code> package).</p>
<p>Parsnip offers a unified interface for the massive variety of models that exist in R. This means that you only have to learn one way of specifying a model, and you can use this specification and have it generate a linear model, a random forest model, a support vector machine model, and more with a single line of code.</p>
<p>There are a few primary components that you need to provide for the model specification</p>
<ol type="1">
<li><p>The <strong>model type</strong>: what kind of model you want to fit, set using a different function depending on the model, such as <code>rand_forest()</code> for random forest, <code>logistic_reg()</code> for logistic regression, <code>svm_poly()</code> for a polynomial SVM model etc. The full list of models available via parsnip can be found <a href="https://tidymodels.github.io/parsnip/articles/articles/Models.html">here</a>.</p></li>
<li><p>The <strong>arguments</strong>: the model parameter values (now consistently named across different models), set using <code>set_args()</code>.</p></li>
<li><p>The <strong>engine</strong>: the underlying package the model should come from (e.g.&nbsp;“ranger” for the ranger implementation of Random Forest), set using <code>set_engine()</code>.</p></li>
<li><p>The <strong>mode</strong>: the type of prediction - since several packages can do both classification (binary/categorical prediction) and regression (continuous prediction), set using <code>set_mode()</code>.</p></li>
</ol>
<p>For instance, if we want to fit a random forest model as implemented by the <code>ranger</code> package for the purpose of classification and we want to tune the <code>mtry</code> parameter (the number of randomly selected variables to be considered at each split in the trees), then we would define the following model specification:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">rf_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb26-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># specify that the model is a random forest</span></span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rand_forest</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb26-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># specify that the `mtry` parameter needs to be tuned</span></span>
<span id="cb26-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_args</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mtry =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tune</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb26-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># select the engine/package that underlies the model</span></span>
<span id="cb26-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_engine</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ranger"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">importance =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"impurity"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb26-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># choose either the continuous regression or binary classification mode</span></span>
<span id="cb26-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_mode</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"classification"</span>) </span></code></pre></div>
</div>
<p>If you want to be able to examine the variable importance of your final model later, you will need to set <code>importance</code> argument when setting the engine. For ranger, the importance options are <code>"impurity"</code> or <code>"permutation"</code>.</p>
<p>As another example, the following code would instead specify a logistic regression model from the <code>glm</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">lr_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb27-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># specify that the model is a random forest</span></span>
<span id="cb27-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">logistic_reg</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb27-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># select the engine/package that underlies the model</span></span>
<span id="cb27-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_engine</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"glm"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb27-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># choose either the continuous regression or binary classification mode</span></span>
<span id="cb27-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_mode</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"classification"</span>) </span></code></pre></div>
</div>
<p>Note that this code doesn’t actually fit the model. Like the recipe, it just outlines a description of the model. Moreover, setting a parameter to <code>tune()</code> means that it will be tuned later in the tune stage of the pipeline (i.e.&nbsp;the value of the parameter that yields the best performance will be chosen). You could also just specify a particular value of the parameter if you don’t want to tune it e.g.&nbsp;using <code>set_args(mtry = 4)</code>.</p>
<p>Another thing to note is that nothing about this model specification is specific to the diabetes dataset.</p>
</section>
<section id="put-it-all-together-in-a-workflow" class="level1">
<h1>Put it all together in a workflow</h1>
<p>We’re now ready to put the model and recipes together into a workflow. You initiate a workflow using <code>workflow()</code> (from the <code>workflows</code> package) and then you can add a recipe and add a model to it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set the workflow</span></span>
<span id="cb28-2">rf_workflow <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">workflow</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add the recipe</span></span>
<span id="cb28-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_recipe</span>(diabetes_recipe) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add the model</span></span>
<span id="cb28-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_model</span>(rf_model)</span></code></pre></div>
</div>
<p>Note that we still haven’t yet implemented the pre-processing steps in the recipe nor have we fit the model. We’ve just written the framework. It is only when we tune the parameters or fit the model that the recipe and model frameworks are actually implemented.</p>
</section>
<section id="tune-the-parameters" class="level1">
<h1>Tune the parameters</h1>
<p>Since we had a parameter that we designated to be tuned (<code>mtry</code>), we need to tune it (i.e.&nbsp;choose the value that leads to the best performance) before fitting our model. If you don’t have any parameters to tune, you can skip this step.</p>
<p>Note that we will do our tuning using the cross-validation object (<code>diabetes_cv</code>). To do this, we specify the range of <code>mtry</code> values we want to try, and then we add a tuning layer to our workflow using <code>tune_grid()</code> (from the <code>tune</code> package). Note that we focus on two metrics: <code>accuracy</code> and <code>roc_auc</code> (from the <code>yardstick</code> package).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># specify which values eant to try</span></span>
<span id="cb29-2">rf_grid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand.grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mtry =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb29-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># extract results</span></span>
<span id="cb29-4">rf_tune_results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rf_workflow <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb29-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tune_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">resamples =</span> diabetes_cv, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#CV object</span></span>
<span id="cb29-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grid =</span> rf_grid, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># grid of values to try</span></span>
<span id="cb29-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metrics =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metric_set</span>(accuracy, roc_auc) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># metrics we care about</span></span>
<span id="cb29-8">            )</span></code></pre></div>
</div>
<p>You can tune multiple parameters at once by providing multiple parameters to the <code>expand.grid()</code> function, e.g.&nbsp;<code>expand.grid(mtry = c(3, 4, 5), trees = c(100, 500))</code>.</p>
<p>It’s always a good idea to explore the results of the cross-validation. <code>collect_metrics()</code> is a really handy function that can be used in a variety of circumstances to extract any metrics that have been calculated within the object it’s being used on. In this case, the metrics come from the cross-validation performance across the different values of the parameters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print results</span></span>
<span id="cb30-2">rf_tune_results <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb30-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">collect_metrics</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
   mtry .metric  .estimator  mean     n std_err .config             
  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1     3 accuracy binary     0.762    10  0.0108 Preprocessor1_Model1
2     3 roc_auc  binary     0.840    10  0.0116 Preprocessor1_Model1
3     4 accuracy binary     0.767    10  0.0130 Preprocessor1_Model2
4     4 roc_auc  binary     0.840    10  0.0128 Preprocessor1_Model2
5     5 accuracy binary     0.766    10  0.0108 Preprocessor1_Model3
6     5 roc_auc  binary     0.837    10  0.0118 Preprocessor1_Model3</code></pre>
</div>
</div>
<p>Across both accuracy and AUC, <code>mtry = 4</code> yields the best performance (<em>just</em>).</p>
</section>
<section id="finalize-the-workflow" class="level1">
<h1>Finalize the workflow</h1>
<p>We want to add a layer to our workflow that corresponds to the tuned parameter, i.e.&nbsp;sets <code>mtry</code> to be the value that yielded the best results. If you didn’t tune any parameters, you can skip this step.</p>
<p>We can extract the best value for the accuracy metric by applying the <code>select_best()</code> function to the tune object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">param_final <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rf_tune_results <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select_best</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metric =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accuracy"</span>)</span>
<span id="cb32-3">param_final</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
   mtry .config             
  &lt;dbl&gt; &lt;chr&gt;               
1     4 Preprocessor1_Model2</code></pre>
</div>
</div>
<p>Then we can add this parameter to the workflow using the <code>finalize_workflow()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">rf_workflow <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rf_workflow <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb34-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">finalize_workflow</span>(param_final)</span></code></pre></div>
</div>
</section>
<section id="evaluate-the-model-on-the-test-set" class="level1">
<h1>Evaluate the model on the test set</h1>
<p>Now we’ve defined our recipe, our model, and tuned the model’s parameters, we’re ready to actually fit the final model. Since all of this information is contained within the workflow object, we will apply the <code>last_fit()</code> function to our workflow and our train/test split object. This will automatically train the model specified by the workflow using the training data, and produce evaluations based on the test set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1">rf_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rf_workflow <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb35-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fit on the training set and evaluate on test set</span></span>
<span id="cb35-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">last_fit</span>(diabetes_split)</span></code></pre></div>
</div>
<p>Note that the fit object that is created is a data-frame-like object; specifically, it is a tibble with list columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">rf_fit</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Resampling results
# Manual resampling 
# A tibble: 1 × 6
  splits            id               .metrics .notes   .predictions .workflow 
  &lt;list&gt;            &lt;chr&gt;            &lt;list&gt;   &lt;list&gt;   &lt;list&gt;       &lt;list&gt;    
1 &lt;split [576/192]&gt; train/test split &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;     &lt;workflow&gt;</code></pre>
</div>
</div>
<p>This is a really nice feature of tidymodels (and is what makes it work so nicely with the tidyverse) since you can do all of your tidyverse operations to the model object. While truly taking advantage of this flexibility requires proficiency with purrr, if you don’t want to deal with purrr and list-columns, there are functions that can extract the relevant information from the fit object that remove the need for purrr as we will see below.</p>
<p>Since we supplied the train/test object when we fit the workflow, the metrics are evaluated on the <em>test</em> set. Now when we use the <code>collect_metrics()</code> function (recall we used this when tuning our parameters), it extracts the performance of the final model (since <code>rf_fit</code> now consists of a single final model) applied to the <em>test</em> set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1">test_performance <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rf_fit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">collect_metrics</span>()</span>
<span id="cb38-2">test_performance</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric  .estimator .estimate .config             
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 accuracy binary         0.792 Preprocessor1_Model1
2 roc_auc  binary         0.853 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>Overall the performance is very good, with an accuracy of 0.74 and an AUC of 0.82.</p>
<p>You can also extract the test set predictions themselves using the <code>collect_predictions()</code> function. Note that there are 192 rows in the predictions object below which matches the number of <em>test set</em> observations (just to give you some evidence that these are based on the test set rather than the training set).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate predictions from the test set</span></span>
<span id="cb40-2">test_predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rf_fit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">collect_predictions</span>()</span>
<span id="cb40-3">test_predictions</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 192 × 7
   id               .pred_neg .pred_pos  .row .pred_class diabetes .config      
   &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt; &lt;fct&gt;       &lt;fct&gt;    &lt;chr&gt;        
 1 train/test split     0.365    0.635      3 pos         pos      Preprocessor…
 2 train/test split     0.213    0.787      9 pos         pos      Preprocessor…
 3 train/test split     0.765    0.235     11 neg         neg      Preprocessor…
 4 train/test split     0.511    0.489     13 neg         neg      Preprocessor…
 5 train/test split     0.594    0.406     18 neg         pos      Preprocessor…
 6 train/test split     0.356    0.644     26 pos         pos      Preprocessor…
 7 train/test split     0.209    0.791     32 pos         pos      Preprocessor…
 8 train/test split     0.751    0.249     50 neg         neg      Preprocessor…
 9 train/test split     0.961    0.0385    53 neg         neg      Preprocessor…
10 train/test split     0.189    0.811     55 pos         neg      Preprocessor…
# … with 182 more rows</code></pre>
</div>
</div>
<p>Since this is just a normal data frame/tibble object, we can generate summaries and plots such as a confusion matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate a confusion matrix</span></span>
<span id="cb42-2">test_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb42-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">conf_mat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">truth =</span> diabetes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">estimate =</span> .pred_class)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction neg pos
       neg 107  17
       pos  23  45</code></pre>
</div>
</div>
<p>We could also plot distributions of the predicted probability distributions for each class.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">test_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb44-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> .pred_pos, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> diabetes), </span>
<span id="cb44-4">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2020-03-25_machine_learning_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If you’re familiar with purrr, you could use purrr functions to extract the predictions column using <code>pull()</code>. The following code does almost the same thing as <code>collect_predictions()</code>. You could similarly have done this with the <code>.metrics</code> column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1">test_predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rf_fit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(.predictions)</span>
<span id="cb45-2">test_predictions</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 192 × 6
   .pred_neg .pred_pos  .row .pred_class diabetes .config             
       &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt; &lt;fct&gt;       &lt;fct&gt;    &lt;chr&gt;               
 1     0.365    0.635      3 pos         pos      Preprocessor1_Model1
 2     0.213    0.787      9 pos         pos      Preprocessor1_Model1
 3     0.765    0.235     11 neg         neg      Preprocessor1_Model1
 4     0.511    0.489     13 neg         neg      Preprocessor1_Model1
 5     0.594    0.406     18 neg         pos      Preprocessor1_Model1
 6     0.356    0.644     26 pos         pos      Preprocessor1_Model1
 7     0.209    0.791     32 pos         pos      Preprocessor1_Model1
 8     0.751    0.249     50 neg         neg      Preprocessor1_Model1
 9     0.961    0.0385    53 neg         neg      Preprocessor1_Model1
10     0.189    0.811     55 pos         neg      Preprocessor1_Model1
# … with 182 more rows</code></pre>
</div>
</div>
</section>
<section id="fitting-and-using-your-final-model" class="level1">
<h1>Fitting and using your final model</h1>
<p>The previous section evaluated the model trained on the training data using the testing data. But once you’ve determined your final model, you often want to train it on your full dataset and then use it to predict the response for <em>new</em> data.</p>
<p>If you want to use your model to predict the response for new observations, you need to use the <code>fit()</code> function on your workflow and the dataset that you want to fit the final model on (e.g.&nbsp;the complete training + testing dataset).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1">final_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fit</span>(rf_workflow, diabetes_clean)</span></code></pre></div>
</div>
<p>The <code>final_model</code> object contains a few things including the ranger object trained with the parameters established through the workflow contained in <code>rf_workflow</code> based on the data in <code>diabetes_clean</code> (the combined training and testing data).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1">final_model</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: rand_forest()

── Preprocessor ────────────────────────────────────────────────────────────────
2 Recipe Steps

• step_normalize()
• step_impute_knn()

── Model ───────────────────────────────────────────────────────────────────────
Ranger result

Call:
 ranger::ranger(x = maybe_data_frame(x), y = y, mtry = min_cols(~4,      x), importance = ~"impurity", num.threads = 1, verbose = FALSE,      seed = sample.int(10^5, 1), probability = TRUE) 

Type:                             Probability estimation 
Number of trees:                  500 
Sample size:                      768 
Number of independent variables:  8 
Mtry:                             4 
Target node size:                 10 
Variable importance mode:         impurity 
Splitrule:                        gini 
OOB prediction error (Brier s.):  0.1583874 </code></pre>
</div>
</div>
<p>If we wanted to predict the diabetes status of a new woman, we could use the normal <code>predict()</code> function.</p>
<p>For instance, below we define the data for a new woman.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1">new_woman <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tribble</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>pregnant, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>glucose, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>pressure, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>triceps, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>insulin, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>mass, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>pedigree, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>age,</span>
<span id="cb50-2">                     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">31</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">102</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">28.2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.67</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">47</span>)</span>
<span id="cb50-3">new_woman</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
  pregnant glucose pressure triceps insulin  mass pedigree   age
     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
1        2      95       70      31     102  28.2     0.67    47</code></pre>
</div>
</div>
<p>The predicted diabetes status of this new woman is “negative”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(final_model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">new_data =</span> new_woman)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  .pred_class
  &lt;fct&gt;      
1 neg        </code></pre>
</div>
</div>
</section>
<section id="variable-importance" class="level1">
<h1>Variable importance</h1>
<p>If you want to extract the variable importance scores from your model, as far as I can tell, for now you need to extract the model object from the <code>fit()</code> object (which for us is called <code>final_model</code>). The function that extracts the model is <code>pull_workflow_fit()</code> and then you need to grab the <code>fit</code> object that the output contains.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1">ranger_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull_workflow_fit</span>(final_model)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fit</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `pull_workflow_fit()` was deprecated in workflows 0.2.3.
ℹ Please use `extract_fit_parsnip()` instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1">ranger_obj</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ranger result

Call:
 ranger::ranger(x = maybe_data_frame(x), y = y, mtry = min_cols(~4,      x), importance = ~"impurity", num.threads = 1, verbose = FALSE,      seed = sample.int(10^5, 1), probability = TRUE) 

Type:                             Probability estimation 
Number of trees:                  500 
Sample size:                      768 
Number of independent variables:  8 
Mtry:                             4 
Target node size:                 10 
Variable importance mode:         impurity 
Splitrule:                        gini 
OOB prediction error (Brier s.):  0.1583874 </code></pre>
</div>
</div>
<p>Then you can extract the variable importance from the ranger object itself (<code>variable.importance</code> is a specific object contained within ranger output - this will need to be adapted for the specific object type of other models).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1">ranger_obj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>variable.importance</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pregnant  glucose pressure  triceps  insulin     mass pedigree      age 
16.40687 79.68408 17.08361 22.10685 52.27195 42.60717 30.12246 33.19040 </code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>tidyverse</category>
  <category>machine learning</category>
  <category>tidymodels</category>
  <category>caret</category>
  <category>recipes</category>
  <category>parsnip</category>
  <category>tune</category>
  <category>rsample</category>
  <guid>https://www.rebeccabarter.com/blog/2020-03-25_machine_learning.html</guid>
  <pubDate>Tue, 14 Apr 2020 07:00:00 GMT</pubDate>
</item>
<item>
  <title>5 useful R tips from rstudio::conf(2020) - tidy eval, piping, conflicts, bar charts and colors</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2020-02-05_rstudio_conf.html</link>
  <description><![CDATA[ 





<p>This was my second year attending rstudio::conf() as a diversity scholar (and my first time as a <a href="http://www.rebeccabarter.com/blog/2020-02-03_blogger/">speaker</a>), and I was yet again blown away by the friendliness of the community and the quality of the talks. Over the course of the week, I met so many wonderful and talented humans, and learnt so many incredibly useful things. This post is all about the little tips and tricks that I picked up from watching many fantastic presentations, attendees live tweeting, and having many insightful conversations.</p>
<section id="tip-1-tidy-evaluation" class="level1">
<h1>Tip 1: Tidy evaluation</h1>
<p>Tidy eval is one of those terms that seems to float around a lot in the R community, but I feel like 99% of us don’t really get what tidy eval is, nor why we should care about it. Turns out, unless we’re getting deep into package development, we probably don’t need to be up to speed with tidy eval. The only part of tidy eval that I know is this: how to supply column names as unquoted arguments in functions. All of the resources I found on tidy eval go into waaay more detail about how it works, and maybe one day I’ll care about that, but that time is not now.</p>
<p>For this (and the next few) example, I’ll use the <code>midwest</code> dataset from the ggplot2 package, the first 6 rows of which are shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(midwest)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 28
    PID county    state  area poptotal popdens…¹ popwh…² popbl…³ popam…⁴ popas…⁵
  &lt;int&gt; &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
1   561 ADAMS     IL    0.052    66090     1271.   63917    1702      98     249
2   562 ALEXANDER IL    0.014    10626      759     7054    3496      19      48
3   563 BOND      IL    0.022    14991      681.   14477     429      35      16
4   564 BOONE     IL    0.017    30806     1812.   29344     127      46     150
5   565 BROWN     IL    0.018     5836      324.    5264     547      14       5
6   566 BUREAU    IL    0.05     35688      714.   35157      50      65     195
# … with 18 more variables: popother &lt;int&gt;, percwhite &lt;dbl&gt;, percblack &lt;dbl&gt;,
#   percamerindan &lt;dbl&gt;, percasian &lt;dbl&gt;, percother &lt;dbl&gt;, popadults &lt;int&gt;,
#   perchsd &lt;dbl&gt;, percollege &lt;dbl&gt;, percprof &lt;dbl&gt;, poppovertyknown &lt;int&gt;,
#   percpovertyknown &lt;dbl&gt;, percbelowpoverty &lt;dbl&gt;, percchildbelowpovert &lt;dbl&gt;,
#   percadultpoverty &lt;dbl&gt;, percelderlypoverty &lt;dbl&gt;, inmetro &lt;int&gt;,
#   category &lt;chr&gt;, and abbreviated variable names ¹​popdensity, ²​popwhite,
#   ³​popblack, ⁴​popamerindian, ⁵​popasian</code></pre>
</div>
</div>
<p>Suppose that you want to write a function that plays nicely with the tidyverse (e.g.&nbsp;can take unquoted column names just like tidyverse functions do). Such an example might be one that makes a plot where the user supplies the variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">plotMidwest <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(var1, var2) {</span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(midwest) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> var1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> var2))</span>
<span id="cb4-4">}</span></code></pre></div>
</div>
<p>Theoretically, this plot should be able to take the arguments <code>popdensity</code> and <code>percbelowpoverty</code> and provide me with a scatterplot of these two columns against one another:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotMidwest</span>(popdensity, percbelowpoverty)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `geom_point()`:
! Problem while computing aesthetics.
ℹ Error occurred in the 1st layer.
Caused by error in `FUN()`:
! object 'popdensity' not found</code></pre>
</div>
</div>
<p>but this doesn’t work! Perhaps if I quote the variable names it will work:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotMidwest</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"popdensity"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"percbelowpoverty"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2020-02-05_rstudio_conf_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The above code didn’t throw an error, but this is literally plotting the <em>word</em> “popdensity” against the <em>word</em> “percbelowpoverty”, which isn’t what I wanted to do!</p>
<p>The secret to providing column names as arguments to a function is…. tidy eval! Fortunately even without understanding <em>why</em> it works (something about delaying evaluation until later in the execution path blah blah blah), you can use tidy eval. The way you do this is to envelop your arguments within the function in curly braces <code>{ }</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">plotMidwestTidy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(var1, var2) {</span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(midwest) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> {{ var1 }}, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> {{ var2 }}))</span>
<span id="cb8-4">}</span></code></pre></div>
</div>
<p>Now when I provide my column names as unquoted variables, I actually get the scatterplot I wanted!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotMidwestTidy</span>(popdensity, percbelowpoverty)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2020-02-05_rstudio_conf_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note that my tidy eval version of my <code>plotMidwest()</code> function isn’t designed to take <em>quoted</em> variable names. The following code yields the same plot as before of the <em>word</em> “popdensity” against the <em>word</em> “percbelowpoverty”.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotMidwestTidy</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"popdensity"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"percbelowpoverty"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2020-02-05_rstudio_conf_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A neat little trick I learned from <a href="https://twitter.com/paleolimbot?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor">Dewey Dunnington</a>’s talk is that you can use <code>.data</code> as placeholder for the data object inside <code>aes()</code>. This means that, if <code>var</code> is a character column name, you can access the quoted column from the data object using <code>.data[[var]]</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">plotMidwestQuoted <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(var1, var2) {</span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(midwest) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> .data[[var1]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> .data[[var2]]))</span>
<span id="cb11-4">}</span>
<span id="cb11-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotMidwestQuoted</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"popdensity"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"percbelowpoverty"</span>) </span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2020-02-05_rstudio_conf_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Dewey’s talk is full of gems (check out his slides: https://fishandwhistle.net/slides/rstudioconf2020/#1).</p>
</section>
<section id="tip-2-pipe-into-later-arguments-of-a-function-using-." class="level1">
<h1>Tip 2: Pipe into later arguments of a function using <code>.</code></h1>
<p>While I didn’t technically learn this one from a talk at rstudio::conf(2020), I did run into an old friend <a href="https://twitter.com/garthtarr">Garth Tarr</a> who told me about this piping trick: if you want to pipe an object into any argument other than the first one, you can do so using the <code>.</code> placeholder. For instance, let’s say that you want to use the <code>lm()</code> function to fit a linear model, and because you, like me, are pipe-obsessed, you want to pipe the data into <code>lm()</code>.</p>
<p>Sadly, when I try to pipe the midwest data into my <code>lm()</code> function for regressing population density (<code>popdensity</code>) against poverty rate (<code>percbelowpoverty</code>), I get an error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">midwest <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(popdensity <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> percbelowpoverty)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in as.data.frame.default(data): cannot coerce class '"formula"' to a data.frame</code></pre>
</div>
</div>
<p>What’s going wrong? There are two things you need to understand about what’s happening here:</p>
<ol type="1">
<li><p>The argument order of <code>lm()</code> is: <code>lm(formula, data)</code>, i.e.&nbsp;the data is the <em>second</em> argument of the <code>lm</code> function (whereas all tidyverse functions have the data as the <em>first</em> argument)</p></li>
<li><p>The pipe, <code>%&gt;%</code>, automatically places the <em>object</em> to the left of the pipe into the <em>first argument</em> of the function to the right of the pipe</p></li>
</ol>
<p>so <code>midwest %&gt;% lm(popdensity ~ percbelowpoverty)</code> above is equivalent to <code>lm(formula = iris, data = Sepal.Length ~ Sepal.Width)</code>, which has the arguments reversed.</p>
<p>Instead of abandoning the trusty pipe (the thought of which fills me with sadness), I can instead pipe the data into the <em>second</em> argument using <code>.</code> as a placeholder for the position into which I want to pipe the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">midwest <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(popdensity <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> percbelowpoverty, .)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = popdensity ~ percbelowpoverty, data = .)

Coefficients:
     (Intercept)  percbelowpoverty  
         4068.06            -77.56  </code></pre>
</div>
</div>
<p>Note that I could alternatively <em>name</em> the <code>formula</code> argument, which would automatically pipe the object into the first <em>unassigned</em> argument (which in our case is the data argument), but this becomes cumbersome when you have many arguments.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">midwest <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> popdensity <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> percbelowpoverty)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = popdensity ~ percbelowpoverty, data = .)

Coefficients:
     (Intercept)  percbelowpoverty  
         4068.06            -77.56  </code></pre>
</div>
</div>
</section>
<section id="tip-3-function-conflicts-workaround-no-more-dplyrselect" class="level1">
<h1>Tip 3: Function conflicts workaround (no more dplyr::select())</h1>
<p>Have you ever loaded the <code>MASS</code> R package and found that <code>select()</code> from <code>dplyr</code> no longer works? I regularly get this type of error when functions from different packages have the same name as tidyverse functions I use on the reg. Let’s pretend that I really want to select the <code>cut</code> variable from the <code>diamonds</code> dataset from the <code>ggplot2</code> package.</p>
<p>The first 6 rows of the diamonds dataset are shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(diamonds)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  carat cut       color clarity depth table price     x     y     z
  &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
2  0.21 Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
3  0.23 Good      E     VS1      56.9    65   327  4.05  4.07  2.31
4  0.29 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
5  0.31 Good      J     SI2      63.3    58   335  4.34  4.35  2.75
6  0.24 Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48</code></pre>
</div>
</div>
<p>Sadly if I loaded the <code>MASS</code> library before trying to select <code>cut</code> from <code>diamonds</code>, I get the following error:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(MASS)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">diamonds <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(cut)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in select(., cut): unused argument (cut)</code></pre>
</div>
</div>
<p>This is because by loading <code>MASS</code>, I have overwritten <code>dplyr</code>’s <code>select()</code> function (hence the warning). The normal workaround is to be explicit about what <code>select()</code> function you want using <code>dplyr::select()</code> as in</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">diamonds <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(cut)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53,940 × 1
   cut      
   &lt;ord&gt;    
 1 Ideal    
 2 Premium  
 3 Good     
 4 Premium  
 5 Good     
 6 Very Good
 7 Very Good
 8 Very Good
 9 Fair     
10 Very Good
# … with 53,930 more rows</code></pre>
</div>
</div>
<p>But this can be really annoying if you have a lot of <code>select()</code>s in your code (because you have to go through and apply <code>dplyr::</code> to each one). It turns out (as <a href="https://twitter.com/cbirunda/status/1221954540544507906?s=20">tweeted by Birunda Chelliah</a> - I’m not where she learned it though) that a better workaround is to set conflict hierarchies at the top of your document (<code>conflict_prefer("select", "dplyr")</code>) to specify that the <code>select()</code> function should always come from the <code>dplyr</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># install.packages("conflicted")</span></span>
<span id="cb27-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(conflicted)</span>
<span id="cb27-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set conflict preference</span></span>
<span id="cb27-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">conflict_prefer</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"select"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dplyr"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[conflicted] Will prefer dplyr::select over any other package.</code></pre>
</div>
</div>
<p>Now when I use <code>select()</code> it works just fine!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># no more error!</span></span>
<span id="cb29-2">diamonds <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(cut)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53,940 × 1
   cut      
   &lt;ord&gt;    
 1 Ideal    
 2 Premium  
 3 Good     
 4 Premium  
 5 Good     
 6 Very Good
 7 Very Good
 8 Very Good
 9 Fair     
10 Very Good
# … with 53,930 more rows</code></pre>
</div>
</div>
</section>
<section id="tip-4-geom_col-youll-never-have-to-specify-stat-identity-for-your-bar-plots-ever-again" class="level1">
<h1>Tip 4: <code>geom_col()</code>: you’ll never have to specify “stat = identity” for your bar plots ever again!</h1>
<p>Most of the time when I want to make a bar chart, I want to provide an <code>x</code> variable for the bar categories, and a <code>y</code> variable for the height of the bar for each category. Sadly, this isn’t what <code>geom_bar()</code> does by default - its default behaviour is to <em>count</em> each level of the provided <code>x</code> aesthetic. For instance, in the <code>diamonds</code> dataset, the <code>cut</code> variable takes 5 unique values: fair, good, very good, premium and ideal. Providing <code>cut</code> as the x-aesthetic for <code>geom_bar()</code> will, by default, count the number of times each of these unique values appear in the data and use these counts as the heights.</p>
<p>The default usage of <code>geom_bar()</code> is as follows</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">diamonds <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb31-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> cut))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2020-02-05_rstudio_conf_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>which automatically counts the number of time each <code>cut</code> appears in the data.</p>
<p>However (putting aside arguments about what types of data bar charts are appropriate for), I frequently want to use a bar chart to display something other than a count. For instance, the average price of each cut, shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">average_price <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> diamonds <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb32-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(cut) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">average_price =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(price)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() </span>
<span id="cb32-5">average_price</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  cut       average_price
  &lt;ord&gt;             &lt;dbl&gt;
1 Fair              4359.
2 Good              3929.
3 Very Good         3982.
4 Premium           4584.
5 Ideal             3458.</code></pre>
</div>
</div>
<p>If I try to set the <code>y</code> aesthetic of <code>geom_bar</code> to <code>y = average_price</code>, I get an annoying error:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">average_price <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb34-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> cut, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> average_price))</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `geom_bar()`:
! Problem while computing stat.
ℹ Error occurred in the 1st layer.
Caused by error in `setup_params()`:
! `stat_count()` must only have an x or y aesthetic.</code></pre>
</div>
</div>
<p>The typical fix for this is to include <code>stat = 'identity'</code> as an argument of <code>geom_bar()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">average_price <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb36-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> cut, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> average_price), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2020-02-05_rstudio_conf_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>But it turns out <em>there’s a better way</em>!</p>
<p>During his fantastic talk on his <code>ggtext</code> package, <a href="https://twitter.com/ClausWilke">Claus Wilke</a>) casually used the <code>geom_col()</code> function to create a <em>column chart</em> (is that what <code>geom_col()</code> stands for?), which, as it turns out, is what I’ve been trying to make the whole time:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">average_price <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb37-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> cut, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> average_price))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2020-02-05_rstudio_conf_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This probably wasn’t what Claus imagined me to take away from his talk, but I swear ggtext was super cool too!</p>
<!--  To demonstrate `geom_col()` we will use the inbuilt islands dataset consisting of the sizes of the land masses. `islands` initially comes as a named vector, so here are some bonus tips: the `enframe()` function converts a named vector to a two-column data frame, and the `gt()` function is a nice way to print a data frame in html format. -->
<!-- ```{r} -->
<!-- library(tidyverse) -->
<!-- library(gt) -->
<!-- large_islands <- islands %>% -->
<!--   # convert the vector to a data frame -->
<!--   enframe(name = "island", value = "land_mass") %>% -->
<!--   # filter to the larger islands -->
<!--   filter(land_mass > 1000)   -->
<!-- gt(large_islands) -->
<!-- ``` -->
<!-- When I want to create a bar plot I usually try  -->
<!-- ```{r, eval = FALSE} -->
<!-- large_islands %>% -->
<!--   ggplot() + -->
<!--   geom_bar(aes(x = island, y = land_mass)) -->
<!-- ``` -->
<!-- and fix the error by specifying `stat = "identity"`.  -->
<!-- ```{r, eval = FALSE, fig.align="center"} -->
<!-- large_islands %>% -->
<!--   ggplot() + -->
<!--   geom_bar(aes(x = island, y = land_mass), stat = "identity") -->
<!-- ``` -->
<!-- While it seems like a very small life improvement, you have no idea how much joy simply being able to use `geom_col()` brings me. I'm never going to have to specify `stat = "identity"` again! I'm so pathetically excited! -->
<!-- ```{r, eval = FALSE, fig.align="center"} -->
<!-- large_islands %>% -->
<!--   ggplot() + -->
<!--   geom_col(aes(x = island, y = land_mass)) -->
<!-- ``` -->
</section>
<section id="tip-5-using-show_col-for-viewing-colour-palettes" class="level1">
<h1>Tip 5: Using <code>show_col()</code> for viewing colour palettes</h1>
<p>Last but not least, <a href="https://twitter.com/dpseidel">Dana Paige Seidel</a> gave a great talk on the scales package, which does a lot of great things under the hood of ggplot. But scales also let’s you look at colours! The <code>show_col()</code> function shows you what colours look like:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(scales)</span>
<span id="cb38-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">show_col</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9C89B8"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#F0A6CA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#EFC3E6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#F0E6EF"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2020-02-05_rstudio_conf_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Also a quick plug for how I chose these colours (and how I choose colours in general): https://coolors.co/app.</p>
<p>I’m super excited for rstudio::conf(2021)!!</p>


</section>

 ]]></description>
  <category>R</category>
  <category>rstudioconf</category>
  <category>tidyverse</category>
  <category>ggplot2</category>
  <category>tidyeval</category>
  <category>visualization</category>
  <guid>https://www.rebeccabarter.com/blog/2020-02-05_rstudio_conf.html</guid>
  <pubDate>Thu, 06 Feb 2020 08:00:00 GMT</pubDate>
</item>
<item>
  <title>Becoming an R blogger</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2020-02-03_blogger.html</link>
  <description><![CDATA[ 





<p>This year I was given the opportunity to talk at rstudio::conf(2020), which, if you’ve never been, is one of those rare conferences where every person you meet is both extremely friendly and excited about R, and you learn a million fun and useful things that you can <em>actually use</em>. 10/10, would go again.</p>
<p>My talk was about blogging about R. Specifically, about why I blog, and why you should too, while also giving some tips and tricks for getting started. My slides can are here, if you just want to flick through the slides and get the tl;dr.</p>
<iframe src="https://docs.google.com/presentation/d/e/2PACX-1vQ2Q5VLQ-izMDNocHumJzStmo2IIo9BVKRqXmWve0UocVzTWMOVlBAz8mfCMpJ1cA0G_3O5i3uyJ-jH/embed?start=false&amp;loop=false&amp;delayms=60000" frameborder="0" width="960" height="569" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true">
</iframe>
<p>Read on below if you’re interested in learning more!</p>
<section id="why-start-a-blog" class="level1">
<h1>Why start a blog?</h1>
<p>Many years ago, I began to realize that I love to teach and explain <em>things</em>. As it turned out, it doesn’t really matter what the <em>things</em> are, but since I happened to be getting a PhD in statistics, I figured I might as well apply my love of explaining things to my work. Since I decided that I might want to do explain things as a career one day, I decided to start a <strong>portfolio</strong> in the form of a blog, which turned out to be a great way to <strong>practice my explaining skills</strong> (which have undoubtedly improved over the past few years). To be honest, I never really expected anyone to pay attention to the things I wrote (and for many years, they didn’t), but I’m pretty excited that you’re here reading this now!</p>
<p>One of the main benefits I’ve found since I started my blog several years ago is that I’ve <strong>learnt so many things</strong>. For starters, having to come up with topics to write about is an excellent way to keep up with what’s current. If you hear about a new R package or statistical concept floating around, but you can’t think of an excuse to learn about it in your every-day work, write a blog post about it! Having to explain something is an excellent way to learn it. Writing a blog post also turns out to be a great way to <strong>procrastinate</strong> during those afternoons when you can’t force yourself to do your actual work, but you still want to give the illusion (both to your boss and yourself) that you’re being productive.</p>
<p>So my top 4 reasons to start a blog:</p>
<ol type="1">
<li><p>To learn!</p></li>
<li><p>Portfolio &amp; gain exposure (people will start to know who you are)</p></li>
<li><p>To practice your communication skills</p></li>
<li><p>Productive procrastination</p></li>
</ol>
<p>Bonus reason: someone else might find what you wrote useful and send you a nice email, or even give you a job!</p>
</section>
<section id="how-to-choose-a-topic" class="level1">
<h1>How to choose a topic</h1>
<p>So you’ve decided you want to start a blog. That’s so awesome! Now how in the world are you supposed to decide what to write about?</p>
<p>I tend to choose topics in one of two ways:</p>
<p><strong>Write about something that you just learned</strong>. Especially if you had a hard time learning it, because there weren’t any good resources out there. This is a definite indication that there is a need for a good post about a topic. It happens surprisingly often, even with widely used R packages.</p>
<p>Alternatively, <strong>write about something you want to learn</strong>. As I mentioned above, having to explain something to someone else is a great way to learn something thoroughly in the first place.</p>
</section>
<section id="use-interesting-and-easily-accessible-data-examples" class="level1">
<h1>Use interesting and easily accessible data examples</h1>
<p>I always try to use interesting data examples (such as the gapminder dataset), or examples that are humorous in some way (such as the baking data example for my <a href="http://www.rebeccabarter.com/blog/2019-06-06_pre_processing/">recipes blogpost</a>).</p>
<p>Making it very easy for your reader to access the data in their own console is highly recommended. For instance, instead of proving a link where the user can download the data locally to their computer and then load it in to their environment (since who knows where it will end up on their computer relative to their working directory), try to use data examples that can be downloaded directly from a URL. For instance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">muffin_cupcake_data_orig <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/adashofdata/muffin-cupcake/master/recipes_muffins_cupcakes.csv"</span>)</span></code></pre></div>
</div>
</section>
<section id="keep-it-simple" class="level1">
<h1>Keep it simple</h1>
<p>When explaining technical concepts, try to stay away from complex terminology, jargon, notation, and if possible, stay away from math altogether. Opt instead for metaphors and images that explain a concept. You’re writing a blog post, not a text book. My advice is always: explain it to your grandmother. Always keep your audience in mind. Err on the side of being <em>too</em> detailed, and assume that your audience is a total newbie. Then the people who already know the basics can skip over your intro-level descriptions and take away the high level info, but this way you’re still making your post accessible to absolute newbies.</p>
<p>In addition, avoid saying that things are “obvious”, “easy”, or “trivial”. Just because they are for you, doesn’t mean that they are for everyone, and you’re likely to scare away people who don’t find it obvious, easy, or trivial.</p>
</section>
<section id="creating-and-hosting-your-blog" class="level1">
<h1>Creating and hosting your blog</h1>
<p>I write my blog in RStudio using the <a href="https://bookdown.org/yihui/blogdown/">blogdown</a> R package, which magically combines many .Rmd files into a webpage. It’s amazing. There are many pre-existing themes that you can choose from that you can modify with a little bit of CSS and html code if you want to.</p>
<p>I also have a <a href="https://github.com/rlbarter/personal-website">GitHub repository</a> that contains my website, which is where I push any updates I make to my website to. Then I have a Netlify site that mirrors whatever is in the GitHub repository, so that any changes I push are automatically updated.</p>
<p>A summary of the technical workflow to get the website set up is as follows: make a GitHub repository containing your website, tell Netlify what the repository is called and push. Bam! Your website is now ready!</p>
<p>If you’re looking for some more explicit details, here they are:</p>
<ol type="1">
<li><p>Start a new github repository for your website and call it anything you like. By that I mean that it doesn’t have to be <code>username.github.io</code>. I called mine <code>personal-webpage</code>. So creative, I know.</p></li>
<li><p>Use the R package <a href="https://bookdown.org/yihui/blogdown/">blogdown</a> to design your page with <a href="https://gohugo.io/">Hugo</a>. There are lots of cool <a href="https://themes.gohugo.io/">themes</a> available. Choose a good one.</p></li>
<li><p>Push your website, content and all, to your new repo.</p></li>
<li><p>Head on over to <a href="https://app.netlify.com/">netlify</a>, create and account/log in and hit “New site from Git”.</p></li>
</ol>
<ul>
<li><p>Step 1: Set the Continuous Deployment Git provider to GitHub (or whichever provider you use).</p></li>
<li><p>Step 2: Choose the repository containing your website.</p></li>
<li><p>Step 3: Set the Build command to hugo_0.19 (or whichever version you want), and the Publish directory to “public” (this is the folder in which Hugo by default puts the actual webpage files when it’s built).</p></li>
</ul>
<ol start="5" type="1">
<li><p>Hit “Deploy site”.</p></li>
<li><p>If you like you can choose to “Change site name”.</p></li>
<li><p>Your site can now be found at <code>sitename.netlify.com</code>!</p></li>
<li><p>Every time you push new content to the GitHub repo, Netlify will automatically rebuild and deploy your site. You can just sit back and relax :).</p></li>
</ol>
<p>It’s probably a good idea to buy a domain name from somewhere like Google Domains for like $10/year and point that domain name towards your netlify site, but otherwise you’re good to go!</p>
</section>
<section id="spreading-the-word" class="level1">
<h1>Spreading the word</h1>
<p>Title your blogs as something people might google, such as “A caret tutorial” (try googling this, and see what comes up ;)). Most of the people who come to my website find it on Google.</p>
<p>A great way to gain a reader following is Twitter (I’m <a href="https://twitter.com/rlbarter"><span class="citation" data-cites="rlbarter">@rlbarter</span></a>). Twitter is also a surprisingly effective way to keep up to date with what’s current with the R community. Even though I initially had very few followers, whenever I shared one of my blogs on twitter, it would get a surprisingly large number of re-tweets and likes. It gave me warm fuzzies.</p>
<p>Finally, another great way to get experience explaining things, and to get your blog (and name) out there is to run tutorials on your favorite blog posts. Reach out to your local R Ladies or UseR! groups, or run a tutorial in your department or company.</p>
</section>
<section id="go-forth-and-blog" class="level1">
<h1>Go forth and blog!</h1>


</section>

 ]]></description>
  <category>R</category>
  <category>rstudioconf</category>
  <category>blog</category>
  <guid>https://www.rebeccabarter.com/blog/2020-02-03_blogger.html</guid>
  <pubDate>Mon, 03 Feb 2020 08:00:00 GMT</pubDate>
</item>
<item>
  <title>Learn to purrr</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2019-08-19_purrr.html</link>
  <description><![CDATA[ 





<blockquote class="blockquote">
<p>“It was on the corner of the street that he noticed the first sign of something peculiar - a cat reading a map” - J.K. Rowling</p>
</blockquote>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/purrr/cat_map.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Purrr is one of those tidyverse packages that you keep hearing about, and you know you should probably learn it, but you just never seem to get around to it.</p>
<p>At it’s core, purrr is all about iteration. Purrr introduces map functions (the tidyverse’s answer to base R’s apply functions, but more in line with functional programming practices) as well as some new functions for manipulating lists. To get a quick snapshot of any tidyverse package, a nice place to go is the <a href="https://github.com/rstudio/cheatsheets/raw/master/purrr.pdf">cheatsheet</a>. I find these particularly useful after I’ve already got the basics of a package down, because I inevitably realise that there are a bunch of functionalities I knew nothing about.</p>
<p>Another useful resource for learning about purrr is <a href="https://jennybc.github.io/purrr-tutorial/">Jenny Bryan’s tutorial</a>. Jenny’s tutorial is fantastic, but is a lot longer than mine. This post is a lot shorter and my goal is to get you up and running with purrr very quickly.</p>
<p>While the workhorse of dplyr is the data frame, the workhorse of purrr is the list. If you aren’t familiar with lists, hopefully this will help you understand what they are:</p>
<ul>
<li><p>A <strong>vector</strong> is a way of storing many individual elements (a single number or a single character or string) of the same type together in a single object,</p></li>
<li><p>A <strong>data frame</strong> is a way of storing many vectors of the same length but possibly of different types together in a single object</p></li>
<li><p>A <strong>list</strong> is a way of storing many objects of any type (e.g.&nbsp;data frames, plots, vectors) together in a single object</p></li>
</ul>
<p>Here is an example of a list that has three elements: a single number, a vector and a data frame</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">my_first_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">my_number =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb1-2">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">my_vector =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c"</span>),</span>
<span id="cb1-3">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">my_dataframe =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"q"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"z"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bananas"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"are"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"so very great"</span>)))</span>
<span id="cb1-4">my_first_list</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="output"><code>$my_number
[1] 5

$my_vector
[1] "a" "b" "c"

$my_dataframe
  a b             c
1 1 q       bananas
2 2 b           are
3 3 z so very great</code></pre>
</div>
</div>
<p>Note that a data frame is actually a special case of a list where each element of the list is a vector of the same length.</p>
<section id="map-functions-beyond-apply" class="level1">
<h1>Map functions: beyond apply</h1>
<p>A <strong>map function</strong> is one that applies the same action/function to every element of an object (e.g.&nbsp;each entry of a list or a vector, or each of the columns of a data frame).</p>
<p>If you’re familiar with the base R <code>apply()</code> functions, then it turns out that you are already familiar with map functions, even if you didn’t know it!</p>
<p>The <code>apply()</code> functions are set of super useful base-R functions for iteratively performing an action across entries of a vector or list without having to write a for-loop. While there is nothing fundamentally wrong with the base R apply functions, the syntax is somewhat inconsistent across the different apply functions, and the expected type of the object they return is often ambiguous (at least it is for <code>sapply</code>…).</p>
<p>The naming convention of the map functions are such that the type of the <strong>output</strong> is specified by the term that follows the underscore in the function name.</p>
<ul>
<li><p><code>map(.x, .f)</code> is the main mapping function and returns a list</p></li>
<li><p><code>map_df(.x, .f)</code> returns a data frame</p></li>
<li><p><code>map_dbl(.x, .f)</code> returns a numeric (double) vector</p></li>
<li><p><code>map_chr(.x, .f)</code> returns a character vector</p></li>
<li><p><code>map_lgl(.x, .f)</code> returns a logical vector</p></li>
</ul>
<p>Consistent with the way of the tidyverse, the first argument of each mapping function is always the data object that you want to map over, and the second argument is always the <em>function</em> that you want to iteratively apply to each element of the input object.</p>
<p>The <strong>input</strong> object to any <code>map</code> function is always either</p>
<ul>
<li><p>a <em>vector</em> (of any type), in which case the iteration is done over the entries of the vector,</p></li>
<li><p>a <em>list</em>, in which case the iteration is performed over the elements of the list,</p></li>
<li><p>a <em>data frame</em>, in which case the iteration is performed over the columns of the data frame (which, since a data frame is a special kind of list, is technically the same as the previous point).</p></li>
</ul>
<p>Since the first argument is always the data, this means that map functions play nicely with pipes (<code>%&gt;%</code>). If you’ve never seen pipes before, they’re really useful (originally from the <code>magrittr</code> package, but also ported with the <code>dplyr</code> package and thus with the <code>tidyverse</code>). Piping allows you to string together many functions by piping an object (which itself might be the output of a function) into the first argument of the next function. If you’d like to learn more about pipes, check out my <a href="http://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse/">tidyverse blog posts</a>.</p>
<p>Throughout this post I will demonstrate each of purrr’s functionalities using both a simple numeric example (to explain the concept) and the gapminder data (to show a more complex example).</p>
<section id="simplest-usage-repeated-looping-with-map" class="level2">
<h2 class="anchored" data-anchor-id="simplest-usage-repeated-looping-with-map">Simplest usage: repeated looping with map</h2>
<p>Fundamentally, maps are for iteration. In the example below I will iterate through the vector <code>c(1, 4, 7)</code> by adding 10 to each entry. This function applied to a single number, which we will call <code>.x</code>, can be defined as</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">addTen <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(.x) {</span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb3-3">}</span></code></pre></div>
</div>
<p>The <code>map()</code> function below iterates <code>addTen()</code> across all entries of the vector, <code>.x = c(1, 4, 7)</code>, and returns the output as a list</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), </span>
<span id="cb4-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> addTen)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 11

[[2]]
[1] 14

[[3]]
[1] 17</code></pre>
</div>
</div>
<p>Fortunately, you don’t actually need to specify the argument names</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), addTen)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 11

[[2]]
[1] 14

[[3]]
[1] 17</code></pre>
</div>
</div>
<p>Note that</p>
<ul>
<li><p>the first element of the output is the result of applying the function to the first element of the input (<code>1</code>),</p></li>
<li><p>the second element of the output is the result of applying the function to the second element of the input (<code>4</code>),</p></li>
<li><p>and the third element of the output is the result of applying the function to the third element of the input (<code>7</code>).</p></li>
</ul>
<p>The following code chunks show that no matter if the input object is a vector, a list, or a data frame, <code>map()</code> always returns a list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), addTen)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 11

[[2]]
[1] 14

[[3]]
[1] 17</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">c =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), addTen)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$a
[1] 11

$b
[1] 14

$c
[1] 17</code></pre>
</div>
</div>
<p>If we wanted the output of <code>map</code> to be some other object type, we need to use a different function. For instance to map the input to a numeric (double) vector, you can use the <code>map_dbl()</code> (“map to a double”) function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), addTen)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11 14 17</code></pre>
</div>
</div>
<p>To map to a character vector, you can use the <code>map_chr()</code> (“map to a character”) function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_chr</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), addTen)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Automatic coercion from double to character was deprecated in purrr 1.0.0.
ℹ Please use an explicit call to `as.character()` within `map_chr()` instead.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "11.000000" "14.000000" "17.000000"</code></pre>
</div>
</div>
<p>If you want to return a data frame, then you would use the <code>map_df()</code> function. However, you need to make sure that in each iteration you’re returning a data frame which has consistent column names. <code>map_df</code> will automatically bind the rows of each iteration.</p>
<p>For this example, I want to return a data frame whose columns correspond to the original number and the number plus ten.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(.x) {</span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">old_number =</span> .x, </span>
<span id="cb17-3">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">new_number =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addTen</span>(.x)))</span>
<span id="cb17-4">})</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  old_number new_number
1          1         11
2          4         14
3          7         17</code></pre>
</div>
</div>
<p>Note that in this case, I defined an “anonymous” function as our output for each iteration. An anonymous function is a temporary function (that you define as the function argument to the map). Here I used the argument name <code>.x</code>, but I could have used anything.</p>
<p>Another function to be aware of is <code>modify()</code>, which is just like the map functions, but always returns an object the same type as the input object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb19-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">modify</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), addTen)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11 14 17</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">modify</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), addTen)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 11

[[2]]
[1] 14

[[3]]
[1] 17</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">modify</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), addTen)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  X1 X4 X7
1 11 14 17</code></pre>
</div>
</div>
<p>Modify also has a pretty useful sibling, <code>modify_if()</code>, that only applies the function to elements that satisfy a specific criteria (specified by a “predicate function”, the second argument called <code>.p</code>). For instance, the following example only modifies the third entry since it is greater than 5.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">modify_if</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), </span>
<span id="cb25-2">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.p =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb25-3">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> addTen)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 1

[[2]]
[1] 4

[[3]]
[1] 17</code></pre>
</div>
</div>
</section>
<section id="the-tilde-dot-shorthand-for-functions" class="level2">
<h2 class="anchored" data-anchor-id="the-tilde-dot-shorthand-for-functions">The tilde-dot shorthand for functions</h2>
<p>To make the code more concise you can use the tilde-dot shorthand for anonymous functions (the functions that you create as arguments of other functions).</p>
<p>The notation works by replacing</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) {</span>
<span id="cb27-2">  x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb27-3">}</span></code></pre></div>
</div>
<p>with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>{.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>}</span></code></pre></div>
</div>
<p><code>~</code> indicates that you have started an anonymous function, and the argument of the anonymous function can be referred to using <code>.x</code> (or simply <code>.</code>). Unlike normal function arguments that can be anything that you like, the tilde-dot function argument is always <code>.x</code>.</p>
<p>Thus, instead of defining the <code>addTen()</code> function separately, we could use the tilde-dot shorthand</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>{.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>})</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11 14 17</code></pre>
</div>
</div>
</section>
<section id="applying-map-functions-in-a-slightly-more-interesting-context" class="level2">
<h2 class="anchored" data-anchor-id="applying-map-functions-in-a-slightly-more-interesting-context">Applying map functions in a slightly more interesting context</h2>
<p>Throughout this tutorial, we will use the gapminder dataset that can be loaded directly if you’re connected to the internet. Each function will first be demonstrated using a simple numeric example, and then will be demonstrated using a more complex practical example based on the gapminder dataset.</p>
<p>My general workflow involves loading the original data and saving it as an object with a meaningful name and an <code>_orig</code> suffix. I then define a copy of the original dataset without the <code>_orig</code> suffix. Having an original copy of my data in my environment means that it is easy to check that my manipulations do what I expected. I will make direct data cleaning modifications to the <code>gapminder</code> data frame, but will never edit the <code>gapminder_orig</code> data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to download the data directly:</span></span>
<span id="cb31-2">gapminder_orig <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/rlbarter/personal-website-quarto/main/blog/data/gapminder.csv"</span>)</span>
<span id="cb31-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define a copy of the original dataset that we will clean and play with </span></span>
<span id="cb31-4">gapminder <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder_orig</span></code></pre></div>
</div>
<p>The gapminder dataset has 1704 rows containing information on population, life expectancy and GDP per capita by year and country.</p>
<p>A “tidy” data frame is one where every row is a single observational unit (in this case, indexed by country and year), and every column corresponds to a variable that is measured for each observational unit (in this case, for each country and year, a measurement is made for population, continent, life expectancy and GDP). If you’d like to learn more about “tidy data”, I highly recommend reading <a href="vita.had.co.nz/papers/tidy-data.pdf">Hadley Wickham’s tidy data article</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(gapminder)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1704    6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(gapminder)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      country continent year lifeExp      pop gdpPercap
1 Afghanistan      Asia 1952  28.801  8425333  779.4453
2 Afghanistan      Asia 1957  30.332  9240934  820.8530
3 Afghanistan      Asia 1962  31.997 10267083  853.1007
4 Afghanistan      Asia 1967  34.020 11537966  836.1971
5 Afghanistan      Asia 1972  36.088 13079460  739.9811
6 Afghanistan      Asia 1977  38.438 14880372  786.1134</code></pre>
</div>
</div>
<p>Since <code>gapminder</code> is a data frame, the <code>map_</code> functions will iterate over each column. An example of simple usage of the <code>map_</code> functions is to summarize each column. For instance, you can identify the type of each column by applying the <code>class()</code> function to each column. Since the output of the <code>class()</code> function is a character, we will use the <code>map_chr()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># apply the class() function to each column</span></span>
<span id="cb36-2">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_chr</span>(class)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    country   continent        year     lifeExp         pop   gdpPercap 
"character" "character"   "integer"   "numeric"   "integer"   "numeric" </code></pre>
</div>
</div>
<p>I frequently do this to get a quick snapshot of each column type of a new dataset directly in the console. As a habit, I usually pipe in the data using <code>%&gt;%</code>, rather than provide it as an argument. Remember that the pipe places the object to the left of the pipe in the first argument of the function to the right.</p>
<p>Similarly, if you wanted to identify the number of distinct values in each column, you could apply the <code>n_distinct()</code> function from the dplyr package to each column. Since the output of <code>n_distinct()</code> is a numeric (a double), you might want to use the <code>map_dbl()</code> function so that the results of each iteration (the application of <code>n_distinct()</code> to each column) are concatenated into a numeric vector:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># apply the n_distinct() function to each column</span></span>
<span id="cb38-2">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(n_distinct)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  country continent      year   lifeExp       pop gdpPercap 
      142         5        12      1626      1704      1704 </code></pre>
</div>
</div>
<p>If you want to do something a little more complicated, such return a few different summaries of each column in a data frame, you can use <code>map_df()</code>. When things are getting a little bit more complicated, you typically need to define an anonymous function that you want to apply to each column. Using the tilde-dot notation, the anonymous function below calculates the number of distinct entries and the type of the current column (which is accessible as <code>.x</code>), and then combines them into a two-column data frame. Once it has iterated through each of the columns, the <code>map_df</code> function combines the data frames row-wise into a single data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_distinct =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n_distinct</span>(.x),</span>
<span id="cb40-2">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span>(.x))))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  n_distinct     class
1        142 character
2          5 character
3         12   integer
4       1626   numeric
5       1704   integer
6       1704   numeric</code></pre>
</div>
</div>
<p>Note that we’ve lost the variable names! The variable names correspond to the names of the objects over which we are iterating (in this case, the column names), and these are not automatically included as a column in the output data frame. You can tell <code>map_df()</code> to include them using the <code>.id</code> argument of <code>map_df()</code>. This will automatically take the name of the element being iterated over and include it in the column corresponding to whatever you set <code>.id</code> to.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_distinct =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n_distinct</span>(.x),</span>
<span id="cb42-2">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span>(.x))),</span>
<span id="cb42-3">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"variable"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   variable n_distinct     class
1   country        142 character
2 continent          5 character
3      year         12   integer
4   lifeExp       1626   numeric
5       pop       1704   integer
6 gdpPercap       1704   numeric</code></pre>
</div>
</div>
<p>If you’re having trouble thinking through these map actions, I recommend that you first figure out what the code would be to do what you want for a single element, and then paste it into the <code>map_df()</code> function (a nice trick I saw Hadley Wickham used a few years ago when he presented on purrr at RLadies SF).</p>
<p>For instance, since the first element of the gapminder data frame is the first column, let’s define <code>.x</code> in our environment to be this first column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># take the first element of the gapminder data</span></span>
<span id="cb44-2">.x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pluck</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb44-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># look at the first 6 rows</span></span>
<span id="cb44-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(.x)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan"
[6] "Afghanistan"</code></pre>
</div>
</div>
<p>Then, you can create a data frame for this column that contains the number of distinct entries, and the class of the column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_distinct =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n_distinct</span>(.x),</span>
<span id="cb46-2">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span>(.x))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  n_distinct     class
1        142 character</code></pre>
</div>
</div>
<p>Since this has done what was expected want for the first column, you can paste this code into the map function using the tilde-dot shorthand.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_distinct =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n_distinct</span>(.x),</span>
<span id="cb48-2">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span>(.x))),</span>
<span id="cb48-3">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"variable"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   variable n_distinct     class
1   country        142 character
2 continent          5 character
3      year         12   integer
4   lifeExp       1626   numeric
5       pop       1704   integer
6 gdpPercap       1704   numeric</code></pre>
</div>
</div>
<p><code>map_df()</code> is definitely one of the most powerful functions of <code>purrr</code> in my opinion, and is probably the one that I use most.</p>
</section>
<section id="maps-with-multiple-input-objects" class="level2">
<h2 class="anchored" data-anchor-id="maps-with-multiple-input-objects">Maps with multiple input objects</h2>
<p>After gaining a basic understanding of purrr’s map functions, you can start to do some fancier stuff. For instance, what if you want to perform a map that iterates through two objects. The code below uses map functions to create a <em>list of plots</em> that compare life expectancy and GDP per capita for each continent/year combination.</p>
<p>The map function that maps over two objects instead of 1 is called <code>map2()</code>. The first two arguments are the two objects you want to iterate over, and the third is the function (with two arguments, one for each object).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.x =</span> object1, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the first object to iterate over</span></span>
<span id="cb50-2">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.y =</span> object2, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the second object to iterate over</span></span>
<span id="cb50-3">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotFunction</span>(.x, .y))</span></code></pre></div>
</div>
<p>First, you need to define a vector (or list) of continents and a paired vector (or list) of years that you want to iterate through. Note that in our continent/year example</p>
<ul>
<li><p>the <em>first iteration</em> will correspond to the <em>first continent</em> in the continent vector and the <em>first year</em> in the year vector,</p></li>
<li><p>the <em>second iteration</em> will correspond to the <em>second continent</em> in the continent vector and the <em>second year</em> in the year vector.</p></li>
</ul>
<p>This might seem obvious, but it is a natural instinct to incorrectly assume that <code>map2()</code> will automatically perform the action on <em>all</em> combinations that can be made from the two vectors. For instance if you have a continent vector <code>.x = c("Americas", "Asia")</code> and a year vector <code>.y = c(1952, 2007)</code>, then you might assume that <code>map2</code> will iterate over the Americas for 1952 and for 2007, and then Asia for 1952 and 2007. It won’t though. The iteration will actually be first the Americas for 1952 only, and then Asia for 2007 only.</p>
<p>First, let’s get our vectors of continents and years, starting by obtaining all distinct combinations of continents and years that appear in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1">continent_year <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>(continent, year)</span>
<span id="cb51-2">continent_year</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   continent year
1       Asia 1952
2       Asia 1957
3       Asia 1962
4       Asia 1967
5       Asia 1972
6       Asia 1977
7       Asia 1982
8       Asia 1987
9       Asia 1992
10      Asia 1997
11      Asia 2002
12      Asia 2007
13    Europe 1952
14    Europe 1957
15    Europe 1962
16    Europe 1967
17    Europe 1972
18    Europe 1977
19    Europe 1982
20    Europe 1987
21    Europe 1992
22    Europe 1997
23    Europe 2002
24    Europe 2007
25    Africa 1952
26    Africa 1957
27    Africa 1962
28    Africa 1967
29    Africa 1972
30    Africa 1977
31    Africa 1982
32    Africa 1987
33    Africa 1992
34    Africa 1997
35    Africa 2002
36    Africa 2007
37  Americas 1952
38  Americas 1957
39  Americas 1962
40  Americas 1967
41  Americas 1972
42  Americas 1977
43  Americas 1982
44  Americas 1987
45  Americas 1992
46  Americas 1997
47  Americas 2002
48  Americas 2007
49   Oceania 1952
50   Oceania 1957
51   Oceania 1962
52   Oceania 1967
53   Oceania 1972
54   Oceania 1977
55   Oceania 1982
56   Oceania 1987
57   Oceania 1992
58   Oceania 1997
59   Oceania 2002
60   Oceania 2007</code></pre>
</div>
</div>
<p>Then extracting the continent and year pairs as separate vectors</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># extract the continent and year pairs as separate vectors</span></span>
<span id="cb53-2">continents <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> continent_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(continent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> as.character</span>
<span id="cb53-3">years <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> continent_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(year)</span></code></pre></div>
</div>
<p>If you want to use tilde-dot short-hand, the anonymous arguments will be <code>.x</code> for the first object being iterated over, and <code>.y</code> for the second object being iterated over.</p>
<p>Before jumping straight into the map function, it’s a good idea to first figure out what the code will be for just first iteration (the first continent and the first year, which happen to be Asia in 1952).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># try to figure out the code for the first example</span></span>
<span id="cb54-2">.x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> continents[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb54-3">.y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> years[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb54-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make a scatterplot of GDP vs life expectancy in all Asian countries for 1952</span></span>
<span id="cb54-5">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb54-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(continent <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> .x,</span>
<span id="cb54-7">         year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> .y) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb54-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb54-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdpPercap, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb54-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(.x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>, .y))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-19_purrr_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This seems to have worked. So you can then copy-and-paste the code into the <code>map2</code> function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1">plot_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.x =</span> continents, </span>
<span id="cb55-2">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.y =</span> years, </span>
<span id="cb55-3">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>{</span>
<span id="cb55-4">                    gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb55-5">                      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(continent <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> .x,</span>
<span id="cb55-6">                             year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> .y) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb55-7">                      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb55-8">                      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdpPercap, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb55-9">                      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(.x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>, .y))</span>
<span id="cb55-10">                  })</span></code></pre></div>
</div>
<p>And you can look at a few of the entries of the list to see that they make sense</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1">plot_list[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-19_purrr_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb57" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1">plot_list[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>]]</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-19_purrr_files/figure-html/unnamed-chunk-32-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><code>pmap()</code> allows you to iterate over an arbitrary number of objects (i.e.&nbsp;more than two).</p>
</section>
<section id="list-columns-and-nested-data-frames" class="level2">
<h2 class="anchored" data-anchor-id="list-columns-and-nested-data-frames">List columns and Nested data frames</h2>
<p>Tibbles are tidyverse data frames. Some crazy stuff starts happening when you learn that tibble columns can be lists (as opposed to vectors, which is what they usually are). This is where the difference between tibbles and data frames becomes real.</p>
<p>For instance, a tibble can be “nested” where the tibble is essentially split into separate data frames based on a grouping variable, and these separate data frames are stored as entries of a list (that is then stored in the <code>data</code> column of the data frame).</p>
<p>Below I nest the gapminder data by continent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1">gapminder_nested <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb58-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(continent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb58-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nest</span>()</span>
<span id="cb58-4">gapminder_nested</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
# Groups:   continent [5]
  continent data              
  &lt;chr&gt;     &lt;list&gt;            
1 Asia      &lt;tibble [396 × 5]&gt;
2 Europe    &lt;tibble [360 × 5]&gt;
3 Africa    &lt;tibble [624 × 5]&gt;
4 Americas  &lt;tibble [300 × 5]&gt;
5 Oceania   &lt;tibble [24 × 5]&gt; </code></pre>
</div>
</div>
<p>The first column is the variable that we grouped by, <code>continent</code>, and the second column is the rest of the data frame corresponding to that group (as if you had filtered the data frame to the specific continent). To see this, the code below shows that the first entry in the <code>data</code> column corresponds to the entire gapminder dataset for Asia.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1">gapminder_nested<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>data[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 396 × 5
   country      year lifeExp      pop gdpPercap
   &lt;chr&gt;       &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
 1 Afghanistan  1952    28.8  8425333      779.
 2 Afghanistan  1957    30.3  9240934      821.
 3 Afghanistan  1962    32.0 10267083      853.
 4 Afghanistan  1967    34.0 11537966      836.
 5 Afghanistan  1972    36.1 13079460      740.
 6 Afghanistan  1977    38.4 14880372      786.
 7 Afghanistan  1982    39.9 12881816      978.
 8 Afghanistan  1987    40.8 13867957      852.
 9 Afghanistan  1992    41.7 16317921      649.
10 Afghanistan  1997    41.8 22227415      635.
# ℹ 386 more rows</code></pre>
</div>
</div>
<p>Using dplyr <code>pluck()</code> function, this can be written as</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1">gapminder_nested <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb62-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># extract the first entry from the data column</span></span>
<span id="cb62-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pluck</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 396 × 5
   country      year lifeExp      pop gdpPercap
   &lt;chr&gt;       &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
 1 Afghanistan  1952    28.8  8425333      779.
 2 Afghanistan  1957    30.3  9240934      821.
 3 Afghanistan  1962    32.0 10267083      853.
 4 Afghanistan  1967    34.0 11537966      836.
 5 Afghanistan  1972    36.1 13079460      740.
 6 Afghanistan  1977    38.4 14880372      786.
 7 Afghanistan  1982    39.9 12881816      978.
 8 Afghanistan  1987    40.8 13867957      852.
 9 Afghanistan  1992    41.7 16317921      649.
10 Afghanistan  1997    41.8 22227415      635.
# ℹ 386 more rows</code></pre>
</div>
</div>
<p>Similarly, the 5th entry in the <code>data</code> column corresponds to the entire gapminder dataset for Oceania.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1">gapminder_nested <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pluck</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 5
   country    year lifeExp      pop gdpPercap
   &lt;chr&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
 1 Australia  1952    69.1  8691212    10040.
 2 Australia  1957    70.3  9712569    10950.
 3 Australia  1962    70.9 10794968    12217.
 4 Australia  1967    71.1 11872264    14526.
 5 Australia  1972    71.9 13177000    16789.
 6 Australia  1977    73.5 14074100    18334.
 7 Australia  1982    74.7 15184200    19477.
 8 Australia  1987    76.3 16257249    21889.
 9 Australia  1992    77.6 17481977    23425.
10 Australia  1997    78.8 18565243    26998.
# ℹ 14 more rows</code></pre>
</div>
</div>
<p>You might be asking at this point <em>why</em> you would ever want to nest your data frame? It just doesn’t seem like that useful a thing to do… until you realise that you now have the power to use dplyr manipulations on more complex objects that can be stored in a list.</p>
<p>However, since actions such as <code>mutate()</code> are applied directly to the entire column (which is usually a vector, so is fine), we run into issues when we try to mutate a list. For instance, since columns are usually vectors, normal vectorized functions work just fine on them</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vec_col =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb66-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vec_sum =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(vec_col))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   vec_col vec_sum
     &lt;int&gt;   &lt;int&gt;
 1       1      55
 2       2      55
 3       3      55
 4       4      55
 5       5      55
 6       6      55
 7       7      55
 8       8      55
 9       9      55
10      10      55</code></pre>
</div>
</div>
<p>but when the column is a list, vectorized functions don’t know what to do with them, and we get an error that says <code>Error in sum(x) : invalid 'type' (list) of argument</code>. Try</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list_col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), </span>
<span id="cb68-2">                       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb68-3">                       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb68-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list_sum =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(list_col))</span></code></pre></div>
</div>
<p>To apply mutate functions to a list-column, you need to wrap the function you want to apply in a map function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list_col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), </span>
<span id="cb69-2">                       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb69-3">                       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb69-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list_sum =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(list_col, sum))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  list_col  list_sum 
  &lt;list&gt;    &lt;list&gt;   
1 &lt;dbl [3]&gt; &lt;dbl [1]&gt;
2 &lt;dbl [1]&gt; &lt;dbl [1]&gt;
3 &lt;dbl [3]&gt; &lt;dbl [1]&gt;</code></pre>
</div>
</div>
<p>Since <code>map()</code> returns a list itself, the <code>list_sum</code> column is thus itself a list</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list_col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), </span>
<span id="cb71-2">                       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb71-3">                       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb71-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list_sum =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(list_col, sum)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb71-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(list_sum)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 13

[[2]]
[1] 5

[[3]]
[1] 31</code></pre>
</div>
</div>
<p>What could we do if we wanted it to be a vector? We could use the <code>map_dbl()</code> function instead!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list_col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), </span>
<span id="cb73-2">                       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb73-3">                       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb73-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list_sum =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(list_col, sum))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  list_col  list_sum
  &lt;list&gt;       &lt;dbl&gt;
1 &lt;dbl [3]&gt;       13
2 &lt;dbl [1]&gt;        5
3 &lt;dbl [3]&gt;       31</code></pre>
</div>
</div>
<section id="nesting-the-gapminder-data" class="level3">
<h3 class="anchored" data-anchor-id="nesting-the-gapminder-data">Nesting the gapminder data</h3>
<p>Let’s return to the nested gapminder dataset. I want to calculate the average life expectancy within each continent and add it as a new column using <code>mutate()</code>. Based on the example above, can you explain why the following code doesn’t work?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1">gapminder_nested <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb75-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avg_lifeExp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>lifeExp))</span></code></pre></div>
</div>
<p>I was hoping that this code would extract the <code>lifeExp</code> column from each data frame. But I’m applying the mutate to the <code>data</code> column, which itself doesn’t have an entry called <code>lifeExp</code> since it’s a <em>list</em> of data frames. How could I get access to the <code>lifeExp</code> column of the data frames stored in the <code>data</code> list? Using a <code>map</code> function of course!</p>
<p>Think of an individual data frame as <code>.x</code>. Again, I will first figure out the code for calculating the mean life expectancy for the first entry of the column. The following code defines <code>.x</code> to be the first entry of the <code>data</code> column (this is the data frame for Asia).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the first entry of the "data" column</span></span>
<span id="cb76-2">.x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder_nested <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pluck</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb76-3">.x</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 396 × 5
   country      year lifeExp      pop gdpPercap
   &lt;chr&gt;       &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
 1 Afghanistan  1952    28.8  8425333      779.
 2 Afghanistan  1957    30.3  9240934      821.
 3 Afghanistan  1962    32.0 10267083      853.
 4 Afghanistan  1967    34.0 11537966      836.
 5 Afghanistan  1972    36.1 13079460      740.
 6 Afghanistan  1977    38.4 14880372      786.
 7 Afghanistan  1982    39.9 12881816      978.
 8 Afghanistan  1987    40.8 13867957      852.
 9 Afghanistan  1992    41.7 16317921      649.
10 Afghanistan  1997    41.8 22227415      635.
# ℹ 386 more rows</code></pre>
</div>
</div>
<p>Then to calculate the average life expectancy for Asia, I could write</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(.x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>lifeExp)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60.0649</code></pre>
</div>
</div>
<p>So copy-pasting this into the tilde-dot anonymous function argument of the <code>map_dbl()</code> function within <code>mutate()</code>, I get what I wanted!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1">gapminder_nested <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb80-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avg_lifeExp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(data, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>{<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(.x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>lifeExp)}))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
# Groups:   continent [5]
  continent data               avg_lifeExp
  &lt;chr&gt;     &lt;list&gt;                   &lt;dbl&gt;
1 Asia      &lt;tibble [396 × 5]&gt;        60.1
2 Europe    &lt;tibble [360 × 5]&gt;        71.9
3 Africa    &lt;tibble [624 × 5]&gt;        48.9
4 Americas  &lt;tibble [300 × 5]&gt;        64.7
5 Oceania   &lt;tibble [24 × 5]&gt;         74.3</code></pre>
</div>
</div>
<p>This code iterates through the data frames stored in the <code>data</code> column, returns the average life expectancy for each data frame, and concatonates the results into a numeric vector (which is then stored as a column called <code>avg_lifeExp</code>).</p>
<p>I hear what you’re saying… this is something that we could have done a lot more easily using standard dplyr commands (such as <code>summarise()</code>). True, but hopefully it helped you understand why you need to wrap mutate functions inside map functions when applying them to list columns.</p>
<p>Even if this example was less than inspiring, I promise the next example will knock your socks off!</p>
<p>The next exampe will demonstrate how to fit a model separately for each continent, and evaluate it, all within a single tibble. First, I will fit a linear model for each continent and store it as a list-column. If the data frame for a single continent is <code>.x</code>, then the model I want to fit is <code>lm(lifeExp ~ pop + gdpPercap + year, data = .x)</code> (check for yourself that this does what you expect). So I can copy-past this command into the <code>map()</code> function within the <code>mutate()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fit a model separately for each continent</span></span>
<span id="cb82-2">gapminder_nested <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder_nested <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb82-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lm_obj =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(data, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(lifeExp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> gdpPercap <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> .x)))</span>
<span id="cb82-4">gapminder_nested</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
# Groups:   continent [5]
  continent data               lm_obj
  &lt;chr&gt;     &lt;list&gt;             &lt;list&gt;
1 Asia      &lt;tibble [396 × 5]&gt; &lt;lm&gt;  
2 Europe    &lt;tibble [360 × 5]&gt; &lt;lm&gt;  
3 Africa    &lt;tibble [624 × 5]&gt; &lt;lm&gt;  
4 Americas  &lt;tibble [300 × 5]&gt; &lt;lm&gt;  
5 Oceania   &lt;tibble [24 × 5]&gt;  &lt;lm&gt;  </code></pre>
</div>
</div>
<p>Where the first linear model (for Asia) is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1">gapminder_nested <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pluck</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm_obj"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lifeExp ~ pop + gdpPercap + year, data = .x)

Coefficients:
(Intercept)          pop    gdpPercap         year  
 -7.833e+02    4.228e-11    2.510e-04    4.251e-01  </code></pre>
</div>
</div>
<p>I can then predict the response for the data stored in the <code>data</code> column using the corresponding linear model. So I have two objects I want to iterate over: the data and the linear model object. This means I want to use <code>map2()</code>. When things get a little more complicated I like to have multiple function arguments, so I’m going to use a full anonymous function rather than the tilde-dot shorthand.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># predict the response for each continent</span></span>
<span id="cb86-2">gapminder_nested <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder_nested <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb86-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pred =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2</span>(lm_obj, data, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(.lm, .data) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(.lm, .data)))</span>
<span id="cb86-4">gapminder_nested</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
# Groups:   continent [5]
  continent data               lm_obj pred       
  &lt;chr&gt;     &lt;list&gt;             &lt;list&gt; &lt;list&gt;     
1 Asia      &lt;tibble [396 × 5]&gt; &lt;lm&gt;   &lt;dbl [396]&gt;
2 Europe    &lt;tibble [360 × 5]&gt; &lt;lm&gt;   &lt;dbl [360]&gt;
3 Africa    &lt;tibble [624 × 5]&gt; &lt;lm&gt;   &lt;dbl [624]&gt;
4 Americas  &lt;tibble [300 × 5]&gt; &lt;lm&gt;   &lt;dbl [300]&gt;
5 Oceania   &lt;tibble [24 × 5]&gt;  &lt;lm&gt;   &lt;dbl [24]&gt; </code></pre>
</div>
</div>
<p>And I can then calculate the correlation between the predicted response and the true response, this time using the <code>map2()_dbl</code> function since I want the output the be a numeric vector rather than a list of single elements.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># calculate the correlation between observed and predicted response for each continent</span></span>
<span id="cb88-2">gapminder_nested <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder_nested <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb88-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2_dbl</span>(pred, data, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(.pred, .data) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(.pred, .data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>lifeExp)))</span>
<span id="cb88-4">gapminder_nested</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
# Groups:   continent [5]
  continent data               lm_obj pred          cor
  &lt;chr&gt;     &lt;list&gt;             &lt;list&gt; &lt;list&gt;      &lt;dbl&gt;
1 Asia      &lt;tibble [396 × 5]&gt; &lt;lm&gt;   &lt;dbl [396]&gt; 0.723
2 Europe    &lt;tibble [360 × 5]&gt; &lt;lm&gt;   &lt;dbl [360]&gt; 0.834
3 Africa    &lt;tibble [624 × 5]&gt; &lt;lm&gt;   &lt;dbl [624]&gt; 0.645
4 Americas  &lt;tibble [300 × 5]&gt; &lt;lm&gt;   &lt;dbl [300]&gt; 0.779
5 Oceania   &lt;tibble [24 × 5]&gt;  &lt;lm&gt;   &lt;dbl [24]&gt;  0.987</code></pre>
</div>
</div>
<p>Holy guacamole, that is so awesome!</p>
</section>
</section>
<section id="advanced-exercise" class="level2">
<h2 class="anchored" data-anchor-id="advanced-exercise">Advanced exercise</h2>
<p>The goal of this exercise is to fit a separate linear model for each continent without splitting up the data. Create the following data frame that has the continent, each term in the model for the continent, its linear model coefficient estimate, and standard error.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 6
   continent term         estimate std.error statistic  p.value
   &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 Asia      (Intercept) -7.83e+ 2   4.83e+1  -16.2    1.22e-45
 2 Asia      pop          4.23e-11   2.04e-9    0.0207 9.83e- 1
 3 Asia      year         4.25e- 1   2.44e-2   17.4    1.13e-50
 4 Asia      gdpPercap    2.51e- 4   3.01e-5    8.34   1.31e-15
 5 Europe    (Intercept) -1.61e+ 2   2.28e+1   -7.09   7.44e-12
 6 Europe    pop         -8.18e- 9   7.80e-9   -1.05   2.95e- 1
 7 Europe    year         1.16e- 1   1.16e-2    9.96   8.88e-21
 8 Europe    gdpPercap    3.25e- 4   2.15e-5   15.2    2.21e-40
 9 Africa    (Intercept) -4.70e+ 2   3.39e+1  -13.9    2.17e-38
10 Africa    pop         -3.68e- 9   1.89e-8   -0.195  8.45e- 1
11 Africa    year         2.61e- 1   1.71e-2   15.2    1.07e-44
12 Africa    gdpPercap    1.12e- 3   1.01e-4   11.1    2.46e-26
13 Americas  (Intercept) -5.33e+ 2   4.10e+1  -13.0    6.40e-31
14 Americas  pop         -2.15e- 8   8.62e-9   -2.49   1.32e- 2
15 Americas  year         3.00e- 1   2.08e-2   14.4    3.79e-36
16 Americas  gdpPercap    6.75e- 4   7.15e-5    9.44   1.13e-18
17 Oceania   (Intercept) -2.10e+ 2   5.12e+1   -4.10   5.61e- 4
18 Oceania   pop          8.37e- 9   3.34e-8    0.251  8.05e- 1
19 Oceania   year         1.42e- 1   2.65e-2    5.34   3.19e- 5
20 Oceania   gdpPercap    2.03e- 4   8.47e-5    2.39   2.66e- 2</code></pre>
</div>
</div>
<p>Hint: starting from the <code>gapminder</code> dataset, use <code>group_by()</code> and <code>nest()</code> to nest by continent, use a mutate together with <code>map</code> to fit a linear model for each continent, use another mutate with <code>broom::tidy()</code> to get a data frame of model coefficients for each model, and a <code>transmute</code> to get just the columns you want, followed by an <code>unnest()</code> to re-expand the nested tibble.</p>
<p>The solution code is at the end of this post.</p>
<p>If you want to stop here, you will already know more than most purrr users. The remainder of this blog post involves little-used features of purrr for manipulating lists.</p>
</section>
</section>
<section id="additional-purrr-functionalities-for-lists" class="level1">
<h1>Additional purrr functionalities for lists</h1>
<p>To demonstrate how to use purrr to manipulate lists, we will split the gapminder dataset into a <em>list of data frames</em> (which is kind of like the converse of a data frame containing a list-column). To make sure it’s easy to follow, we will only keep 5 rows from each continent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23489</span>)</span>
<span id="cb91-2">gapminder_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split</span>(gapminder<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>continent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb91-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample_n</span>(., <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb91-4">gapminder_list</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Africa
            country continent year lifeExp      pop gdpPercap
1            Gambia    Africa 1967  35.857   439593  734.7829
2      Sierra Leone    Africa 1967  34.113  2662190 1206.0435
3           Namibia    Africa 1997  58.909  1774766 3899.5243
4 Equatorial Guinea    Africa 1992  47.545   387838 1132.0550
5     Cote d'Ivoire    Africa 2002  46.832 16252726 1648.8008

$Americas
             country continent year lifeExp     pop gdpPercap
1 Dominican Republic  Americas 1997  69.957 7992357  3614.101
2        Puerto Rico  Americas 1987  74.630 3444468 12281.342
3           Honduras  Americas 1992  66.399 5077347  3081.695
4            Uruguay  Americas 2007  76.384 3447496 10611.463
5         Costa Rica  Americas 1962  62.842 1345187  3460.937

$Asia
      country continent year lifeExp       pop gdpPercap
1     Lebanon      Asia 1967  63.870   2186894 6006.9830
2       Nepal      Asia 1962  39.393  10332057  652.3969
3 Yemen, Rep.      Asia 1992  55.599  13367997 1879.4967
4       India      Asia 1972  50.651 567000000  724.0325
5    Cambodia      Asia 1952  39.417   4693836  368.4693

$Europe
         country continent year lifeExp      pop gdpPercap
1 United Kingdom    Europe 2002  78.471 59912431  29479.00
2         Greece    Europe 1997  77.869 10502372  18747.70
3        Belgium    Europe 2002  78.320 10311970  30485.88
4        Croatia    Europe 2002  74.876  4481020  11628.39
5    Netherlands    Europe 1967  73.820 12596822  15363.25

$Oceania
      country continent year lifeExp      pop gdpPercap
1   Australia   Oceania 1982  74.740 15184200  19477.01
2 New Zealand   Oceania 1997  77.550  3676187  21050.41
3 New Zealand   Oceania 2007  80.204  4115771  25185.01
4   Australia   Oceania 2007  81.235 20434176  34435.37
5 New Zealand   Oceania 1952  69.390  1994794  10556.58</code></pre>
</div>
</div>
<section id="keepdiscard-select_if-for-lists" class="level2">
<h2 class="anchored" data-anchor-id="keepdiscard-select_if-for-lists">Keep/Discard: select_if for lists</h2>
<p><code>keep()</code> only keeps elements of a list that satisfy a given condition, much like <code>select_if()</code> selects columns of a data frame that satisfy a given condition.</p>
<p>The following code only keeps the gapminder continent data frames (the elements of the list) that have an average (among the sample of 5 rows) life expectancy of at least 70.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1">gapminder_list <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb93-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">keep</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>{<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(.x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>lifeExp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>})</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Americas
             country continent year lifeExp     pop gdpPercap
1 Dominican Republic  Americas 1997  69.957 7992357  3614.101
2        Puerto Rico  Americas 1987  74.630 3444468 12281.342
3           Honduras  Americas 1992  66.399 5077347  3081.695
4            Uruguay  Americas 2007  76.384 3447496 10611.463
5         Costa Rica  Americas 1962  62.842 1345187  3460.937

$Europe
         country continent year lifeExp      pop gdpPercap
1 United Kingdom    Europe 2002  78.471 59912431  29479.00
2         Greece    Europe 1997  77.869 10502372  18747.70
3        Belgium    Europe 2002  78.320 10311970  30485.88
4        Croatia    Europe 2002  74.876  4481020  11628.39
5    Netherlands    Europe 1967  73.820 12596822  15363.25

$Oceania
      country continent year lifeExp      pop gdpPercap
1   Australia   Oceania 1982  74.740 15184200  19477.01
2 New Zealand   Oceania 1997  77.550  3676187  21050.41
3 New Zealand   Oceania 2007  80.204  4115771  25185.01
4   Australia   Oceania 2007  81.235 20434176  34435.37
5 New Zealand   Oceania 1952  69.390  1994794  10556.58</code></pre>
</div>
</div>
<p><code>discard()</code> does the opposite of <code>keep()</code>: it discards any elements that satisfy your logical condition.</p>
</section>
<section id="reduce" class="level2">
<h2 class="anchored" data-anchor-id="reduce">Reduce</h2>
<p><code>reduce()</code> is designed to combine (reduces) all of the elements of a list into a single object by iteratively applying a binary function (a function that takes two inputs).</p>
<p>For instance, applying a reduce function to add up all of the elements of the vector <code>c(1, 2, 3)</code> is like doing <code>sum(sum(1, 2), 3)</code>: first it applies <code>sum</code> to <code>1</code> and <code>2</code>, then it applies <code>sum</code> again to the output of <code>sum(1, 2)</code> and <code>3</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reduce</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), sum)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
<p><code>accumulate()</code> also returns the intermediate values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">accumulate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), sum)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 3 6</code></pre>
</div>
</div>
<p>An example of when <code>reduce()</code> might come in handy is when you want to perform many <code>left_join()</code>s in a row, or to do repeated <code>rbinds()</code> (e.g.&nbsp;to bind the rows of the list back together into a single data frame)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1">gapminder_list <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb99-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reduce</span>(rbind)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              country continent year lifeExp       pop  gdpPercap
1              Gambia    Africa 1967  35.857    439593   734.7829
2        Sierra Leone    Africa 1967  34.113   2662190  1206.0435
3             Namibia    Africa 1997  58.909   1774766  3899.5243
4   Equatorial Guinea    Africa 1992  47.545    387838  1132.0550
5       Cote d'Ivoire    Africa 2002  46.832  16252726  1648.8008
6  Dominican Republic  Americas 1997  69.957   7992357  3614.1013
7         Puerto Rico  Americas 1987  74.630   3444468 12281.3419
8            Honduras  Americas 1992  66.399   5077347  3081.6946
9             Uruguay  Americas 2007  76.384   3447496 10611.4630
10         Costa Rica  Americas 1962  62.842   1345187  3460.9370
11            Lebanon      Asia 1967  63.870   2186894  6006.9830
12              Nepal      Asia 1962  39.393  10332057   652.3969
13        Yemen, Rep.      Asia 1992  55.599  13367997  1879.4967
14              India      Asia 1972  50.651 567000000   724.0325
15           Cambodia      Asia 1952  39.417   4693836   368.4693
16     United Kingdom    Europe 2002  78.471  59912431 29478.9992
17             Greece    Europe 1997  77.869  10502372 18747.6981
18            Belgium    Europe 2002  78.320  10311970 30485.8838
19            Croatia    Europe 2002  74.876   4481020 11628.3890
20        Netherlands    Europe 1967  73.820  12596822 15363.2514
21          Australia   Oceania 1982  74.740  15184200 19477.0093
22        New Zealand   Oceania 1997  77.550   3676187 21050.4138
23        New Zealand   Oceania 2007  80.204   4115771 25185.0091
24          Australia   Oceania 2007  81.235  20434176 34435.3674
25        New Zealand   Oceania 1952  69.390   1994794 10556.5757</code></pre>
</div>
</div>
</section>
<section id="logical-statements-for-lists" class="level2">
<h2 class="anchored" data-anchor-id="logical-statements-for-lists">Logical statements for lists</h2>
<p>Asking logical questions of a list can be done using <code>every()</code> and <code>some()</code>. For instance to ask whether <em>every</em> continent has average life expectancy greater than 70, you can use <code>every()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1">gapminder_list <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">every</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>{<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(.x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>life) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>})</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>To ask whether <em>some</em> continents have average life expectancy greater than 70, you can use <code>some()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1">gapminder_list <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">some</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>{<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(.x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>life) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>})</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>An equivalent of <code>%in%</code> for lists is <code>has_element()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">has_element</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Most of these functions also work on vectors.</p>
<p>Now go forth and purrr!</p>
</section>
</section>
<section id="answer-to-advanced-exercise" class="level1">
<h1>Answer to advanced exercise</h1>
<p>The following code produces the table from the exercise above</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb107-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(continent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb107-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nest</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb107-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lm_obj =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(data, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(lifeExp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> gdpPercap, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> .))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb107-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lm_tidy =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(lm_obj, broom<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>tidy)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb107-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb107-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transmute</span>(continent, lm_tidy) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb107-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(lm_tidy))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 6
   continent term         estimate std.error statistic  p.value
   &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 Asia      (Intercept) -7.83e+ 2   4.83e+1  -16.2    1.22e-45
 2 Asia      pop          4.23e-11   2.04e-9    0.0207 9.83e- 1
 3 Asia      year         4.25e- 1   2.44e-2   17.4    1.13e-50
 4 Asia      gdpPercap    2.51e- 4   3.01e-5    8.34   1.31e-15
 5 Europe    (Intercept) -1.61e+ 2   2.28e+1   -7.09   7.44e-12
 6 Europe    pop         -8.18e- 9   7.80e-9   -1.05   2.95e- 1
 7 Europe    year         1.16e- 1   1.16e-2    9.96   8.88e-21
 8 Europe    gdpPercap    3.25e- 4   2.15e-5   15.2    2.21e-40
 9 Africa    (Intercept) -4.70e+ 2   3.39e+1  -13.9    2.17e-38
10 Africa    pop         -3.68e- 9   1.89e-8   -0.195  8.45e- 1
11 Africa    year         2.61e- 1   1.71e-2   15.2    1.07e-44
12 Africa    gdpPercap    1.12e- 3   1.01e-4   11.1    2.46e-26
13 Americas  (Intercept) -5.33e+ 2   4.10e+1  -13.0    6.40e-31
14 Americas  pop         -2.15e- 8   8.62e-9   -2.49   1.32e- 2
15 Americas  year         3.00e- 1   2.08e-2   14.4    3.79e-36
16 Americas  gdpPercap    6.75e- 4   7.15e-5    9.44   1.13e-18
17 Oceania   (Intercept) -2.10e+ 2   5.12e+1   -4.10   5.61e- 4
18 Oceania   pop          8.37e- 9   3.34e-8    0.251  8.05e- 1
19 Oceania   year         1.42e- 1   2.65e-2    5.34   3.19e- 5
20 Oceania   gdpPercap    2.03e- 4   8.47e-5    2.39   2.66e- 2</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>purrr</category>
  <category>tidyverse</category>
  <guid>https://www.rebeccabarter.com/blog/2019-08-19_purrr.html</guid>
  <pubDate>Mon, 19 Aug 2019 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Transitioning into the tidyverse (part 1)</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse.html</link>
  <description><![CDATA[ 





<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/tidyverse/tidyverse_all.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>Most people who learned R before the tidyverse have likely started to feel a nibble of pressure to get aboard the tidyverse train. Sadly a fact of human nature is that once you’re comfortable doing something a certain way, it’s hard to find the motivation to learn a different way of doing something that you already know how to do. As someone first learnt R 10 years ago (long before the tidyverse) I’ve been there. Five years ago, I was pushed to stick my little toe into the shallow-end of the tidyverse pool by learning ggplot2, and I never went back.</p>
<p>While the tidyverse is primarily made up of a set of super useful R packages (<em>ggplot2</em>, <em>dplyr</em>, <em>purrr</em>, <em>tidyr</em>, <em>readr</em>, <em>tibble</em>), it is also a way of thinking about implementing “tidy” data analysis. If you combine tidy thinking with the tidy packages, you will inevitably become a master of tidy analysis. From where I float now substantially closer to the deep-end of the tidyverse pool, I would provide the following arguments you as well as to my past self for why it is a good idea to learn the tidyverse:</p>
<ul>
<li><p>Regardless of whether you think the tidyverse or base R is “better”, it is always a good idea to keep up with what is current. It’s so easy to get left behind. What you learn today will most likely be out-of-date in a year, but next year’s iteration of what is current will almost certainly be built upon today’s iteration. If you make an effort keep up with things as they change, then you can take lots of little easy steps instead of finding yourself needing to take a big difficult jump in a few years.</p></li>
<li><p>Code written in the tidyverse style is much easier to read, and is more consistent than base R (e.g.&nbsp;the first argument of almost every tidyverse function is the data frame on which it acts, which allows us to make heavy use of something called “piping”). Base R, on the other hand, has a somewhat inconsistent mish-mash of function and argument styles.</p></li>
<li><p>The humans that make up the tidyverse community are amazing.</p></li>
</ul>
<p>Much of the initial efforts of the tidyverse were the brainchild of Hadley Wickham, but these days there are a huge number of people who contribute to, maintain, and develop the tidyverse. The tidyverse is open-source and collaborative (which means that you - yes <em>you</em> - could contribute to it if you wanted to), and is hosted on the tidyverse github: https://github.com/tidyverse.</p>
<p>The goal of this post is to summarise the overall goals of the tidyverse, provide short tutorials on each of the packages that form the tidyverse (and how they play together), and to provide links to additional resources for learning them.</p>
<p>For new tidyverse practitioners, I’d recommend focusing on getting a handle on piping <code>%&gt;%</code>, and learning the <em>dplyr</em> and <em>ggplot2</em> packages (these form part one of this post). Once you feel comfortable with these core aspects of the tidyverse, you can move onto <a href="http://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_pt2/">part two</a> of this two-part series on the tidyverse to learn about the remaining packages.</p>
<p>It is important to remember that the tidyverse is constantly evolving. The best ways to keep up to date with the evolving tidyverse ecosystem is (1) to follow the RStudio blog (https://blog.rstudio.com/), and (2) start following R people on twitter. Mara Averick (<span class="citation" data-cites="dataandme">@dataandme</span>) and Hadley Wickham (<span class="citation" data-cites="hadleywickham">@hadleywickham</span>) are good people to follow. A great resource for learning about the tidyverse in more detail is <a href="https://r4ds.had.co.nz/">R for Data Science</a> by Garrett Grolemund and Hadley Wickham.</p>
<section id="entering-the-tidyverse" class="level1">
<h1>Entering the tidyverse</h1>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/tidyverse/tidyverse.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
<p>The fundamental object type of the tidyverse is the data frame (which, once you get a little deeper into the tidyverse ecosystem, becomes a “tibble” - more on that later in part 2). Thus the starting point for getting comfortable with the tidyverse is to <em>always store your data as a <strong>data frame</strong></em> (rather than as a matrix or as vectors) with informative string-based column names where words are preferably separated by underscores (rather than periods).</p>
<p>The tidyverse is not simply a set of functions that replace base R functions. The tidyverse represents a way of <em>thinking</em> about how you conduct your data analysis:</p>
<ul>
<li><p>Think of your data frame as the universe, and the columns of your data frame as the objects in your universe that you can explore, manipulate and model.</p></li>
<li><p>When coding in <em>base R</em>, it is very common to define many intermediate objects and modified versions of the same data frame (or data object). When coding in the <em>tidyverse</em>, the key is to <strong>minimize defining new data objects</strong>. Instead, focus on manipulating your current data frame and just printing the output of your manipulations (e.g.&nbsp;a summary or plot). Only create new data objects in your R environment if you will be using both the <em>original</em> data object and the <em>new</em> data object in your later analyses.</p></li>
</ul>
<p>To load the tidyverse packages, you could install them all individually (once):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># only ever run once to install the individual packages on your system</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dplyr"</span>)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggplot2"</span>)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purrr"</span>)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyr"</span>)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"readr"</span>)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tibble"</span>)</span></code></pre></div>
</div>
<p>and then load them all into your session individually every time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readr)</span>
<span id="cb2-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tibble)</span></code></pre></div>
</div>
<p><em>or</em>, you could just install and load the <code>tidyverse</code> package, which will do all of the above for you:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># only ever run once to install the tidyverse on your system</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
</div>
<p>which is much easier.</p>
<p>Throughout this tutorial, we will use the gapminder dataset that can be loaded directly if you’re connected to the internet.</p>
<p>My general workflow involves loading the original data and saving it as an object with a meaningful name and an <code>_orig</code> suffix. I then define a copy of the original dataset without the <code>_orig</code> suffix. Having an original copy of my data in my environment means that it is easy to check that my manipulations do what I expected. I will make direct data cleaning modifications to the <code>gapminder</code> data frame, but will never edit the <code>gapminder_orig</code> data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to download the data directly:</span></span>
<span id="cb5-2">gapminder_orig <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/gh-pages/_episodes_rmd/data/gapminder-FiveYearData.csv"</span>)</span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define a copy of the original dataset that we will clean and play with </span></span>
<span id="cb5-4">gapminder <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder_orig</span></code></pre></div>
</div>
<p>The gapminder dataset has 1704 rows containing information on population, life expectancy and GDP per capita by year and country.</p>
<p>A “tidy” data frame is one where every row is a single observational unit (in this case, indexed by country and year), and every column corresponds to a variable that is measured for each observational unit (in this case, for each country and year, a measurement is made for population, continent, life expectancy and GDP). If you’d like to learn more about “tidy data”, I highly recommend reading <a href="vita.had.co.nz/papers/tidy-data.pdf">Hadley Wickham’s tidy data article</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dim</span>(gapminder)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1704    6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(gapminder)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      country year      pop continent lifeExp gdpPercap
1 Afghanistan 1952  8425333      Asia  28.801  779.4453
2 Afghanistan 1957  9240934      Asia  30.332  820.8530
3 Afghanistan 1962 10267083      Asia  31.997  853.1007
4 Afghanistan 1967 11537966      Asia  34.020  836.1971
5 Afghanistan 1972 13079460      Asia  36.088  739.9811
6 Afghanistan 1977 14880372      Asia  38.438  786.1134</code></pre>
</div>
</div>
<p>Now that you’ve loaded the tidyverse and the gapminder data, you’re are ready to learn about our first tidy analysis tool: the pipe.</p>
</section>
<section id="piping" class="level1">
<h1>Piping: %&gt;%</h1>
<p align="center">
<img src="https://www.rebeccabarter.com/blog/img/tidyverse/pipe.png" alt="Pipe" width="180" height="200">
</p>
<p>Pipes are the workhorse of tidy analyses. Piping allows you to chain together many functions, eliminating the need to define multiple intermediate objects to use as the input to subsequent functions. In my eyes, pipes are also the primary reason that tidyverse code is fundamentally easier to read than base R code.</p>
<p>I always read the pipe symbol, <code>%&gt;%</code>, in my head as <em>“and then”</em>. Consider the following code. Try to figure out what the following code will produce (even if you’ve never seen the <code>filter</code> and <code>select</code> dplyr functions before - I’ll formally introduce these later).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(continent <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Americas"</span>, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2007"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(country, lifeExp)</span></code></pre></div>
</div>
<p>I read this code in my head as: <em>take the gapminder dataset <strong>and then</strong> filter to the “Americas” continents and the year 2007, <strong>and then</strong> select the country and life expectancy variables.</em></p>
<p>Running this code first filters the data frame only to the rows whose <code>continent</code> value is “Americas” and whose <code>year</code> value is “2007”, and then it shows you the <code>country</code> and <code>lifeExp</code> columns for those rows. Run it yourself to see.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># take the gapminder dataset</span></span>
<span id="cb11-2">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and filter to the rows whose continent is Americas and year is 2007</span></span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(continent <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Americas"</span>, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># show the country and lifeExp values for these rows</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(country, lifeExp)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               country lifeExp
1            Argentina  75.320
2              Bolivia  65.554
3               Brazil  72.390
4               Canada  80.653
5                Chile  78.553
6             Colombia  72.889
7           Costa Rica  78.782
8                 Cuba  78.273
9   Dominican Republic  72.235
10             Ecuador  74.994
11         El Salvador  71.878
12           Guatemala  70.259
13               Haiti  60.916
14            Honduras  70.198
15             Jamaica  72.567
16              Mexico  76.195
17           Nicaragua  72.899
18              Panama  75.537
19            Paraguay  71.752
20                Peru  71.421
21         Puerto Rico  78.746
22 Trinidad and Tobago  69.819
23       United States  78.242
24             Uruguay  76.384
25           Venezuela  73.747</code></pre>
</div>
</div>
<p>To become a piping expert you’ll need to have a firm grasp on what it’s actually doing. The pipe uses the object on the left-hand-side of the <code>%&gt;%</code> as the <em>first argument</em> of the function on the right-hand-side.</p>
<p>For instance, the un-piped version of</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(continent <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Americas"</span>, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>)</span></code></pre></div>
</div>
<p>is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(gapminder, continent <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Americas"</span>, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>)</span></code></pre></div>
</div>
<p>If you were determined not to use piping, but you wanted to do many manipulations, your code would very quickly get messy and difficult to read. In the style of base R, the common way of making code more readable is to define intermediate objects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">gapminder_filtered <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(gapminder, continent <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Americas"</span>, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>)</span>
<span id="cb15-2">gapminder_filtered_selected <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(gapminder_filtered, country, lifeExp)</span>
<span id="cb15-3">gapminder_filtered_selected</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               country lifeExp
1            Argentina  75.320
2              Bolivia  65.554
3               Brazil  72.390
4               Canada  80.653
5                Chile  78.553
6             Colombia  72.889
7           Costa Rica  78.782
8                 Cuba  78.273
9   Dominican Republic  72.235
10             Ecuador  74.994
11         El Salvador  71.878
12           Guatemala  70.259
13               Haiti  60.916
14            Honduras  70.198
15             Jamaica  72.567
16              Mexico  76.195
17           Nicaragua  72.899
18              Panama  75.537
19            Paraguay  71.752
20                Peru  71.421
21         Puerto Rico  78.746
22 Trinidad and Tobago  69.819
23       United States  78.242
24             Uruguay  76.384
25           Venezuela  73.747</code></pre>
</div>
</div>
<p>To me, the piped version is infinitely more clear, and simultaneously got rid of the need to define any intermediate objects that I would have needed to keep track of while reading the code. Once I got more and more comfortable with piping, I started to find that pretty much <em>all</em> of my code uses pipes.</p>
</section>
<section id="data-manipulation-dplyr" class="level1">
<h1>Data manipulation: dplyr</h1>
<p align="center">
<img src="https://www.rebeccabarter.com/blog/img/tidyverse/dplyr.png" alt="dplyr" width="180" height="200">
</p>
<p>The <code>filter()</code> and <code>select()</code> functions that I just introduced are examples of data manipulation functions from the dplyr package.</p>
<p>In the tidyverse, you will almost never use the <code>[,]</code> indexing nor the <code>$</code> data frame column indexing that are pervasive throughout base R code. Indexing in dplyr is done using <code>filter()</code> for rows and <code>select()</code> for columns.</p>
<p>You may have noticed that the variable names <code>continent</code>, <code>year</code>, <code>country</code>, <code>lifeExp</code> that were used inside the <code>filter()</code> and <code>select()</code> functions were <strong>unquoted</strong>. One of the key components of the tidyverse is thinking of your universe as the data frame, and the <em>columns</em> of the data frame as variables or objects that you can play with. Just like how you don’t need to quote variable names in your environment to play with them, you usually don’t need to quote data frame variables (columns) inside tidyverse functions.</p>
<p>Let’s contrast our piped dplyr code</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># take the gapminder dataset</span></span>
<span id="cb17-2">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and filter to the rows whose continent is Americas and year is 2007</span></span>
<span id="cb17-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(continent <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Americas"</span>, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># show the country and lifeExp values for these rows</span></span>
<span id="cb17-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(country, lifeExp)</span></code></pre></div>
</div>
<p>with one potential version of equivalent base R code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># identify which rows correspond to the Americas and the year 2007</span></span>
<span id="cb18-2">continent_year_index <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(gapminder[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"continent"</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Americas"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> gapminder[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>)</span>
<span id="cb18-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pull only those rows and show the country and life expectency columns</span></span>
<span id="cb18-4">gapminder[continent_year_index, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"country"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lifeExp"</span>)]</span></code></pre></div>
</div>
<p>There are a few key differences</p>
<ul>
<li><p>The variable names are quoted in the base R version but not in the dplyr version</p></li>
<li><p>An intermediate row index variable was defined in the base R version but not in the dplyr version</p></li>
</ul>
<p>The primary dplyr functions are</p>
<section id="select-select-columns" class="level2">
<h2 class="anchored" data-anchor-id="select-select-columns"><code>select</code>: select columns</h2>
<p>The arguments of the select function specify which data frame variables should be kept. <code>select()</code> is like indexing columns by name. You do not need to quote the column names (but you can if you want to).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(country, gdpPercap) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      country   gdpPercap
1                 Afghanistan    779.4453
2                 Afghanistan    820.8530
3                 Afghanistan    853.1007
4                 Afghanistan    836.1971
5                 Afghanistan    739.9811
6                 Afghanistan    786.1134
7                 Afghanistan    978.0114
8                 Afghanistan    852.3959
9                 Afghanistan    649.3414
10                Afghanistan    635.3414
11                Afghanistan    726.7341
12                Afghanistan    974.5803
13                    Albania   1601.0561
14                    Albania   1942.2842
15                    Albania   2312.8890
16                    Albania   2760.1969
17                    Albania   3313.4222
18                    Albania   3533.0039
19                    Albania   3630.8807
20                    Albania   3738.9327
21                    Albania   2497.4379
22                    Albania   3193.0546
23                    Albania   4604.2117
24                    Albania   5937.0295
25                    Algeria   2449.0082
26                    Algeria   3013.9760
27                    Algeria   2550.8169
28                    Algeria   3246.9918
29                    Algeria   4182.6638
30                    Algeria   4910.4168
31                    Algeria   5745.1602
32                    Algeria   5681.3585
33                    Algeria   5023.2166
34                    Algeria   4797.2951
35                    Algeria   5288.0404
36                    Algeria   6223.3675
37                     Angola   3520.6103
38                     Angola   3827.9405
39                     Angola   4269.2767
40                     Angola   5522.7764
41                     Angola   5473.2880
42                     Angola   3008.6474
43                     Angola   2756.9537
44                     Angola   2430.2083
45                     Angola   2627.8457
46                     Angola   2277.1409
47                     Angola   2773.2873
48                     Angola   4797.2313
49                  Argentina   5911.3151
50                  Argentina   6856.8562
51                  Argentina   7133.1660
52                  Argentina   8052.9530
53                  Argentina   9443.0385
54                  Argentina  10079.0267
55                  Argentina   8997.8974
56                  Argentina   9139.6714
57                  Argentina   9308.4187
58                  Argentina  10967.2820
59                  Argentina   8797.6407
60                  Argentina  12779.3796
61                  Australia  10039.5956
62                  Australia  10949.6496
63                  Australia  12217.2269
64                  Australia  14526.1246
65                  Australia  16788.6295
66                  Australia  18334.1975
67                  Australia  19477.0093
68                  Australia  21888.8890
69                  Australia  23424.7668
70                  Australia  26997.9366
71                  Australia  30687.7547
72                  Australia  34435.3674
73                    Austria   6137.0765
74                    Austria   8842.5980
75                    Austria  10750.7211
76                    Austria  12834.6024
77                    Austria  16661.6256
78                    Austria  19749.4223
79                    Austria  21597.0836
80                    Austria  23687.8261
81                    Austria  27042.0187
82                    Austria  29095.9207
83                    Austria  32417.6077
84                    Austria  36126.4927
85                    Bahrain   9867.0848
86                    Bahrain  11635.7995
87                    Bahrain  12753.2751
88                    Bahrain  14804.6727
89                    Bahrain  18268.6584
90                    Bahrain  19340.1020
91                    Bahrain  19211.1473
92                    Bahrain  18524.0241
93                    Bahrain  19035.5792
94                    Bahrain  20292.0168
95                    Bahrain  23403.5593
96                    Bahrain  29796.0483
97                 Bangladesh    684.2442
98                 Bangladesh    661.6375
99                 Bangladesh    686.3416
100                Bangladesh    721.1861
101                Bangladesh    630.2336
102                Bangladesh    659.8772
103                Bangladesh    676.9819
104                Bangladesh    751.9794
105                Bangladesh    837.8102
106                Bangladesh    972.7700
107                Bangladesh   1136.3904
108                Bangladesh   1391.2538
109                   Belgium   8343.1051
110                   Belgium   9714.9606
111                   Belgium  10991.2068
112                   Belgium  13149.0412
113                   Belgium  16672.1436
114                   Belgium  19117.9745
115                   Belgium  20979.8459
116                   Belgium  22525.5631
117                   Belgium  25575.5707
118                   Belgium  27561.1966
119                   Belgium  30485.8838
120                   Belgium  33692.6051
121                     Benin   1062.7522
122                     Benin    959.6011
123                     Benin    949.4991
124                     Benin   1035.8314
125                     Benin   1085.7969
126                     Benin   1029.1613
127                     Benin   1277.8976
128                     Benin   1225.8560
129                     Benin   1191.2077
130                     Benin   1232.9753
131                     Benin   1372.8779
132                     Benin   1441.2849
133                   Bolivia   2677.3263
134                   Bolivia   2127.6863
135                   Bolivia   2180.9725
136                   Bolivia   2586.8861
137                   Bolivia   2980.3313
138                   Bolivia   3548.0978
139                   Bolivia   3156.5105
140                   Bolivia   2753.6915
141                   Bolivia   2961.6997
142                   Bolivia   3326.1432
143                   Bolivia   3413.2627
144                   Bolivia   3822.1371
145    Bosnia and Herzegovina    973.5332
146    Bosnia and Herzegovina   1353.9892
147    Bosnia and Herzegovina   1709.6837
148    Bosnia and Herzegovina   2172.3524
149    Bosnia and Herzegovina   2860.1698
150    Bosnia and Herzegovina   3528.4813
151    Bosnia and Herzegovina   4126.6132
152    Bosnia and Herzegovina   4314.1148
153    Bosnia and Herzegovina   2546.7814
154    Bosnia and Herzegovina   4766.3559
155    Bosnia and Herzegovina   6018.9752
156    Bosnia and Herzegovina   7446.2988
157                  Botswana    851.2411
158                  Botswana    918.2325
159                  Botswana    983.6540
160                  Botswana   1214.7093
161                  Botswana   2263.6111
162                  Botswana   3214.8578
163                  Botswana   4551.1421
164                  Botswana   6205.8839
165                  Botswana   7954.1116
166                  Botswana   8647.1423
167                  Botswana  11003.6051
168                  Botswana  12569.8518
169                    Brazil   2108.9444
170                    Brazil   2487.3660
171                    Brazil   3336.5858
172                    Brazil   3429.8644
173                    Brazil   4985.7115
174                    Brazil   6660.1187
175                    Brazil   7030.8359
176                    Brazil   7807.0958
177                    Brazil   6950.2830
178                    Brazil   7957.9808
179                    Brazil   8131.2128
180                    Brazil   9065.8008
181                  Bulgaria   2444.2866
182                  Bulgaria   3008.6707
183                  Bulgaria   4254.3378
184                  Bulgaria   5577.0028
185                  Bulgaria   6597.4944
186                  Bulgaria   7612.2404
187                  Bulgaria   8224.1916
188                  Bulgaria   8239.8548
189                  Bulgaria   6302.6234
190                  Bulgaria   5970.3888
191                  Bulgaria   7696.7777
192                  Bulgaria  10680.7928
193              Burkina Faso    543.2552
194              Burkina Faso    617.1835
195              Burkina Faso    722.5120
196              Burkina Faso    794.8266
197              Burkina Faso    854.7360
198              Burkina Faso    743.3870
199              Burkina Faso    807.1986
200              Burkina Faso    912.0631
201              Burkina Faso    931.7528
202              Burkina Faso    946.2950
203              Burkina Faso   1037.6452
204              Burkina Faso   1217.0330
205                   Burundi    339.2965
206                   Burundi    379.5646
207                   Burundi    355.2032
208                   Burundi    412.9775
209                   Burundi    464.0995
210                   Burundi    556.1033
211                   Burundi    559.6032
212                   Burundi    621.8188
213                   Burundi    631.6999
214                   Burundi    463.1151
215                   Burundi    446.4035
216                   Burundi    430.0707
217                  Cambodia    368.4693
218                  Cambodia    434.0383
219                  Cambodia    496.9136
220                  Cambodia    523.4323
221                  Cambodia    421.6240
222                  Cambodia    524.9722
223                  Cambodia    624.4755
224                  Cambodia    683.8956
225                  Cambodia    682.3032
226                  Cambodia    734.2852
227                  Cambodia    896.2260
228                  Cambodia   1713.7787
229                  Cameroon   1172.6677
230                  Cameroon   1313.0481
231                  Cameroon   1399.6074
232                  Cameroon   1508.4531
233                  Cameroon   1684.1465
234                  Cameroon   1783.4329
235                  Cameroon   2367.9833
236                  Cameroon   2602.6642
237                  Cameroon   1793.1633
238                  Cameroon   1694.3375
239                  Cameroon   1934.0114
240                  Cameroon   2042.0952
241                    Canada  11367.1611
242                    Canada  12489.9501
243                    Canada  13462.4855
244                    Canada  16076.5880
245                    Canada  18970.5709
246                    Canada  22090.8831
247                    Canada  22898.7921
248                    Canada  26626.5150
249                    Canada  26342.8843
250                    Canada  28954.9259
251                    Canada  33328.9651
252                    Canada  36319.2350
253  Central African Republic   1071.3107
254  Central African Republic   1190.8443
255  Central African Republic   1193.0688
256  Central African Republic   1136.0566
257  Central African Republic   1070.0133
258  Central African Republic   1109.3743
259  Central African Republic    956.7530
260  Central African Republic    844.8764
261  Central African Republic    747.9055
262  Central African Republic    740.5063
263  Central African Republic    738.6906
264  Central African Republic    706.0165
265                      Chad   1178.6659
266                      Chad   1308.4956
267                      Chad   1389.8176
268                      Chad   1196.8106
269                      Chad   1104.1040
270                      Chad   1133.9850
271                      Chad    797.9081
272                      Chad    952.3861
273                      Chad   1058.0643
274                      Chad   1004.9614
275                      Chad   1156.1819
276                      Chad   1704.0637
277                     Chile   3939.9788
278                     Chile   4315.6227
279                     Chile   4519.0943
280                     Chile   5106.6543
281                     Chile   5494.0244
282                     Chile   4756.7638
283                     Chile   5095.6657
284                     Chile   5547.0638
285                     Chile   7596.1260
286                     Chile  10118.0532
287                     Chile  10778.7838
288                     Chile  13171.6388
289                     China    400.4486
290                     China    575.9870
291                     China    487.6740
292                     China    612.7057
293                     China    676.9001
294                     China    741.2375
295                     China    962.4214
296                     China   1378.9040
297                     China   1655.7842
298                     China   2289.2341
299                     China   3119.2809
300                     China   4959.1149
301                  Colombia   2144.1151
302                  Colombia   2323.8056
303                  Colombia   2492.3511
304                  Colombia   2678.7298
305                  Colombia   3264.6600
306                  Colombia   3815.8079
307                  Colombia   4397.5757
308                  Colombia   4903.2191
309                  Colombia   5444.6486
310                  Colombia   6117.3617
311                  Colombia   5755.2600
312                  Colombia   7006.5804
313                   Comoros   1102.9909
314                   Comoros   1211.1485
315                   Comoros   1406.6483
316                   Comoros   1876.0296
317                   Comoros   1937.5777
318                   Comoros   1172.6030
319                   Comoros   1267.1001
320                   Comoros   1315.9808
321                   Comoros   1246.9074
322                   Comoros   1173.6182
323                   Comoros   1075.8116
324                   Comoros    986.1479
325           Congo Dem. Rep.    780.5423
326           Congo Dem. Rep.    905.8602
327           Congo Dem. Rep.    896.3146
328           Congo Dem. Rep.    861.5932
329           Congo Dem. Rep.    904.8961
330           Congo Dem. Rep.    795.7573
331           Congo Dem. Rep.    673.7478
332           Congo Dem. Rep.    672.7748
333           Congo Dem. Rep.    457.7192
334           Congo Dem. Rep.    312.1884
335           Congo Dem. Rep.    241.1659
336           Congo Dem. Rep.    277.5519
337                Congo Rep.   2125.6214
338                Congo Rep.   2315.0566
339                Congo Rep.   2464.7832
340                Congo Rep.   2677.9396
341                Congo Rep.   3213.1527
342                Congo Rep.   3259.1790
343                Congo Rep.   4879.5075
344                Congo Rep.   4201.1949
345                Congo Rep.   4016.2395
346                Congo Rep.   3484.1644
347                Congo Rep.   3484.0620
348                Congo Rep.   3632.5578
349                Costa Rica   2627.0095
350                Costa Rica   2990.0108
351                Costa Rica   3460.9370
352                Costa Rica   4161.7278
353                Costa Rica   5118.1469
354                Costa Rica   5926.8770
355                Costa Rica   5262.7348
356                Costa Rica   5629.9153
357                Costa Rica   6160.4163
358                Costa Rica   6677.0453
359                Costa Rica   7723.4472
360                Costa Rica   9645.0614
361             Cote d'Ivoire   1388.5947
362             Cote d'Ivoire   1500.8959
363             Cote d'Ivoire   1728.8694
364             Cote d'Ivoire   2052.0505
365             Cote d'Ivoire   2378.2011
366             Cote d'Ivoire   2517.7365
367             Cote d'Ivoire   2602.7102
368             Cote d'Ivoire   2156.9561
369             Cote d'Ivoire   1648.0738
370             Cote d'Ivoire   1786.2654
371             Cote d'Ivoire   1648.8008
372             Cote d'Ivoire   1544.7501
373                   Croatia   3119.2365
374                   Croatia   4338.2316
375                   Croatia   5477.8900
376                   Croatia   6960.2979
377                   Croatia   9164.0901
378                   Croatia  11305.3852
379                   Croatia  13221.8218
380                   Croatia  13822.5839
381                   Croatia   8447.7949
382                   Croatia   9875.6045
383                   Croatia  11628.3890
384                   Croatia  14619.2227
385                      Cuba   5586.5388
386                      Cuba   6092.1744
387                      Cuba   5180.7559
388                      Cuba   5690.2680
389                      Cuba   5305.4453
390                      Cuba   6380.4950
391                      Cuba   7316.9181
392                      Cuba   7532.9248
393                      Cuba   5592.8440
394                      Cuba   5431.9904
395                      Cuba   6340.6467
396                      Cuba   8948.1029
397            Czech Republic   6876.1403
398            Czech Republic   8256.3439
399            Czech Republic  10136.8671
400            Czech Republic  11399.4449
401            Czech Republic  13108.4536
402            Czech Republic  14800.1606
403            Czech Republic  15377.2285
404            Czech Republic  16310.4434
405            Czech Republic  14297.0212
406            Czech Republic  16048.5142
407            Czech Republic  17596.2102
408            Czech Republic  22833.3085
409                   Denmark   9692.3852
410                   Denmark  11099.6593
411                   Denmark  13583.3135
412                   Denmark  15937.2112
413                   Denmark  18866.2072
414                   Denmark  20422.9015
415                   Denmark  21688.0405
416                   Denmark  25116.1758
417                   Denmark  26406.7399
418                   Denmark  29804.3457
419                   Denmark  32166.5001
420                   Denmark  35278.4187
421                  Djibouti   2669.5295
422                  Djibouti   2864.9691
423                  Djibouti   3020.9893
424                  Djibouti   3020.0505
425                  Djibouti   3694.2124
426                  Djibouti   3081.7610
427                  Djibouti   2879.4681
428                  Djibouti   2880.1026
429                  Djibouti   2377.1562
430                  Djibouti   1895.0170
431                  Djibouti   1908.2609
432                  Djibouti   2082.4816
433        Dominican Republic   1397.7171
434        Dominican Republic   1544.4030
435        Dominican Republic   1662.1374
436        Dominican Republic   1653.7230
437        Dominican Republic   2189.8745
438        Dominican Republic   2681.9889
439        Dominican Republic   2861.0924
440        Dominican Republic   2899.8422
441        Dominican Republic   3044.2142
442        Dominican Republic   3614.1013
443        Dominican Republic   4563.8082
444        Dominican Republic   6025.3748
445                   Ecuador   3522.1107
446                   Ecuador   3780.5467
447                   Ecuador   4086.1141
448                   Ecuador   4579.0742
449                   Ecuador   5280.9947
450                   Ecuador   6679.6233
451                   Ecuador   7213.7913
452                   Ecuador   6481.7770
453                   Ecuador   7103.7026
454                   Ecuador   7429.4559
455                   Ecuador   5773.0445
456                   Ecuador   6873.2623
457                     Egypt   1418.8224
458                     Egypt   1458.9153
459                     Egypt   1693.3359
460                     Egypt   1814.8807
461                     Egypt   2024.0081
462                     Egypt   2785.4936
463                     Egypt   3503.7296
464                     Egypt   3885.4607
465                     Egypt   3794.7552
466                     Egypt   4173.1818
467                     Egypt   4754.6044
468                     Egypt   5581.1810
469               El Salvador   3048.3029
470               El Salvador   3421.5232
471               El Salvador   3776.8036
472               El Salvador   4358.5954
473               El Salvador   4520.2460
474               El Salvador   5138.9224
475               El Salvador   4098.3442
476               El Salvador   4140.4421
477               El Salvador   4444.2317
478               El Salvador   5154.8255
479               El Salvador   5351.5687
480               El Salvador   5728.3535
481         Equatorial Guinea    375.6431
482         Equatorial Guinea    426.0964
483         Equatorial Guinea    582.8420
484         Equatorial Guinea    915.5960
485         Equatorial Guinea    672.4123
486         Equatorial Guinea    958.5668
487         Equatorial Guinea    927.8253
488         Equatorial Guinea    966.8968
489         Equatorial Guinea   1132.0550
490         Equatorial Guinea   2814.4808
491         Equatorial Guinea   7703.4959
492         Equatorial Guinea  12154.0897
493                   Eritrea    328.9406
494                   Eritrea    344.1619
495                   Eritrea    380.9958
496                   Eritrea    468.7950
497                   Eritrea    514.3242
498                   Eritrea    505.7538
499                   Eritrea    524.8758
500                   Eritrea    521.1341
501                   Eritrea    582.8585
502                   Eritrea    913.4708
503                   Eritrea    765.3500
504                   Eritrea    641.3695
505                  Ethiopia    362.1463
506                  Ethiopia    378.9042
507                  Ethiopia    419.4564
508                  Ethiopia    516.1186
509                  Ethiopia    566.2439
510                  Ethiopia    556.8084
511                  Ethiopia    577.8607
512                  Ethiopia    573.7413
513                  Ethiopia    421.3535
514                  Ethiopia    515.8894
515                  Ethiopia    530.0535
516                  Ethiopia    690.8056
517                   Finland   6424.5191
518                   Finland   7545.4154
519                   Finland   9371.8426
520                   Finland  10921.6363
521                   Finland  14358.8759
522                   Finland  15605.4228
523                   Finland  18533.1576
524                   Finland  21141.0122
525                   Finland  20647.1650
526                   Finland  23723.9502
527                   Finland  28204.5906
528                   Finland  33207.0844
529                    France   7029.8093
530                    France   8662.8349
531                    France  10560.4855
532                    France  12999.9177
533                    France  16107.1917
534                    France  18292.6351
535                    France  20293.8975
536                    France  22066.4421
537                    France  24703.7961
538                    France  25889.7849
539                    France  28926.0323
540                    France  30470.0167
541                     Gabon   4293.4765
542                     Gabon   4976.1981
543                     Gabon   6631.4592
544                     Gabon   8358.7620
545                     Gabon  11401.9484
546                     Gabon  21745.5733
547                     Gabon  15113.3619
548                     Gabon  11864.4084
549                     Gabon  13522.1575
550                     Gabon  14722.8419
551                     Gabon  12521.7139
552                     Gabon  13206.4845
553                    Gambia    485.2307
554                    Gambia    520.9267
555                    Gambia    599.6503
556                    Gambia    734.7829
557                    Gambia    756.0868
558                    Gambia    884.7553
559                    Gambia    835.8096
560                    Gambia    611.6589
561                    Gambia    665.6244
562                    Gambia    653.7302
563                    Gambia    660.5856
564                    Gambia    752.7497
565                   Germany   7144.1144
566                   Germany  10187.8267
567                   Germany  12902.4629
568                   Germany  14745.6256
569                   Germany  18016.1803
570                   Germany  20512.9212
571                   Germany  22031.5327
572                   Germany  24639.1857
573                   Germany  26505.3032
574                   Germany  27788.8842
575                   Germany  30035.8020
576                   Germany  32170.3744
577                     Ghana    911.2989
578                     Ghana   1043.5615
579                     Ghana   1190.0411
580                     Ghana   1125.6972
581                     Ghana   1178.2237
582                     Ghana    993.2240
583                     Ghana    876.0326
584                     Ghana    847.0061
585                     Ghana    925.0602
586                     Ghana   1005.2458
587                     Ghana   1111.9846
588                     Ghana   1327.6089
589                    Greece   3530.6901
590                    Greece   4916.2999
591                    Greece   6017.1907
592                    Greece   8513.0970
593                    Greece  12724.8296
594                    Greece  14195.5243
595                    Greece  15268.4209
596                    Greece  16120.5284
597                    Greece  17541.4963
598                    Greece  18747.6981
599                    Greece  22514.2548
600                    Greece  27538.4119
601                 Guatemala   2428.2378
602                 Guatemala   2617.1560
603                 Guatemala   2750.3644
604                 Guatemala   3242.5311
605                 Guatemala   4031.4083
606                 Guatemala   4879.9927
607                 Guatemala   4820.4948
608                 Guatemala   4246.4860
609                 Guatemala   4439.4508
610                 Guatemala   4684.3138
611                 Guatemala   4858.3475
612                 Guatemala   5186.0500
613                    Guinea    510.1965
614                    Guinea    576.2670
615                    Guinea    686.3737
616                    Guinea    708.7595
617                    Guinea    741.6662
618                    Guinea    874.6859
619                    Guinea    857.2504
620                    Guinea    805.5725
621                    Guinea    794.3484
622                    Guinea    869.4498
623                    Guinea    945.5836
624                    Guinea    942.6542
625             Guinea-Bissau    299.8503
626             Guinea-Bissau    431.7905
627             Guinea-Bissau    522.0344
628             Guinea-Bissau    715.5806
629             Guinea-Bissau    820.2246
630             Guinea-Bissau    764.7260
631             Guinea-Bissau    838.1240
632             Guinea-Bissau    736.4154
633             Guinea-Bissau    745.5399
634             Guinea-Bissau    796.6645
635             Guinea-Bissau    575.7047
636             Guinea-Bissau    579.2317
637                     Haiti   1840.3669
638                     Haiti   1726.8879
639                     Haiti   1796.5890
640                     Haiti   1452.0577
641                     Haiti   1654.4569
642                     Haiti   1874.2989
643                     Haiti   2011.1595
644                     Haiti   1823.0160
645                     Haiti   1456.3095
646                     Haiti   1341.7269
647                     Haiti   1270.3649
648                     Haiti   1201.6372
649                  Honduras   2194.9262
650                  Honduras   2220.4877
651                  Honduras   2291.1568
652                  Honduras   2538.2694
653                  Honduras   2529.8423
654                  Honduras   3203.2081
655                  Honduras   3121.7608
656                  Honduras   3023.0967
657                  Honduras   3081.6946
658                  Honduras   3160.4549
659                  Honduras   3099.7287
660                  Honduras   3548.3308
661           Hong Kong China   3054.4212
662           Hong Kong China   3629.0765
663           Hong Kong China   4692.6483
664           Hong Kong China   6197.9628
665           Hong Kong China   8315.9281
666           Hong Kong China  11186.1413
667           Hong Kong China  14560.5305
668           Hong Kong China  20038.4727
669           Hong Kong China  24757.6030
670           Hong Kong China  28377.6322
671           Hong Kong China  30209.0152
672           Hong Kong China  39724.9787
673                   Hungary   5263.6738
674                   Hungary   6040.1800
675                   Hungary   7550.3599
676                   Hungary   9326.6447
677                   Hungary  10168.6561
678                   Hungary  11674.8374
679                   Hungary  12545.9907
680                   Hungary  12986.4800
681                   Hungary  10535.6285
682                   Hungary  11712.7768
683                   Hungary  14843.9356
684                   Hungary  18008.9444
685                   Iceland   7267.6884
686                   Iceland   9244.0014
687                   Iceland  10350.1591
688                   Iceland  13319.8957
689                   Iceland  15798.0636
690                   Iceland  19654.9625
691                   Iceland  23269.6075
692                   Iceland  26923.2063
693                   Iceland  25144.3920
694                   Iceland  28061.0997
695                   Iceland  31163.2020
696                   Iceland  36180.7892
697                     India    546.5657
698                     India    590.0620
699                     India    658.3472
700                     India    700.7706
701                     India    724.0325
702                     India    813.3373
703                     India    855.7235
704                     India    976.5127
705                     India   1164.4068
706                     India   1458.8174
707                     India   1746.7695
708                     India   2452.2104
709                 Indonesia    749.6817
710                 Indonesia    858.9003
711                 Indonesia    849.2898
712                 Indonesia    762.4318
713                 Indonesia   1111.1079
714                 Indonesia   1382.7021
715                 Indonesia   1516.8730
716                 Indonesia   1748.3570
717                 Indonesia   2383.1409
718                 Indonesia   3119.3356
719                 Indonesia   2873.9129
720                 Indonesia   3540.6516
721                      Iran   3035.3260
722                      Iran   3290.2576
723                      Iran   4187.3298
724                      Iran   5906.7318
725                      Iran   9613.8186
726                      Iran  11888.5951
727                      Iran   7608.3346
728                      Iran   6642.8814
729                      Iran   7235.6532
730                      Iran   8263.5903
731                      Iran   9240.7620
732                      Iran  11605.7145
733                      Iraq   4129.7661
734                      Iraq   6229.3336
735                      Iraq   8341.7378
736                      Iraq   8931.4598
737                      Iraq   9576.0376
738                      Iraq  14688.2351
739                      Iraq  14517.9071
740                      Iraq  11643.5727
741                      Iraq   3745.6407
742                      Iraq   3076.2398
743                      Iraq   4390.7173
744                      Iraq   4471.0619
745                   Ireland   5210.2803
746                   Ireland   5599.0779
747                   Ireland   6631.5973
748                   Ireland   7655.5690
749                   Ireland   9530.7729
750                   Ireland  11150.9811
751                   Ireland  12618.3214
752                   Ireland  13872.8665
753                   Ireland  17558.8155
754                   Ireland  24521.9471
755                   Ireland  34077.0494
756                   Ireland  40675.9964
757                    Israel   4086.5221
758                    Israel   5385.2785
759                    Israel   7105.6307
760                    Israel   8393.7414
761                    Israel  12786.9322
762                    Israel  13306.6192
763                    Israel  15367.0292
764                    Israel  17122.4799
765                    Israel  18051.5225
766                    Israel  20896.6092
767                    Israel  21905.5951
768                    Israel  25523.2771
769                     Italy   4931.4042
770                     Italy   6248.6562
771                     Italy   8243.5823
772                     Italy  10022.4013
773                     Italy  12269.2738
774                     Italy  14255.9847
775                     Italy  16537.4835
776                     Italy  19207.2348
777                     Italy  22013.6449
778                     Italy  24675.0245
779                     Italy  27968.0982
780                     Italy  28569.7197
781                   Jamaica   2898.5309
782                   Jamaica   4756.5258
783                   Jamaica   5246.1075
784                   Jamaica   6124.7035
785                   Jamaica   7433.8893
786                   Jamaica   6650.1956
787                   Jamaica   6068.0513
788                   Jamaica   6351.2375
789                   Jamaica   7404.9237
790                   Jamaica   7121.9247
791                   Jamaica   6994.7749
792                   Jamaica   7320.8803
793                     Japan   3216.9563
794                     Japan   4317.6944
795                     Japan   6576.6495
796                     Japan   9847.7886
797                     Japan  14778.7864
798                     Japan  16610.3770
799                     Japan  19384.1057
800                     Japan  22375.9419
801                     Japan  26824.8951
802                     Japan  28816.5850
803                     Japan  28604.5919
804                     Japan  31656.0681
805                    Jordan   1546.9078
806                    Jordan   1886.0806
807                    Jordan   2348.0092
808                    Jordan   2741.7963
809                    Jordan   2110.8563
810                    Jordan   2852.3516
811                    Jordan   4161.4160
812                    Jordan   4448.6799
813                    Jordan   3431.5936
814                    Jordan   3645.3796
815                    Jordan   3844.9172
816                    Jordan   4519.4612
817                     Kenya    853.5409
818                     Kenya    944.4383
819                     Kenya    896.9664
820                     Kenya   1056.7365
821                     Kenya   1222.3600
822                     Kenya   1267.6132
823                     Kenya   1348.2258
824                     Kenya   1361.9369
825                     Kenya   1341.9217
826                     Kenya   1360.4850
827                     Kenya   1287.5147
828                     Kenya   1463.2493
829           Korea Dem. Rep.   1088.2778
830           Korea Dem. Rep.   1571.1347
831           Korea Dem. Rep.   1621.6936
832           Korea Dem. Rep.   2143.5406
833           Korea Dem. Rep.   3701.6215
834           Korea Dem. Rep.   4106.3012
835           Korea Dem. Rep.   4106.5253
836           Korea Dem. Rep.   4106.4923
837           Korea Dem. Rep.   3726.0635
838           Korea Dem. Rep.   1690.7568
839           Korea Dem. Rep.   1646.7582
840           Korea Dem. Rep.   1593.0655
841                Korea Rep.   1030.5922
842                Korea Rep.   1487.5935
843                Korea Rep.   1536.3444
844                Korea Rep.   2029.2281
845                Korea Rep.   3030.8767
846                Korea Rep.   4657.2210
847                Korea Rep.   5622.9425
848                Korea Rep.   8533.0888
849                Korea Rep.  12104.2787
850                Korea Rep.  15993.5280
851                Korea Rep.  19233.9882
852                Korea Rep.  23348.1397
853                    Kuwait 108382.3529
854                    Kuwait 113523.1329
855                    Kuwait  95458.1118
856                    Kuwait  80894.8833
857                    Kuwait 109347.8670
858                    Kuwait  59265.4771
859                    Kuwait  31354.0357
860                    Kuwait  28118.4300
861                    Kuwait  34932.9196
862                    Kuwait  40300.6200
863                    Kuwait  35110.1057
864                    Kuwait  47306.9898
865                   Lebanon   4834.8041
866                   Lebanon   6089.7869
867                   Lebanon   5714.5606
868                   Lebanon   6006.9830
869                   Lebanon   7486.3843
870                   Lebanon   8659.6968
871                   Lebanon   7640.5195
872                   Lebanon   5377.0913
873                   Lebanon   6890.8069
874                   Lebanon   8754.9639
875                   Lebanon   9313.9388
876                   Lebanon  10461.0587
877                   Lesotho    298.8462
878                   Lesotho    335.9971
879                   Lesotho    411.8006
880                   Lesotho    498.6390
881                   Lesotho    496.5816
882                   Lesotho    745.3695
883                   Lesotho    797.2631
884                   Lesotho    773.9932
885                   Lesotho    977.4863
886                   Lesotho   1186.1480
887                   Lesotho   1275.1846
888                   Lesotho   1569.3314
889                   Liberia    575.5730
890                   Liberia    620.9700
891                   Liberia    634.1952
892                   Liberia    713.6036
893                   Liberia    803.0055
894                   Liberia    640.3224
895                   Liberia    572.1996
896                   Liberia    506.1139
897                   Liberia    636.6229
898                   Liberia    609.1740
899                   Liberia    531.4824
900                   Liberia    414.5073
901                     Libya   2387.5481
902                     Libya   3448.2844
903                     Libya   6757.0308
904                     Libya  18772.7517
905                     Libya  21011.4972
906                     Libya  21951.2118
907                     Libya  17364.2754
908                     Libya  11770.5898
909                     Libya   9640.1385
910                     Libya   9467.4461
911                     Libya   9534.6775
912                     Libya  12057.4993
913                Madagascar   1443.0117
914                Madagascar   1589.2027
915                Madagascar   1643.3871
916                Madagascar   1634.0473
917                Madagascar   1748.5630
918                Madagascar   1544.2286
919                Madagascar   1302.8787
920                Madagascar   1155.4419
921                Madagascar   1040.6762
922                Madagascar    986.2959
923                Madagascar    894.6371
924                Madagascar   1044.7701
925                    Malawi    369.1651
926                    Malawi    416.3698
927                    Malawi    427.9011
928                    Malawi    495.5148
929                    Malawi    584.6220
930                    Malawi    663.2237
931                    Malawi    632.8039
932                    Malawi    635.5174
933                    Malawi    563.2000
934                    Malawi    692.2758
935                    Malawi    665.4231
936                    Malawi    759.3499
937                  Malaysia   1831.1329
938                  Malaysia   1810.0670
939                  Malaysia   2036.8849
940                  Malaysia   2277.7424
941                  Malaysia   2849.0948
942                  Malaysia   3827.9216
943                  Malaysia   4920.3560
944                  Malaysia   5249.8027
945                  Malaysia   7277.9128
946                  Malaysia  10132.9096
947                  Malaysia  10206.9779
948                  Malaysia  12451.6558
949                      Mali    452.3370
950                      Mali    490.3822
951                      Mali    496.1743
952                      Mali    545.0099
953                      Mali    581.3689
954                      Mali    686.3953
955                      Mali    618.0141
956                      Mali    684.1716
957                      Mali    739.0144
958                      Mali    790.2580
959                      Mali    951.4098
960                      Mali   1042.5816
961                Mauritania    743.1159
962                Mauritania    846.1203
963                Mauritania   1055.8960
964                Mauritania   1421.1452
965                Mauritania   1586.8518
966                Mauritania   1497.4922
967                Mauritania   1481.1502
968                Mauritania   1421.6036
969                Mauritania   1361.3698
970                Mauritania   1483.1361
971                Mauritania   1579.0195
972                Mauritania   1803.1515
973                 Mauritius   1967.9557
974                 Mauritius   2034.0380
975                 Mauritius   2529.0675
976                 Mauritius   2475.3876
977                 Mauritius   2575.4842
978                 Mauritius   3710.9830
979                 Mauritius   3688.0377
980                 Mauritius   4783.5869
981                 Mauritius   6058.2538
982                 Mauritius   7425.7053
983                 Mauritius   9021.8159
984                 Mauritius  10956.9911
985                    Mexico   3478.1255
986                    Mexico   4131.5466
987                    Mexico   4581.6094
988                    Mexico   5754.7339
989                    Mexico   6809.4067
990                    Mexico   7674.9291
991                    Mexico   9611.1475
992                    Mexico   8688.1560
993                    Mexico   9472.3843
994                    Mexico   9767.2975
995                    Mexico  10742.4405
996                    Mexico  11977.5750
997                  Mongolia    786.5669
998                  Mongolia    912.6626
999                  Mongolia   1056.3540
1000                 Mongolia   1226.0411
1001                 Mongolia   1421.7420
1002                 Mongolia   1647.5117
1003                 Mongolia   2000.6031
1004                 Mongolia   2338.0083
1005                 Mongolia   1785.4020
1006                 Mongolia   1902.2521
1007                 Mongolia   2140.7393
1008                 Mongolia   3095.7723
1009               Montenegro   2647.5856
1010               Montenegro   3682.2599
1011               Montenegro   4649.5938
1012               Montenegro   5907.8509
1013               Montenegro   7778.4140
1014               Montenegro   9595.9299
1015               Montenegro  11222.5876
1016               Montenegro  11732.5102
1017               Montenegro   7003.3390
1018               Montenegro   6465.6133
1019               Montenegro   6557.1943
1020               Montenegro   9253.8961
1021                  Morocco   1688.2036
1022                  Morocco   1642.0023
1023                  Morocco   1566.3535
1024                  Morocco   1711.0448
1025                  Morocco   1930.1950
1026                  Morocco   2370.6200
1027                  Morocco   2702.6204
1028                  Morocco   2755.0470
1029                  Morocco   2948.0473
1030                  Morocco   2982.1019
1031                  Morocco   3258.4956
1032                  Morocco   3820.1752
1033               Mozambique    468.5260
1034               Mozambique    495.5868
1035               Mozambique    556.6864
1036               Mozambique    566.6692
1037               Mozambique    724.9178
1038               Mozambique    502.3197
1039               Mozambique    462.2114
1040               Mozambique    389.8762
1041               Mozambique    410.8968
1042               Mozambique    472.3461
1043               Mozambique    633.6179
1044               Mozambique    823.6856
1045                  Myanmar    331.0000
1046                  Myanmar    350.0000
1047                  Myanmar    388.0000
1048                  Myanmar    349.0000
1049                  Myanmar    357.0000
1050                  Myanmar    371.0000
1051                  Myanmar    424.0000
1052                  Myanmar    385.0000
1053                  Myanmar    347.0000
1054                  Myanmar    415.0000
1055                  Myanmar    611.0000
1056                  Myanmar    944.0000
1057                  Namibia   2423.7804
1058                  Namibia   2621.4481
1059                  Namibia   3173.2156
1060                  Namibia   3793.6948
1061                  Namibia   3746.0809
1062                  Namibia   3876.4860
1063                  Namibia   4191.1005
1064                  Namibia   3693.7313
1065                  Namibia   3804.5380
1066                  Namibia   3899.5243
1067                  Namibia   4072.3248
1068                  Namibia   4811.0604
1069                    Nepal    545.8657
1070                    Nepal    597.9364
1071                    Nepal    652.3969
1072                    Nepal    676.4422
1073                    Nepal    674.7881
1074                    Nepal    694.1124
1075                    Nepal    718.3731
1076                    Nepal    775.6325
1077                    Nepal    897.7404
1078                    Nepal   1010.8921
1079                    Nepal   1057.2063
1080                    Nepal   1091.3598
1081              Netherlands   8941.5719
1082              Netherlands  11276.1934
1083              Netherlands  12790.8496
1084              Netherlands  15363.2514
1085              Netherlands  18794.7457
1086              Netherlands  21209.0592
1087              Netherlands  21399.4605
1088              Netherlands  23651.3236
1089              Netherlands  26790.9496
1090              Netherlands  30246.1306
1091              Netherlands  33724.7578
1092              Netherlands  36797.9333
1093              New Zealand  10556.5757
1094              New Zealand  12247.3953
1095              New Zealand  13175.6780
1096              New Zealand  14463.9189
1097              New Zealand  16046.0373
1098              New Zealand  16233.7177
1099              New Zealand  17632.4104
1100              New Zealand  19007.1913
1101              New Zealand  18363.3249
1102              New Zealand  21050.4138
1103              New Zealand  23189.8014
1104              New Zealand  25185.0091
1105                Nicaragua   3112.3639
1106                Nicaragua   3457.4159
1107                Nicaragua   3634.3644
1108                Nicaragua   4643.3935
1109                Nicaragua   4688.5933
1110                Nicaragua   5486.3711
1111                Nicaragua   3470.3382
1112                Nicaragua   2955.9844
1113                Nicaragua   2170.1517
1114                Nicaragua   2253.0230
1115                Nicaragua   2474.5488
1116                Nicaragua   2749.3210
1117                    Niger    761.8794
1118                    Niger    835.5234
1119                    Niger    997.7661
1120                    Niger   1054.3849
1121                    Niger    954.2092
1122                    Niger    808.8971
1123                    Niger    909.7221
1124                    Niger    668.3000
1125                    Niger    581.1827
1126                    Niger    580.3052
1127                    Niger    601.0745
1128                    Niger    619.6769
1129                  Nigeria   1077.2819
1130                  Nigeria   1100.5926
1131                  Nigeria   1150.9275
1132                  Nigeria   1014.5141
1133                  Nigeria   1698.3888
1134                  Nigeria   1981.9518
1135                  Nigeria   1576.9738
1136                  Nigeria   1385.0296
1137                  Nigeria   1619.8482
1138                  Nigeria   1624.9413
1139                  Nigeria   1615.2864
1140                  Nigeria   2013.9773
1141                   Norway  10095.4217
1142                   Norway  11653.9730
1143                   Norway  13450.4015
1144                   Norway  16361.8765
1145                   Norway  18965.0555
1146                   Norway  23311.3494
1147                   Norway  26298.6353
1148                   Norway  31540.9748
1149                   Norway  33965.6611
1150                   Norway  41283.1643
1151                   Norway  44683.9753
1152                   Norway  49357.1902
1153                     Oman   1828.2303
1154                     Oman   2242.7466
1155                     Oman   2924.6381
1156                     Oman   4720.9427
1157                     Oman  10618.0385
1158                     Oman  11848.3439
1159                     Oman  12954.7910
1160                     Oman  18115.2231
1161                     Oman  18616.7069
1162                     Oman  19702.0558
1163                     Oman  19774.8369
1164                     Oman  22316.1929
1165                 Pakistan    684.5971
1166                 Pakistan    747.0835
1167                 Pakistan    803.3427
1168                 Pakistan    942.4083
1169                 Pakistan   1049.9390
1170                 Pakistan   1175.9212
1171                 Pakistan   1443.4298
1172                 Pakistan   1704.6866
1173                 Pakistan   1971.8295
1174                 Pakistan   2049.3505
1175                 Pakistan   2092.7124
1176                 Pakistan   2605.9476
1177                   Panama   2480.3803
1178                   Panama   2961.8009
1179                   Panama   3536.5403
1180                   Panama   4421.0091
1181                   Panama   5364.2497
1182                   Panama   5351.9121
1183                   Panama   7009.6016
1184                   Panama   7034.7792
1185                   Panama   6618.7431
1186                   Panama   7113.6923
1187                   Panama   7356.0319
1188                   Panama   9809.1856
1189                 Paraguay   1952.3087
1190                 Paraguay   2046.1547
1191                 Paraguay   2148.0271
1192                 Paraguay   2299.3763
1193                 Paraguay   2523.3380
1194                 Paraguay   3248.3733
1195                 Paraguay   4258.5036
1196                 Paraguay   3998.8757
1197                 Paraguay   4196.4111
1198                 Paraguay   4247.4003
1199                 Paraguay   3783.6742
1200                 Paraguay   4172.8385
1201                     Peru   3758.5234
1202                     Peru   4245.2567
1203                     Peru   4957.0380
1204                     Peru   5788.0933
1205                     Peru   5937.8273
1206                     Peru   6281.2909
1207                     Peru   6434.5018
1208                     Peru   6360.9434
1209                     Peru   4446.3809
1210                     Peru   5838.3477
1211                     Peru   5909.0201
1212                     Peru   7408.9056
1213              Philippines   1272.8810
1214              Philippines   1547.9448
1215              Philippines   1649.5522
1216              Philippines   1814.1274
1217              Philippines   1989.3741
1218              Philippines   2373.2043
1219              Philippines   2603.2738
1220              Philippines   2189.6350
1221              Philippines   2279.3240
1222              Philippines   2536.5349
1223              Philippines   2650.9211
1224              Philippines   3190.4810
1225                   Poland   4029.3297
1226                   Poland   4734.2530
1227                   Poland   5338.7521
1228                   Poland   6557.1528
1229                   Poland   8006.5070
1230                   Poland   9508.1415
1231                   Poland   8451.5310
1232                   Poland   9082.3512
1233                   Poland   7738.8812
1234                   Poland  10159.5837
1235                   Poland  12002.2391
1236                   Poland  15389.9247
1237                 Portugal   3068.3199
1238                 Portugal   3774.5717
1239                 Portugal   4727.9549
1240                 Portugal   6361.5180
1241                 Portugal   9022.2474
1242                 Portugal  10172.4857
1243                 Portugal  11753.8429
1244                 Portugal  13039.3088
1245                 Portugal  16207.2666
1246                 Portugal  17641.0316
1247                 Portugal  19970.9079
1248                 Portugal  20509.6478
1249              Puerto Rico   3081.9598
1250              Puerto Rico   3907.1562
1251              Puerto Rico   5108.3446
1252              Puerto Rico   6929.2777
1253              Puerto Rico   9123.0417
1254              Puerto Rico   9770.5249
1255              Puerto Rico  10330.9891
1256              Puerto Rico  12281.3419
1257              Puerto Rico  14641.5871
1258              Puerto Rico  16999.4333
1259              Puerto Rico  18855.6062
1260              Puerto Rico  19328.7090
1261                  Reunion   2718.8853
1262                  Reunion   2769.4518
1263                  Reunion   3173.7233
1264                  Reunion   4021.1757
1265                  Reunion   5047.6586
1266                  Reunion   4319.8041
1267                  Reunion   5267.2194
1268                  Reunion   5303.3775
1269                  Reunion   6101.2558
1270                  Reunion   6071.9414
1271                  Reunion   6316.1652
1272                  Reunion   7670.1226
1273                  Romania   3144.6132
1274                  Romania   3943.3702
1275                  Romania   4734.9976
1276                  Romania   6470.8665
1277                  Romania   8011.4144
1278                  Romania   9356.3972
1279                  Romania   9605.3141
1280                  Romania   9696.2733
1281                  Romania   6598.4099
1282                  Romania   7346.5476
1283                  Romania   7885.3601
1284                  Romania  10808.4756
1285                   Rwanda    493.3239
1286                   Rwanda    540.2894
1287                   Rwanda    597.4731
1288                   Rwanda    510.9637
1289                   Rwanda    590.5807
1290                   Rwanda    670.0806
1291                   Rwanda    881.5706
1292                   Rwanda    847.9912
1293                   Rwanda    737.0686
1294                   Rwanda    589.9445
1295                   Rwanda    785.6538
1296                   Rwanda    863.0885
1297    Sao Tome and Principe    879.5836
1298    Sao Tome and Principe    860.7369
1299    Sao Tome and Principe   1071.5511
1300    Sao Tome and Principe   1384.8406
1301    Sao Tome and Principe   1532.9853
1302    Sao Tome and Principe   1737.5617
1303    Sao Tome and Principe   1890.2181
1304    Sao Tome and Principe   1516.5255
1305    Sao Tome and Principe   1428.7778
1306    Sao Tome and Principe   1339.0760
1307    Sao Tome and Principe   1353.0924
1308    Sao Tome and Principe   1598.4351
1309             Saudi Arabia   6459.5548
1310             Saudi Arabia   8157.5912
1311             Saudi Arabia  11626.4197
1312             Saudi Arabia  16903.0489
1313             Saudi Arabia  24837.4287
1314             Saudi Arabia  34167.7626
1315             Saudi Arabia  33693.1753
1316             Saudi Arabia  21198.2614
1317             Saudi Arabia  24841.6178
1318             Saudi Arabia  20586.6902
1319             Saudi Arabia  19014.5412
1320             Saudi Arabia  21654.8319
1321                  Senegal   1450.3570
1322                  Senegal   1567.6530
1323                  Senegal   1654.9887
1324                  Senegal   1612.4046
1325                  Senegal   1597.7121
1326                  Senegal   1561.7691
1327                  Senegal   1518.4800
1328                  Senegal   1441.7207
1329                  Senegal   1367.8994
1330                  Senegal   1392.3683
1331                  Senegal   1519.6353
1332                  Senegal   1712.4721
1333                   Serbia   3581.4594
1334                   Serbia   4981.0909
1335                   Serbia   6289.6292
1336                   Serbia   7991.7071
1337                   Serbia  10522.0675
1338                   Serbia  12980.6696
1339                   Serbia  15181.0927
1340                   Serbia  15870.8785
1341                   Serbia   9325.0682
1342                   Serbia   7914.3203
1343                   Serbia   7236.0753
1344                   Serbia   9786.5347
1345             Sierra Leone    879.7877
1346             Sierra Leone   1004.4844
1347             Sierra Leone   1116.6399
1348             Sierra Leone   1206.0435
1349             Sierra Leone   1353.7598
1350             Sierra Leone   1348.2852
1351             Sierra Leone   1465.0108
1352             Sierra Leone   1294.4478
1353             Sierra Leone   1068.6963
1354             Sierra Leone    574.6482
1355             Sierra Leone    699.4897
1356             Sierra Leone    862.5408
1357                Singapore   2315.1382
1358                Singapore   2843.1044
1359                Singapore   3674.7356
1360                Singapore   4977.4185
1361                Singapore   8597.7562
1362                Singapore  11210.0895
1363                Singapore  15169.1611
1364                Singapore  18861.5308
1365                Singapore  24769.8912
1366                Singapore  33519.4766
1367                Singapore  36023.1054
1368                Singapore  47143.1796
1369          Slovak Republic   5074.6591
1370          Slovak Republic   6093.2630
1371          Slovak Republic   7481.1076
1372          Slovak Republic   8412.9024
1373          Slovak Republic   9674.1676
1374          Slovak Republic  10922.6640
1375          Slovak Republic  11348.5459
1376          Slovak Republic  12037.2676
1377          Slovak Republic   9498.4677
1378          Slovak Republic  12126.2306
1379          Slovak Republic  13638.7784
1380          Slovak Republic  18678.3144
1381                 Slovenia   4215.0417
1382                 Slovenia   5862.2766
1383                 Slovenia   7402.3034
1384                 Slovenia   9405.4894
1385                 Slovenia  12383.4862
1386                 Slovenia  15277.0302
1387                 Slovenia  17866.7218
1388                 Slovenia  18678.5349
1389                 Slovenia  14214.7168
1390                 Slovenia  17161.1073
1391                 Slovenia  20660.0194
1392                 Slovenia  25768.2576
1393                  Somalia   1135.7498
1394                  Somalia   1258.1474
1395                  Somalia   1369.4883
1396                  Somalia   1284.7332
1397                  Somalia   1254.5761
1398                  Somalia   1450.9925
1399                  Somalia   1176.8070
1400                  Somalia   1093.2450
1401                  Somalia    926.9603
1402                  Somalia    930.5964
1403                  Somalia    882.0818
1404                  Somalia    926.1411
1405             South Africa   4725.2955
1406             South Africa   5487.1042
1407             South Africa   5768.7297
1408             South Africa   7114.4780
1409             South Africa   7765.9626
1410             South Africa   8028.6514
1411             South Africa   8568.2662
1412             South Africa   7825.8234
1413             South Africa   7225.0693
1414             South Africa   7479.1882
1415             South Africa   7710.9464
1416             South Africa   9269.6578
1417                    Spain   3834.0347
1418                    Spain   4564.8024
1419                    Spain   5693.8439
1420                    Spain   7993.5123
1421                    Spain  10638.7513
1422                    Spain  13236.9212
1423                    Spain  13926.1700
1424                    Spain  15764.9831
1425                    Spain  18603.0645
1426                    Spain  20445.2990
1427                    Spain  24835.4717
1428                    Spain  28821.0637
1429                Sri Lanka   1083.5320
1430                Sri Lanka   1072.5466
1431                Sri Lanka   1074.4720
1432                Sri Lanka   1135.5143
1433                Sri Lanka   1213.3955
1434                Sri Lanka   1348.7757
1435                Sri Lanka   1648.0798
1436                Sri Lanka   1876.7668
1437                Sri Lanka   2153.7392
1438                Sri Lanka   2664.4773
1439                Sri Lanka   3015.3788
1440                Sri Lanka   3970.0954
1441                    Sudan   1615.9911
1442                    Sudan   1770.3371
1443                    Sudan   1959.5938
1444                    Sudan   1687.9976
1445                    Sudan   1659.6528
1446                    Sudan   2202.9884
1447                    Sudan   1895.5441
1448                    Sudan   1507.8192
1449                    Sudan   1492.1970
1450                    Sudan   1632.2108
1451                    Sudan   1993.3983
1452                    Sudan   2602.3950
1453                Swaziland   1148.3766
1454                Swaziland   1244.7084
1455                Swaziland   1856.1821
1456                Swaziland   2613.1017
1457                Swaziland   3364.8366
1458                Swaziland   3781.4106
1459                Swaziland   3895.3840
1460                Swaziland   3984.8398
1461                Swaziland   3553.0224
1462                Swaziland   3876.7685
1463                Swaziland   4128.1169
1464                Swaziland   4513.4806
1465                   Sweden   8527.8447
1466                   Sweden   9911.8782
1467                   Sweden  12329.4419
1468                   Sweden  15258.2970
1469                   Sweden  17832.0246
1470                   Sweden  18855.7252
1471                   Sweden  20667.3812
1472                   Sweden  23586.9293
1473                   Sweden  23880.0168
1474                   Sweden  25266.5950
1475                   Sweden  29341.6309
1476                   Sweden  33859.7484
1477              Switzerland  14734.2327
1478              Switzerland  17909.4897
1479              Switzerland  20431.0927
1480              Switzerland  22966.1443
1481              Switzerland  27195.1130
1482              Switzerland  26982.2905
1483              Switzerland  28397.7151
1484              Switzerland  30281.7046
1485              Switzerland  31871.5303
1486              Switzerland  32135.3230
1487              Switzerland  34480.9577
1488              Switzerland  37506.4191
1489                    Syria   1643.4854
1490                    Syria   2117.2349
1491                    Syria   2193.0371
1492                    Syria   1881.9236
1493                    Syria   2571.4230
1494                    Syria   3195.4846
1495                    Syria   3761.8377
1496                    Syria   3116.7743
1497                    Syria   3340.5428
1498                    Syria   4014.2390
1499                    Syria   4090.9253
1500                    Syria   4184.5481
1501                   Taiwan   1206.9479
1502                   Taiwan   1507.8613
1503                   Taiwan   1822.8790
1504                   Taiwan   2643.8587
1505                   Taiwan   4062.5239
1506                   Taiwan   5596.5198
1507                   Taiwan   7426.3548
1508                   Taiwan  11054.5618
1509                   Taiwan  15215.6579
1510                   Taiwan  20206.8210
1511                   Taiwan  23235.4233
1512                   Taiwan  28718.2768
1513                 Tanzania    716.6501
1514                 Tanzania    698.5356
1515                 Tanzania    722.0038
1516                 Tanzania    848.2187
1517                 Tanzania    915.9851
1518                 Tanzania    962.4923
1519                 Tanzania    874.2426
1520                 Tanzania    831.8221
1521                 Tanzania    825.6825
1522                 Tanzania    789.1862
1523                 Tanzania    899.0742
1524                 Tanzania   1107.4822
1525                 Thailand    757.7974
1526                 Thailand    793.5774
1527                 Thailand   1002.1992
1528                 Thailand   1295.4607
1529                 Thailand   1524.3589
1530                 Thailand   1961.2246
1531                 Thailand   2393.2198
1532                 Thailand   2982.6538
1533                 Thailand   4616.8965
1534                 Thailand   5852.6255
1535                 Thailand   5913.1875
1536                 Thailand   7458.3963
1537                     Togo    859.8087
1538                     Togo    925.9083
1539                     Togo   1067.5348
1540                     Togo   1477.5968
1541                     Togo   1649.6602
1542                     Togo   1532.7770
1543                     Togo   1344.5780
1544                     Togo   1202.2014
1545                     Togo   1034.2989
1546                     Togo    982.2869
1547                     Togo    886.2206
1548                     Togo    882.9699
1549      Trinidad and Tobago   3023.2719
1550      Trinidad and Tobago   4100.3934
1551      Trinidad and Tobago   4997.5240
1552      Trinidad and Tobago   5621.3685
1553      Trinidad and Tobago   6619.5514
1554      Trinidad and Tobago   7899.5542
1555      Trinidad and Tobago   9119.5286
1556      Trinidad and Tobago   7388.5978
1557      Trinidad and Tobago   7370.9909
1558      Trinidad and Tobago   8792.5731
1559      Trinidad and Tobago  11460.6002
1560      Trinidad and Tobago  18008.5092
1561                  Tunisia   1468.4756
1562                  Tunisia   1395.2325
1563                  Tunisia   1660.3032
1564                  Tunisia   1932.3602
1565                  Tunisia   2753.2860
1566                  Tunisia   3120.8768
1567                  Tunisia   3560.2332
1568                  Tunisia   3810.4193
1569                  Tunisia   4332.7202
1570                  Tunisia   4876.7986
1571                  Tunisia   5722.8957
1572                  Tunisia   7092.9230
1573                   Turkey   1969.1010
1574                   Turkey   2218.7543
1575                   Turkey   2322.8699
1576                   Turkey   2826.3564
1577                   Turkey   3450.6964
1578                   Turkey   4269.1223
1579                   Turkey   4241.3563
1580                   Turkey   5089.0437
1581                   Turkey   5678.3483
1582                   Turkey   6601.4299
1583                   Turkey   6508.0857
1584                   Turkey   8458.2764
1585                   Uganda    734.7535
1586                   Uganda    774.3711
1587                   Uganda    767.2717
1588                   Uganda    908.9185
1589                   Uganda    950.7359
1590                   Uganda    843.7331
1591                   Uganda    682.2662
1592                   Uganda    617.7244
1593                   Uganda    644.1708
1594                   Uganda    816.5591
1595                   Uganda    927.7210
1596                   Uganda   1056.3801
1597           United Kingdom   9979.5085
1598           United Kingdom  11283.1779
1599           United Kingdom  12477.1771
1600           United Kingdom  14142.8509
1601           United Kingdom  15895.1164
1602           United Kingdom  17428.7485
1603           United Kingdom  18232.4245
1604           United Kingdom  21664.7877
1605           United Kingdom  22705.0925
1606           United Kingdom  26074.5314
1607           United Kingdom  29478.9992
1608           United Kingdom  33203.2613
1609            United States  13990.4821
1610            United States  14847.1271
1611            United States  16173.1459
1612            United States  19530.3656
1613            United States  21806.0359
1614            United States  24072.6321
1615            United States  25009.5591
1616            United States  29884.3504
1617            United States  32003.9322
1618            United States  35767.4330
1619            United States  39097.0995
1620            United States  42951.6531
1621                  Uruguay   5716.7667
1622                  Uruguay   6150.7730
1623                  Uruguay   5603.3577
1624                  Uruguay   5444.6196
1625                  Uruguay   5703.4089
1626                  Uruguay   6504.3397
1627                  Uruguay   6920.2231
1628                  Uruguay   7452.3990
1629                  Uruguay   8137.0048
1630                  Uruguay   9230.2407
1631                  Uruguay   7727.0020
1632                  Uruguay  10611.4630
1633                Venezuela   7689.7998
1634                Venezuela   9802.4665
1635                Venezuela   8422.9742
1636                Venezuela   9541.4742
1637                Venezuela  10505.2597
1638                Venezuela  13143.9510
1639                Venezuela  11152.4101
1640                Venezuela   9883.5846
1641                Venezuela  10733.9263
1642                Venezuela  10165.4952
1643                Venezuela   8605.0478
1644                Venezuela  11415.8057
1645                  Vietnam    605.0665
1646                  Vietnam    676.2854
1647                  Vietnam    772.0492
1648                  Vietnam    637.1233
1649                  Vietnam    699.5016
1650                  Vietnam    713.5371
1651                  Vietnam    707.2358
1652                  Vietnam    820.7994
1653                  Vietnam    989.0231
1654                  Vietnam   1385.8968
1655                  Vietnam   1764.4567
1656                  Vietnam   2441.5764
1657       West Bank and Gaza   1515.5923
1658       West Bank and Gaza   1827.0677
1659       West Bank and Gaza   2198.9563
1660       West Bank and Gaza   2649.7150
1661       West Bank and Gaza   3133.4093
1662       West Bank and Gaza   3682.8315
1663       West Bank and Gaza   4336.0321
1664       West Bank and Gaza   5107.1974
1665       West Bank and Gaza   6017.6548
1666       West Bank and Gaza   7110.6676
1667       West Bank and Gaza   4515.4876
1668       West Bank and Gaza   3025.3498
1669               Yemen Rep.    781.7176
1670               Yemen Rep.    804.8305
1671               Yemen Rep.    825.6232
1672               Yemen Rep.    862.4421
1673               Yemen Rep.   1265.0470
1674               Yemen Rep.   1829.7652
1675               Yemen Rep.   1977.5570
1676               Yemen Rep.   1971.7415
1677               Yemen Rep.   1879.4967
1678               Yemen Rep.   2117.4845
1679               Yemen Rep.   2234.8208
1680               Yemen Rep.   2280.7699
1681                   Zambia   1147.3888
1682                   Zambia   1311.9568
1683                   Zambia   1452.7258
1684                   Zambia   1777.0773
1685                   Zambia   1773.4983
1686                   Zambia   1588.6883
1687                   Zambia   1408.6786
1688                   Zambia   1213.3151
1689                   Zambia   1210.8846
1690                   Zambia   1071.3538
1691                   Zambia   1071.6139
1692                   Zambia   1271.2116
1693                 Zimbabwe    406.8841
1694                 Zimbabwe    518.7643
1695                 Zimbabwe    527.2722
1696                 Zimbabwe    569.7951
1697                 Zimbabwe    799.3622
1698                 Zimbabwe    685.5877
1699                 Zimbabwe    788.8550
1700                 Zimbabwe    706.1573
1701                 Zimbabwe    693.4208
1702                 Zimbabwe    792.4500
1703                 Zimbabwe    672.0386
1704                 Zimbabwe    469.7093</code></pre>
</div>
</div>
<p>You can also specify columns to remove using negative selection, <code>select(-varname)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>continent) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      country year        pop  lifeExp   gdpPercap
1                 Afghanistan 1952    8425333 28.80100    779.4453
2                 Afghanistan 1957    9240934 30.33200    820.8530
3                 Afghanistan 1962   10267083 31.99700    853.1007
4                 Afghanistan 1967   11537966 34.02000    836.1971
5                 Afghanistan 1972   13079460 36.08800    739.9811
6                 Afghanistan 1977   14880372 38.43800    786.1134
7                 Afghanistan 1982   12881816 39.85400    978.0114
8                 Afghanistan 1987   13867957 40.82200    852.3959
9                 Afghanistan 1992   16317921 41.67400    649.3414
10                Afghanistan 1997   22227415 41.76300    635.3414
11                Afghanistan 2002   25268405 42.12900    726.7341
12                Afghanistan 2007   31889923 43.82800    974.5803
13                    Albania 1952    1282697 55.23000   1601.0561
14                    Albania 1957    1476505 59.28000   1942.2842
15                    Albania 1962    1728137 64.82000   2312.8890
16                    Albania 1967    1984060 66.22000   2760.1969
17                    Albania 1972    2263554 67.69000   3313.4222
18                    Albania 1977    2509048 68.93000   3533.0039
19                    Albania 1982    2780097 70.42000   3630.8807
20                    Albania 1987    3075321 72.00000   3738.9327
21                    Albania 1992    3326498 71.58100   2497.4379
22                    Albania 1997    3428038 72.95000   3193.0546
23                    Albania 2002    3508512 75.65100   4604.2117
24                    Albania 2007    3600523 76.42300   5937.0295
25                    Algeria 1952    9279525 43.07700   2449.0082
26                    Algeria 1957   10270856 45.68500   3013.9760
27                    Algeria 1962   11000948 48.30300   2550.8169
28                    Algeria 1967   12760499 51.40700   3246.9918
29                    Algeria 1972   14760787 54.51800   4182.6638
30                    Algeria 1977   17152804 58.01400   4910.4168
31                    Algeria 1982   20033753 61.36800   5745.1602
32                    Algeria 1987   23254956 65.79900   5681.3585
33                    Algeria 1992   26298373 67.74400   5023.2166
34                    Algeria 1997   29072015 69.15200   4797.2951
35                    Algeria 2002   31287142 70.99400   5288.0404
36                    Algeria 2007   33333216 72.30100   6223.3675
37                     Angola 1952    4232095 30.01500   3520.6103
38                     Angola 1957    4561361 31.99900   3827.9405
39                     Angola 1962    4826015 34.00000   4269.2767
40                     Angola 1967    5247469 35.98500   5522.7764
41                     Angola 1972    5894858 37.92800   5473.2880
42                     Angola 1977    6162675 39.48300   3008.6474
43                     Angola 1982    7016384 39.94200   2756.9537
44                     Angola 1987    7874230 39.90600   2430.2083
45                     Angola 1992    8735988 40.64700   2627.8457
46                     Angola 1997    9875024 40.96300   2277.1409
47                     Angola 2002   10866106 41.00300   2773.2873
48                     Angola 2007   12420476 42.73100   4797.2313
49                  Argentina 1952   17876956 62.48500   5911.3151
50                  Argentina 1957   19610538 64.39900   6856.8562
51                  Argentina 1962   21283783 65.14200   7133.1660
52                  Argentina 1967   22934225 65.63400   8052.9530
53                  Argentina 1972   24779799 67.06500   9443.0385
54                  Argentina 1977   26983828 68.48100  10079.0267
55                  Argentina 1982   29341374 69.94200   8997.8974
56                  Argentina 1987   31620918 70.77400   9139.6714
57                  Argentina 1992   33958947 71.86800   9308.4187
58                  Argentina 1997   36203463 73.27500  10967.2820
59                  Argentina 2002   38331121 74.34000   8797.6407
60                  Argentina 2007   40301927 75.32000  12779.3796
61                  Australia 1952    8691212 69.12000  10039.5956
62                  Australia 1957    9712569 70.33000  10949.6496
63                  Australia 1962   10794968 70.93000  12217.2269
64                  Australia 1967   11872264 71.10000  14526.1246
65                  Australia 1972   13177000 71.93000  16788.6295
66                  Australia 1977   14074100 73.49000  18334.1975
67                  Australia 1982   15184200 74.74000  19477.0093
68                  Australia 1987   16257249 76.32000  21888.8890
69                  Australia 1992   17481977 77.56000  23424.7668
70                  Australia 1997   18565243 78.83000  26997.9366
71                  Australia 2002   19546792 80.37000  30687.7547
72                  Australia 2007   20434176 81.23500  34435.3674
73                    Austria 1952    6927772 66.80000   6137.0765
74                    Austria 1957    6965860 67.48000   8842.5980
75                    Austria 1962    7129864 69.54000  10750.7211
76                    Austria 1967    7376998 70.14000  12834.6024
77                    Austria 1972    7544201 70.63000  16661.6256
78                    Austria 1977    7568430 72.17000  19749.4223
79                    Austria 1982    7574613 73.18000  21597.0836
80                    Austria 1987    7578903 74.94000  23687.8261
81                    Austria 1992    7914969 76.04000  27042.0187
82                    Austria 1997    8069876 77.51000  29095.9207
83                    Austria 2002    8148312 78.98000  32417.6077
84                    Austria 2007    8199783 79.82900  36126.4927
85                    Bahrain 1952     120447 50.93900   9867.0848
86                    Bahrain 1957     138655 53.83200  11635.7995
87                    Bahrain 1962     171863 56.92300  12753.2751
88                    Bahrain 1967     202182 59.92300  14804.6727
89                    Bahrain 1972     230800 63.30000  18268.6584
90                    Bahrain 1977     297410 65.59300  19340.1020
91                    Bahrain 1982     377967 69.05200  19211.1473
92                    Bahrain 1987     454612 70.75000  18524.0241
93                    Bahrain 1992     529491 72.60100  19035.5792
94                    Bahrain 1997     598561 73.92500  20292.0168
95                    Bahrain 2002     656397 74.79500  23403.5593
96                    Bahrain 2007     708573 75.63500  29796.0483
97                 Bangladesh 1952   46886859 37.48400    684.2442
98                 Bangladesh 1957   51365468 39.34800    661.6375
99                 Bangladesh 1962   56839289 41.21600    686.3416
100                Bangladesh 1967   62821884 43.45300    721.1861
101                Bangladesh 1972   70759295 45.25200    630.2336
102                Bangladesh 1977   80428306 46.92300    659.8772
103                Bangladesh 1982   93074406 50.00900    676.9819
104                Bangladesh 1987  103764241 52.81900    751.9794
105                Bangladesh 1992  113704579 56.01800    837.8102
106                Bangladesh 1997  123315288 59.41200    972.7700
107                Bangladesh 2002  135656790 62.01300   1136.3904
108                Bangladesh 2007  150448339 64.06200   1391.2538
109                   Belgium 1952    8730405 68.00000   8343.1051
110                   Belgium 1957    8989111 69.24000   9714.9606
111                   Belgium 1962    9218400 70.25000  10991.2068
112                   Belgium 1967    9556500 70.94000  13149.0412
113                   Belgium 1972    9709100 71.44000  16672.1436
114                   Belgium 1977    9821800 72.80000  19117.9745
115                   Belgium 1982    9856303 73.93000  20979.8459
116                   Belgium 1987    9870200 75.35000  22525.5631
117                   Belgium 1992   10045622 76.46000  25575.5707
118                   Belgium 1997   10199787 77.53000  27561.1966
119                   Belgium 2002   10311970 78.32000  30485.8838
120                   Belgium 2007   10392226 79.44100  33692.6051
121                     Benin 1952    1738315 38.22300   1062.7522
122                     Benin 1957    1925173 40.35800    959.6011
123                     Benin 1962    2151895 42.61800    949.4991
124                     Benin 1967    2427334 44.88500   1035.8314
125                     Benin 1972    2761407 47.01400   1085.7969
126                     Benin 1977    3168267 49.19000   1029.1613
127                     Benin 1982    3641603 50.90400   1277.8976
128                     Benin 1987    4243788 52.33700   1225.8560
129                     Benin 1992    4981671 53.91900   1191.2077
130                     Benin 1997    6066080 54.77700   1232.9753
131                     Benin 2002    7026113 54.40600   1372.8779
132                     Benin 2007    8078314 56.72800   1441.2849
133                   Bolivia 1952    2883315 40.41400   2677.3263
134                   Bolivia 1957    3211738 41.89000   2127.6863
135                   Bolivia 1962    3593918 43.42800   2180.9725
136                   Bolivia 1967    4040665 45.03200   2586.8861
137                   Bolivia 1972    4565872 46.71400   2980.3313
138                   Bolivia 1977    5079716 50.02300   3548.0978
139                   Bolivia 1982    5642224 53.85900   3156.5105
140                   Bolivia 1987    6156369 57.25100   2753.6915
141                   Bolivia 1992    6893451 59.95700   2961.6997
142                   Bolivia 1997    7693188 62.05000   3326.1432
143                   Bolivia 2002    8445134 63.88300   3413.2627
144                   Bolivia 2007    9119152 65.55400   3822.1371
145    Bosnia and Herzegovina 1952    2791000 53.82000    973.5332
146    Bosnia and Herzegovina 1957    3076000 58.45000   1353.9892
147    Bosnia and Herzegovina 1962    3349000 61.93000   1709.6837
148    Bosnia and Herzegovina 1967    3585000 64.79000   2172.3524
149    Bosnia and Herzegovina 1972    3819000 67.45000   2860.1698
150    Bosnia and Herzegovina 1977    4086000 69.86000   3528.4813
151    Bosnia and Herzegovina 1982    4172693 70.69000   4126.6132
152    Bosnia and Herzegovina 1987    4338977 71.14000   4314.1148
153    Bosnia and Herzegovina 1992    4256013 72.17800   2546.7814
154    Bosnia and Herzegovina 1997    3607000 73.24400   4766.3559
155    Bosnia and Herzegovina 2002    4165416 74.09000   6018.9752
156    Bosnia and Herzegovina 2007    4552198 74.85200   7446.2988
157                  Botswana 1952     442308 47.62200    851.2411
158                  Botswana 1957     474639 49.61800    918.2325
159                  Botswana 1962     512764 51.52000    983.6540
160                  Botswana 1967     553541 53.29800   1214.7093
161                  Botswana 1972     619351 56.02400   2263.6111
162                  Botswana 1977     781472 59.31900   3214.8578
163                  Botswana 1982     970347 61.48400   4551.1421
164                  Botswana 1987    1151184 63.62200   6205.8839
165                  Botswana 1992    1342614 62.74500   7954.1116
166                  Botswana 1997    1536536 52.55600   8647.1423
167                  Botswana 2002    1630347 46.63400  11003.6051
168                  Botswana 2007    1639131 50.72800  12569.8518
169                    Brazil 1952   56602560 50.91700   2108.9444
170                    Brazil 1957   65551171 53.28500   2487.3660
171                    Brazil 1962   76039390 55.66500   3336.5858
172                    Brazil 1967   88049823 57.63200   3429.8644
173                    Brazil 1972  100840058 59.50400   4985.7115
174                    Brazil 1977  114313951 61.48900   6660.1187
175                    Brazil 1982  128962939 63.33600   7030.8359
176                    Brazil 1987  142938076 65.20500   7807.0958
177                    Brazil 1992  155975974 67.05700   6950.2830
178                    Brazil 1997  168546719 69.38800   7957.9808
179                    Brazil 2002  179914212 71.00600   8131.2128
180                    Brazil 2007  190010647 72.39000   9065.8008
181                  Bulgaria 1952    7274900 59.60000   2444.2866
182                  Bulgaria 1957    7651254 66.61000   3008.6707
183                  Bulgaria 1962    8012946 69.51000   4254.3378
184                  Bulgaria 1967    8310226 70.42000   5577.0028
185                  Bulgaria 1972    8576200 70.90000   6597.4944
186                  Bulgaria 1977    8797022 70.81000   7612.2404
187                  Bulgaria 1982    8892098 71.08000   8224.1916
188                  Bulgaria 1987    8971958 71.34000   8239.8548
189                  Bulgaria 1992    8658506 71.19000   6302.6234
190                  Bulgaria 1997    8066057 70.32000   5970.3888
191                  Bulgaria 2002    7661799 72.14000   7696.7777
192                  Bulgaria 2007    7322858 73.00500  10680.7928
193              Burkina Faso 1952    4469979 31.97500    543.2552
194              Burkina Faso 1957    4713416 34.90600    617.1835
195              Burkina Faso 1962    4919632 37.81400    722.5120
196              Burkina Faso 1967    5127935 40.69700    794.8266
197              Burkina Faso 1972    5433886 43.59100    854.7360
198              Burkina Faso 1977    5889574 46.13700    743.3870
199              Burkina Faso 1982    6634596 48.12200    807.1986
200              Burkina Faso 1987    7586551 49.55700    912.0631
201              Burkina Faso 1992    8878303 50.26000    931.7528
202              Burkina Faso 1997   10352843 50.32400    946.2950
203              Burkina Faso 2002   12251209 50.65000   1037.6452
204              Burkina Faso 2007   14326203 52.29500   1217.0330
205                   Burundi 1952    2445618 39.03100    339.2965
206                   Burundi 1957    2667518 40.53300    379.5646
207                   Burundi 1962    2961915 42.04500    355.2032
208                   Burundi 1967    3330989 43.54800    412.9775
209                   Burundi 1972    3529983 44.05700    464.0995
210                   Burundi 1977    3834415 45.91000    556.1033
211                   Burundi 1982    4580410 47.47100    559.6032
212                   Burundi 1987    5126023 48.21100    621.8188
213                   Burundi 1992    5809236 44.73600    631.6999
214                   Burundi 1997    6121610 45.32600    463.1151
215                   Burundi 2002    7021078 47.36000    446.4035
216                   Burundi 2007    8390505 49.58000    430.0707
217                  Cambodia 1952    4693836 39.41700    368.4693
218                  Cambodia 1957    5322536 41.36600    434.0383
219                  Cambodia 1962    6083619 43.41500    496.9136
220                  Cambodia 1967    6960067 45.41500    523.4323
221                  Cambodia 1972    7450606 40.31700    421.6240
222                  Cambodia 1977    6978607 31.22000    524.9722
223                  Cambodia 1982    7272485 50.95700    624.4755
224                  Cambodia 1987    8371791 53.91400    683.8956
225                  Cambodia 1992   10150094 55.80300    682.3032
226                  Cambodia 1997   11782962 56.53400    734.2852
227                  Cambodia 2002   12926707 56.75200    896.2260
228                  Cambodia 2007   14131858 59.72300   1713.7787
229                  Cameroon 1952    5009067 38.52300   1172.6677
230                  Cameroon 1957    5359923 40.42800   1313.0481
231                  Cameroon 1962    5793633 42.64300   1399.6074
232                  Cameroon 1967    6335506 44.79900   1508.4531
233                  Cameroon 1972    7021028 47.04900   1684.1465
234                  Cameroon 1977    7959865 49.35500   1783.4329
235                  Cameroon 1982    9250831 52.96100   2367.9833
236                  Cameroon 1987   10780667 54.98500   2602.6642
237                  Cameroon 1992   12467171 54.31400   1793.1633
238                  Cameroon 1997   14195809 52.19900   1694.3375
239                  Cameroon 2002   15929988 49.85600   1934.0114
240                  Cameroon 2007   17696293 50.43000   2042.0952
241                    Canada 1952   14785584 68.75000  11367.1611
242                    Canada 1957   17010154 69.96000  12489.9501
243                    Canada 1962   18985849 71.30000  13462.4855
244                    Canada 1967   20819767 72.13000  16076.5880
245                    Canada 1972   22284500 72.88000  18970.5709
246                    Canada 1977   23796400 74.21000  22090.8831
247                    Canada 1982   25201900 75.76000  22898.7921
248                    Canada 1987   26549700 76.86000  26626.5150
249                    Canada 1992   28523502 77.95000  26342.8843
250                    Canada 1997   30305843 78.61000  28954.9259
251                    Canada 2002   31902268 79.77000  33328.9651
252                    Canada 2007   33390141 80.65300  36319.2350
253  Central African Republic 1952    1291695 35.46300   1071.3107
254  Central African Republic 1957    1392284 37.46400   1190.8443
255  Central African Republic 1962    1523478 39.47500   1193.0688
256  Central African Republic 1967    1733638 41.47800   1136.0566
257  Central African Republic 1972    1927260 43.45700   1070.0133
258  Central African Republic 1977    2167533 46.77500   1109.3743
259  Central African Republic 1982    2476971 48.29500    956.7530
260  Central African Republic 1987    2840009 50.48500    844.8764
261  Central African Republic 1992    3265124 49.39600    747.9055
262  Central African Republic 1997    3696513 46.06600    740.5063
263  Central African Republic 2002    4048013 43.30800    738.6906
264  Central African Republic 2007    4369038 44.74100    706.0165
265                      Chad 1952    2682462 38.09200   1178.6659
266                      Chad 1957    2894855 39.88100   1308.4956
267                      Chad 1962    3150417 41.71600   1389.8176
268                      Chad 1967    3495967 43.60100   1196.8106
269                      Chad 1972    3899068 45.56900   1104.1040
270                      Chad 1977    4388260 47.38300   1133.9850
271                      Chad 1982    4875118 49.51700    797.9081
272                      Chad 1987    5498955 51.05100    952.3861
273                      Chad 1992    6429417 51.72400   1058.0643
274                      Chad 1997    7562011 51.57300   1004.9614
275                      Chad 2002    8835739 50.52500   1156.1819
276                      Chad 2007   10238807 50.65100   1704.0637
277                     Chile 1952    6377619 54.74500   3939.9788
278                     Chile 1957    7048426 56.07400   4315.6227
279                     Chile 1962    7961258 57.92400   4519.0943
280                     Chile 1967    8858908 60.52300   5106.6543
281                     Chile 1972    9717524 63.44100   5494.0244
282                     Chile 1977   10599793 67.05200   4756.7638
283                     Chile 1982   11487112 70.56500   5095.6657
284                     Chile 1987   12463354 72.49200   5547.0638
285                     Chile 1992   13572994 74.12600   7596.1260
286                     Chile 1997   14599929 75.81600  10118.0532
287                     Chile 2002   15497046 77.86000  10778.7838
288                     Chile 2007   16284741 78.55300  13171.6388
289                     China 1952  556263528 44.00000    400.4486
290                     China 1957  637408000 50.54896    575.9870
291                     China 1962  665770000 44.50136    487.6740
292                     China 1967  754550000 58.38112    612.7057
293                     China 1972  862030000 63.11888    676.9001
294                     China 1977  943455000 63.96736    741.2375
295                     China 1982 1000281000 65.52500    962.4214
296                     China 1987 1084035000 67.27400   1378.9040
297                     China 1992 1164970000 68.69000   1655.7842
298                     China 1997 1230075000 70.42600   2289.2341
299                     China 2002 1280400000 72.02800   3119.2809
300                     China 2007 1318683096 72.96100   4959.1149
301                  Colombia 1952   12350771 50.64300   2144.1151
302                  Colombia 1957   14485993 55.11800   2323.8056
303                  Colombia 1962   17009885 57.86300   2492.3511
304                  Colombia 1967   19764027 59.96300   2678.7298
305                  Colombia 1972   22542890 61.62300   3264.6600
306                  Colombia 1977   25094412 63.83700   3815.8079
307                  Colombia 1982   27764644 66.65300   4397.5757
308                  Colombia 1987   30964245 67.76800   4903.2191
309                  Colombia 1992   34202721 68.42100   5444.6486
310                  Colombia 1997   37657830 70.31300   6117.3617
311                  Colombia 2002   41008227 71.68200   5755.2600
312                  Colombia 2007   44227550 72.88900   7006.5804
313                   Comoros 1952     153936 40.71500   1102.9909
314                   Comoros 1957     170928 42.46000   1211.1485
315                   Comoros 1962     191689 44.46700   1406.6483
316                   Comoros 1967     217378 46.47200   1876.0296
317                   Comoros 1972     250027 48.94400   1937.5777
318                   Comoros 1977     304739 50.93900   1172.6030
319                   Comoros 1982     348643 52.93300   1267.1001
320                   Comoros 1987     395114 54.92600   1315.9808
321                   Comoros 1992     454429 57.93900   1246.9074
322                   Comoros 1997     527982 60.66000   1173.6182
323                   Comoros 2002     614382 62.97400   1075.8116
324                   Comoros 2007     710960 65.15200    986.1479
325           Congo Dem. Rep. 1952   14100005 39.14300    780.5423
326           Congo Dem. Rep. 1957   15577932 40.65200    905.8602
327           Congo Dem. Rep. 1962   17486434 42.12200    896.3146
328           Congo Dem. Rep. 1967   19941073 44.05600    861.5932
329           Congo Dem. Rep. 1972   23007669 45.98900    904.8961
330           Congo Dem. Rep. 1977   26480870 47.80400    795.7573
331           Congo Dem. Rep. 1982   30646495 47.78400    673.7478
332           Congo Dem. Rep. 1987   35481645 47.41200    672.7748
333           Congo Dem. Rep. 1992   41672143 45.54800    457.7192
334           Congo Dem. Rep. 1997   47798986 42.58700    312.1884
335           Congo Dem. Rep. 2002   55379852 44.96600    241.1659
336           Congo Dem. Rep. 2007   64606759 46.46200    277.5519
337                Congo Rep. 1952     854885 42.11100   2125.6214
338                Congo Rep. 1957     940458 45.05300   2315.0566
339                Congo Rep. 1962    1047924 48.43500   2464.7832
340                Congo Rep. 1967    1179760 52.04000   2677.9396
341                Congo Rep. 1972    1340458 54.90700   3213.1527
342                Congo Rep. 1977    1536769 55.62500   3259.1790
343                Congo Rep. 1982    1774735 56.69500   4879.5075
344                Congo Rep. 1987    2064095 57.47000   4201.1949
345                Congo Rep. 1992    2409073 56.43300   4016.2395
346                Congo Rep. 1997    2800947 52.96200   3484.1644
347                Congo Rep. 2002    3328795 52.97000   3484.0620
348                Congo Rep. 2007    3800610 55.32200   3632.5578
349                Costa Rica 1952     926317 57.20600   2627.0095
350                Costa Rica 1957    1112300 60.02600   2990.0108
351                Costa Rica 1962    1345187 62.84200   3460.9370
352                Costa Rica 1967    1588717 65.42400   4161.7278
353                Costa Rica 1972    1834796 67.84900   5118.1469
354                Costa Rica 1977    2108457 70.75000   5926.8770
355                Costa Rica 1982    2424367 73.45000   5262.7348
356                Costa Rica 1987    2799811 74.75200   5629.9153
357                Costa Rica 1992    3173216 75.71300   6160.4163
358                Costa Rica 1997    3518107 77.26000   6677.0453
359                Costa Rica 2002    3834934 78.12300   7723.4472
360                Costa Rica 2007    4133884 78.78200   9645.0614
361             Cote d'Ivoire 1952    2977019 40.47700   1388.5947
362             Cote d'Ivoire 1957    3300000 42.46900   1500.8959
363             Cote d'Ivoire 1962    3832408 44.93000   1728.8694
364             Cote d'Ivoire 1967    4744870 47.35000   2052.0505
365             Cote d'Ivoire 1972    6071696 49.80100   2378.2011
366             Cote d'Ivoire 1977    7459574 52.37400   2517.7365
367             Cote d'Ivoire 1982    9025951 53.98300   2602.7102
368             Cote d'Ivoire 1987   10761098 54.65500   2156.9561
369             Cote d'Ivoire 1992   12772596 52.04400   1648.0738
370             Cote d'Ivoire 1997   14625967 47.99100   1786.2654
371             Cote d'Ivoire 2002   16252726 46.83200   1648.8008
372             Cote d'Ivoire 2007   18013409 48.32800   1544.7501
373                   Croatia 1952    3882229 61.21000   3119.2365
374                   Croatia 1957    3991242 64.77000   4338.2316
375                   Croatia 1962    4076557 67.13000   5477.8900
376                   Croatia 1967    4174366 68.50000   6960.2979
377                   Croatia 1972    4225310 69.61000   9164.0901
378                   Croatia 1977    4318673 70.64000  11305.3852
379                   Croatia 1982    4413368 70.46000  13221.8218
380                   Croatia 1987    4484310 71.52000  13822.5839
381                   Croatia 1992    4494013 72.52700   8447.7949
382                   Croatia 1997    4444595 73.68000   9875.6045
383                   Croatia 2002    4481020 74.87600  11628.3890
384                   Croatia 2007    4493312 75.74800  14619.2227
385                      Cuba 1952    6007797 59.42100   5586.5388
386                      Cuba 1957    6640752 62.32500   6092.1744
387                      Cuba 1962    7254373 65.24600   5180.7559
388                      Cuba 1967    8139332 68.29000   5690.2680
389                      Cuba 1972    8831348 70.72300   5305.4453
390                      Cuba 1977    9537988 72.64900   6380.4950
391                      Cuba 1982    9789224 73.71700   7316.9181
392                      Cuba 1987   10239839 74.17400   7532.9248
393                      Cuba 1992   10723260 74.41400   5592.8440
394                      Cuba 1997   10983007 76.15100   5431.9904
395                      Cuba 2002   11226999 77.15800   6340.6467
396                      Cuba 2007   11416987 78.27300   8948.1029
397            Czech Republic 1952    9125183 66.87000   6876.1403
398            Czech Republic 1957    9513758 69.03000   8256.3439
399            Czech Republic 1962    9620282 69.90000  10136.8671
400            Czech Republic 1967    9835109 70.38000  11399.4449
401            Czech Republic 1972    9862158 70.29000  13108.4536
402            Czech Republic 1977   10161915 70.71000  14800.1606
403            Czech Republic 1982   10303704 70.96000  15377.2285
404            Czech Republic 1987   10311597 71.58000  16310.4434
405            Czech Republic 1992   10315702 72.40000  14297.0212
406            Czech Republic 1997   10300707 74.01000  16048.5142
407            Czech Republic 2002   10256295 75.51000  17596.2102
408            Czech Republic 2007   10228744 76.48600  22833.3085
409                   Denmark 1952    4334000 70.78000   9692.3852
410                   Denmark 1957    4487831 71.81000  11099.6593
411                   Denmark 1962    4646899 72.35000  13583.3135
412                   Denmark 1967    4838800 72.96000  15937.2112
413                   Denmark 1972    4991596 73.47000  18866.2072
414                   Denmark 1977    5088419 74.69000  20422.9015
415                   Denmark 1982    5117810 74.63000  21688.0405
416                   Denmark 1987    5127024 74.80000  25116.1758
417                   Denmark 1992    5171393 75.33000  26406.7399
418                   Denmark 1997    5283663 76.11000  29804.3457
419                   Denmark 2002    5374693 77.18000  32166.5001
420                   Denmark 2007    5468120 78.33200  35278.4187
421                  Djibouti 1952      63149 34.81200   2669.5295
422                  Djibouti 1957      71851 37.32800   2864.9691
423                  Djibouti 1962      89898 39.69300   3020.9893
424                  Djibouti 1967     127617 42.07400   3020.0505
425                  Djibouti 1972     178848 44.36600   3694.2124
426                  Djibouti 1977     228694 46.51900   3081.7610
427                  Djibouti 1982     305991 48.81200   2879.4681
428                  Djibouti 1987     311025 50.04000   2880.1026
429                  Djibouti 1992     384156 51.60400   2377.1562
430                  Djibouti 1997     417908 53.15700   1895.0170
431                  Djibouti 2002     447416 53.37300   1908.2609
432                  Djibouti 2007     496374 54.79100   2082.4816
433        Dominican Republic 1952    2491346 45.92800   1397.7171
434        Dominican Republic 1957    2923186 49.82800   1544.4030
435        Dominican Republic 1962    3453434 53.45900   1662.1374
436        Dominican Republic 1967    4049146 56.75100   1653.7230
437        Dominican Republic 1972    4671329 59.63100   2189.8745
438        Dominican Republic 1977    5302800 61.78800   2681.9889
439        Dominican Republic 1982    5968349 63.72700   2861.0924
440        Dominican Republic 1987    6655297 66.04600   2899.8422
441        Dominican Republic 1992    7351181 68.45700   3044.2142
442        Dominican Republic 1997    7992357 69.95700   3614.1013
443        Dominican Republic 2002    8650322 70.84700   4563.8082
444        Dominican Republic 2007    9319622 72.23500   6025.3748
445                   Ecuador 1952    3548753 48.35700   3522.1107
446                   Ecuador 1957    4058385 51.35600   3780.5467
447                   Ecuador 1962    4681707 54.64000   4086.1141
448                   Ecuador 1967    5432424 56.67800   4579.0742
449                   Ecuador 1972    6298651 58.79600   5280.9947
450                   Ecuador 1977    7278866 61.31000   6679.6233
451                   Ecuador 1982    8365850 64.34200   7213.7913
452                   Ecuador 1987    9545158 67.23100   6481.7770
453                   Ecuador 1992   10748394 69.61300   7103.7026
454                   Ecuador 1997   11911819 72.31200   7429.4559
455                   Ecuador 2002   12921234 74.17300   5773.0445
456                   Ecuador 2007   13755680 74.99400   6873.2623
457                     Egypt 1952   22223309 41.89300   1418.8224
458                     Egypt 1957   25009741 44.44400   1458.9153
459                     Egypt 1962   28173309 46.99200   1693.3359
460                     Egypt 1967   31681188 49.29300   1814.8807
461                     Egypt 1972   34807417 51.13700   2024.0081
462                     Egypt 1977   38783863 53.31900   2785.4936
463                     Egypt 1982   45681811 56.00600   3503.7296
464                     Egypt 1987   52799062 59.79700   3885.4607
465                     Egypt 1992   59402198 63.67400   3794.7552
466                     Egypt 1997   66134291 67.21700   4173.1818
467                     Egypt 2002   73312559 69.80600   4754.6044
468                     Egypt 2007   80264543 71.33800   5581.1810
469               El Salvador 1952    2042865 45.26200   3048.3029
470               El Salvador 1957    2355805 48.57000   3421.5232
471               El Salvador 1962    2747687 52.30700   3776.8036
472               El Salvador 1967    3232927 55.85500   4358.5954
473               El Salvador 1972    3790903 58.20700   4520.2460
474               El Salvador 1977    4282586 56.69600   5138.9224
475               El Salvador 1982    4474873 56.60400   4098.3442
476               El Salvador 1987    4842194 63.15400   4140.4421
477               El Salvador 1992    5274649 66.79800   4444.2317
478               El Salvador 1997    5783439 69.53500   5154.8255
479               El Salvador 2002    6353681 70.73400   5351.5687
480               El Salvador 2007    6939688 71.87800   5728.3535
481         Equatorial Guinea 1952     216964 34.48200    375.6431
482         Equatorial Guinea 1957     232922 35.98300    426.0964
483         Equatorial Guinea 1962     249220 37.48500    582.8420
484         Equatorial Guinea 1967     259864 38.98700    915.5960
485         Equatorial Guinea 1972     277603 40.51600    672.4123
486         Equatorial Guinea 1977     192675 42.02400    958.5668
487         Equatorial Guinea 1982     285483 43.66200    927.8253
488         Equatorial Guinea 1987     341244 45.66400    966.8968
489         Equatorial Guinea 1992     387838 47.54500   1132.0550
490         Equatorial Guinea 1997     439971 48.24500   2814.4808
491         Equatorial Guinea 2002     495627 49.34800   7703.4959
492         Equatorial Guinea 2007     551201 51.57900  12154.0897
493                   Eritrea 1952    1438760 35.92800    328.9406
494                   Eritrea 1957    1542611 38.04700    344.1619
495                   Eritrea 1962    1666618 40.15800    380.9958
496                   Eritrea 1967    1820319 42.18900    468.7950
497                   Eritrea 1972    2260187 44.14200    514.3242
498                   Eritrea 1977    2512642 44.53500    505.7538
499                   Eritrea 1982    2637297 43.89000    524.8758
500                   Eritrea 1987    2915959 46.45300    521.1341
501                   Eritrea 1992    3668440 49.99100    582.8585
502                   Eritrea 1997    4058319 53.37800    913.4708
503                   Eritrea 2002    4414865 55.24000    765.3500
504                   Eritrea 2007    4906585 58.04000    641.3695
505                  Ethiopia 1952   20860941 34.07800    362.1463
506                  Ethiopia 1957   22815614 36.66700    378.9042
507                  Ethiopia 1962   25145372 40.05900    419.4564
508                  Ethiopia 1967   27860297 42.11500    516.1186
509                  Ethiopia 1972   30770372 43.51500    566.2439
510                  Ethiopia 1977   34617799 44.51000    556.8084
511                  Ethiopia 1982   38111756 44.91600    577.8607
512                  Ethiopia 1987   42999530 46.68400    573.7413
513                  Ethiopia 1992   52088559 48.09100    421.3535
514                  Ethiopia 1997   59861301 49.40200    515.8894
515                  Ethiopia 2002   67946797 50.72500    530.0535
516                  Ethiopia 2007   76511887 52.94700    690.8056
517                   Finland 1952    4090500 66.55000   6424.5191
518                   Finland 1957    4324000 67.49000   7545.4154
519                   Finland 1962    4491443 68.75000   9371.8426
520                   Finland 1967    4605744 69.83000  10921.6363
521                   Finland 1972    4639657 70.87000  14358.8759
522                   Finland 1977    4738902 72.52000  15605.4228
523                   Finland 1982    4826933 74.55000  18533.1576
524                   Finland 1987    4931729 74.83000  21141.0122
525                   Finland 1992    5041039 75.70000  20647.1650
526                   Finland 1997    5134406 77.13000  23723.9502
527                   Finland 2002    5193039 78.37000  28204.5906
528                   Finland 2007    5238460 79.31300  33207.0844
529                    France 1952   42459667 67.41000   7029.8093
530                    France 1957   44310863 68.93000   8662.8349
531                    France 1962   47124000 70.51000  10560.4855
532                    France 1967   49569000 71.55000  12999.9177
533                    France 1972   51732000 72.38000  16107.1917
534                    France 1977   53165019 73.83000  18292.6351
535                    France 1982   54433565 74.89000  20293.8975
536                    France 1987   55630100 76.34000  22066.4421
537                    France 1992   57374179 77.46000  24703.7961
538                    France 1997   58623428 78.64000  25889.7849
539                    France 2002   59925035 79.59000  28926.0323
540                    France 2007   61083916 80.65700  30470.0167
541                     Gabon 1952     420702 37.00300   4293.4765
542                     Gabon 1957     434904 38.99900   4976.1981
543                     Gabon 1962     455661 40.48900   6631.4592
544                     Gabon 1967     489004 44.59800   8358.7620
545                     Gabon 1972     537977 48.69000  11401.9484
546                     Gabon 1977     706367 52.79000  21745.5733
547                     Gabon 1982     753874 56.56400  15113.3619
548                     Gabon 1987     880397 60.19000  11864.4084
549                     Gabon 1992     985739 61.36600  13522.1575
550                     Gabon 1997    1126189 60.46100  14722.8419
551                     Gabon 2002    1299304 56.76100  12521.7139
552                     Gabon 2007    1454867 56.73500  13206.4845
553                    Gambia 1952     284320 30.00000    485.2307
554                    Gambia 1957     323150 32.06500    520.9267
555                    Gambia 1962     374020 33.89600    599.6503
556                    Gambia 1967     439593 35.85700    734.7829
557                    Gambia 1972     517101 38.30800    756.0868
558                    Gambia 1977     608274 41.84200    884.7553
559                    Gambia 1982     715523 45.58000    835.8096
560                    Gambia 1987     848406 49.26500    611.6589
561                    Gambia 1992    1025384 52.64400    665.6244
562                    Gambia 1997    1235767 55.86100    653.7302
563                    Gambia 2002    1457766 58.04100    660.5856
564                    Gambia 2007    1688359 59.44800    752.7497
565                   Germany 1952   69145952 67.50000   7144.1144
566                   Germany 1957   71019069 69.10000  10187.8267
567                   Germany 1962   73739117 70.30000  12902.4629
568                   Germany 1967   76368453 70.80000  14745.6256
569                   Germany 1972   78717088 71.00000  18016.1803
570                   Germany 1977   78160773 72.50000  20512.9212
571                   Germany 1982   78335266 73.80000  22031.5327
572                   Germany 1987   77718298 74.84700  24639.1857
573                   Germany 1992   80597764 76.07000  26505.3032
574                   Germany 1997   82011073 77.34000  27788.8842
575                   Germany 2002   82350671 78.67000  30035.8020
576                   Germany 2007   82400996 79.40600  32170.3744
577                     Ghana 1952    5581001 43.14900    911.2989
578                     Ghana 1957    6391288 44.77900   1043.5615
579                     Ghana 1962    7355248 46.45200   1190.0411
580                     Ghana 1967    8490213 48.07200   1125.6972
581                     Ghana 1972    9354120 49.87500   1178.2237
582                     Ghana 1977   10538093 51.75600    993.2240
583                     Ghana 1982   11400338 53.74400    876.0326
584                     Ghana 1987   14168101 55.72900    847.0061
585                     Ghana 1992   16278738 57.50100    925.0602
586                     Ghana 1997   18418288 58.55600   1005.2458
587                     Ghana 2002   20550751 58.45300   1111.9846
588                     Ghana 2007   22873338 60.02200   1327.6089
589                    Greece 1952    7733250 65.86000   3530.6901
590                    Greece 1957    8096218 67.86000   4916.2999
591                    Greece 1962    8448233 69.51000   6017.1907
592                    Greece 1967    8716441 71.00000   8513.0970
593                    Greece 1972    8888628 72.34000  12724.8296
594                    Greece 1977    9308479 73.68000  14195.5243
595                    Greece 1982    9786480 75.24000  15268.4209
596                    Greece 1987    9974490 76.67000  16120.5284
597                    Greece 1992   10325429 77.03000  17541.4963
598                    Greece 1997   10502372 77.86900  18747.6981
599                    Greece 2002   10603863 78.25600  22514.2548
600                    Greece 2007   10706290 79.48300  27538.4119
601                 Guatemala 1952    3146381 42.02300   2428.2378
602                 Guatemala 1957    3640876 44.14200   2617.1560
603                 Guatemala 1962    4208858 46.95400   2750.3644
604                 Guatemala 1967    4690773 50.01600   3242.5311
605                 Guatemala 1972    5149581 53.73800   4031.4083
606                 Guatemala 1977    5703430 56.02900   4879.9927
607                 Guatemala 1982    6395630 58.13700   4820.4948
608                 Guatemala 1987    7326406 60.78200   4246.4860
609                 Guatemala 1992    8486949 63.37300   4439.4508
610                 Guatemala 1997    9803875 66.32200   4684.3138
611                 Guatemala 2002   11178650 68.97800   4858.3475
612                 Guatemala 2007   12572928 70.25900   5186.0500
613                    Guinea 1952    2664249 33.60900    510.1965
614                    Guinea 1957    2876726 34.55800    576.2670
615                    Guinea 1962    3140003 35.75300    686.3737
616                    Guinea 1967    3451418 37.19700    708.7595
617                    Guinea 1972    3811387 38.84200    741.6662
618                    Guinea 1977    4227026 40.76200    874.6859
619                    Guinea 1982    4710497 42.89100    857.2504
620                    Guinea 1987    5650262 45.55200    805.5725
621                    Guinea 1992    6990574 48.57600    794.3484
622                    Guinea 1997    8048834 51.45500    869.4498
623                    Guinea 2002    8807818 53.67600    945.5836
624                    Guinea 2007    9947814 56.00700    942.6542
625             Guinea-Bissau 1952     580653 32.50000    299.8503
626             Guinea-Bissau 1957     601095 33.48900    431.7905
627             Guinea-Bissau 1962     627820 34.48800    522.0344
628             Guinea-Bissau 1967     601287 35.49200    715.5806
629             Guinea-Bissau 1972     625361 36.48600    820.2246
630             Guinea-Bissau 1977     745228 37.46500    764.7260
631             Guinea-Bissau 1982     825987 39.32700    838.1240
632             Guinea-Bissau 1987     927524 41.24500    736.4154
633             Guinea-Bissau 1992    1050938 43.26600    745.5399
634             Guinea-Bissau 1997    1193708 44.87300    796.6645
635             Guinea-Bissau 2002    1332459 45.50400    575.7047
636             Guinea-Bissau 2007    1472041 46.38800    579.2317
637                     Haiti 1952    3201488 37.57900   1840.3669
638                     Haiti 1957    3507701 40.69600   1726.8879
639                     Haiti 1962    3880130 43.59000   1796.5890
640                     Haiti 1967    4318137 46.24300   1452.0577
641                     Haiti 1972    4698301 48.04200   1654.4569
642                     Haiti 1977    4908554 49.92300   1874.2989
643                     Haiti 1982    5198399 51.46100   2011.1595
644                     Haiti 1987    5756203 53.63600   1823.0160
645                     Haiti 1992    6326682 55.08900   1456.3095
646                     Haiti 1997    6913545 56.67100   1341.7269
647                     Haiti 2002    7607651 58.13700   1270.3649
648                     Haiti 2007    8502814 60.91600   1201.6372
649                  Honduras 1952    1517453 41.91200   2194.9262
650                  Honduras 1957    1770390 44.66500   2220.4877
651                  Honduras 1962    2090162 48.04100   2291.1568
652                  Honduras 1967    2500689 50.92400   2538.2694
653                  Honduras 1972    2965146 53.88400   2529.8423
654                  Honduras 1977    3055235 57.40200   3203.2081
655                  Honduras 1982    3669448 60.90900   3121.7608
656                  Honduras 1987    4372203 64.49200   3023.0967
657                  Honduras 1992    5077347 66.39900   3081.6946
658                  Honduras 1997    5867957 67.65900   3160.4549
659                  Honduras 2002    6677328 68.56500   3099.7287
660                  Honduras 2007    7483763 70.19800   3548.3308
661           Hong Kong China 1952    2125900 60.96000   3054.4212
662           Hong Kong China 1957    2736300 64.75000   3629.0765
663           Hong Kong China 1962    3305200 67.65000   4692.6483
664           Hong Kong China 1967    3722800 70.00000   6197.9628
665           Hong Kong China 1972    4115700 72.00000   8315.9281
666           Hong Kong China 1977    4583700 73.60000  11186.1413
667           Hong Kong China 1982    5264500 75.45000  14560.5305
668           Hong Kong China 1987    5584510 76.20000  20038.4727
669           Hong Kong China 1992    5829696 77.60100  24757.6030
670           Hong Kong China 1997    6495918 80.00000  28377.6322
671           Hong Kong China 2002    6762476 81.49500  30209.0152
672           Hong Kong China 2007    6980412 82.20800  39724.9787
673                   Hungary 1952    9504000 64.03000   5263.6738
674                   Hungary 1957    9839000 66.41000   6040.1800
675                   Hungary 1962   10063000 67.96000   7550.3599
676                   Hungary 1967   10223422 69.50000   9326.6447
677                   Hungary 1972   10394091 69.76000  10168.6561
678                   Hungary 1977   10637171 69.95000  11674.8374
679                   Hungary 1982   10705535 69.39000  12545.9907
680                   Hungary 1987   10612740 69.58000  12986.4800
681                   Hungary 1992   10348684 69.17000  10535.6285
682                   Hungary 1997   10244684 71.04000  11712.7768
683                   Hungary 2002   10083313 72.59000  14843.9356
684                   Hungary 2007    9956108 73.33800  18008.9444
685                   Iceland 1952     147962 72.49000   7267.6884
686                   Iceland 1957     165110 73.47000   9244.0014
687                   Iceland 1962     182053 73.68000  10350.1591
688                   Iceland 1967     198676 73.73000  13319.8957
689                   Iceland 1972     209275 74.46000  15798.0636
690                   Iceland 1977     221823 76.11000  19654.9625
691                   Iceland 1982     233997 76.99000  23269.6075
692                   Iceland 1987     244676 77.23000  26923.2063
693                   Iceland 1992     259012 78.77000  25144.3920
694                   Iceland 1997     271192 78.95000  28061.0997
695                   Iceland 2002     288030 80.50000  31163.2020
696                   Iceland 2007     301931 81.75700  36180.7892
697                     India 1952  372000000 37.37300    546.5657
698                     India 1957  409000000 40.24900    590.0620
699                     India 1962  454000000 43.60500    658.3472
700                     India 1967  506000000 47.19300    700.7706
701                     India 1972  567000000 50.65100    724.0325
702                     India 1977  634000000 54.20800    813.3373
703                     India 1982  708000000 56.59600    855.7235
704                     India 1987  788000000 58.55300    976.5127
705                     India 1992  872000000 60.22300   1164.4068
706                     India 1997  959000000 61.76500   1458.8174
707                     India 2002 1034172547 62.87900   1746.7695
708                     India 2007 1110396331 64.69800   2452.2104
709                 Indonesia 1952   82052000 37.46800    749.6817
710                 Indonesia 1957   90124000 39.91800    858.9003
711                 Indonesia 1962   99028000 42.51800    849.2898
712                 Indonesia 1967  109343000 45.96400    762.4318
713                 Indonesia 1972  121282000 49.20300   1111.1079
714                 Indonesia 1977  136725000 52.70200   1382.7021
715                 Indonesia 1982  153343000 56.15900   1516.8730
716                 Indonesia 1987  169276000 60.13700   1748.3570
717                 Indonesia 1992  184816000 62.68100   2383.1409
718                 Indonesia 1997  199278000 66.04100   3119.3356
719                 Indonesia 2002  211060000 68.58800   2873.9129
720                 Indonesia 2007  223547000 70.65000   3540.6516
721                      Iran 1952   17272000 44.86900   3035.3260
722                      Iran 1957   19792000 47.18100   3290.2576
723                      Iran 1962   22874000 49.32500   4187.3298
724                      Iran 1967   26538000 52.46900   5906.7318
725                      Iran 1972   30614000 55.23400   9613.8186
726                      Iran 1977   35480679 57.70200  11888.5951
727                      Iran 1982   43072751 59.62000   7608.3346
728                      Iran 1987   51889696 63.04000   6642.8814
729                      Iran 1992   60397973 65.74200   7235.6532
730                      Iran 1997   63327987 68.04200   8263.5903
731                      Iran 2002   66907826 69.45100   9240.7620
732                      Iran 2007   69453570 70.96400  11605.7145
733                      Iraq 1952    5441766 45.32000   4129.7661
734                      Iraq 1957    6248643 48.43700   6229.3336
735                      Iraq 1962    7240260 51.45700   8341.7378
736                      Iraq 1967    8519282 54.45900   8931.4598
737                      Iraq 1972   10061506 56.95000   9576.0376
738                      Iraq 1977   11882916 60.41300  14688.2351
739                      Iraq 1982   14173318 62.03800  14517.9071
740                      Iraq 1987   16543189 65.04400  11643.5727
741                      Iraq 1992   17861905 59.46100   3745.6407
742                      Iraq 1997   20775703 58.81100   3076.2398
743                      Iraq 2002   24001816 57.04600   4390.7173
744                      Iraq 2007   27499638 59.54500   4471.0619
745                   Ireland 1952    2952156 66.91000   5210.2803
746                   Ireland 1957    2878220 68.90000   5599.0779
747                   Ireland 1962    2830000 70.29000   6631.5973
748                   Ireland 1967    2900100 71.08000   7655.5690
749                   Ireland 1972    3024400 71.28000   9530.7729
750                   Ireland 1977    3271900 72.03000  11150.9811
751                   Ireland 1982    3480000 73.10000  12618.3214
752                   Ireland 1987    3539900 74.36000  13872.8665
753                   Ireland 1992    3557761 75.46700  17558.8155
754                   Ireland 1997    3667233 76.12200  24521.9471
755                   Ireland 2002    3879155 77.78300  34077.0494
756                   Ireland 2007    4109086 78.88500  40675.9964
757                    Israel 1952    1620914 65.39000   4086.5221
758                    Israel 1957    1944401 67.84000   5385.2785
759                    Israel 1962    2310904 69.39000   7105.6307
760                    Israel 1967    2693585 70.75000   8393.7414
761                    Israel 1972    3095893 71.63000  12786.9322
762                    Israel 1977    3495918 73.06000  13306.6192
763                    Israel 1982    3858421 74.45000  15367.0292
764                    Israel 1987    4203148 75.60000  17122.4799
765                    Israel 1992    4936550 76.93000  18051.5225
766                    Israel 1997    5531387 78.26900  20896.6092
767                    Israel 2002    6029529 79.69600  21905.5951
768                    Israel 2007    6426679 80.74500  25523.2771
769                     Italy 1952   47666000 65.94000   4931.4042
770                     Italy 1957   49182000 67.81000   6248.6562
771                     Italy 1962   50843200 69.24000   8243.5823
772                     Italy 1967   52667100 71.06000  10022.4013
773                     Italy 1972   54365564 72.19000  12269.2738
774                     Italy 1977   56059245 73.48000  14255.9847
775                     Italy 1982   56535636 74.98000  16537.4835
776                     Italy 1987   56729703 76.42000  19207.2348
777                     Italy 1992   56840847 77.44000  22013.6449
778                     Italy 1997   57479469 78.82000  24675.0245
779                     Italy 2002   57926999 80.24000  27968.0982
780                     Italy 2007   58147733 80.54600  28569.7197
781                   Jamaica 1952    1426095 58.53000   2898.5309
782                   Jamaica 1957    1535090 62.61000   4756.5258
783                   Jamaica 1962    1665128 65.61000   5246.1075
784                   Jamaica 1967    1861096 67.51000   6124.7035
785                   Jamaica 1972    1997616 69.00000   7433.8893
786                   Jamaica 1977    2156814 70.11000   6650.1956
787                   Jamaica 1982    2298309 71.21000   6068.0513
788                   Jamaica 1987    2326606 71.77000   6351.2375
789                   Jamaica 1992    2378618 71.76600   7404.9237
790                   Jamaica 1997    2531311 72.26200   7121.9247
791                   Jamaica 2002    2664659 72.04700   6994.7749
792                   Jamaica 2007    2780132 72.56700   7320.8803
793                     Japan 1952   86459025 63.03000   3216.9563
794                     Japan 1957   91563009 65.50000   4317.6944
795                     Japan 1962   95831757 68.73000   6576.6495
796                     Japan 1967  100825279 71.43000   9847.7886
797                     Japan 1972  107188273 73.42000  14778.7864
798                     Japan 1977  113872473 75.38000  16610.3770
799                     Japan 1982  118454974 77.11000  19384.1057
800                     Japan 1987  122091325 78.67000  22375.9419
801                     Japan 1992  124329269 79.36000  26824.8951
802                     Japan 1997  125956499 80.69000  28816.5850
803                     Japan 2002  127065841 82.00000  28604.5919
804                     Japan 2007  127467972 82.60300  31656.0681
805                    Jordan 1952     607914 43.15800   1546.9078
806                    Jordan 1957     746559 45.66900   1886.0806
807                    Jordan 1962     933559 48.12600   2348.0092
808                    Jordan 1967    1255058 51.62900   2741.7963
809                    Jordan 1972    1613551 56.52800   2110.8563
810                    Jordan 1977    1937652 61.13400   2852.3516
811                    Jordan 1982    2347031 63.73900   4161.4160
812                    Jordan 1987    2820042 65.86900   4448.6799
813                    Jordan 1992    3867409 68.01500   3431.5936
814                    Jordan 1997    4526235 69.77200   3645.3796
815                    Jordan 2002    5307470 71.26300   3844.9172
816                    Jordan 2007    6053193 72.53500   4519.4612
817                     Kenya 1952    6464046 42.27000    853.5409
818                     Kenya 1957    7454779 44.68600    944.4383
819                     Kenya 1962    8678557 47.94900    896.9664
820                     Kenya 1967   10191512 50.65400   1056.7365
821                     Kenya 1972   12044785 53.55900   1222.3600
822                     Kenya 1977   14500404 56.15500   1267.6132
823                     Kenya 1982   17661452 58.76600   1348.2258
824                     Kenya 1987   21198082 59.33900   1361.9369
825                     Kenya 1992   25020539 59.28500   1341.9217
826                     Kenya 1997   28263827 54.40700   1360.4850
827                     Kenya 2002   31386842 50.99200   1287.5147
828                     Kenya 2007   35610177 54.11000   1463.2493
829           Korea Dem. Rep. 1952    8865488 50.05600   1088.2778
830           Korea Dem. Rep. 1957    9411381 54.08100   1571.1347
831           Korea Dem. Rep. 1962   10917494 56.65600   1621.6936
832           Korea Dem. Rep. 1967   12617009 59.94200   2143.5406
833           Korea Dem. Rep. 1972   14781241 63.98300   3701.6215
834           Korea Dem. Rep. 1977   16325320 67.15900   4106.3012
835           Korea Dem. Rep. 1982   17647518 69.10000   4106.5253
836           Korea Dem. Rep. 1987   19067554 70.64700   4106.4923
837           Korea Dem. Rep. 1992   20711375 69.97800   3726.0635
838           Korea Dem. Rep. 1997   21585105 67.72700   1690.7568
839           Korea Dem. Rep. 2002   22215365 66.66200   1646.7582
840           Korea Dem. Rep. 2007   23301725 67.29700   1593.0655
841                Korea Rep. 1952   20947571 47.45300   1030.5922
842                Korea Rep. 1957   22611552 52.68100   1487.5935
843                Korea Rep. 1962   26420307 55.29200   1536.3444
844                Korea Rep. 1967   30131000 57.71600   2029.2281
845                Korea Rep. 1972   33505000 62.61200   3030.8767
846                Korea Rep. 1977   36436000 64.76600   4657.2210
847                Korea Rep. 1982   39326000 67.12300   5622.9425
848                Korea Rep. 1987   41622000 69.81000   8533.0888
849                Korea Rep. 1992   43805450 72.24400  12104.2787
850                Korea Rep. 1997   46173816 74.64700  15993.5280
851                Korea Rep. 2002   47969150 77.04500  19233.9882
852                Korea Rep. 2007   49044790 78.62300  23348.1397
853                    Kuwait 1952     160000 55.56500 108382.3529
854                    Kuwait 1957     212846 58.03300 113523.1329
855                    Kuwait 1962     358266 60.47000  95458.1118
856                    Kuwait 1967     575003 64.62400  80894.8833
857                    Kuwait 1972     841934 67.71200 109347.8670
858                    Kuwait 1977    1140357 69.34300  59265.4771
859                    Kuwait 1982    1497494 71.30900  31354.0357
860                    Kuwait 1987    1891487 74.17400  28118.4300
861                    Kuwait 1992    1418095 75.19000  34932.9196
862                    Kuwait 1997    1765345 76.15600  40300.6200
863                    Kuwait 2002    2111561 76.90400  35110.1057
864                    Kuwait 2007    2505559 77.58800  47306.9898
865                   Lebanon 1952    1439529 55.92800   4834.8041
866                   Lebanon 1957    1647412 59.48900   6089.7869
867                   Lebanon 1962    1886848 62.09400   5714.5606
868                   Lebanon 1967    2186894 63.87000   6006.9830
869                   Lebanon 1972    2680018 65.42100   7486.3843
870                   Lebanon 1977    3115787 66.09900   8659.6968
871                   Lebanon 1982    3086876 66.98300   7640.5195
872                   Lebanon 1987    3089353 67.92600   5377.0913
873                   Lebanon 1992    3219994 69.29200   6890.8069
874                   Lebanon 1997    3430388 70.26500   8754.9639
875                   Lebanon 2002    3677780 71.02800   9313.9388
876                   Lebanon 2007    3921278 71.99300  10461.0587
877                   Lesotho 1952     748747 42.13800    298.8462
878                   Lesotho 1957     813338 45.04700    335.9971
879                   Lesotho 1962     893143 47.74700    411.8006
880                   Lesotho 1967     996380 48.49200    498.6390
881                   Lesotho 1972    1116779 49.76700    496.5816
882                   Lesotho 1977    1251524 52.20800    745.3695
883                   Lesotho 1982    1411807 55.07800    797.2631
884                   Lesotho 1987    1599200 57.18000    773.9932
885                   Lesotho 1992    1803195 59.68500    977.4863
886                   Lesotho 1997    1982823 55.55800   1186.1480
887                   Lesotho 2002    2046772 44.59300   1275.1846
888                   Lesotho 2007    2012649 42.59200   1569.3314
889                   Liberia 1952     863308 38.48000    575.5730
890                   Liberia 1957     975950 39.48600    620.9700
891                   Liberia 1962    1112796 40.50200    634.1952
892                   Liberia 1967    1279406 41.53600    713.6036
893                   Liberia 1972    1482628 42.61400    803.0055
894                   Liberia 1977    1703617 43.76400    640.3224
895                   Liberia 1982    1956875 44.85200    572.1996
896                   Liberia 1987    2269414 46.02700    506.1139
897                   Liberia 1992    1912974 40.80200    636.6229
898                   Liberia 1997    2200725 42.22100    609.1740
899                   Liberia 2002    2814651 43.75300    531.4824
900                   Liberia 2007    3193942 45.67800    414.5073
901                     Libya 1952    1019729 42.72300   2387.5481
902                     Libya 1957    1201578 45.28900   3448.2844
903                     Libya 1962    1441863 47.80800   6757.0308
904                     Libya 1967    1759224 50.22700  18772.7517
905                     Libya 1972    2183877 52.77300  21011.4972
906                     Libya 1977    2721783 57.44200  21951.2118
907                     Libya 1982    3344074 62.15500  17364.2754
908                     Libya 1987    3799845 66.23400  11770.5898
909                     Libya 1992    4364501 68.75500   9640.1385
910                     Libya 1997    4759670 71.55500   9467.4461
911                     Libya 2002    5368585 72.73700   9534.6775
912                     Libya 2007    6036914 73.95200  12057.4993
913                Madagascar 1952    4762912 36.68100   1443.0117
914                Madagascar 1957    5181679 38.86500   1589.2027
915                Madagascar 1962    5703324 40.84800   1643.3871
916                Madagascar 1967    6334556 42.88100   1634.0473
917                Madagascar 1972    7082430 44.85100   1748.5630
918                Madagascar 1977    8007166 46.88100   1544.2286
919                Madagascar 1982    9171477 48.96900   1302.8787
920                Madagascar 1987   10568642 49.35000   1155.4419
921                Madagascar 1992   12210395 52.21400   1040.6762
922                Madagascar 1997   14165114 54.97800    986.2959
923                Madagascar 2002   16473477 57.28600    894.6371
924                Madagascar 2007   19167654 59.44300   1044.7701
925                    Malawi 1952    2917802 36.25600    369.1651
926                    Malawi 1957    3221238 37.20700    416.3698
927                    Malawi 1962    3628608 38.41000    427.9011
928                    Malawi 1967    4147252 39.48700    495.5148
929                    Malawi 1972    4730997 41.76600    584.6220
930                    Malawi 1977    5637246 43.76700    663.2237
931                    Malawi 1982    6502825 45.64200    632.8039
932                    Malawi 1987    7824747 47.45700    635.5174
933                    Malawi 1992   10014249 49.42000    563.2000
934                    Malawi 1997   10419991 47.49500    692.2758
935                    Malawi 2002   11824495 45.00900    665.4231
936                    Malawi 2007   13327079 48.30300    759.3499
937                  Malaysia 1952    6748378 48.46300   1831.1329
938                  Malaysia 1957    7739235 52.10200   1810.0670
939                  Malaysia 1962    8906385 55.73700   2036.8849
940                  Malaysia 1967   10154878 59.37100   2277.7424
941                  Malaysia 1972   11441462 63.01000   2849.0948
942                  Malaysia 1977   12845381 65.25600   3827.9216
943                  Malaysia 1982   14441916 68.00000   4920.3560
944                  Malaysia 1987   16331785 69.50000   5249.8027
945                  Malaysia 1992   18319502 70.69300   7277.9128
946                  Malaysia 1997   20476091 71.93800  10132.9096
947                  Malaysia 2002   22662365 73.04400  10206.9779
948                  Malaysia 2007   24821286 74.24100  12451.6558
949                      Mali 1952    3838168 33.68500    452.3370
950                      Mali 1957    4241884 35.30700    490.3822
951                      Mali 1962    4690372 36.93600    496.1743
952                      Mali 1967    5212416 38.48700    545.0099
953                      Mali 1972    5828158 39.97700    581.3689
954                      Mali 1977    6491649 41.71400    686.3953
955                      Mali 1982    6998256 43.91600    618.0141
956                      Mali 1987    7634008 46.36400    684.1716
957                      Mali 1992    8416215 48.38800    739.0144
958                      Mali 1997    9384984 49.90300    790.2580
959                      Mali 2002   10580176 51.81800    951.4098
960                      Mali 2007   12031795 54.46700   1042.5816
961                Mauritania 1952    1022556 40.54300    743.1159
962                Mauritania 1957    1076852 42.33800    846.1203
963                Mauritania 1962    1146757 44.24800   1055.8960
964                Mauritania 1967    1230542 46.28900   1421.1452
965                Mauritania 1972    1332786 48.43700   1586.8518
966                Mauritania 1977    1456688 50.85200   1497.4922
967                Mauritania 1982    1622136 53.59900   1481.1502
968                Mauritania 1987    1841240 56.14500   1421.6036
969                Mauritania 1992    2119465 58.33300   1361.3698
970                Mauritania 1997    2444741 60.43000   1483.1361
971                Mauritania 2002    2828858 62.24700   1579.0195
972                Mauritania 2007    3270065 64.16400   1803.1515
973                 Mauritius 1952     516556 50.98600   1967.9557
974                 Mauritius 1957     609816 58.08900   2034.0380
975                 Mauritius 1962     701016 60.24600   2529.0675
976                 Mauritius 1967     789309 61.55700   2475.3876
977                 Mauritius 1972     851334 62.94400   2575.4842
978                 Mauritius 1977     913025 64.93000   3710.9830
979                 Mauritius 1982     992040 66.71100   3688.0377
980                 Mauritius 1987    1042663 68.74000   4783.5869
981                 Mauritius 1992    1096202 69.74500   6058.2538
982                 Mauritius 1997    1149818 70.73600   7425.7053
983                 Mauritius 2002    1200206 71.95400   9021.8159
984                 Mauritius 2007    1250882 72.80100  10956.9911
985                    Mexico 1952   30144317 50.78900   3478.1255
986                    Mexico 1957   35015548 55.19000   4131.5466
987                    Mexico 1962   41121485 58.29900   4581.6094
988                    Mexico 1967   47995559 60.11000   5754.7339
989                    Mexico 1972   55984294 62.36100   6809.4067
990                    Mexico 1977   63759976 65.03200   7674.9291
991                    Mexico 1982   71640904 67.40500   9611.1475
992                    Mexico 1987   80122492 69.49800   8688.1560
993                    Mexico 1992   88111030 71.45500   9472.3843
994                    Mexico 1997   95895146 73.67000   9767.2975
995                    Mexico 2002  102479927 74.90200  10742.4405
996                    Mexico 2007  108700891 76.19500  11977.5750
997                  Mongolia 1952     800663 42.24400    786.5669
998                  Mongolia 1957     882134 45.24800    912.6626
999                  Mongolia 1962    1010280 48.25100   1056.3540
1000                 Mongolia 1967    1149500 51.25300   1226.0411
1001                 Mongolia 1972    1320500 53.75400   1421.7420
1002                 Mongolia 1977    1528000 55.49100   1647.5117
1003                 Mongolia 1982    1756032 57.48900   2000.6031
1004                 Mongolia 1987    2015133 60.22200   2338.0083
1005                 Mongolia 1992    2312802 61.27100   1785.4020
1006                 Mongolia 1997    2494803 63.62500   1902.2521
1007                 Mongolia 2002    2674234 65.03300   2140.7393
1008                 Mongolia 2007    2874127 66.80300   3095.7723
1009               Montenegro 1952     413834 59.16400   2647.5856
1010               Montenegro 1957     442829 61.44800   3682.2599
1011               Montenegro 1962     474528 63.72800   4649.5938
1012               Montenegro 1967     501035 67.17800   5907.8509
1013               Montenegro 1972     527678 70.63600   7778.4140
1014               Montenegro 1977     560073 73.06600   9595.9299
1015               Montenegro 1982     562548 74.10100  11222.5876
1016               Montenegro 1987     569473 74.86500  11732.5102
1017               Montenegro 1992     621621 75.43500   7003.3390
1018               Montenegro 1997     692651 75.44500   6465.6133
1019               Montenegro 2002     720230 73.98100   6557.1943
1020               Montenegro 2007     684736 74.54300   9253.8961
1021                  Morocco 1952    9939217 42.87300   1688.2036
1022                  Morocco 1957   11406350 45.42300   1642.0023
1023                  Morocco 1962   13056604 47.92400   1566.3535
1024                  Morocco 1967   14770296 50.33500   1711.0448
1025                  Morocco 1972   16660670 52.86200   1930.1950
1026                  Morocco 1977   18396941 55.73000   2370.6200
1027                  Morocco 1982   20198730 59.65000   2702.6204
1028                  Morocco 1987   22987397 62.67700   2755.0470
1029                  Morocco 1992   25798239 65.39300   2948.0473
1030                  Morocco 1997   28529501 67.66000   2982.1019
1031                  Morocco 2002   31167783 69.61500   3258.4956
1032                  Morocco 2007   33757175 71.16400   3820.1752
1033               Mozambique 1952    6446316 31.28600    468.5260
1034               Mozambique 1957    7038035 33.77900    495.5868
1035               Mozambique 1962    7788944 36.16100    556.6864
1036               Mozambique 1967    8680909 38.11300    566.6692
1037               Mozambique 1972    9809596 40.32800    724.9178
1038               Mozambique 1977   11127868 42.49500    502.3197
1039               Mozambique 1982   12587223 42.79500    462.2114
1040               Mozambique 1987   12891952 42.86100    389.8762
1041               Mozambique 1992   13160731 44.28400    410.8968
1042               Mozambique 1997   16603334 46.34400    472.3461
1043               Mozambique 2002   18473780 44.02600    633.6179
1044               Mozambique 2007   19951656 42.08200    823.6856
1045                  Myanmar 1952   20092996 36.31900    331.0000
1046                  Myanmar 1957   21731844 41.90500    350.0000
1047                  Myanmar 1962   23634436 45.10800    388.0000
1048                  Myanmar 1967   25870271 49.37900    349.0000
1049                  Myanmar 1972   28466390 53.07000    357.0000
1050                  Myanmar 1977   31528087 56.05900    371.0000
1051                  Myanmar 1982   34680442 58.05600    424.0000
1052                  Myanmar 1987   38028578 58.33900    385.0000
1053                  Myanmar 1992   40546538 59.32000    347.0000
1054                  Myanmar 1997   43247867 60.32800    415.0000
1055                  Myanmar 2002   45598081 59.90800    611.0000
1056                  Myanmar 2007   47761980 62.06900    944.0000
1057                  Namibia 1952     485831 41.72500   2423.7804
1058                  Namibia 1957     548080 45.22600   2621.4481
1059                  Namibia 1962     621392 48.38600   3173.2156
1060                  Namibia 1967     706640 51.15900   3793.6948
1061                  Namibia 1972     821782 53.86700   3746.0809
1062                  Namibia 1977     977026 56.43700   3876.4860
1063                  Namibia 1982    1099010 58.96800   4191.1005
1064                  Namibia 1987    1278184 60.83500   3693.7313
1065                  Namibia 1992    1554253 61.99900   3804.5380
1066                  Namibia 1997    1774766 58.90900   3899.5243
1067                  Namibia 2002    1972153 51.47900   4072.3248
1068                  Namibia 2007    2055080 52.90600   4811.0604
1069                    Nepal 1952    9182536 36.15700    545.8657
1070                    Nepal 1957    9682338 37.68600    597.9364
1071                    Nepal 1962   10332057 39.39300    652.3969
1072                    Nepal 1967   11261690 41.47200    676.4422
1073                    Nepal 1972   12412593 43.97100    674.7881
1074                    Nepal 1977   13933198 46.74800    694.1124
1075                    Nepal 1982   15796314 49.59400    718.3731
1076                    Nepal 1987   17917180 52.53700    775.6325
1077                    Nepal 1992   20326209 55.72700    897.7404
1078                    Nepal 1997   23001113 59.42600   1010.8921
1079                    Nepal 2002   25873917 61.34000   1057.2063
1080                    Nepal 2007   28901790 63.78500   1091.3598
1081              Netherlands 1952   10381988 72.13000   8941.5719
1082              Netherlands 1957   11026383 72.99000  11276.1934
1083              Netherlands 1962   11805689 73.23000  12790.8496
1084              Netherlands 1967   12596822 73.82000  15363.2514
1085              Netherlands 1972   13329874 73.75000  18794.7457
1086              Netherlands 1977   13852989 75.24000  21209.0592
1087              Netherlands 1982   14310401 76.05000  21399.4605
1088              Netherlands 1987   14665278 76.83000  23651.3236
1089              Netherlands 1992   15174244 77.42000  26790.9496
1090              Netherlands 1997   15604464 78.03000  30246.1306
1091              Netherlands 2002   16122830 78.53000  33724.7578
1092              Netherlands 2007   16570613 79.76200  36797.9333
1093              New Zealand 1952    1994794 69.39000  10556.5757
1094              New Zealand 1957    2229407 70.26000  12247.3953
1095              New Zealand 1962    2488550 71.24000  13175.6780
1096              New Zealand 1967    2728150 71.52000  14463.9189
1097              New Zealand 1972    2929100 71.89000  16046.0373
1098              New Zealand 1977    3164900 72.22000  16233.7177
1099              New Zealand 1982    3210650 73.84000  17632.4104
1100              New Zealand 1987    3317166 74.32000  19007.1913
1101              New Zealand 1992    3437674 76.33000  18363.3249
1102              New Zealand 1997    3676187 77.55000  21050.4138
1103              New Zealand 2002    3908037 79.11000  23189.8014
1104              New Zealand 2007    4115771 80.20400  25185.0091
1105                Nicaragua 1952    1165790 42.31400   3112.3639
1106                Nicaragua 1957    1358828 45.43200   3457.4159
1107                Nicaragua 1962    1590597 48.63200   3634.3644
1108                Nicaragua 1967    1865490 51.88400   4643.3935
1109                Nicaragua 1972    2182908 55.15100   4688.5933
1110                Nicaragua 1977    2554598 57.47000   5486.3711
1111                Nicaragua 1982    2979423 59.29800   3470.3382
1112                Nicaragua 1987    3344353 62.00800   2955.9844
1113                Nicaragua 1992    4017939 65.84300   2170.1517
1114                Nicaragua 1997    4609572 68.42600   2253.0230
1115                Nicaragua 2002    5146848 70.83600   2474.5488
1116                Nicaragua 2007    5675356 72.89900   2749.3210
1117                    Niger 1952    3379468 37.44400    761.8794
1118                    Niger 1957    3692184 38.59800    835.5234
1119                    Niger 1962    4076008 39.48700    997.7661
1120                    Niger 1967    4534062 40.11800   1054.3849
1121                    Niger 1972    5060262 40.54600    954.2092
1122                    Niger 1977    5682086 41.29100    808.8971
1123                    Niger 1982    6437188 42.59800    909.7221
1124                    Niger 1987    7332638 44.55500    668.3000
1125                    Niger 1992    8392818 47.39100    581.1827
1126                    Niger 1997    9666252 51.31300    580.3052
1127                    Niger 2002   11140655 54.49600    601.0745
1128                    Niger 2007   12894865 56.86700    619.6769
1129                  Nigeria 1952   33119096 36.32400   1077.2819
1130                  Nigeria 1957   37173340 37.80200   1100.5926
1131                  Nigeria 1962   41871351 39.36000   1150.9275
1132                  Nigeria 1967   47287752 41.04000   1014.5141
1133                  Nigeria 1972   53740085 42.82100   1698.3888
1134                  Nigeria 1977   62209173 44.51400   1981.9518
1135                  Nigeria 1982   73039376 45.82600   1576.9738
1136                  Nigeria 1987   81551520 46.88600   1385.0296
1137                  Nigeria 1992   93364244 47.47200   1619.8482
1138                  Nigeria 1997  106207839 47.46400   1624.9413
1139                  Nigeria 2002  119901274 46.60800   1615.2864
1140                  Nigeria 2007  135031164 46.85900   2013.9773
1141                   Norway 1952    3327728 72.67000  10095.4217
1142                   Norway 1957    3491938 73.44000  11653.9730
1143                   Norway 1962    3638919 73.47000  13450.4015
1144                   Norway 1967    3786019 74.08000  16361.8765
1145                   Norway 1972    3933004 74.34000  18965.0555
1146                   Norway 1977    4043205 75.37000  23311.3494
1147                   Norway 1982    4114787 75.97000  26298.6353
1148                   Norway 1987    4186147 75.89000  31540.9748
1149                   Norway 1992    4286357 77.32000  33965.6611
1150                   Norway 1997    4405672 78.32000  41283.1643
1151                   Norway 2002    4535591 79.05000  44683.9753
1152                   Norway 2007    4627926 80.19600  49357.1902
1153                     Oman 1952     507833 37.57800   1828.2303
1154                     Oman 1957     561977 40.08000   2242.7466
1155                     Oman 1962     628164 43.16500   2924.6381
1156                     Oman 1967     714775 46.98800   4720.9427
1157                     Oman 1972     829050 52.14300  10618.0385
1158                     Oman 1977    1004533 57.36700  11848.3439
1159                     Oman 1982    1301048 62.72800  12954.7910
1160                     Oman 1987    1593882 67.73400  18115.2231
1161                     Oman 1992    1915208 71.19700  18616.7069
1162                     Oman 1997    2283635 72.49900  19702.0558
1163                     Oman 2002    2713462 74.19300  19774.8369
1164                     Oman 2007    3204897 75.64000  22316.1929
1165                 Pakistan 1952   41346560 43.43600    684.5971
1166                 Pakistan 1957   46679944 45.55700    747.0835
1167                 Pakistan 1962   53100671 47.67000    803.3427
1168                 Pakistan 1967   60641899 49.80000    942.4083
1169                 Pakistan 1972   69325921 51.92900   1049.9390
1170                 Pakistan 1977   78152686 54.04300   1175.9212
1171                 Pakistan 1982   91462088 56.15800   1443.4298
1172                 Pakistan 1987  105186881 58.24500   1704.6866
1173                 Pakistan 1992  120065004 60.83800   1971.8295
1174                 Pakistan 1997  135564834 61.81800   2049.3505
1175                 Pakistan 2002  153403524 63.61000   2092.7124
1176                 Pakistan 2007  169270617 65.48300   2605.9476
1177                   Panama 1952     940080 55.19100   2480.3803
1178                   Panama 1957    1063506 59.20100   2961.8009
1179                   Panama 1962    1215725 61.81700   3536.5403
1180                   Panama 1967    1405486 64.07100   4421.0091
1181                   Panama 1972    1616384 66.21600   5364.2497
1182                   Panama 1977    1839782 68.68100   5351.9121
1183                   Panama 1982    2036305 70.47200   7009.6016
1184                   Panama 1987    2253639 71.52300   7034.7792
1185                   Panama 1992    2484997 72.46200   6618.7431
1186                   Panama 1997    2734531 73.73800   7113.6923
1187                   Panama 2002    2990875 74.71200   7356.0319
1188                   Panama 2007    3242173 75.53700   9809.1856
1189                 Paraguay 1952    1555876 62.64900   1952.3087
1190                 Paraguay 1957    1770902 63.19600   2046.1547
1191                 Paraguay 1962    2009813 64.36100   2148.0271
1192                 Paraguay 1967    2287985 64.95100   2299.3763
1193                 Paraguay 1972    2614104 65.81500   2523.3380
1194                 Paraguay 1977    2984494 66.35300   3248.3733
1195                 Paraguay 1982    3366439 66.87400   4258.5036
1196                 Paraguay 1987    3886512 67.37800   3998.8757
1197                 Paraguay 1992    4483945 68.22500   4196.4111
1198                 Paraguay 1997    5154123 69.40000   4247.4003
1199                 Paraguay 2002    5884491 70.75500   3783.6742
1200                 Paraguay 2007    6667147 71.75200   4172.8385
1201                     Peru 1952    8025700 43.90200   3758.5234
1202                     Peru 1957    9146100 46.26300   4245.2567
1203                     Peru 1962   10516500 49.09600   4957.0380
1204                     Peru 1967   12132200 51.44500   5788.0933
1205                     Peru 1972   13954700 55.44800   5937.8273
1206                     Peru 1977   15990099 58.44700   6281.2909
1207                     Peru 1982   18125129 61.40600   6434.5018
1208                     Peru 1987   20195924 64.13400   6360.9434
1209                     Peru 1992   22430449 66.45800   4446.3809
1210                     Peru 1997   24748122 68.38600   5838.3477
1211                     Peru 2002   26769436 69.90600   5909.0201
1212                     Peru 2007   28674757 71.42100   7408.9056
1213              Philippines 1952   22438691 47.75200   1272.8810
1214              Philippines 1957   26072194 51.33400   1547.9448
1215              Philippines 1962   30325264 54.75700   1649.5522
1216              Philippines 1967   35356600 56.39300   1814.1274
1217              Philippines 1972   40850141 58.06500   1989.3741
1218              Philippines 1977   46850962 60.06000   2373.2043
1219              Philippines 1982   53456774 62.08200   2603.2738
1220              Philippines 1987   60017788 64.15100   2189.6350
1221              Philippines 1992   67185766 66.45800   2279.3240
1222              Philippines 1997   75012988 68.56400   2536.5349
1223              Philippines 2002   82995088 70.30300   2650.9211
1224              Philippines 2007   91077287 71.68800   3190.4810
1225                   Poland 1952   25730551 61.31000   4029.3297
1226                   Poland 1957   28235346 65.77000   4734.2530
1227                   Poland 1962   30329617 67.64000   5338.7521
1228                   Poland 1967   31785378 69.61000   6557.1528
1229                   Poland 1972   33039545 70.85000   8006.5070
1230                   Poland 1977   34621254 70.67000   9508.1415
1231                   Poland 1982   36227381 71.32000   8451.5310
1232                   Poland 1987   37740710 70.98000   9082.3512
1233                   Poland 1992   38370697 70.99000   7738.8812
1234                   Poland 1997   38654957 72.75000  10159.5837
1235                   Poland 2002   38625976 74.67000  12002.2391
1236                   Poland 2007   38518241 75.56300  15389.9247
1237                 Portugal 1952    8526050 59.82000   3068.3199
1238                 Portugal 1957    8817650 61.51000   3774.5717
1239                 Portugal 1962    9019800 64.39000   4727.9549
1240                 Portugal 1967    9103000 66.60000   6361.5180
1241                 Portugal 1972    8970450 69.26000   9022.2474
1242                 Portugal 1977    9662600 70.41000  10172.4857
1243                 Portugal 1982    9859650 72.77000  11753.8429
1244                 Portugal 1987    9915289 74.06000  13039.3088
1245                 Portugal 1992    9927680 74.86000  16207.2666
1246                 Portugal 1997   10156415 75.97000  17641.0316
1247                 Portugal 2002   10433867 77.29000  19970.9079
1248                 Portugal 2007   10642836 78.09800  20509.6478
1249              Puerto Rico 1952    2227000 64.28000   3081.9598
1250              Puerto Rico 1957    2260000 68.54000   3907.1562
1251              Puerto Rico 1962    2448046 69.62000   5108.3446
1252              Puerto Rico 1967    2648961 71.10000   6929.2777
1253              Puerto Rico 1972    2847132 72.16000   9123.0417
1254              Puerto Rico 1977    3080828 73.44000   9770.5249
1255              Puerto Rico 1982    3279001 73.75000  10330.9891
1256              Puerto Rico 1987    3444468 74.63000  12281.3419
1257              Puerto Rico 1992    3585176 73.91100  14641.5871
1258              Puerto Rico 1997    3759430 74.91700  16999.4333
1259              Puerto Rico 2002    3859606 77.77800  18855.6062
1260              Puerto Rico 2007    3942491 78.74600  19328.7090
1261                  Reunion 1952     257700 52.72400   2718.8853
1262                  Reunion 1957     308700 55.09000   2769.4518
1263                  Reunion 1962     358900 57.66600   3173.7233
1264                  Reunion 1967     414024 60.54200   4021.1757
1265                  Reunion 1972     461633 64.27400   5047.6586
1266                  Reunion 1977     492095 67.06400   4319.8041
1267                  Reunion 1982     517810 69.88500   5267.2194
1268                  Reunion 1987     562035 71.91300   5303.3775
1269                  Reunion 1992     622191 73.61500   6101.2558
1270                  Reunion 1997     684810 74.77200   6071.9414
1271                  Reunion 2002     743981 75.74400   6316.1652
1272                  Reunion 2007     798094 76.44200   7670.1226
1273                  Romania 1952   16630000 61.05000   3144.6132
1274                  Romania 1957   17829327 64.10000   3943.3702
1275                  Romania 1962   18680721 66.80000   4734.9976
1276                  Romania 1967   19284814 66.80000   6470.8665
1277                  Romania 1972   20662648 69.21000   8011.4144
1278                  Romania 1977   21658597 69.46000   9356.3972
1279                  Romania 1982   22356726 69.66000   9605.3141
1280                  Romania 1987   22686371 69.53000   9696.2733
1281                  Romania 1992   22797027 69.36000   6598.4099
1282                  Romania 1997   22562458 69.72000   7346.5476
1283                  Romania 2002   22404337 71.32200   7885.3601
1284                  Romania 2007   22276056 72.47600  10808.4756
1285                   Rwanda 1952    2534927 40.00000    493.3239
1286                   Rwanda 1957    2822082 41.50000    540.2894
1287                   Rwanda 1962    3051242 43.00000    597.4731
1288                   Rwanda 1967    3451079 44.10000    510.9637
1289                   Rwanda 1972    3992121 44.60000    590.5807
1290                   Rwanda 1977    4657072 45.00000    670.0806
1291                   Rwanda 1982    5507565 46.21800    881.5706
1292                   Rwanda 1987    6349365 44.02000    847.9912
1293                   Rwanda 1992    7290203 23.59900    737.0686
1294                   Rwanda 1997    7212583 36.08700    589.9445
1295                   Rwanda 2002    7852401 43.41300    785.6538
1296                   Rwanda 2007    8860588 46.24200    863.0885
1297    Sao Tome and Principe 1952      60011 46.47100    879.5836
1298    Sao Tome and Principe 1957      61325 48.94500    860.7369
1299    Sao Tome and Principe 1962      65345 51.89300   1071.5511
1300    Sao Tome and Principe 1967      70787 54.42500   1384.8406
1301    Sao Tome and Principe 1972      76595 56.48000   1532.9853
1302    Sao Tome and Principe 1977      86796 58.55000   1737.5617
1303    Sao Tome and Principe 1982      98593 60.35100   1890.2181
1304    Sao Tome and Principe 1987     110812 61.72800   1516.5255
1305    Sao Tome and Principe 1992     125911 62.74200   1428.7778
1306    Sao Tome and Principe 1997     145608 63.30600   1339.0760
1307    Sao Tome and Principe 2002     170372 64.33700   1353.0924
1308    Sao Tome and Principe 2007     199579 65.52800   1598.4351
1309             Saudi Arabia 1952    4005677 39.87500   6459.5548
1310             Saudi Arabia 1957    4419650 42.86800   8157.5912
1311             Saudi Arabia 1962    4943029 45.91400  11626.4197
1312             Saudi Arabia 1967    5618198 49.90100  16903.0489
1313             Saudi Arabia 1972    6472756 53.88600  24837.4287
1314             Saudi Arabia 1977    8128505 58.69000  34167.7626
1315             Saudi Arabia 1982   11254672 63.01200  33693.1753
1316             Saudi Arabia 1987   14619745 66.29500  21198.2614
1317             Saudi Arabia 1992   16945857 68.76800  24841.6178
1318             Saudi Arabia 1997   21229759 70.53300  20586.6902
1319             Saudi Arabia 2002   24501530 71.62600  19014.5412
1320             Saudi Arabia 2007   27601038 72.77700  21654.8319
1321                  Senegal 1952    2755589 37.27800   1450.3570
1322                  Senegal 1957    3054547 39.32900   1567.6530
1323                  Senegal 1962    3430243 41.45400   1654.9887
1324                  Senegal 1967    3965841 43.56300   1612.4046
1325                  Senegal 1972    4588696 45.81500   1597.7121
1326                  Senegal 1977    5260855 48.87900   1561.7691
1327                  Senegal 1982    6147783 52.37900   1518.4800
1328                  Senegal 1987    7171347 55.76900   1441.7207
1329                  Senegal 1992    8307920 58.19600   1367.8994
1330                  Senegal 1997    9535314 60.18700   1392.3683
1331                  Senegal 2002   10870037 61.60000   1519.6353
1332                  Senegal 2007   12267493 63.06200   1712.4721
1333                   Serbia 1952    6860147 57.99600   3581.4594
1334                   Serbia 1957    7271135 61.68500   4981.0909
1335                   Serbia 1962    7616060 64.53100   6289.6292
1336                   Serbia 1967    7971222 66.91400   7991.7071
1337                   Serbia 1972    8313288 68.70000  10522.0675
1338                   Serbia 1977    8686367 70.30000  12980.6696
1339                   Serbia 1982    9032824 70.16200  15181.0927
1340                   Serbia 1987    9230783 71.21800  15870.8785
1341                   Serbia 1992    9826397 71.65900   9325.0682
1342                   Serbia 1997   10336594 72.23200   7914.3203
1343                   Serbia 2002   10111559 73.21300   7236.0753
1344                   Serbia 2007   10150265 74.00200   9786.5347
1345             Sierra Leone 1952    2143249 30.33100    879.7877
1346             Sierra Leone 1957    2295678 31.57000   1004.4844
1347             Sierra Leone 1962    2467895 32.76700   1116.6399
1348             Sierra Leone 1967    2662190 34.11300   1206.0435
1349             Sierra Leone 1972    2879013 35.40000   1353.7598
1350             Sierra Leone 1977    3140897 36.78800   1348.2852
1351             Sierra Leone 1982    3464522 38.44500   1465.0108
1352             Sierra Leone 1987    3868905 40.00600   1294.4478
1353             Sierra Leone 1992    4260884 38.33300   1068.6963
1354             Sierra Leone 1997    4578212 39.89700    574.6482
1355             Sierra Leone 2002    5359092 41.01200    699.4897
1356             Sierra Leone 2007    6144562 42.56800    862.5408
1357                Singapore 1952    1127000 60.39600   2315.1382
1358                Singapore 1957    1445929 63.17900   2843.1044
1359                Singapore 1962    1750200 65.79800   3674.7356
1360                Singapore 1967    1977600 67.94600   4977.4185
1361                Singapore 1972    2152400 69.52100   8597.7562
1362                Singapore 1977    2325300 70.79500  11210.0895
1363                Singapore 1982    2651869 71.76000  15169.1611
1364                Singapore 1987    2794552 73.56000  18861.5308
1365                Singapore 1992    3235865 75.78800  24769.8912
1366                Singapore 1997    3802309 77.15800  33519.4766
1367                Singapore 2002    4197776 78.77000  36023.1054
1368                Singapore 2007    4553009 79.97200  47143.1796
1369          Slovak Republic 1952    3558137 64.36000   5074.6591
1370          Slovak Republic 1957    3844277 67.45000   6093.2630
1371          Slovak Republic 1962    4237384 70.33000   7481.1076
1372          Slovak Republic 1967    4442238 70.98000   8412.9024
1373          Slovak Republic 1972    4593433 70.35000   9674.1676
1374          Slovak Republic 1977    4827803 70.45000  10922.6640
1375          Slovak Republic 1982    5048043 70.80000  11348.5459
1376          Slovak Republic 1987    5199318 71.08000  12037.2676
1377          Slovak Republic 1992    5302888 71.38000   9498.4677
1378          Slovak Republic 1997    5383010 72.71000  12126.2306
1379          Slovak Republic 2002    5410052 73.80000  13638.7784
1380          Slovak Republic 2007    5447502 74.66300  18678.3144
1381                 Slovenia 1952    1489518 65.57000   4215.0417
1382                 Slovenia 1957    1533070 67.85000   5862.2766
1383                 Slovenia 1962    1582962 69.15000   7402.3034
1384                 Slovenia 1967    1646912 69.18000   9405.4894
1385                 Slovenia 1972    1694510 69.82000  12383.4862
1386                 Slovenia 1977    1746919 70.97000  15277.0302
1387                 Slovenia 1982    1861252 71.06300  17866.7218
1388                 Slovenia 1987    1945870 72.25000  18678.5349
1389                 Slovenia 1992    1999210 73.64000  14214.7168
1390                 Slovenia 1997    2011612 75.13000  17161.1073
1391                 Slovenia 2002    2011497 76.66000  20660.0194
1392                 Slovenia 2007    2009245 77.92600  25768.2576
1393                  Somalia 1952    2526994 32.97800   1135.7498
1394                  Somalia 1957    2780415 34.97700   1258.1474
1395                  Somalia 1962    3080153 36.98100   1369.4883
1396                  Somalia 1967    3428839 38.97700   1284.7332
1397                  Somalia 1972    3840161 40.97300   1254.5761
1398                  Somalia 1977    4353666 41.97400   1450.9925
1399                  Somalia 1982    5828892 42.95500   1176.8070
1400                  Somalia 1987    6921858 44.50100   1093.2450
1401                  Somalia 1992    6099799 39.65800    926.9603
1402                  Somalia 1997    6633514 43.79500    930.5964
1403                  Somalia 2002    7753310 45.93600    882.0818
1404                  Somalia 2007    9118773 48.15900    926.1411
1405             South Africa 1952   14264935 45.00900   4725.2955
1406             South Africa 1957   16151549 47.98500   5487.1042
1407             South Africa 1962   18356657 49.95100   5768.7297
1408             South Africa 1967   20997321 51.92700   7114.4780
1409             South Africa 1972   23935810 53.69600   7765.9626
1410             South Africa 1977   27129932 55.52700   8028.6514
1411             South Africa 1982   31140029 58.16100   8568.2662
1412             South Africa 1987   35933379 60.83400   7825.8234
1413             South Africa 1992   39964159 61.88800   7225.0693
1414             South Africa 1997   42835005 60.23600   7479.1882
1415             South Africa 2002   44433622 53.36500   7710.9464
1416             South Africa 2007   43997828 49.33900   9269.6578
1417                    Spain 1952   28549870 64.94000   3834.0347
1418                    Spain 1957   29841614 66.66000   4564.8024
1419                    Spain 1962   31158061 69.69000   5693.8439
1420                    Spain 1967   32850275 71.44000   7993.5123
1421                    Spain 1972   34513161 73.06000  10638.7513
1422                    Spain 1977   36439000 74.39000  13236.9212
1423                    Spain 1982   37983310 76.30000  13926.1700
1424                    Spain 1987   38880702 76.90000  15764.9831
1425                    Spain 1992   39549438 77.57000  18603.0645
1426                    Spain 1997   39855442 78.77000  20445.2990
1427                    Spain 2002   40152517 79.78000  24835.4717
1428                    Spain 2007   40448191 80.94100  28821.0637
1429                Sri Lanka 1952    7982342 57.59300   1083.5320
1430                Sri Lanka 1957    9128546 61.45600   1072.5466
1431                Sri Lanka 1962   10421936 62.19200   1074.4720
1432                Sri Lanka 1967   11737396 64.26600   1135.5143
1433                Sri Lanka 1972   13016733 65.04200   1213.3955
1434                Sri Lanka 1977   14116836 65.94900   1348.7757
1435                Sri Lanka 1982   15410151 68.75700   1648.0798
1436                Sri Lanka 1987   16495304 69.01100   1876.7668
1437                Sri Lanka 1992   17587060 70.37900   2153.7392
1438                Sri Lanka 1997   18698655 70.45700   2664.4773
1439                Sri Lanka 2002   19576783 70.81500   3015.3788
1440                Sri Lanka 2007   20378239 72.39600   3970.0954
1441                    Sudan 1952    8504667 38.63500   1615.9911
1442                    Sudan 1957    9753392 39.62400   1770.3371
1443                    Sudan 1962   11183227 40.87000   1959.5938
1444                    Sudan 1967   12716129 42.85800   1687.9976
1445                    Sudan 1972   14597019 45.08300   1659.6528
1446                    Sudan 1977   17104986 47.80000   2202.9884
1447                    Sudan 1982   20367053 50.33800   1895.5441
1448                    Sudan 1987   24725960 51.74400   1507.8192
1449                    Sudan 1992   28227588 53.55600   1492.1970
1450                    Sudan 1997   32160729 55.37300   1632.2108
1451                    Sudan 2002   37090298 56.36900   1993.3983
1452                    Sudan 2007   42292929 58.55600   2602.3950
1453                Swaziland 1952     290243 41.40700   1148.3766
1454                Swaziland 1957     326741 43.42400   1244.7084
1455                Swaziland 1962     370006 44.99200   1856.1821
1456                Swaziland 1967     420690 46.63300   2613.1017
1457                Swaziland 1972     480105 49.55200   3364.8366
1458                Swaziland 1977     551425 52.53700   3781.4106
1459                Swaziland 1982     649901 55.56100   3895.3840
1460                Swaziland 1987     779348 57.67800   3984.8398
1461                Swaziland 1992     962344 58.47400   3553.0224
1462                Swaziland 1997    1054486 54.28900   3876.7685
1463                Swaziland 2002    1130269 43.86900   4128.1169
1464                Swaziland 2007    1133066 39.61300   4513.4806
1465                   Sweden 1952    7124673 71.86000   8527.8447
1466                   Sweden 1957    7363802 72.49000   9911.8782
1467                   Sweden 1962    7561588 73.37000  12329.4419
1468                   Sweden 1967    7867931 74.16000  15258.2970
1469                   Sweden 1972    8122293 74.72000  17832.0246
1470                   Sweden 1977    8251648 75.44000  18855.7252
1471                   Sweden 1982    8325260 76.42000  20667.3812
1472                   Sweden 1987    8421403 77.19000  23586.9293
1473                   Sweden 1992    8718867 78.16000  23880.0168
1474                   Sweden 1997    8897619 79.39000  25266.5950
1475                   Sweden 2002    8954175 80.04000  29341.6309
1476                   Sweden 2007    9031088 80.88400  33859.7484
1477              Switzerland 1952    4815000 69.62000  14734.2327
1478              Switzerland 1957    5126000 70.56000  17909.4897
1479              Switzerland 1962    5666000 71.32000  20431.0927
1480              Switzerland 1967    6063000 72.77000  22966.1443
1481              Switzerland 1972    6401400 73.78000  27195.1130
1482              Switzerland 1977    6316424 75.39000  26982.2905
1483              Switzerland 1982    6468126 76.21000  28397.7151
1484              Switzerland 1987    6649942 77.41000  30281.7046
1485              Switzerland 1992    6995447 78.03000  31871.5303
1486              Switzerland 1997    7193761 79.37000  32135.3230
1487              Switzerland 2002    7361757 80.62000  34480.9577
1488              Switzerland 2007    7554661 81.70100  37506.4191
1489                    Syria 1952    3661549 45.88300   1643.4854
1490                    Syria 1957    4149908 48.28400   2117.2349
1491                    Syria 1962    4834621 50.30500   2193.0371
1492                    Syria 1967    5680812 53.65500   1881.9236
1493                    Syria 1972    6701172 57.29600   2571.4230
1494                    Syria 1977    7932503 61.19500   3195.4846
1495                    Syria 1982    9410494 64.59000   3761.8377
1496                    Syria 1987   11242847 66.97400   3116.7743
1497                    Syria 1992   13219062 69.24900   3340.5428
1498                    Syria 1997   15081016 71.52700   4014.2390
1499                    Syria 2002   17155814 73.05300   4090.9253
1500                    Syria 2007   19314747 74.14300   4184.5481
1501                   Taiwan 1952    8550362 58.50000   1206.9479
1502                   Taiwan 1957   10164215 62.40000   1507.8613
1503                   Taiwan 1962   11918938 65.20000   1822.8790
1504                   Taiwan 1967   13648692 67.50000   2643.8587
1505                   Taiwan 1972   15226039 69.39000   4062.5239
1506                   Taiwan 1977   16785196 70.59000   5596.5198
1507                   Taiwan 1982   18501390 72.16000   7426.3548
1508                   Taiwan 1987   19757799 73.40000  11054.5618
1509                   Taiwan 1992   20686918 74.26000  15215.6579
1510                   Taiwan 1997   21628605 75.25000  20206.8210
1511                   Taiwan 2002   22454239 76.99000  23235.4233
1512                   Taiwan 2007   23174294 78.40000  28718.2768
1513                 Tanzania 1952    8322925 41.21500    716.6501
1514                 Tanzania 1957    9452826 42.97400    698.5356
1515                 Tanzania 1962   10863958 44.24600    722.0038
1516                 Tanzania 1967   12607312 45.75700    848.2187
1517                 Tanzania 1972   14706593 47.62000    915.9851
1518                 Tanzania 1977   17129565 49.91900    962.4923
1519                 Tanzania 1982   19844382 50.60800    874.2426
1520                 Tanzania 1987   23040630 51.53500    831.8221
1521                 Tanzania 1992   26605473 50.44000    825.6825
1522                 Tanzania 1997   30686889 48.46600    789.1862
1523                 Tanzania 2002   34593779 49.65100    899.0742
1524                 Tanzania 2007   38139640 52.51700   1107.4822
1525                 Thailand 1952   21289402 50.84800    757.7974
1526                 Thailand 1957   25041917 53.63000    793.5774
1527                 Thailand 1962   29263397 56.06100   1002.1992
1528                 Thailand 1967   34024249 58.28500   1295.4607
1529                 Thailand 1972   39276153 60.40500   1524.3589
1530                 Thailand 1977   44148285 62.49400   1961.2246
1531                 Thailand 1982   48827160 64.59700   2393.2198
1532                 Thailand 1987   52910342 66.08400   2982.6538
1533                 Thailand 1992   56667095 67.29800   4616.8965
1534                 Thailand 1997   60216677 67.52100   5852.6255
1535                 Thailand 2002   62806748 68.56400   5913.1875
1536                 Thailand 2007   65068149 70.61600   7458.3963
1537                     Togo 1952    1219113 38.59600    859.8087
1538                     Togo 1957    1357445 41.20800    925.9083
1539                     Togo 1962    1528098 43.92200   1067.5348
1540                     Togo 1967    1735550 46.76900   1477.5968
1541                     Togo 1972    2056351 49.75900   1649.6602
1542                     Togo 1977    2308582 52.88700   1532.7770
1543                     Togo 1982    2644765 55.47100   1344.5780
1544                     Togo 1987    3154264 56.94100   1202.2014
1545                     Togo 1992    3747553 58.06100   1034.2989
1546                     Togo 1997    4320890 58.39000    982.2869
1547                     Togo 2002    4977378 57.56100    886.2206
1548                     Togo 2007    5701579 58.42000    882.9699
1549      Trinidad and Tobago 1952     662850 59.10000   3023.2719
1550      Trinidad and Tobago 1957     764900 61.80000   4100.3934
1551      Trinidad and Tobago 1962     887498 64.90000   4997.5240
1552      Trinidad and Tobago 1967     960155 65.40000   5621.3685
1553      Trinidad and Tobago 1972     975199 65.90000   6619.5514
1554      Trinidad and Tobago 1977    1039009 68.30000   7899.5542
1555      Trinidad and Tobago 1982    1116479 68.83200   9119.5286
1556      Trinidad and Tobago 1987    1191336 69.58200   7388.5978
1557      Trinidad and Tobago 1992    1183669 69.86200   7370.9909
1558      Trinidad and Tobago 1997    1138101 69.46500   8792.5731
1559      Trinidad and Tobago 2002    1101832 68.97600  11460.6002
1560      Trinidad and Tobago 2007    1056608 69.81900  18008.5092
1561                  Tunisia 1952    3647735 44.60000   1468.4756
1562                  Tunisia 1957    3950849 47.10000   1395.2325
1563                  Tunisia 1962    4286552 49.57900   1660.3032
1564                  Tunisia 1967    4786986 52.05300   1932.3602
1565                  Tunisia 1972    5303507 55.60200   2753.2860
1566                  Tunisia 1977    6005061 59.83700   3120.8768
1567                  Tunisia 1982    6734098 64.04800   3560.2332
1568                  Tunisia 1987    7724976 66.89400   3810.4193
1569                  Tunisia 1992    8523077 70.00100   4332.7202
1570                  Tunisia 1997    9231669 71.97300   4876.7986
1571                  Tunisia 2002    9770575 73.04200   5722.8957
1572                  Tunisia 2007   10276158 73.92300   7092.9230
1573                   Turkey 1952   22235677 43.58500   1969.1010
1574                   Turkey 1957   25670939 48.07900   2218.7543
1575                   Turkey 1962   29788695 52.09800   2322.8699
1576                   Turkey 1967   33411317 54.33600   2826.3564
1577                   Turkey 1972   37492953 57.00500   3450.6964
1578                   Turkey 1977   42404033 59.50700   4269.1223
1579                   Turkey 1982   47328791 61.03600   4241.3563
1580                   Turkey 1987   52881328 63.10800   5089.0437
1581                   Turkey 1992   58179144 66.14600   5678.3483
1582                   Turkey 1997   63047647 68.83500   6601.4299
1583                   Turkey 2002   67308928 70.84500   6508.0857
1584                   Turkey 2007   71158647 71.77700   8458.2764
1585                   Uganda 1952    5824797 39.97800    734.7535
1586                   Uganda 1957    6675501 42.57100    774.3711
1587                   Uganda 1962    7688797 45.34400    767.2717
1588                   Uganda 1967    8900294 48.05100    908.9185
1589                   Uganda 1972   10190285 51.01600    950.7359
1590                   Uganda 1977   11457758 50.35000    843.7331
1591                   Uganda 1982   12939400 49.84900    682.2662
1592                   Uganda 1987   15283050 51.50900    617.7244
1593                   Uganda 1992   18252190 48.82500    644.1708
1594                   Uganda 1997   21210254 44.57800    816.5591
1595                   Uganda 2002   24739869 47.81300    927.7210
1596                   Uganda 2007   29170398 51.54200   1056.3801
1597           United Kingdom 1952   50430000 69.18000   9979.5085
1598           United Kingdom 1957   51430000 70.42000  11283.1779
1599           United Kingdom 1962   53292000 70.76000  12477.1771
1600           United Kingdom 1967   54959000 71.36000  14142.8509
1601           United Kingdom 1972   56079000 72.01000  15895.1164
1602           United Kingdom 1977   56179000 72.76000  17428.7485
1603           United Kingdom 1982   56339704 74.04000  18232.4245
1604           United Kingdom 1987   56981620 75.00700  21664.7877
1605           United Kingdom 1992   57866349 76.42000  22705.0925
1606           United Kingdom 1997   58808266 77.21800  26074.5314
1607           United Kingdom 2002   59912431 78.47100  29478.9992
1608           United Kingdom 2007   60776238 79.42500  33203.2613
1609            United States 1952  157553000 68.44000  13990.4821
1610            United States 1957  171984000 69.49000  14847.1271
1611            United States 1962  186538000 70.21000  16173.1459
1612            United States 1967  198712000 70.76000  19530.3656
1613            United States 1972  209896000 71.34000  21806.0359
1614            United States 1977  220239000 73.38000  24072.6321
1615            United States 1982  232187835 74.65000  25009.5591
1616            United States 1987  242803533 75.02000  29884.3504
1617            United States 1992  256894189 76.09000  32003.9322
1618            United States 1997  272911760 76.81000  35767.4330
1619            United States 2002  287675526 77.31000  39097.0995
1620            United States 2007  301139947 78.24200  42951.6531
1621                  Uruguay 1952    2252965 66.07100   5716.7667
1622                  Uruguay 1957    2424959 67.04400   6150.7730
1623                  Uruguay 1962    2598466 68.25300   5603.3577
1624                  Uruguay 1967    2748579 68.46800   5444.6196
1625                  Uruguay 1972    2829526 68.67300   5703.4089
1626                  Uruguay 1977    2873520 69.48100   6504.3397
1627                  Uruguay 1982    2953997 70.80500   6920.2231
1628                  Uruguay 1987    3045153 71.91800   7452.3990
1629                  Uruguay 1992    3149262 72.75200   8137.0048
1630                  Uruguay 1997    3262838 74.22300   9230.2407
1631                  Uruguay 2002    3363085 75.30700   7727.0020
1632                  Uruguay 2007    3447496 76.38400  10611.4630
1633                Venezuela 1952    5439568 55.08800   7689.7998
1634                Venezuela 1957    6702668 57.90700   9802.4665
1635                Venezuela 1962    8143375 60.77000   8422.9742
1636                Venezuela 1967    9709552 63.47900   9541.4742
1637                Venezuela 1972   11515649 65.71200  10505.2597
1638                Venezuela 1977   13503563 67.45600  13143.9510
1639                Venezuela 1982   15620766 68.55700  11152.4101
1640                Venezuela 1987   17910182 70.19000   9883.5846
1641                Venezuela 1992   20265563 71.15000  10733.9263
1642                Venezuela 1997   22374398 72.14600  10165.4952
1643                Venezuela 2002   24287670 72.76600   8605.0478
1644                Venezuela 2007   26084662 73.74700  11415.8057
1645                  Vietnam 1952   26246839 40.41200    605.0665
1646                  Vietnam 1957   28998543 42.88700    676.2854
1647                  Vietnam 1962   33796140 45.36300    772.0492
1648                  Vietnam 1967   39463910 47.83800    637.1233
1649                  Vietnam 1972   44655014 50.25400    699.5016
1650                  Vietnam 1977   50533506 55.76400    713.5371
1651                  Vietnam 1982   56142181 58.81600    707.2358
1652                  Vietnam 1987   62826491 62.82000    820.7994
1653                  Vietnam 1992   69940728 67.66200    989.0231
1654                  Vietnam 1997   76048996 70.67200   1385.8968
1655                  Vietnam 2002   80908147 73.01700   1764.4567
1656                  Vietnam 2007   85262356 74.24900   2441.5764
1657       West Bank and Gaza 1952    1030585 43.16000   1515.5923
1658       West Bank and Gaza 1957    1070439 45.67100   1827.0677
1659       West Bank and Gaza 1962    1133134 48.12700   2198.9563
1660       West Bank and Gaza 1967    1142636 51.63100   2649.7150
1661       West Bank and Gaza 1972    1089572 56.53200   3133.4093
1662       West Bank and Gaza 1977    1261091 60.76500   3682.8315
1663       West Bank and Gaza 1982    1425876 64.40600   4336.0321
1664       West Bank and Gaza 1987    1691210 67.04600   5107.1974
1665       West Bank and Gaza 1992    2104779 69.71800   6017.6548
1666       West Bank and Gaza 1997    2826046 71.09600   7110.6676
1667       West Bank and Gaza 2002    3389578 72.37000   4515.4876
1668       West Bank and Gaza 2007    4018332 73.42200   3025.3498
1669               Yemen Rep. 1952    4963829 32.54800    781.7176
1670               Yemen Rep. 1957    5498090 33.97000    804.8305
1671               Yemen Rep. 1962    6120081 35.18000    825.6232
1672               Yemen Rep. 1967    6740785 36.98400    862.4421
1673               Yemen Rep. 1972    7407075 39.84800   1265.0470
1674               Yemen Rep. 1977    8403990 44.17500   1829.7652
1675               Yemen Rep. 1982    9657618 49.11300   1977.5570
1676               Yemen Rep. 1987   11219340 52.92200   1971.7415
1677               Yemen Rep. 1992   13367997 55.59900   1879.4967
1678               Yemen Rep. 1997   15826497 58.02000   2117.4845
1679               Yemen Rep. 2002   18701257 60.30800   2234.8208
1680               Yemen Rep. 2007   22211743 62.69800   2280.7699
1681                   Zambia 1952    2672000 42.03800   1147.3888
1682                   Zambia 1957    3016000 44.07700   1311.9568
1683                   Zambia 1962    3421000 46.02300   1452.7258
1684                   Zambia 1967    3900000 47.76800   1777.0773
1685                   Zambia 1972    4506497 50.10700   1773.4983
1686                   Zambia 1977    5216550 51.38600   1588.6883
1687                   Zambia 1982    6100407 51.82100   1408.6786
1688                   Zambia 1987    7272406 50.82100   1213.3151
1689                   Zambia 1992    8381163 46.10000   1210.8846
1690                   Zambia 1997    9417789 40.23800   1071.3538
1691                   Zambia 2002   10595811 39.19300   1071.6139
1692                   Zambia 2007   11746035 42.38400   1271.2116
1693                 Zimbabwe 1952    3080907 48.45100    406.8841
1694                 Zimbabwe 1957    3646340 50.46900    518.7643
1695                 Zimbabwe 1962    4277736 52.35800    527.2722
1696                 Zimbabwe 1967    4995432 53.99500    569.7951
1697                 Zimbabwe 1972    5861135 55.63500    799.3622
1698                 Zimbabwe 1977    6642107 57.67400    685.5877
1699                 Zimbabwe 1982    7636524 60.36300    788.8550
1700                 Zimbabwe 1987    9216418 62.35100    706.1573
1701                 Zimbabwe 1992   10704340 60.37700    693.4208
1702                 Zimbabwe 1997   11404948 46.80900    792.4500
1703                 Zimbabwe 2002   11926563 39.98900    672.0386
1704                 Zimbabwe 2007   12311143 43.48700    469.7093</code></pre>
</div>
</div>
<p>Note that there are some other packages (e.g.&nbsp;the MASS package) that also have a function called <code>select()</code>. If you happen to load one of those packages after loading the tidyverse package in your session, you may end up with an error that says <code>Error in select(., x) : unused argument (x)</code>. To fix this, you will either need to directly call the <code>select()</code> function from the dplyr package using <code>dplyr::select()</code> or ensure that you load such packages <em>before</em> the tidyverse package (which automatically loads the dplyr package).</p>
</section>
<section id="filter-filter-to-rows-that-satisfy-certain-conditions" class="level2">
<h2 class="anchored" data-anchor-id="filter-filter-to-rows-that-satisfy-certain-conditions"><code>filter</code>: filter to rows that satisfy certain conditions</h2>
<p>Filtering is a very simple way of only keeping rows that satisfy certain conditions. These conditions are always based on logical statements involving variables/columns of the data frame.</p>
<p>For instance, to keep only the rows that have a recorded population of at least 1 billion, you can use a filtering with a logical statement involving the <code>pop</code> variable (again unquoted).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000000000</span>) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  country year        pop continent lifeExp gdpPercap
1   China 1982 1000281000      Asia  65.525  962.4214
2   China 1987 1084035000      Asia  67.274 1378.9040
3   China 1992 1164970000      Asia  68.690 1655.7842
4   China 1997 1230075000      Asia  70.426 2289.2341
5   China 2002 1280400000      Asia  72.028 3119.2809
6   China 2007 1318683096      Asia  72.961 4959.1149
7   India 2002 1034172547      Asia  62.879 1746.7695
8   India 2007 1110396331      Asia  64.698 2452.2104</code></pre>
</div>
</div>
<p>You can specify multiple filter conditions using a comma (and in this case the filter function will return rows that satisfy <em>all</em> of the conditions specified). Below I filter to rows from 1992 that have a population of at least 100 million in that year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000000</span>, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1992</span>) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        country year        pop continent lifeExp  gdpPercap
1    Bangladesh 1992  113704579      Asia  56.018   837.8102
2        Brazil 1992  155975974  Americas  67.057  6950.2830
3         China 1992 1164970000      Asia  68.690  1655.7842
4         India 1992  872000000      Asia  60.223  1164.4068
5     Indonesia 1992  184816000      Asia  62.681  2383.1409
6         Japan 1992  124329269      Asia  79.360 26824.8951
7      Pakistan 1992  120065004      Asia  60.838  1971.8295
8 United States 1992  256894189  Americas  76.090 32003.9322</code></pre>
</div>
</div>
</section>
<section id="mutate-add-a-new-variable" class="level2">
<h2 class="anchored" data-anchor-id="mutate-add-a-new-variable"><code>mutate</code>: add a new variable</h2>
<p>Mutating the data frame involves adding a new variable. This new variable is usually a function of existing variables, but it can also be defined based on external objects.</p>
<p>For instance below I add a new variable, <code>gdp</code>, to the gapminder data frame. <code>gdp</code> is equal to <code>gdpPercap</code> multiplied by <code>pop</code>, and then look at the first 6 rows of the data frame using the classic <code>head()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gdp =</span> gdpPercap <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pop) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb27-3">  head</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      country year      pop continent lifeExp gdpPercap         gdp
1 Afghanistan 1952  8425333      Asia  28.801  779.4453  6567086330
2 Afghanistan 1957  9240934      Asia  30.332  820.8530  7585448670
3 Afghanistan 1962 10267083      Asia  31.997  853.1007  8758855797
4 Afghanistan 1967 11537966      Asia  34.020  836.1971  9648014150
5 Afghanistan 1972 13079460      Asia  36.088  739.9811  9678553274
6 Afghanistan 1977 14880372      Asia  38.438  786.1134 11697659231</code></pre>
</div>
</div>
<p>Note that I haven’t re-defined the gapminder data frame, so all I have done here is print out the data frame with the additional gdp variable.</p>
<p>If you wanted to be able to use this gdp variable down the line, you would need to re-define the gapminder data frame so that <code>gapminder</code> now corresponds to the version with the <code>gdp</code> variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">gapminder <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb29-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gdp =</span> gdpPercap <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pop)</span></code></pre></div>
</div>
</section>
<section id="arrange-arrange-the-rows-of-the-data-frame-in-order-a-variable" class="level2">
<h2 class="anchored" data-anchor-id="arrange-arrange-the-rows-of-the-data-frame-in-order-a-variable"><code>arrange</code>: arrange the rows of the data frame in order a variable</h2>
<p>The <code>arrange</code> function allows you to easily reorder the rows of the data frame in increasing or decreasing order of one (or more) of the variables of the data frame.</p>
<p>For instance, you could arrange all rows in the data frame in order of increasing life expectancy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb30-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(lifeExp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb30-3">  head</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       country year     pop continent lifeExp gdpPercap         gdp
1       Rwanda 1992 7290203    Africa  23.599  737.0686  5373379682
2  Afghanistan 1952 8425333      Asia  28.801  779.4453  6567086330
3       Gambia 1952  284320    Africa  30.000  485.2307   137960781
4       Angola 1952 4232095    Africa  30.015 3520.6103 14899557133
5 Sierra Leone 1952 2143249    Africa  30.331  879.7877  1885604185
6  Afghanistan 1957 9240934      Asia  30.332  820.8530  7585448670</code></pre>
</div>
</div>
<p>To arrange in <em>descending</em> order, you need to wrap the variable name in the <code>desc()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb32-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(gdpPercap)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-3">  head</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  country year     pop continent lifeExp gdpPercap         gdp
1  Kuwait 1957  212846      Asia  58.033 113523.13 24162944745
2  Kuwait 1972  841934      Asia  67.712 109347.87 92063687055
3  Kuwait 1952  160000      Asia  55.565 108382.35 17341176464
4  Kuwait 1962  358266      Asia  60.470  95458.11 34199395868
5  Kuwait 1967  575003      Asia  64.624  80894.88 46514800559
6  Kuwait 1977 1140357      Asia  69.343  59265.48 67583801715</code></pre>
</div>
</div>
<p>Again, if you wanted your data frame to actually be arranged as specified, you would need to re-define the gapminder data frame. But if you only need it for one quick analysis (e.g.&nbsp;creating a summary table), then you don’t need to redefine the data frame.</p>
<p>Below I re-define the gapminder dataset so that the rows are in order of increasing year, and the countries are in alphabetical order within each year (the secondary arrange variable).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb34-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(year, country) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb34-3">  head</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      country year      pop continent lifeExp  gdpPercap          gdp
1 Afghanistan 1952  8425333      Asia  28.801   779.4453   6567086330
2     Albania 1952  1282697    Europe  55.230  1601.0561   2053669902
3     Algeria 1952  9279525    Africa  43.077  2449.0082  22725632678
4      Angola 1952  4232095    Africa  30.015  3520.6103  14899557133
5   Argentina 1952 17876956  Americas  62.485  5911.3151 105676319105
6   Australia 1952  8691212   Oceania  69.120 10039.5956  87256254102</code></pre>
</div>
</div>
</section>
<section id="group_by-apply-other-dplyr-functions-separately-within-within-a-group-defined-by-one-or-more-variables" class="level2">
<h2 class="anchored" data-anchor-id="group_by-apply-other-dplyr-functions-separately-within-within-a-group-defined-by-one-or-more-variables"><code>group_by</code>: apply other dplyr functions separately within within a group defined by one or more variables</h2>
<p>The <code>group_by()</code> function can be really useful if you want to apply a function independently within groups of observations (where the groups are specified by a categorical variable in your data frame). Think of <code>group_by()</code> as splitting your data frame into several separate data frames based on the categorical variable you specify. All functions that you apply to the grouped data frame are applied separately to each group until you specify an <code>ungroup()</code> function.</p>
<p>The code below filters the data frame to only the country-years that have life expectancy above the average life expectancy <em>for their continent</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(continent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(lifeExp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 873 × 7
   country  year      pop continent lifeExp gdpPercap           gdp
   &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1 Albania  1987  3075321 Europe       72       3739.  11498418358.
 2 Albania  1997  3428038 Europe       73.0     3193.  10945912519.
 3 Albania  2002  3508512 Europe       75.7     4604.  16153932130.
 4 Albania  2007  3600523 Europe       76.4     5937.  21376411360.
 5 Algeria  1967 12760499 Africa       51.4     3247.  41433235247.
 6 Algeria  1972 14760787 Africa       54.5     4183.  61739408943.
 7 Algeria  1977 17152804 Africa       58.0     4910.  84227416174.
 8 Algeria  1982 20033753 Africa       61.4     5745. 115097120653.
 9 Algeria  1987 23254956 Africa       65.8     5681. 132119742845.
10 Algeria  1992 26298373 Africa       67.7     5023. 132102425043.
# … with 863 more rows</code></pre>
</div>
</div>
<p>To check that this does something different than it would without the <code>group_by()</code> (i.e.&nbsp;filtering to the country-years that have life expectancy above the average <em>global</em> life expectancy), compare the distribution of continents from each <code>filter()</code> command using the <code>count()</code> function (another handly dplyr function):</p>
<p>The number of countries from each continent included post-filtering when grouping by continent is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(continent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(lifeExp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(continent)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  continent     n
  &lt;chr&gt;     &lt;int&gt;
1 Africa      282
2 Americas    176
3 Asia        216
4 Europe      189
5 Oceania      10</code></pre>
</div>
</div>
<p>The number of countries from each continent included post-filtering when <strong>not</strong> grouping by continent is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb40-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(lifeExp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb40-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(continent)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  continent   n
1    Africa  80
2  Americas 218
3      Asia 224
4    Europe 349
5   Oceania  24</code></pre>
</div>
</div>
<p>Notice that when you <em>don’t</em> group by continent, substantially fewer African countries are included since they tend to have lower life expectencies than the global average.</p>
<p>To combine some of the things you’ve just learnt, the code below first filters to the year 2007, and then splits the data frame into groups by continent and adds a row to each group corresponding to the average life expectancy of all of the countries in that group/continent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb42-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># first filter to 2007</span></span>
<span id="cb42-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb42-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># group by continent</span></span>
<span id="cb42-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(continent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb42-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a column within each continent corresponding to the average life expectancy</span></span>
<span id="cb42-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">continent_lifeExp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb42-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ungroup the data frame</span></span>
<span id="cb42-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb42-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># only show a few variables</span></span>
<span id="cb42-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(country, continent, lifeExp, continent_lifeExp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb42-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   country     continent lifeExp continent_lifeExp
   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;             &lt;dbl&gt;
 1 Afghanistan Asia         43.8              70.7
 2 Albania     Europe       76.4              77.6
 3 Algeria     Africa       72.3              54.8
 4 Angola      Africa       42.7              54.8
 5 Argentina   Americas     75.3              73.6
 6 Australia   Oceania      81.2              80.7
 7 Austria     Europe       79.8              77.6
 8 Bahrain     Asia         75.6              70.7
 9 Bangladesh  Asia         64.1              70.7
10 Belgium     Europe       79.4              77.6</code></pre>
</div>
</div>
<p>Notice that all rows from the same continent have the same value for <code>continent_lifeExp</code>. Note that even though this example defines a single value for each continent, this value is repeated for all rows within the continent.</p>
</section>
<section id="summarisesummarize-define-a-variable-that-is-a-summary-of-other-variables" class="level2">
<h2 class="anchored" data-anchor-id="summarisesummarize-define-a-variable-that-is-a-summary-of-other-variables"><code>summarise</code>/<code>summarize</code>: define a variable that is a summary of other variables</h2>
<p>The <code>summarise()</code> (or <code>summarize()</code>) function aggregates across the rows of the data frame. For instance, you can calculate the average life expectancy, as well as the total GDP.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb44-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean_lifeExp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lifeExp),</span>
<span id="cb44-3">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">total_gdp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(gdp))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mean_lifeExp    total_gdp
1     59.47444 3.183235e+14</code></pre>
</div>
</div>
<p>The summarise function plays very nicely with the <code>group_by()</code> function. For instance, by first grouping by year and then calculating the average life expectancy and total GDP <em>for each year</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb46-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb46-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean_lifeExp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lifeExp),</span>
<span id="cb46-4">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">total_gdp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(gdp)) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
    year mean_lifeExp total_gdp
   &lt;int&gt;        &lt;dbl&gt;     &lt;dbl&gt;
 1  1952         49.1   7.04e12
 2  1957         51.5   8.90e12
 3  1962         53.6   1.10e13
 4  1967         55.7   1.42e13
 5  1972         57.6   1.84e13
 6  1977         59.6   2.23e13
 7  1982         61.5   2.54e13
 8  1987         63.2   3.01e13
 9  1992         64.2   3.45e13
10  1997         65.0   4.10e13
11  2002         65.7   4.73e13
12  2007         67.0   5.81e13</code></pre>
</div>
</div>
<p>Note that since these are summaries of the data frame itself, I just want to print them out, rather than re-defining the <code>gapminder</code> data frame to be equal to these summaries. And since I won’t be using them for anything other than to look at, I don’t need to define them as a variable.</p>
</section>
<section id="more-dplyr-functions" class="level2">
<h2 class="anchored" data-anchor-id="more-dplyr-functions">More dplyr functions</h2>
<p>Other dplyr functions that are incredibly useful include:</p>
<p><code>rename()</code> for renaming variables of the data frame</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb48-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gdp_per_capita =</span> gdpPercap,</span>
<span id="cb48-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">life_exp =</span> lifeExp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb48-4">  head</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      country year      pop continent life_exp gdp_per_capita         gdp
1 Afghanistan 1952  8425333      Asia   28.801       779.4453  6567086330
2 Afghanistan 1957  9240934      Asia   30.332       820.8530  7585448670
3 Afghanistan 1962 10267083      Asia   31.997       853.1007  8758855797
4 Afghanistan 1967 11537966      Asia   34.020       836.1971  9648014150
5 Afghanistan 1972 13079460      Asia   36.088       739.9811  9678553274
6 Afghanistan 1977 14880372      Asia   38.438       786.1134 11697659231</code></pre>
</div>
</div>
<p><code>distinct()</code> for extracting the distinct values of a variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb50-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>(continent)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  continent
1      Asia
2    Europe
3    Africa
4  Americas
5   Oceania</code></pre>
</div>
</div>
<p><code>sample_n()</code> and <code>sample_frac()</code> for taking random samples of rows</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb52-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  country year     pop continent lifeExp gdpPercap        gdp
1 Eritrea 1977 2512642    Africa  44.535  505.7538 1270778259
2 Lesotho 1957  813338    Africa  45.047  335.9971  273279222</code></pre>
</div>
</div>
<p><code>count()</code> for counting the number of rows with each value of a categorical variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb54-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(continent)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  continent   n
1    Africa 624
2  Americas 300
3      Asia 396
4    Europe 360
5   Oceania  24</code></pre>
</div>
</div>
<p><code>transmute()</code> for doing a mutate and select at the same time: only the variables defined in the mutation are retained.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb56-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transmute</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gdp =</span> gdpPercap <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pop) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb56-3">  head</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          gdp
1  6567086330
2  7585448670
3  8758855797
4  9648014150
5  9678553274
6 11697659231</code></pre>
</div>
</div>
<p>Advanced dplyr practitioners will eventually want to learn about <a href="http://www.rebeccabarter.com/blog/2019-01-23_scoped-verbs/"><em>scoped verbs</em></a>.</p>
</section>
</section>
<section id="visualization-ggplot2" class="level1">
<h1>Visualization: ggplot2</h1>
<p align="center">
<img src="https://www.rebeccabarter.com/blog/img/tidyverse/ggplot2.png" alt="ggplot" width="180" height="200">
</p>
<p>The first tidyverse package I ever learnt was ggplot2 (the more popular older sibling of the non-existent ggplot1). Ggplot2 is the data visualization package made by Hadley Wickham, and it is based a set of principles called the <em>layered grammar of graphics</em>. The basic idea is that a ggplot graphic layers geometric objects (circles, lines, etc), themes, and scales ontop of data. The form of the geometric object is defined by a <code>geom_xxx()</code> function and the properties (position, size, colour) of the geometric objects that based on the data variables are specified by the aesthetic (<code>aes()</code>) function (within the <code>geom_xxx()</code> function).</p>
<p>The base layer of any ggplot graph is the empty ggplot layer defined by the <code>ggplot()</code> function, which describes the data frame that the plot will be based on. I haven’t told ggplot what type of geometric object(s) I want yet, nor how the variables should be mapped to the geometric objects, so I just have a blank plot.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(gapminder)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Since you now know about pipes, you could pipe in the data that you want to plot. Piping makes it easy to do intermediate manipulations that you don’t necessarily want to save in the data frame itself, such as only plotting one year’s worth of data</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb59-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb59-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="adding-geom-layers" class="level2">
<h2 class="anchored" data-anchor-id="adding-geom-layers">Adding geom layers</h2>
<p>Next, I will add a “geom” layer to our ggplot object.</p>
<p>Layers are added to ggplot objects using <code>+</code>, instead of <code>%&gt;%</code>, since you are not explicitly piping the LHS into each subsequent layer (we are actually adding a layer on top). The error messages have recently been improved to warn you if you are accidentally using a pipe <code>%&gt;%</code> to add layers to ggplot objects (which, once you start piping everything into everything, becomes an easy mistake to make).</p>
<p>Probably the most common geom layer is <code>geom_point</code>. Inside <code>geom_point()</code>, you will specify the aesthetic mappings from the variables to the geometric objects that you want. For instance, if you want to plot a scatterplot with <code>gdpPercap</code> on the x-axis and <code>lifeExp</code> on the y-axis, then you would add a <code>geom_point()</code> geometric layer with relevant aesthetic function: <code>geom_point(aes(x = gdpPercap, y = lifeExp))</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb60" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># describe the base ggplot object and tell it what data we are interested in along with the aesthetic mapping</span></span>
<span id="cb60-2">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb60-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb60-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb60-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a points layer on top</span></span>
<span id="cb60-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdpPercap, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lifeExp))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We could also add a smoothed trend line layer on top of the points using <code>geom_smooth()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb61" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># describe the base ggplot object and tell it what data we are interested in along with the aesthetic mapping</span></span>
<span id="cb61-2">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb61-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb61-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb61-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a points layer on top</span></span>
<span id="cb61-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdpPercap, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb61-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a smoothed LOESS layer</span></span>
<span id="cb61-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdpPercap, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lifeExp), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note that since the aesthetics for <code>geom_point()</code> and <code>geom_smooth()</code> are the same, you might want to just specify global aesthetics in the <code>ggplot()</code> function, rather than layer-specific aesthetics.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb63" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># describe the base ggplot object and tell it what data we are interested in along with the aesthetic mapping</span></span>
<span id="cb63-2">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb63-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb63-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># specify global aesthetic mappings</span></span>
<span id="cb63-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdpPercap, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb63-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a points layer on top</span></span>
<span id="cb63-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb63-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a smoothed LOESS layer</span></span>
<span id="cb63-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We could also combine a <em>points</em> geom layer with a <em>line</em> geom layer, or any other type of geom layer. Line plots work well for plotting time series, so below we plot the average life expectancy over time using both point and line layers.</p>
<p>Here you can do some clever combinations of dplyr manipulations with ggplot2 by summarising life expectancy by year and piping the results into a ggplot without having to define any intermediate variables.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb65" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb65-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># calcualte the average life expectency for each year</span></span>
<span id="cb65-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb65-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avg_lifeExp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb65-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb65-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># specify global aesthetic mappings</span></span>
<span id="cb65-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> avg_lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb65-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a points layer on top</span></span>
<span id="cb65-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb65-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a line layer on top</span></span>
<span id="cb65-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If you wanted to have a separate line on our plot for each continent (rather than an aggregated line across all continents), you <strong>don’t</strong> need to add an individual layer for each continent to get the following plot:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Instead, start by also grouping by <code>continent</code> when you calculate the average life expectency by year.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb67" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb67-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(continent, year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb67-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avg_lifeExp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lifeExp))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 60 × 3
# Groups:   continent [5]
   continent  year avg_lifeExp
   &lt;chr&gt;     &lt;int&gt;       &lt;dbl&gt;
 1 Africa     1952        39.1
 2 Africa     1957        41.3
 3 Africa     1962        43.3
 4 Africa     1967        45.3
 5 Africa     1972        47.5
 6 Africa     1977        49.6
 7 Africa     1982        51.6
 8 Africa     1987        53.3
 9 Africa     1992        53.6
10 Africa     1997        53.6
# … with 50 more rows</code></pre>
</div>
</div>
<p>However if you try to use the same code as above to plot a line on the country-year grouped data frame, you get a weird zig-zag pattern.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb70" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb70-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(continent, year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb70-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avg_lifeExp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb70-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb70-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb70-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a points layer on top</span></span>
<span id="cb70-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> avg_lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb70-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a lines layer ontop</span></span>
<span id="cb70-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> avg_lifeExp))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This happens because you now have multiple average life expectancy values for each year, but you haven’t specified which ones go together. To fix this plot, you need to specify how the rows are grouped together (i.e.&nbsp;which variable defines the individual lines) by specifying the <code>group = continent</code> argument in the <code>aes()</code> function of the <code>geom_line()</code> layer.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb72" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb72-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(continent, year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb72-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avg_lifeExp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb72-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb72-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a points layer on top</span></span>
<span id="cb72-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> avg_lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb72-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a lines layer on top that is grouped by continent</span></span>
<span id="cb72-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> avg_lifeExp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> continent))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="more-aesthetic-mappings-based-on-variables" class="level2">
<h2 class="anchored" data-anchor-id="more-aesthetic-mappings-based-on-variables">More aesthetic mappings based on variables</h2>
<p>So far we have only specified the x- and y-position aesthetic mappings from the data to the geom objects. But you can also specify other types of aesthetic mappings, such as using a variable to specify the colour of the points.</p>
<p>If you want all of the points to be the same colour, you can specify a global point colour argument (that lies outside the <code>aes()</code> function).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb74" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb74-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb74-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdpPercap, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lifeExp),</span>
<span id="cb74-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cornflowerblue"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>However, if you wanted to use a variable from the data frame to define the colour (or any other aesthetic feature) of the geoms, <strong>you will need to include it inside the <code>aes()</code> function</strong>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb75" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb75-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb75-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdpPercap, </span>
<span id="cb75-4">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lifeExp, </span>
<span id="cb75-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col  =</span> continent))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note that the <code>continent</code> variable does not specify the colours themselves: this is done automatically. You can specify the colours you want yourself by adding a scale layer for colour.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb76" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb76-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb76-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdpPercap, </span>
<span id="cb76-4">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lifeExp, </span>
<span id="cb76-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col  =</span> continent)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb76-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red4"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There are lots of types of scales that you can use for every type of aesthetic mapping (including x- and y-positions), and typically scales are specific to whether your variable using in the aesthetic mapping is discrete or continuous.</p>
<p>We could also add aesthetic mappings for other features such as shape, size, transparency (alpha) and more! For example, changing the size based on population:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb77" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb77-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb77-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdpPercap, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lifeExp, </span>
<span id="cb77-4">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> continent, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> pop),</span>
<span id="cb77-5">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For the line plot example above where we plotted an average life expectancy time line for each continent, instead of specifying a <code>group</code> argument, you could instead specify a <code>colour</code> argument to be <code>continent</code>. This will will automatically group and colour by <code>continent</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb78" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb78-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(continent, year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb78-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avg_lifeExp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb78-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># specify global aesthetic mappings</span></span>
<span id="cb78-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb78-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a points layer on top</span></span>
<span id="cb78-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> avg_lifeExp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> continent))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="other-types-of-layers" class="level2">
<h2 class="anchored" data-anchor-id="other-types-of-layers">Other types of layers</h2>
<p>So far, we have only seen scatterplots (points) and line plots, however, there are many other geoms you could add, including:</p>
<section id="histograms" class="level3">
<h3 class="anchored" data-anchor-id="histograms">Histograms</h3>
<p>Histograms only require an x-aesthetic (the y-aesthetic is a count by default, but you can force it to be a density by specifying <code>y = ..density..</code>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb80" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb80-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb80-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> lifeExp), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="boxplots" class="level3">
<h3 class="anchored" data-anchor-id="boxplots">Boxplots</h3>
<p>Boxplots are automatically grouped by the x-aesthetic provided (e.g.&nbsp;continent in the plot below). To colour boxplots, use the <code>fill</code> argument instead of the <code>col</code> (or <code>color</code>/<code>colour</code>) argument.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb81" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb81-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb81-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_boxplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> continent, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lifeExp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> continent))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="faceting" class="level3">
<h3 class="anchored" data-anchor-id="faceting">Faceting</h3>
<p>You can create a grid (or “facet”) of plots separated by a categorical variable of your choosing (e.g.&nbsp;<code>continent</code>) by adding a facet layer.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb82" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb82-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb82-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdpPercap, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb82-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>continent, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="customizing-ggplot2" class="level2">
<h2 class="anchored" data-anchor-id="customizing-ggplot2">Customizing ggplot2</h2>
<p>While we have stayed within the default ggplot2 functionalities here, there is a lot you can do with ggplot2. For instance, with practice, you will learn how to produce highly-customized plots by combining many layers together. As motivation, here is a much more beautiful plot that can be made with ggplot2:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb83" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1">gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb83-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb83-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb83-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add scatter points</span></span>
<span id="cb83-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdpPercap, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lifeExp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> continent, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> pop),</span>
<span id="cb83-6">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb83-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add some text annotations for the very large countries</span></span>
<span id="cb83-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> gdpPercap, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> lifeExp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> country),</span>
<span id="cb83-9">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey50"</span>,</span>
<span id="cb83-10">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(gapminder, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>, pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000000000</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> country <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nigeria"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"United States"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb83-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean the axes names and breaks</span></span>
<span id="cb83-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_log10</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60000</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb83-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># change labels</span></span>
<span id="cb83-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GDP versus life expectancy in 2007"</span>,</span>
<span id="cb83-15">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GDP per capita (log scale)"</span>,</span>
<span id="cb83-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Life expectancy"</span>,</span>
<span id="cb83-17">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Population"</span>,</span>
<span id="cb83-18">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Continent"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb83-19">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># change the size scale</span></span>
<span id="cb83-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_size</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">range =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb83-21">             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove size legend</span></span>
<span id="cb83-22">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">guide =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb83-23">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a nicer theme</span></span>
<span id="cb83-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb83-25">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># place legend at top and grey axis lines</span></span>
<span id="cb83-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In <a href="http://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_pt2/">part two</a> of this post on the tidyverse, you will see some ggplot2 code (under the guise of learning about factors) that makes this plot:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If you’d like to learn more about ggplot2, such as themes, scales and advanced geoms, check out my more detailed <a href="http://www.rebeccabarter.com/blog/2017-11-17-ggplot2_tutorial/">ggplot2 blog post</a>.</p>
<p>If the tidyverse is new to you, I suggest that you stop here for now. Focus on incorporating piping, dplyr, and ggplot2 into every analysis that you do for the next few months (even if it would initially be quicker to use base R versions). When you feel comfortable with your new skills, move onto <a href="http://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_pt2/">part two</a> of this blog post and start to incorporate the remaining tidyverse packages (below) into your analytic workflow. Trying to learn everything at once is a sure-fire way to become discouraged. First get comfortable with the main ideas, then learn some more.</p>


</section>
</section>

 ]]></description>
  <category>R</category>
  <category>tidyverse</category>
  <category>dplyr</category>
  <category>ggplot2</category>
  <category>pipes</category>
  <guid>https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse.html</guid>
  <pubDate>Mon, 05 Aug 2019 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Transitioning into the tidyverse (part 2)</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_pt2.html</link>
  <description><![CDATA[ 





<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/tidyverse/tidyverse_all.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>If you’re new to the tidyverse, I recommend that you first read <a href="http://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse/">part one</a> of this two-part series on transitioning into the tidyverse. Part 1 focuses on what I feel are the most important aspects and packages of the tidyverse: tidy thinking, piping, dplyr and ggplot2.</p>
<p>This second part of the two-part series focuses on the remaining (less essential, but still immensely useful) packages that make up the tidyverse: tidyr, purrr, readr, tibbles, as well as some additional type-specific packages (lubridate, forcats and stringr). Additional resources include the set of tidyverse <a href="https://www.rstudio.com/resources/cheatsheets/">cheatsheets</a>, as well as the <a href="https://r4ds.had.co.nz/">R for Data Science book</a>.</p>
<p>Start by loading the tidyverse package into your environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
</div>
<p>Then load the gapminder data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to download the data directly:</span></span>
<span id="cb2-2">gapminder_orig <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/gh-pages/_episodes_rmd/data/gapminder-FiveYearData.csv"</span>)</span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define a copy of the original dataset that we will clean and play with </span></span>
<span id="cb2-4">gapminder <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder_orig</span></code></pre></div>
</div>
<section id="data-shaping-tidyr" class="level1">
<h1>Data shaping: tidyr</h1>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/tidyverse/tidyr.jpg" class="quarto-figure quarto-figure-center figure-img" width="180" height="200"></p>
</figure>
</div>
</div>
</div>
<p>Tidyr aims to help you reshape your data, and is very useful if you receive data in a format that isn’t already “tidy”. I also find myself using tidyr functions to help me calculate specific types of summaries and plots.</p>
<p>For instance, tidyr helps you convert your data between (a) long-form data where each variable is in a single column</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>         country year lifeExp
1      Australia 1992  77.560
2      Australia 1997  78.830
3      Australia 2002  80.370
4      Australia 2007  81.235
5         Canada 1992  77.950
6         Canada 1997  78.610
7         Canada 2002  79.770
8         Canada 2007  80.653
9  United States 1992  76.090
10 United States 1997  76.810
11 United States 2002  77.310
12 United States 2007  78.242</code></pre>
</div>
</div>
<p>and (b) wide-form data where a single variable is separated into multiple columns based on some grouping (in this case, the life expectancy variable is separated into three columns, one for each country):</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  year Australia_lifeExp Canada_lifeExp United States_lifeExp
1 1992            77.560         77.950                76.090
2 1997            78.830         78.610                76.810
3 2002            80.370         79.770                77.310
4 2007            81.235         80.653                78.242</code></pre>
</div>
</div>
<section id="gathering-and-spreading" class="level2">
<h2 class="anchored" data-anchor-id="gathering-and-spreading">Gathering and spreading</h2>
<p>The main tidyr functions are <code>spread()</code> and <code>gather()</code>. If you are familiar with the older reshape2 R package, you can think of tidyr as the tidyverse version, where <code>spread()</code> is the equivalent of <code>cast</code>, and <code>gather()</code> is the equivalent of <code>melt()</code>. If not… never mind!</p>
<p>Think of <code>spread()</code> as a function that will spread a single variable’s “values” across multiple columns based on a “key”, or grouping variable. Similarly, think of <code>gather()</code> as a function that will gather a variable whose “values” are spread across multiple columns (where the “key” is the grouping variable that distinguishes the columns) into a single column.</p>
<p>The main things you need to figure out when using <code>spread()</code> and <code>gather()</code> are what are the “key” and what are the “value” columns of your data frame. If you are spreading your data (to make it wider), then your key and value variables are existing variables in the data. If you are gathering your data (making it longer), then you will need to define key and value variables that will become variable names in your long-form data frame.</p>
<p>Below I’ll show how this works with a small subset of the gapminder dataset, corresponding to the life expectancy for US, Australia, and Canada for each year in the data after 1990.</p>
<p>Suppose that you started with the long-form data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">gapminder_sample_long <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(country <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Australia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"United States"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Canada"</span>), year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1990</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(country, year, lifeExp) </span>
<span id="cb5-4">gapminder_sample_long</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         country year lifeExp
1      Australia 1992  77.560
2      Australia 1997  78.830
3      Australia 2002  80.370
4      Australia 2007  81.235
5         Canada 1992  77.950
6         Canada 1997  78.610
7         Canada 2002  79.770
8         Canada 2007  80.653
9  United States 1992  76.090
10 United States 1997  76.810
11 United States 2002  77.310
12 United States 2007  78.242</code></pre>
</div>
</div>
<p>A wide-form version might have the life expectancy variable <em>spread</em> into three variables, one for each country (it would also be perfectly feasible to separate by year). So in this case, the <strong>value</strong> that you want to spread is the <code>lifeExp</code> variable, and the <strong>key</strong> that you want to spread/group by is the <code>country</code> variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">gapminder_sample_wide <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder_sample_long <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spread</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> country, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> lifeExp)</span>
<span id="cb7-3">gapminder_sample_wide</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year Australia Canada United States
1 1992    77.560 77.950        76.090
2 1997    78.830 78.610        76.810
3 2002    80.370 79.770        77.310
4 2007    81.235 80.653        78.242</code></pre>
</div>
</div>
<p>So the columns with the country names, <code>Australia</code>, <code>Canada</code>, and <code>United States</code> contain the <code>lifeExp</code> values corresponding to those countries for each year. Note that the <code>year</code> variable has been retained in the wide form. If you had tried to do this without the <code>year</code> variable in the data frame, you would run into an error that said <code>"Error: Each row of output must be identified by a unique combination of keys."</code> Try running the following code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">gapminder_sample_long <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spread</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> country, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> lifeExp)</span></code></pre></div>
</div>
<p>This is because when the year column is missing, there is no variable that tells purrr which values should go in the same rows together. This error message is a common source of frustration in tidyr, and Hadley has been working on replacements for <code>gather()</code> and <code>spread()</code> called <code>pivot_wider()</code> and <code>pivot_longer()</code>: https://tidyr.tidyverse.org/dev/articles/pivot.html. They haven’t been incorporated into the CRAN versions of tidyr and the tidyverse yet though, but they probably will be soon. If you understand the principles of <code>gather()</code> and <code>spread()</code> then when the new pivot functions are introduced, it will be easy to learn how to use them.</p>
<p>If you wanted to go from the wide form to the long-form, you need to <em>gather</em> together the life expectancy values. This time, the <code>country</code> <strong>key</strong> and <code>lifeExp</code> <strong>value</strong> variable names do not currently exist in the data frame. The <code>key</code> and <code>value</code> arguments that you provide in the <code>gather()</code> function are what will be used as the names of the variables for the long-form version you’re about to create. Just so you can see that these variables did not need to exist in the original data, you will call the key <code>country_var</code> and the value <code>lifeExp_var</code> (previously unused names).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">gapminder_sample_wide</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year Australia Canada United States
1 1992    77.560 77.950        76.090
2 1997    78.830 78.610        76.810
3 2002    80.370 79.770        77.310
4 2007    81.235 80.653        78.242</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">gapminder_sample_wide <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> country_var, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> lifeExp_var)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     country_var lifeExp_var
1           year    1992.000
2           year    1997.000
3           year    2002.000
4           year    2007.000
5      Australia      77.560
6      Australia      78.830
7      Australia      80.370
8      Australia      81.235
9         Canada      77.950
10        Canada      78.610
11        Canada      79.770
12        Canada      80.653
13 United States      76.090
14 United States      76.810
15 United States      77.310
16 United States      78.242</code></pre>
</div>
</div>
<p>Oh no…. something went wrong! The <code>year</code> variable has been included as a key (country). Since there is no distinction between the three country columns (<code>Australia</code>, <code>Canada</code>, and <code>United States</code>) and the <code>year</code> column, the <code>year</code> column was included in the gathering process. To exclude a column from the gathering process, you can explicitly remove it using e.g.&nbsp;<code>-year</code> as an argument to the gather function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">gapminder_sample_wide <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> country_var, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> lifeExp_var, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>year)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   year   country_var lifeExp_var
1  1992     Australia      77.560
2  1997     Australia      78.830
3  2002     Australia      80.370
4  2007     Australia      81.235
5  1992        Canada      77.950
6  1997        Canada      78.610
7  2002        Canada      79.770
8  2007        Canada      80.653
9  1992 United States      76.090
10 1997 United States      76.810
11 2002 United States      77.310
12 2007 United States      78.242</code></pre>
</div>
</div>
</section>
<section id="combining-and-separating-variables" class="level2">
<h2 class="anchored" data-anchor-id="combining-and-separating-variables">Combining and separating variables</h2>
<p>The <code>unite()</code> function combines columns into a single column. For instance, you can combine the country and year variables into a single variable, <code>countryyear</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">gapminder_sample_united <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder_sample_long <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unite</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"countryyear"</span>, country, year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>)</span>
<span id="cb16-3">gapminder_sample_united</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          countryyear lifeExp
1      Australia_1992  77.560
2      Australia_1997  78.830
3      Australia_2002  80.370
4      Australia_2007  81.235
5         Canada_1992  77.950
6         Canada_1997  78.610
7         Canada_2002  79.770
8         Canada_2007  80.653
9  United States_1992  76.090
10 United States_1997  76.810
11 United States_2002  77.310
12 United States_2007  78.242</code></pre>
</div>
</div>
<p>Conversely, you can separate single columns into multiple columns. Below, I undo the <code>unite()</code> that I performed above using <code>separate()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">gapminder_sample_united <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate</span>(countryyear, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"country"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         country year lifeExp
1      Australia 1992  77.560
2      Australia 1997  78.830
3      Australia 2002  80.370
4      Australia 2007  81.235
5         Canada 1992  77.950
6         Canada 1997  78.610
7         Canada 2002  79.770
8         Canada 2007  80.653
9  United States 1992  76.090
10 United States 1997  76.810
11 United States 2002  77.310
12 United States 2007  78.242</code></pre>
</div>
</div>
<p>Tidyr also has some nice functions for dealing with missing values including</p>
<ul>
<li><p><code>drop_na()</code> that will remove every row that has a missing value (<code>NA</code>) in it.</p></li>
<li><p><code>replace_na()</code> that will replace every missing value (<code>NA</code>) with whatever value you specify.</p></li>
</ul>
</section>
</section>
<section id="replacing-loops-purrr" class="level1">
<h1>Replacing loops: purrr</h1>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/tidyverse/purrr.jpg" class="quarto-figure quarto-figure-center figure-img" width="180" height="200"></p>
</figure>
</div>
</div>
</div>
<p>Iteration in the tidyverse is handled using <code>purrr</code>; a feline-friendly package for applying “map” functions (although it does a few other neat things too). If you are experienced in base R, then you’re probably familiar with the <code>apply()</code> functions that can be used in place of loops for iteratively applying a function. The most common apply functions are</p>
<p><code>apply(matrix, margin, fun)</code> applies a function, <code>fun</code>, across each of the rows (if you set <code>margin = 1</code>) or each of the columns (if you set <code>margin = 2</code>) of a <code>matrix</code> (or array) and returns a vector.</p>
<p><code>sapply(object, fun)</code> applies a function, <code>fun</code>, to each entry of an <code>object</code> (which could be a vector, a data frame or a list), and usually returns a vector, but sometimes it returns a matrix, and often it is difficult to guess what type of object it will return before you run your code.</p>
<p><code>lapply(list, fun)</code> applies a function, <code>fun</code>, to each entry of a <code>list</code>, and returns a list. This one at least usually makes sense relative to the other apply functions.</p>
<p>While there is nothing fundamentally wrong with the base R apply functions, the syntax is somewhat inconsistent across the different apply functions, and the expected type of the object they return is often ambiguous (at least it is for <code>sapply</code>…). Each of <code>purrr</code>’s map functions can be applied to vectors, lists and data frames.</p>
<p>It is useful to remember that a data frame is a special type of a list where each columns of the data frame corresponds to an entry of the list. Each entry of the data frame-list is a vector of the same length (although the vectors do not need to be of the same type).</p>
<p>One of the primary features of <code>purrr</code>’s map functions is that you need to specify the form of your output as a function suffix separated by an underscore. The first element is always the data object over which you want to iterate, and the second argument is always the function that you want to iteratively apply. For example:</p>
<ul>
<li><p><code>map(object, fun)</code> is the primary mapping function and returns a list</p></li>
<li><p><code>map_df(object, fun)</code> returns a data frame</p></li>
<li><p><code>map_dbl(object, fun)</code> returns a numeric (double) vector</p></li>
<li><p><code>map_chr(object, fun)</code> returns a character vector</p></li>
<li><p><code>map_lgl(object, fun)</code> returns a logical vector</p></li>
</ul>
<p>The <strong>input</strong> to any <code>map</code> function is always either</p>
<ul>
<li><p>a <strong>vector</strong> (of any type), in which case the iteration is done over the entries of the vector</p></li>
<li><p>a <strong>list</strong>, in which case the iteration is performed over the elements of the list</p></li>
<li><p>a <strong>data frame</strong>, in which case the iteration is performed over the columns of the data frame (which, since a data frame is a special kind of list, is technically the same as the previous point)</p></li>
</ul>
<p>The <strong>output</strong> of each map function is specified by the term that follows the underscore in the function name.</p>
<p>Fundamentally, maps are for iteration. In the example below I will iterate through the vector <code>c(1, 4, 7)</code> by adding 10 to each entry. The following code is how you would do this using the base R apply functions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(number) {</span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(number <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb20-3">})</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 11

[[2]]
[1] 14

[[3]]
[1] 17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(number) {</span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(number <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb22-3">})</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11 14 17</code></pre>
</div>
</div>
<p>For the <code>purrr</code> equivalents, if you want your output to be a list, you would use <code>map()</code>, if you want it to be a numeric vector, then you would use <code>map_dbl()</code>, if you want it to be a character, then it is <code>map_chr()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb24-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(number) {</span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(number <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb24-4">})</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 11

[[2]]
[1] 14

[[3]]
[1] 17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(number) {</span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(number <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb26-3">})</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11 14 17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_chr</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(number) {</span>
<span id="cb28-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(number <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb28-3">})</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Automatic coercion from double to character was deprecated in purrr 1.0.0.
ℹ Please use an explicit call to `as.character()` within `map_chr()` instead.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "11.000000" "14.000000" "17.000000"</code></pre>
</div>
</div>
<p>If you want to return a data frame, then you would use <code>map_df</code> (but you need to make sure that in each iteration you’re returning a data frame which has consistent column names).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(number) {</span>
<span id="cb31-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">old_number =</span> number, </span>
<span id="cb31-3">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">new_number =</span> number <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb31-4">})</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  old_number new_number
1          1         11
2          4         14
3          7         17</code></pre>
</div>
</div>
<p><code>map2</code> and <code>pmap</code> are versions of map functions that work over multiple data frames/lists/vectors at once. There are also fancy things that you can do with purrr that include iterating over entire lists of data as entries to columns of a tibble, but I won’t talk about those here. My next blog post will be on purrr so keep a look out if you want to learn more. For a more comprehensive look at purrr, I recommend <a href="https://jennybc.github.io/purrr-tutorial/">Jenny Bryan’s tutorial</a>.</p>
</section>
<section id="loading-data-readr" class="level1">
<h1>Loading data: readr</h1>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/tidyverse/readr.png" class="quarto-figure quarto-figure-center figure-img" width="180" height="200"></p>
</figure>
</div>
</div>
</div>
<p>At face-value, readr is probably the least exciting tidyverse package. At first glance, it mostly appears to offer tidyverse equivalents to the classic base R data loading functions such as <code>read.csv()</code>. Calling a readr data loading function is usually the same as the base R versions, <em>but</em> they use an underscore <code>_</code> separator rather than a period separator <code>.</code>, as in <code>read_csv()</code>.</p>
<p>The main advantages of the readr versions is that the data is read in directly as a <strong>tibble</strong>, and the readr loading functions do a much better job at deciding what <em>type</em> each variable should be (and it makes it easier to specify what types the columns should be at the time of loading if you have strong opinions).</p>
<p>However, a closer look reveals that <code>readr</code> has some hidden talents that are sure to come in handy! For instance, readr has a series of <code>parse_</code> functions that convert abnormally represented data into normally represented data. For instance, <code>parse_number()</code> will extract the numeric component of strings with numbers in them. So if your collaborators give you a file with prices that have preceding “$”s or other characters in them, <code>parse_number()</code> will remove them for you without you having to do anything involving regular expressions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse_number</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$1,234.5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$12.45"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"99%"</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1234.50   12.45   99.00</code></pre>
</div>
</div>
<p>Tidyr can also be used to convert dates and times coded as strings to actual date-time formats.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse_datetime</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2010-10-01 21:45"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2010-10-01 21:45:00 UTC"</code></pre>
</div>
</div>
<p>But to be honest, I prefer to use the <em>lubridate</em> package for doing things with dates (see below).</p>
<p>Okay, so maybe tidyr isn’t the most exciting package, but that <code>parse_number()</code> thing is pretty neat!</p>
</section>
<section id="storing-data-tibbles" class="level1">
<h1>Storing data: tibbles</h1>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/tidyverse/tibble.png" class="quarto-figure quarto-figure-center figure-img" width="180" height="200"></p>
</figure>
</div>
</div>
</div>
<p>Tibbles are the tidyverse version of a data frame. You’ve probably used tibbles before without even realizing. They look and behave a LOT like a data frame. Often when you input a data frame to a tidyverse function, it comes out the other end as a tibble. The differences are minor and you’re unlikely to notice them if you’re just starting out, so I wouldn’t worry about whether your data is stored as a data frame or a tibble.</p>
<p>The main differences that you might notice is in how they are printed to the console: tibbles are automatically truncated to 10 rows when printed into the console, and if you have too many variables, many of the variables are hidden from view. I secretly sometimes view my tibbles in the console using <code>as.data.frame(data)</code> so that it doesn’t truncate. Probably a better thing to do would be to <code>View(data)</code>, but that opens a whole new window which I sometimes find kind of annoying.</p>
<p>Tibbles only become important much later down the tidyverse track when you want to use list columns to do fancy stuff with purrr.</p>
</section>
<section id="dates-factors-and-strings-lubridate-forcats-and-stringr" class="level1">
<h1>Dates, factors and strings: lubridate, forcats and stringr</h1>
<p>While not technically a part of the tidyverse, there are also very useful packages for manipulating type-specific variables: lubridate for dates/times, forcats for factors and stringr for strings.</p>
<section id="handling-dates-and-times-lubridate" class="level2">
<h2 class="anchored" data-anchor-id="handling-dates-and-times-lubridate">Handling dates and times: lubridate</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/tidyverse/lubridate.png" class="quarto-figure quarto-figure-center figure-img" width="180" height="200"></p>
</figure>
</div>
</div>
</div>
<p>Lubridate makes it really straightforward to deal with dates. One might say… it <em>lubricates</em> them… one might also not say that, because it’s a bit weird.</p>
<p>Lubridate offers a simple way of converting dates/times stored as strings to dates/times stored as dates/times, and it makes it easy to do math with dates.</p>
<p>The primary set of functions are date-time-reading functions that convert strings to dates. To decide which function to use, you will need to figure out what format your dates are in (by… looking at them…). For instance, if your date is coded as <code>"August 2nd 2019"</code> or <code>"08-05-19"</code> or <code>"08/02/19"</code>, then you would use the <code>mdy()</code> function because it is coded as “month-day-year”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(lubridate)</span>
<span id="cb37-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mdy</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"August 2nd 2019"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2019-08-02"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mdy</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8-2-2019"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2019-08-02"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mdy</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8/2/19"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2019-08-02"</code></pre>
</div>
</div>
<p>If your dates were coded as “year-month-day” then you would use the <code>ymd()</code> function, and so on.</p>
<p>Strings that contain times can be parsed using <code>hms()</code> for “hour-minute-second”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hms</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8:45:12"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "8H 45M 12S"</code></pre>
</div>
</div>
<p>And date-times can be parsed using <code>ymd_hms()</code>, <code>ymd_hm()</code>, <code>ymd_h()</code>, as well as for the other date versions (<code>mdy_hms()</code>, <code>dmy_hms()</code>, etc…).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mdy_hms</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"March 13th 2019 at 9:02:00"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2019-03-13 09:02:00 UTC"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mdy_hm</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"03-13-19, 9:02"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2019-03-13 09:02:00 UTC"</code></pre>
</div>
</div>
<p>You can add fixed periods of time to dates easily using the <code>years()</code>, <code>months()</code>, <code>days()</code>, <code>hours()</code>, etc… functions. For instance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mdy</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"August 2nd 2019"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">days</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2019-09-13"</code></pre>
</div>
</div>
<p>Once your dates are in an actual date format, you can do intuitive mathematical calculations with date-times:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mdy_hms</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"August 2nd 2019, 1:21:30 pm"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mdy_hms</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"August 1st 2019, 11:23:33 am"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 1.08191 days</code></pre>
</div>
</div>
<p>Plus ggplot2 handles lubridate-dates really well.</p>
</section>
<section id="handling-factors-forcats" class="level2">
<h2 class="anchored" data-anchor-id="handling-factors-forcats">Handling factors: forcats</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/tidyverse/forcats.png" class="quarto-figure quarto-figure-center figure-img" width="180" height="200"></p>
</figure>
</div>
</div>
</div>
<p>Factors are somehow simultaneously very useful and the worst thing ever. Fortunately, since I discovered the <code>forcats</code> package, my factors have been on their best behaviour.</p>
<p>The forcats package has a few really useful functions. The ones I use most often are</p>
<ul>
<li><p><code>fct_inorder()</code> for reordering the levels of a factor so that the levels are in the order that they appear in the factor vector.</p></li>
<li><p><code>fct_infreq()</code> for reordering the levels of a factor so that the levels are in order of most to least frequent.</p></li>
<li><p><code>fct_rev()</code> for reversing the order of the levels of a factor.</p></li>
<li><p><code>fct_relevel()</code> for manually reordering the levels of the factor.</p></li>
<li><p><code>fct_reorder()</code> for reordering the levels based on their relationship to another variable.</p></li>
</ul>
<p>There are other functions too, but I rarely use them. Check out the forcats <a href="file:///Users/Rebecca/Downloads/factors.pdf">cheatsheet</a>!</p>
<p>An example of how the forcats package makes my life easier is when I want to reorder the factor levels. Factor levels are usually alphabetical by default, and I often want the factor levels to be in a specific order.</p>
<p>As an exercise both in ggplot2 and dplyr, I want to make a plot that shows the difference between life expectancy between 2007 and 1952 and arrange the countries in order of greatest difference in life expectancy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1">gapminder_life_exp_diff <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gapminder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb53-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># filter to the starting and ending years only</span></span>
<span id="cb53-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1952</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2007</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb53-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ensure that the data are arranged so that 1952 is first and 2007 is second </span></span>
<span id="cb53-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># within each year</span></span>
<span id="cb53-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(country, year) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb53-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for country, add a variable corresponding to the difference between life </span></span>
<span id="cb53-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># expectency in 2007 and 1952</span></span>
<span id="cb53-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(country) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb53-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lifeExp_diff =</span> lifeExp[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> lifeExp[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb53-11">         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># also calculate the largest population for the country (based on the two years)</span></span>
<span id="cb53-12">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_pop =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(pop)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb53-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb53-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># arrange in order of the biggest difference in life expectency</span></span>
<span id="cb53-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(lifeExp_diff) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb53-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># restrict to countries with a population of at least 30,000 so we can fit </span></span>
<span id="cb53-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the plot in a reasonable space</span></span>
<span id="cb53-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(max_pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30000000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb53-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(country, year, continent, lifeExp, lifeExp_diff)</span>
<span id="cb53-20">gapminder_life_exp_diff  </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 72 × 5
   country          year continent lifeExp lifeExp_diff
   &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;        &lt;dbl&gt;
 1 South Africa     1952 Africa       45.0         4.33
 2 South Africa     2007 Africa       49.3         4.33
 3 Congo Dem. Rep.  1952 Africa       39.1         7.32
 4 Congo Dem. Rep.  2007 Africa       46.5         7.32
 5 United States    1952 Americas     68.4         9.80
 6 United States    2007 Americas     78.2         9.80
 7 United Kingdom   1952 Europe       69.2        10.2 
 8 United Kingdom   2007 Europe       79.4        10.2 
 9 Nigeria          1952 Africa       36.3        10.5 
10 Nigeria          2007 Africa       46.9        10.5 
# … with 62 more rows</code></pre>
</div>
</div>
<p>To understand what the intermediate dplyr steps are doing in the code below, I suggest printing each step out to the console (without defining a new data frame) - i.e.&nbsp;first print <code>gapminder %&gt;% filter(year == 1952 | year == 2007)</code>, then print <code>gapminder %&gt;% filter(year == 1952 | year == 2007) %&gt;% arrange(country, year)</code>, etc.</p>
<p>The next task is to make a dot plot that shows the life expectancy in 1952 and 2007 for each country. Since the countries in our data frame is arranged in order of smallest to biggest difference in life expectancy, one would expect that the plot will be too. However, the countries in the plot still appear in alphabetical order! The problem is that ggplot2 plots factors in order of their levels, but the <code>arrange()</code> dplyr function rearranges the order of the rows in the data frame but does not change the order of the factor levels.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1">gapminder_life_exp_diff <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb55-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb55-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> lifeExp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> country, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(year)))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_pt2_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If I tried to fix this using base R, I would undoubtedly end up messing up which country is which. Fortunately this is really, really easy to fix using forcats! The <code>fct_inorder()</code> function will automatically reorder the levels of a factor in the order in which they appear in the vector. So all I need to do is add one line of pre-processing code before I make my plot: <code>mutate(country = fct_inorder(country))</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1">gapminder_life_exp_diff <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb56-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">country =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_inorder</span>(country)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb56-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb56-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> lifeExp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> country, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(year)))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_pt2_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I’m a bit pedantic about data viz, so I can’t leave this plot looking like this, so I’m just going to place some ggplot2 code here for making this plot waaaaay more badass. Try to read through the code and understand what its doing. This isn’t a lesson in forcats, it’s a lesson in EDA!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1">gapminder_life_exp_diff <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb57-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">country =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_inorder</span>(country)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb57-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for each country define a varaible for min and max life expectancy</span></span>
<span id="cb57-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(country) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb57-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_lifeExp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(lifeExp),</span>
<span id="cb57-6">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min_lifeExp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(lifeExp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb57-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb57-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb57-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># plot a horizontal line from min to max life expectency for each country</span></span>
<span id="cb57-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> min_lifeExp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> max_lifeExp, </span>
<span id="cb57-11">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> country, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> country,</span>
<span id="cb57-12">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> continent), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb57-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a point for each life expectancy data point</span></span>
<span id="cb57-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> lifeExp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> country, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> continent), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb57-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add text of the country name as well as the max and min life expectency </span></span>
<span id="cb57-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> min_lifeExp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> country, </span>
<span id="cb57-17">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(country, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(min_lifeExp))), </span>
<span id="cb57-18">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey50"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb57-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> max_lifeExp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> country, </span>
<span id="cb57-20">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(max_lifeExp)), </span>
<span id="cb57-21">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey50"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb57-22">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ensure that the left-most text is not cut off </span></span>
<span id="cb57-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb57-24">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># choose a different colour palette</span></span>
<span id="cb57-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pastel2"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb57-26">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set the title</span></span>
<span id="cb57-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Change in life expectancy"</span>,</span>
<span id="cb57-28">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Between 1952 and 2007"</span>,</span>
<span id="cb57-29">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Life expectancy (in 1952 and 2007)"</span>,</span>
<span id="cb57-30">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, </span>
<span id="cb57-31">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Continent"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb57-32">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove the grey background</span></span>
<span id="cb57-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb57-34">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove the axes and move the legend to the top</span></span>
<span id="cb57-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>, </span>
<span id="cb57-36">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb57-37">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb57-38">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_pt2_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="handling-strings-stringr" class="level2">
<h2 class="anchored" data-anchor-id="handling-strings-stringr">Handling strings: stringr</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/tidyverse/stringr.jpg" class="quarto-figure quarto-figure-center figure-img" width="180" height="200"></p>
</figure>
</div>
</div>
</div>
<p>R used to be terrible at handling strings. Stringr has made string-handling a LOT easier. The functions all start with <code>str_</code> and end with what you want to do to the string.</p>
<p>For instance, to return a logical that specifies whether a specific pattern exists in the string (the equivalent of <code>grepl()</code> in base R), you can use the <code>str_detect()</code> function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I like bananas"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"banana"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>My friend Sara Stoudt <a href="https://twitter.com/sastoudt">@sastoudt</a> wrote a wrote a very useful post for the tidyverse website comparing stringr with its Base R equivalents (https://stringr.tidyverse.org/articles/from-base.html). She provides the following useful table (hers is a bit longer - I’m just showing the parts I find most useful):</p>
<table class="table">
<colgroup>
<col style="width: 38%">
<col style="width: 29%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>Action</th>
<th>Base R</th>
<th>Tidyverse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Identify the location of a pattern</td>
<td><code>gregexpr(pattern, x)</code></td>
<td><code>str_locate_all(x, pattern)</code></td>
</tr>
<tr class="even">
<td>Keep strings matching a pattern</td>
<td><code>grep(pattern, x, value = TRUE)</code></td>
<td><code>str_subset(x, pattern)</code></td>
</tr>
<tr class="odd">
<td>Identify position matching a pattern</td>
<td><code>grep(pattern, x)</code></td>
<td><code>str_which(x, pattern)</code></td>
</tr>
<tr class="even">
<td>Detect presence or absence of a pattern</td>
<td><code>grepl(pattern, x)</code></td>
<td><code>str_detect(x, pattern)</code></td>
</tr>
<tr class="odd">
<td>Replace a pattern</td>
<td><code>gsub(pattern, replacement, x)</code></td>
<td><code>str_replace_all(x, pattern, replacement)</code></td>
</tr>
<tr class="even">
<td>Calculate the number of characters in a string</td>
<td><code>nchar(x)</code></td>
<td><code>str_length(x)</code></td>
</tr>
<tr class="odd">
<td>Split a string into pieces</td>
<td><code>strsplit(x, pattern)</code></td>
<td><code>str_split(x, pattern)</code></td>
</tr>
<tr class="even">
<td>Extract a subset of a string</td>
<td><code>substr(x, start, end)</code></td>
<td><code>str_sub(x, start, end)</code></td>
</tr>
<tr class="odd">
<td>Convert a string to lowercase</td>
<td><code>tolower(x)</code></td>
<td><code>str_to_lower(x)</code></td>
</tr>
<tr class="even">
<td>Convert a string to “Title Case”</td>
<td><code>tools::toTitleCase(x)</code></td>
<td><code>str_to_title(x)</code></td>
</tr>
<tr class="odd">
<td>Convert a string to uppercase</td>
<td><code>toupper(x)</code></td>
<td><code>str_to_upper(x)</code></td>
</tr>
<tr class="even">
<td>Trim white space from a string</td>
<td><code>trimws(x)</code></td>
<td><code>str_trim(x)</code></td>
</tr>
</tbody>
</table>
<p>If you’d like to see a little more of stringr, check out Sara’s post!</p>


</section>
</section>

 ]]></description>
  <category>R</category>
  <category>tidyverse</category>
  <category>tidyr</category>
  <category>purrr</category>
  <category>readr</category>
  <category>tibbles</category>
  <category>lubridate</category>
  <category>forcats</category>
  <category>stringr</category>
  <guid>https://www.rebeccabarter.com/blog/2019-08-05_base_r_to_tidyverse_pt2.html</guid>
  <pubDate>Mon, 05 Aug 2019 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Using the recipes package for easy pre-processing</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2019-06-06_pre_processing.html</link>
  <description><![CDATA[ 





<p>Pre-processing data in R used to be the bane of my existence. For something that should be fairly straightforward, it often really wasn’t. Often my frustrations stemmed from simple things such as factor variables having different levels in the training data and test data, or a variable having missing values in the test data but not in the training data. I’d write a function that would pre-process the training data, and when I’d try to apply it to the test data, R would cry and yell and just be generally unpleasant.</p>
<p>Thankfully most of the pain of pre-processing is now in the past thanks to the <a href="https://tidymodels.github.io/recipes/">recipes</a> R package that is a part of the new “tidymodels” package ecosystem (which, I guess is supposed to be equivalent to the data-focused “tidyverse” package ecosystem that includes dplyr, tidyr, and other super awesome packages like that). Recipes was developed by Max Kuhn and Hadley Wickham.</p>
<!-- Those who have ever seen Hadley Wickham give a talk will know that baking and data are inherently related (see photo below).  -->
<!-- ```{r echo = FALSE, fig.align="center", fig.cap = "A photo I took at an R Ladies SF meetup of Hadley's cupcake recipes."} -->
<!-- knitr::include_graphics("/img/recipes/hadley_cupcakes.jpg") -->
<!-- ``` -->
<p>So let’s get baking!</p>
<section id="the-fundamentals-of-pre-processing-your-data-using-recipes" class="level2">
<h2 class="anchored" data-anchor-id="the-fundamentals-of-pre-processing-your-data-using-recipes">The fundamentals of pre-processing your data using recipes</h2>
<p>Creating a recipe has four steps:</p>
<ol type="1">
<li><p><strong>Get the ingredients</strong> (<code>recipe()</code>): specify the response variable and predictor variables</p></li>
<li><p><strong>Write the recipe</strong> (<code>step_zzz()</code>): define the pre-processing steps, such as imputation, creating dummy variables, scaling, and more</p></li>
<li><p><strong>Prepare the recipe</strong> (<code>prep()</code>): provide a dataset to base each step on (e.g.&nbsp;if one of the steps is to remove variables that only have one unique value, then you need to give it a dataset so it can decide which variables satisfy this criteria to ensure that it is doing the same thing to every dataset you apply it to)</p></li>
<li><p><strong>Bake the recipe</strong> (<code>bake()</code>): apply the pre-processing steps to your datasets</p></li>
</ol>
<p>In this blog post I’ll walk you through these three steps, touching on the wide range of things that recipes can do, while hopefully convincing you that recipes makes life really easy and that you should use it next time you need to do some pre-processing.</p>
</section>
<section id="a-simple-example-cupcakes-or-muffins" class="level2">
<h2 class="anchored" data-anchor-id="a-simple-example-cupcakes-or-muffins">A simple example: cupcakes or muffins?</h2>
<p>To keep things in the theme, I’m going to use a dataset from <a href="https://github.com/adashofdata">Alice Zhao’s git repo</a> that I found when I typed “cupcake dataset” into Google. Our goal will be to classify recipes as either cupcakes or muffins based on the quantities used for each of the ingredients. So perhaps we will learn two things today: (1) how to use the recipes package, and (2) the difference between cupcakes and muffins.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set up so that all variables of tibbles are printed</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dplyr.width =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>)</span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load useful libraries</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(recipes) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># could also load the tidymodels package</span></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load in the data</span></span>
<span id="cb1-7">muffin_cupcake_data_orig <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/adashofdata/muffin-cupcake/master/recipes_muffins_cupcakes.csv"</span>)</span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># look at data</span></span>
<span id="cb1-9">muffin_cupcake_data_orig</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 9
   Type    Flour  Milk Sugar Butter   Egg `Baking Powder` Vanilla  Salt
   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
 1 Muffin     55    28     3      7     5               2       0     0
 2 Muffin     47    24    12      6     9               1       0     0
 3 Muffin     47    23    18      6     4               1       0     0
 4 Muffin     45    11    17     17     8               1       0     0
 5 Muffin     50    25    12      6     5               2       1     0
 6 Muffin     55    27     3      7     5               2       1     0
 7 Muffin     54    27     7      5     5               2       0     0
 8 Muffin     47    26    10     10     4               1       0     0
 9 Muffin     50    17    17      8     6               1       0     0
10 Muffin     50    17    17     11     4               1       0     0
11 Cupcake    39     0    26     19    14               1       1     0
12 Cupcake    42    21    16     10     8               3       0     0
13 Cupcake    34    17    20     20     5               2       1     0
14 Cupcake    39    13    17     19    10               1       1     0
15 Cupcake    38    15    23     15     8               0       1     0
16 Cupcake    42    18    25      9     5               1       0     0
17 Cupcake    36    14    21     14    11               2       1     0
18 Cupcake    38    15    31      8     6               1       1     0
19 Cupcake    36    16    24     12     9               1       1     0
20 Cupcake    34    17    23     11    13               0       1     0</code></pre>
</div>
</div>
<p>Since the space in the column name <code>Baking Powder</code> is going to really annoy me, I’m going to do a quick clean where I convert all of the column names to lower case and replace the space with an underscore.</p>
<p>As a side note, I’ve started naming all of my temporary function arguments (lambda functions?) with a period preceding the name. I find it makes it a lot easier to read. As another side note, if you’ve never seen the <code>rename_all()</code> function before, check out my <a href="http://www.rebeccabarter.com/blog/2019-01-23_scoped-verbs/">blog post</a> on scoped verbs!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">muffin_cupcake_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muffin_cupcake_data_orig <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rename all columns </span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename_all</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(.name) {</span>
<span id="cb3-4">    .name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-5">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># replace all names with the lowercase versions</span></span>
<span id="cb3-6">      tolower <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-7">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># replace all spaces with underscores</span></span>
<span id="cb3-8">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>)</span>
<span id="cb3-9">    })</span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check that this did what I wanted</span></span>
<span id="cb3-11">muffin_cupcake_data</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 9
   type    flour  milk sugar butter   egg baking_powder vanilla  salt
   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
 1 Muffin     55    28     3      7     5             2       0     0
 2 Muffin     47    24    12      6     9             1       0     0
 3 Muffin     47    23    18      6     4             1       0     0
 4 Muffin     45    11    17     17     8             1       0     0
 5 Muffin     50    25    12      6     5             2       1     0
 6 Muffin     55    27     3      7     5             2       1     0
 7 Muffin     54    27     7      5     5             2       0     0
 8 Muffin     47    26    10     10     4             1       0     0
 9 Muffin     50    17    17      8     6             1       0     0
10 Muffin     50    17    17     11     4             1       0     0
11 Cupcake    39     0    26     19    14             1       1     0
12 Cupcake    42    21    16     10     8             3       0     0
13 Cupcake    34    17    20     20     5             2       1     0
14 Cupcake    39    13    17     19    10             1       1     0
15 Cupcake    38    15    23     15     8             0       1     0
16 Cupcake    42    18    25      9     5             1       0     0
17 Cupcake    36    14    21     14    11             2       1     0
18 Cupcake    38    15    31      8     6             1       1     0
19 Cupcake    36    16    24     12     9             1       1     0
20 Cupcake    34    17    23     11    13             0       1     0</code></pre>
</div>
</div>
<p>Since recipes does a lot of useful stuff for categorical variables as well as with missing values, I’m going to modify the data a little bit so that it’s a bit more interesting (for educational purposes only - don’t ever actually modify your data so it’s more interesting, in science that’s called “fraud”, and fraud is bad).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add an additional ingredients column that is categorical</span></span>
<span id="cb5-2">muffin_cupcake_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muffin_cupcake_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">additional_ingredients =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fruit"</span>, </span>
<span id="cb5-4">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fruit"</span>, </span>
<span id="cb5-5">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>, </span>
<span id="cb5-6">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nuts"</span>, </span>
<span id="cb5-7">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fruit"</span>, </span>
<span id="cb5-8">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fruit"</span>, </span>
<span id="cb5-9">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nuts"</span>, </span>
<span id="cb5-10">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>, </span>
<span id="cb5-11">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>, </span>
<span id="cb5-12">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nuts"</span>,</span>
<span id="cb5-13">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"icing"</span>,</span>
<span id="cb5-14">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"icing"</span>,</span>
<span id="cb5-15">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fruit"</span>,</span>
<span id="cb5-16">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,</span>
<span id="cb5-17">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fruit"</span>,</span>
<span id="cb5-18">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"icing"</span>,</span>
<span id="cb5-19">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,</span>
<span id="cb5-20">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fruit"</span>,</span>
<span id="cb5-21">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"icing"</span>,</span>
<span id="cb5-22">                                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"icing"</span>))</span>
<span id="cb5-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add some random missing values here and there just for fun</span></span>
<span id="cb5-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26738</span>)</span>
<span id="cb5-25">muffin_cupcake_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> muffin_cupcake_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-26">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># only add missing values to numeric columns</span></span>
<span id="cb5-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_if</span>(is.numeric,</span>
<span id="cb5-28">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) {</span>
<span id="cb5-29">              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># randomly decide if 0, 2, or 3 values will be missing from each column</span></span>
<span id="cb5-30">              n_missing <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-31">              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># replace n_missing randomly selected values from each column with NA</span></span>
<span id="cb5-32">              x[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, n_missing)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-33">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(x)</span>
<span id="cb5-34">              })</span>
<span id="cb5-35">muffin_cupcake_data</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 10
   type    flour  milk sugar butter   egg baking_powder vanilla  salt
   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
 1 Muffin     55    28     3      7     5             2       0     0
 2 Muffin     47    24    12      6     9             1      NA     0
 3 Muffin     47    23    18      6     4             1       0     0
 4 Muffin     NA    NA    17     17     8            NA       0     0
 5 Muffin     50    25    12      6     5             2       1     0
 6 Muffin     55    27     3      7     5             2       1     0
 7 Muffin     54    27     7      5     5             2       0     0
 8 Muffin     47    26    10     10     4            NA      NA     0
 9 Muffin     50    17    17      8     6             1       0     0
10 Muffin     50    NA    17     11     4             1       0     0
11 Cupcake    39     0    26     19    14             1       1     0
12 Cupcake    42    21    16     10     8             3       0     0
13 Cupcake    NA    17    20     20     5             2       1     0
14 Cupcake    39    13    17     19    10             1       1     0
15 Cupcake    38    15    23     NA     8             0       1     0
16 Cupcake    42    18    25     NA     5             1       0     0
17 Cupcake    36    14    21     14    11             2       1     0
18 Cupcake    38    15    31      8     6             1       1     0
19 Cupcake    36    16    24     12     9             1      NA     0
20 Cupcake    34    17    23     11    13             0       1     0
   additional_ingredients
   &lt;chr&gt;                 
 1 fruit                 
 2 fruit                 
 3 none                  
 4 nuts                  
 5 fruit                 
 6 fruit                 
 7 nuts                  
 8 none                  
 9 none                  
10 nuts                  
11 icing                 
12 icing                 
13 fruit                 
14 none                  
15 fruit                 
16 icing                 
17 none                  
18 fruit                 
19 icing                 
20 icing                 </code></pre>
</div>
</div>
<p>Finally, I’m going to split my data into training and test sets, so that you can see how nicely our recipe can be applied to multiple data frames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rsample)</span>
<span id="cb7-2">muffin_cupcake_split <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initial_split</span>(muffin_cupcake_data)</span>
<span id="cb7-3">muffin_cupcake_train <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">training</span>(muffin_cupcake_split)</span>
<span id="cb7-4">muffin_cupcake_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">testing</span>(muffin_cupcake_split)</span>
<span id="cb7-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(muffin_cupcake_data)</span></code></pre></div>
</div>
<p>Our training data is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">muffin_cupcake_train</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 10
   type    flour  milk sugar butter   egg baking_powder vanilla  salt
   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
 1 Cupcake    42    18    25     NA     5             1       0     0
 2 Muffin     50    17    17      8     6             1       0     0
 3 Cupcake    38    15    23     NA     8             0       1     0
 4 Cupcake    39    13    17     19    10             1       1     0
 5 Muffin     47    26    10     10     4            NA      NA     0
 6 Muffin     55    27     3      7     5             2       1     0
 7 Cupcake    42    21    16     10     8             3       0     0
 8 Muffin     50    NA    17     11     4             1       0     0
 9 Muffin     47    23    18      6     4             1       0     0
10 Cupcake    34    17    23     11    13             0       1     0
11 Cupcake    39     0    26     19    14             1       1     0
12 Cupcake    36    14    21     14    11             2       1     0
13 Muffin     NA    NA    17     17     8            NA       0     0
14 Muffin     50    25    12      6     5             2       1     0
15 Cupcake    36    16    24     12     9             1      NA     0
   additional_ingredients
   &lt;chr&gt;                 
 1 icing                 
 2 none                  
 3 fruit                 
 4 none                  
 5 none                  
 6 fruit                 
 7 icing                 
 8 nuts                  
 9 none                  
10 icing                 
11 icing                 
12 none                  
13 nuts                  
14 fruit                 
15 icing                 </code></pre>
</div>
</div>
<p>and our testing data is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">muffin_cupcake_test</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 10
  type    flour  milk sugar butter   egg baking_powder vanilla  salt
  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 Muffin     55    28     3      7     5             2       0     0
2 Muffin     47    24    12      6     9             1      NA     0
3 Muffin     54    27     7      5     5             2       0     0
4 Cupcake    NA    17    20     20     5             2       1     0
5 Cupcake    38    15    31      8     6             1       1     0
  additional_ingredients
  &lt;chr&gt;                 
1 fruit                 
2 fruit                 
3 nuts                  
4 fruit                 
5 fruit                 </code></pre>
</div>
</div>
</section>
<section id="writing-and-applying-the-recipe" class="level2">
<h2 class="anchored" data-anchor-id="writing-and-applying-the-recipe">Writing and applying the recipe</h2>
<p>Now that we’ve set up our data, we’re ready to write some recipes and do some baking! The first thing we need to do is get the ingredients. We can use formula notation within the <code>recipe()</code> function to do this: the thing we’re trying to predict is the variable to the left of the <code>~</code>, and the predictor variables are the things to the right of it (Since I’m including all of my variables, I could have written <code>type ~ .</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define the recipe (it looks a lot like applying the lm function)</span></span>
<span id="cb12-2">model_recipe <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">recipe</span>(type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> flour <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> milk <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sugar <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> butter <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> egg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-3">                         baking_powder <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> vanilla <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> salt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> additional_ingredients, </span>
<span id="cb12-4">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> muffin_cupcake_train)</span></code></pre></div>
</div>
<p>If we print a summary of the <code>model_recipe</code> object, it just shows us the variables we’ve specified, their type, and whether they’re a predictor or an outcome.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(model_recipe)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   variable               type      role      source  
   &lt;chr&gt;                  &lt;list&gt;    &lt;chr&gt;     &lt;chr&gt;   
 1 flour                  &lt;chr [2]&gt; predictor original
 2 milk                   &lt;chr [2]&gt; predictor original
 3 sugar                  &lt;chr [2]&gt; predictor original
 4 butter                 &lt;chr [2]&gt; predictor original
 5 egg                    &lt;chr [2]&gt; predictor original
 6 baking_powder          &lt;chr [2]&gt; predictor original
 7 vanilla                &lt;chr [2]&gt; predictor original
 8 salt                   &lt;chr [2]&gt; predictor original
 9 additional_ingredients &lt;chr [3]&gt; predictor original
10 type                   &lt;chr [3]&gt; outcome   original</code></pre>
</div>
</div>
<section id="writing-the-recipe-steps" class="level3">
<h3 class="anchored" data-anchor-id="writing-the-recipe-steps">Writing the recipe steps</h3>
<p>So now we have our ingredients, we are ready to write the recipe (i.e.&nbsp;describe our pre-processing steps). We write the recipe one step at a time. We have many steps to choose from, including:</p>
<ul>
<li><p><code>step_dummy()</code>: creating dummy variables from categorical variables.</p></li>
<li><p><code>step_zzzimpute()</code>: where instead of “<code>zzz</code>” it is the name of a method, such as <code>step_knnimpute()</code>, <code>step_meanimpute()</code>, <code>step_modeimpute()</code>. I find that the fancier imputation methods are reeeeally slow for decently large datasets, so I would probably do this step outside of the recipes package unless you just want to do a quick mean or mode impute (which, to be honest, I often do).</p></li>
<li><p><code>step_scale()</code>: normalize to have a standard deviation of 1.</p></li>
<li><p><code>step_center()</code>: center to have a mean of 0.</p></li>
<li><p><code>step_range()</code>: normalize numeric data to be within a pre-defined range of values.</p></li>
<li><p><code>step_pca()</code>: create principal component variables from your data.</p></li>
<li><p><code>step_nzv()</code>: remove variables that have (or almost have) the same value for every data point.</p></li>
</ul>
<p>You can also create your own step (which I’ve never felt the need to do, but the details of which can be found here https://tidymodels.github.io/recipes/articles/Custom_Steps.html).</p>
<p>In each step, you need to specify which variables you want to apply it to. There are many ways to do this:</p>
<ol type="1">
<li><p>Specifying the variable name(s) as the first argument</p></li>
<li><p>Standard dplyr selectors:</p>
<ul>
<li><p><code>everything()</code> applies the step to all columns,</p></li>
<li><p><code>contains()</code> allows you to specify column names that contain a specific string,</p></li>
<li><p><code>starts_with()</code> allows you to specify column names that start with a sepcific string,</p></li>
<li><p>etc</p></li>
</ul></li>
<li><p>Functions that specify the role of the variables:</p>
<ul>
<li><p><code>all_predictors()</code> applies the step to the predictor variables only</p></li>
<li><p><code>all_outcomes()</code> applies the step to the outcome variable(s) only</p></li>
</ul></li>
<li><p>Functions that specify the type of the variables:</p>
<ul>
<li><p><code>all_nominal()</code> applies the step to all variables that are nominal (categorical)</p></li>
<li><p><code>all_numeric()</code> applies the step to all variables that are numeric</p></li>
</ul></li>
</ol>
<p>To ignore a specific column, you can specify it’s name with a negative sign as a variable (just like you would in <code>select()</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define the steps we want to apply</span></span>
<span id="cb15-2">model_recipe_steps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model_recipe <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mean impute numeric variables</span></span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_impute_mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all_numeric</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert the additional ingredients variable to dummy variables</span></span>
<span id="cb15-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_dummy</span>(additional_ingredients) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rescale all numeric variables except for vanilla, salt and baking powder to lie between 0 and 1</span></span>
<span id="cb15-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_range</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all_numeric</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>vanilla, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>salt, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>baking_powder) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove predictor variables that are almost the same for every entry</span></span>
<span id="cb15-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_nzv</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all_predictors</span>()) </span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">model_recipe_steps</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:   1
predictor: 9</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Mean imputation for: all_numeric()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: additional_ingredients</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Range scaling to [0,1] for: all_numeric(), -vanilla, -salt, -baking_powder</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Sparse, unbalanced variable filter on: all_predictors()</code></pre>
</div>
</div>
<p>Note that the order in which you apply the steps does matter to some extent. The recommended ordering (<a href="https://tidymodels.github.io/recipes/articles/Ordering.html">taken from here</a>) is</p>
<ol type="1">
<li><p>Impute</p></li>
<li><p>Individual transformations for skewness and other issues</p></li>
<li><p>Discretize (if needed and if you have no other choice)</p></li>
<li><p>Create dummy variables</p></li>
<li><p>Create interactions</p></li>
<li><p>Normalization steps (center, scale, range, etc)</p></li>
<li><p>Multivariate transformation (e.g.&nbsp;PCA, spatial sign, etc)</p></li>
</ol>
</section>
<section id="preparing-the-recipe" class="level3">
<h3 class="anchored" data-anchor-id="preparing-the-recipe">Preparing the recipe</h3>
<p>Next, we need to provide a dataset on which to base the pre-processing steps. This allows the same recipe to be applied to multiple datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">prepped_recipe <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prep</span>(model_recipe_steps, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">training =</span> muffin_cupcake_train)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">prepped_recipe</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:   1
predictor: 9</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Training information </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Training data contained 15 data points and 6 incomplete rows.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Mean imputation for: flour, milk, sugar, butter, egg, ... | Trained</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: additional_ingredients | Trained</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Range scaling to [0,1] for: flour, milk, sugar, butter, egg, ... | Trained</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Sparse, unbalanced variable filter removed: salt | Trained</code></pre>
</div>
</div>
</section>
<section id="bake-the-recipe" class="level3">
<h3 class="anchored" data-anchor-id="bake-the-recipe">Bake the recipe</h3>
<p>Next, you apply your recipe to your datasets.</p>
<p>So what did our recipe do?</p>
<ul>
<li><p><code>step_meanimpute(all_numeric())</code> imputed all of the missing values with the mean value for that variable</p></li>
<li><p><code>step_dummy(additional_ingredients)</code> converted the <code>additional_ingredients</code> into three dummy variables corresponding to three of the four levels of the original variable</p></li>
<li><p><code>step_range(all_numeric(), min = 0, max = 1, -vanilla, -salt, -baking_powder)</code> converted the range of all of the numeric variables except for those specified to lie between 0 and 1</p></li>
<li><p><code>step_nzv(all_predictors())</code> removed the <code>salt</code> variable since it was 0 across all rows (except where it was missing)</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1">muffin_cupcake_train_preprocessed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bake</span>(prepped_recipe, muffin_cupcake_train) </span>
<span id="cb46-2">muffin_cupcake_train_preprocessed</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 11
    flour  milk sugar butter   egg baking_powder vanilla type   
    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;  
 1 0.381  0.667 0.957 0.426    0.1          1      0     Cupcake
 2 0.762  0.630 0.609 0.154    0.2          1      0     Muffin 
 3 0.190  0.556 0.870 0.426    0.4          0      1     Cupcake
 4 0.238  0.481 0.609 1        0.6          1      1     Cupcake
 5 0.619  0.963 0.304 0.308    0            1.23   0.538 Muffin 
 6 1      1     0     0.0769   0.1          2      1     Muffin 
 7 0.381  0.778 0.565 0.308    0.4          3      0     Cupcake
 8 0.762  0.661 0.609 0.385    0            1      0     Muffin 
 9 0.619  0.852 0.652 0        0            1      0     Muffin 
10 0      0.630 0.870 0.385    0.9          0      1     Cupcake
11 0.238  0     1     1        1            1      1     Cupcake
12 0.0952 0.519 0.783 0.615    0.7          2      1     Cupcake
13 0.439  0.661 0.609 0.846    0.4          1.23   0     Muffin 
14 0.762  0.926 0.391 0        0.1          2      1     Muffin 
15 0.0952 0.593 0.913 0.462    0.5          1      0.538 Cupcake
   additional_ingredients_icing additional_ingredients_none
                          &lt;dbl&gt;                       &lt;dbl&gt;
 1                            1                           0
 2                            0                           1
 3                            0                           0
 4                            0                           1
 5                            0                           1
 6                            0                           0
 7                            1                           0
 8                            0                           0
 9                            0                           1
10                            1                           0
11                            1                           0
12                            0                           1
13                            0                           0
14                            0                           0
15                            1                           0
   additional_ingredients_nuts
                         &lt;dbl&gt;
 1                           0
 2                           0
 3                           0
 4                           0
 5                           0
 6                           0
 7                           0
 8                           1
 9                           0
10                           0
11                           0
12                           0
13                           1
14                           0
15                           0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1">muffin_cupcake_test_preprocessed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bake</span>(prepped_recipe, muffin_cupcake_test)</span>
<span id="cb48-2">muffin_cupcake_test_preprocessed</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 11
  flour  milk sugar butter   egg baking_powder vanilla type   
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;  
1 1     1     0     0.0769   0.1             2   0     Muffin 
2 0.619 0.889 0.391 0        0.5             1   0.538 Muffin 
3 0.952 1     0.174 0        0.1             2   0     Muffin 
4 0.439 0.630 0.739 1        0.1             2   1     Cupcake
5 0.190 0.556 1     0.154    0.2             1   1     Cupcake
  additional_ingredients_icing additional_ingredients_none
                         &lt;dbl&gt;                       &lt;dbl&gt;
1                            0                           0
2                            0                           0
3                            0                           0
4                            0                           0
5                            0                           0
  additional_ingredients_nuts
                        &lt;dbl&gt;
1                           0
2                           0
3                           1
4                           0
5                           0</code></pre>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>R</category>
  <category>workflow</category>
  <category>machine learning</category>
  <guid>https://www.rebeccabarter.com/blog/2019-06-06_pre_processing.html</guid>
  <pubDate>Thu, 06 Jun 2019 07:00:00 GMT</pubDate>
</item>
<item>
  <title>A quick guide to developing a reproducible and consistent data science workflow</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2019-03-07_reproducible_pipeline.html</link>
  <description><![CDATA[ 





<p>When you’re learning to code and perform data analysis, it can be overwhelming to figure out how to structure your projects. To help data scientists develop a reproducible and consistent workflow, I’ve put together a short GitHub-based document with some guiding advice: <a href="https://github.com/rlbarter/reproducibility-workflow">https://github.com/rlbarter/reproducibility-workflow</a></p>
<p>If you’re interested in contributing or improving this document, please get in touch, or even better, submit a pull request <a href="https://github.com/rlbarter/reproducibility-workflow">https://github.com/rlbarter/reproducibility-workflow</a>!</p>
<p>The document as of writing is shown below.</p>
<section id="reproducbility-workflow" class="level2">
<h2 class="anchored" data-anchor-id="reproducbility-workflow">Reproducbility workflow</h2>
<p>Every project should consist of a single well structured directory with meaningful subdirectories. Every project should be its own git repository that is hosted on GitHub.</p>
<p>Data cleaning and analyses should be carefully documented in a Jupyter Notebook or R markdown file and should be created with reproducibility in mind. Everyone on the team (and future you) should be able to re-create what you have performed.</p>
<p>The overall purpose is to have an organized project structure in place so that the project is easily approachable to many different individuals.</p>
<blockquote class="blockquote">
<p>Someone unfamiliar with your project should be able to look at your computer files and understand in detail what you did and why - Bill Noble</p>
</blockquote>
<p>An example of a reproducible project that follows this workflow lives in the <a href="https://github.com/rlbarter/reproducibility-workflow/tree/master/project_example">project_example/</a> folder.</p>
<section id="project-structure" class="level3">
<h3 class="anchored" data-anchor-id="project-structure">Project Structure</h3>
<p>The project will typically consist of the following subdirectories:</p>
<section id="data" class="level4">
<h4 class="anchored" data-anchor-id="data">Data</h4>
<p>Original raw data files data should be backed up on something like Google Drive, Dropbox or Box. The raw data itself should never be touched manually. Instead, you should have scripts or notebooks that load the raw data into an R or Python environment for in-environment data manipulation (this will not modify the raw data files themselves).</p>
<p>Any data that is produced by code should be saved in the <code>data/processed_data/</code> subdirectory.</p>
</section>
<section id="documents" class="level4">
<h4 class="anchored" data-anchor-id="documents">Documents</h4>
<p>This is a good place to keep meeting notes, data dictionaries, and any other associated materials.</p>
</section>
<section id="code" class="level4">
<h4 class="anchored" data-anchor-id="code">Code</h4>
<p>There are three types of code documents:</p>
<ol type="1">
<li><p><strong>Function scripts</strong> (.R, .py): scripts that contain reusable functions that will be called in the action scripts below (and possibly in the exploration notebooks). By convention, function scripts are given the name <code>xx_funs_yy.R</code>, where <code>xx</code> is a number and <code>yy</code> describes what the functions are for (e.g.&nbsp;<code>01_funs_clean_data.R</code>).</p></li>
<li><p><strong>Action scripts</strong> (.R, .py): scripts that perform activities such as a detailed data cleaning pipeline, or running many models. Often these scripts will load in data, do something to it (e.g.&nbsp;clean it or fit a model to it) and will then save a new object (such as a cleaned dataset or model results). By convention, action scripts are given the name <code>xx_do_yy.R</code>, where <code>xx</code> is a number and <code>yy</code> describes what action is undertaken by running the script (e.g.&nbsp;<code>01_do_clean_data.R</code>).</p></li>
<li><p><strong>Exploration notebooks</strong> (.Rmd, .ipynb): R Markdown or Jupyter notebook files that are used to produce figures and explanatory files that contain figures and explanations of data cleaning steps and results of analyses. These are the files that an external viewer would find useful to understand your data and analysis.</p></li>
</ol>
<p>Scripts that are run sequentially are numbered accordingly. An example of a project structure is shown below. Note that in the example below the functions folder is nested as a subdirectory of the scripts folder which contains the actionable scripts. This makes sense when the functions are only called in the actionable scripts (but not in the exploration notebooks).</p>
<pre><code>project
│   README.md
└───data/
│       └───raw_data/
│           │   data_orig.csv
│       └───processed_data/
│           │   data_clean.csv
│       └───results/
│           │   model_results.csv
└───documents/
│       meeting_notes.md
│       data_dictionary.md
└───code/
│       └───exploration/
│           │   01_data_exploration.Rmd
│           │   02_model_results.Rmd
│       └───scripts/
│           │   01_do_clean_data.R
│           │   02_do_model_data.R
│           └───functions/
│               │   01_funs_clean_data.R
│               │   02_funs_model_data.R
</code></pre>
</section>
</section>
<section id="syntax-and-conventions" class="level3">
<h3 class="anchored" data-anchor-id="syntax-and-conventions">Syntax and conventions</h3>
<p>All filenames are always lowercase and use underscores to separate words.</p>
<p>Code should follow an appropriate style guide:</p>
<ul>
<li>R: <a href="https://style.tidyverse.org/">Tidyverse Style Guide</a> (based on the R Google Style Guide)</li>
<li>Python: <a href="https://google.github.io/styleguide/pyguide.html">Google Style Guide</a></li>
</ul>
</section>
<section id="resources" class="level3">
<h3 class="anchored" data-anchor-id="resources">Resources</h3>
<ul>
<li><p>I wrote a much more detailed blog post on my workflow a few years ago that can be found here: <a href="http://www.rebeccabarter.com/blog/2017-08-16-data-science-workflow/">http://www.rebeccabarter.com/blog/2017-08-16-data-science-workflow/</a>. My workflow has changed a bit since then, but the underlying ideas are all more or less the same.</p></li>
<li><p>William Noble’s article on organizing computational biology projects: <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1000424">https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1000424</a></p></li>
<li><p>Marwick, Boettiger and Mullen’s article on packaging data analytical work reproducibly: <a href="https://ro.uow.edu.au/cgi/viewcontent.cgi?article=6445&amp;context=smhpapers">https://ro.uow.edu.au/cgi/viewcontent.cgi?article=6445&amp;context=smhpapers</a></p></li>
</ul>
</section>
<section id="acknowledgements" class="level3">
<h3 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h3>
<p>Thanks very much to Ciera Martinez for sharing her <a href="https://github.com/DiscoveryDNA/team_neural_network/blob/master/data_managment.md">project workflow</a>.</p>
<p>I’d also like to acknowledge the <em>Meta Research and Best Practices</em> working group (formerly the <em>Reproducility working group</em>) at the Berkeley Institute for Data Science (BIDS) for insightful discussions that have helped me form my own workflow over the years.</p>


</section>
</section>

 ]]></description>
  <category>data science</category>
  <category>workflow</category>
  <category>reproducibility</category>
  <guid>https://www.rebeccabarter.com/blog/2019-03-07_reproducible_pipeline.html</guid>
  <pubDate>Sat, 23 Mar 2019 07:00:00 GMT</pubDate>
</item>
<item>
  <title>mutate_all(), select_if(), summarise_at()… what’s the deal with scoped verbs?!</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2019-01-23_scoped-verbs.html</link>
  <description><![CDATA[ 





<p>Note: Scoped verbs have now essentially been superseded by <code>accross()</code> (soon to be available in dplyr 1.0.0). See <a href="http://www.rebeccabarter.com/blog/2020-07-09-across/">http://www.rebeccabarter.com/blog/2020-07-09-across/</a> for details.</p>
<p>I often find myself wishing that I could apply the same <code>mutate</code> function to several columns in a data frame at once, such as convert all factors to characters, or do something to all columns that have missing values, or select all variables whose names end with <code>_important</code>. When I first googled these problems around a year ago, I started to see solutions that use weird extensions of the basic <code>mutate()</code>, <code>select()</code>, <code>rename()</code>, and <code>summarise()</code> dplyr functions that look like <code>summarise_all()</code>, <code>filter_at()</code>, <code>mutate_if()</code>, and so on. I have since learned that these functions are called <strong>“scoped verbs”</strong> (where “scoped” means that they operate only on a selection of variables).</p>
<p>Unfortunately, despite my extensive googling, I never really found a satisfactory description of <em>how</em> to use these functions in general, I think primarily because the documentation for these functions is not particularly useful (try <code>?mutate_at()</code>).</p>
<p>Fortunately, I recently attended a series of lightening talks hosted by the RLadies SF chapter where Sara Altman pointed us towards a <a href="https://dcl-2017-04.github.io/curriculum/manip-scoped.html">summary document</a> that Hadley Wickham wrote for the Data Science class he helped create at Stanford in 2017 (this class is now taught by Sara Altman herself).</p>
<p>To summarise what I will demonstrate below, there are three scoped variants of the standard <code>mutate</code>, <code>summarise</code>, <code>rename</code> and <code>select</code> (and <code>transmute</code>) dplyr functions that can be specified by the following suffixes:</p>
<ul>
<li><p><code>_if</code>: allows you to pick variables that satisfy some logical criteria such as <code>is.numeric()</code> or <code>is.character()</code> (e.g.&nbsp;summarising only the numeric columns)</p></li>
<li><p><code>_at</code>: allows you to perform an operation only on variables specified by name (e.g.&nbsp;mutating only the columns whose name ends with “_date”)</p></li>
<li><p><code>_all</code>: allows you to perform an operation on all variables at once (e.g.&nbsp;calculating the number of missing values in every column)</p></li>
</ul>
<p>To explain how these functions all work, I will use the dataset from a survey of 800 Pittsburgh residents on whether or not they approve of self-driving car companies testing their autonomous vehicles on the streets of Pittsburgh (there have several articles on this issue in recent times in case you missed them: <a href="https://www.wired.com/story/uber-returns-self-driving-after-deadly-crash/">1</a>, <a href="https://www.nytimes.com/2018/12/05/technology/uber-self-driving-cars.html">2</a>). The data can usually be downloaded from data.gov (but is currently unavailable due to the current Government Shutdown - I will update this with an actual link to the data one day). For now you can download the data from <a href="../data/bikepghpublic.csv">here</a>.</p>
<p>A random sample of 10 rows of this dataset is shown below. To make it easy to see what’s going on, I’ll restrict my analysis below to these 10 rows</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load in the only library you ever really need</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(lubridate)</span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load in survey data</span></span>
<span id="cb1-5">av_survey <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/bikepghpublic.csv"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45679</span>)</span>
<span id="cb2-2">av_survey_sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> av_survey <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># select jsut a few columns and give some more intuitive column names</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Response ID</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,</span>
<span id="cb2-5">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start_date =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Start Date</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, </span>
<span id="cb2-6">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end_date =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">End Date</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,</span>
<span id="cb2-7">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">interacted_with_av_as_pedestrian =</span> InteractPedestrian,</span>
<span id="cb2-8">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">interacted_with_av_as_cyclist =</span> InteractBicycle,</span>
<span id="cb2-9">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">circumstanses_of_interaction =</span> CircumstancesCoded, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># lol @ typo in data</span></span>
<span id="cb2-10">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">approve_av_testing_pgh =</span> FeelingsProvingGround) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># take a random sample of 10 rows</span></span>
<span id="cb2-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make data frame so that we view the whole thing</span></span>
<span id="cb2-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>()</span>
<span id="cb2-15">av_survey_sample</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id                 start_date                   end_date
1  260381029  02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2  260822947  03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3  260907069  03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4  261099035  03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5  260332379  02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  260355021 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7  260350676  02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  261092370 03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9  260332519  02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10 260351560  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST
   interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   circumstanses_of_interaction approve_av_testing_pgh
1                             2                Approve
2                             4             Disapprove
3                            NA                Approve
4                             3       Somewhat Approve
5                            NA       Somewhat Approve
6                             1                Approve
7                            NA                Approve
8                            NA    Somewhat Disapprove
9                             2                Approve
10                           NA    Somewhat Disapprove</code></pre>
</div>
</div>
<section id="a-quick-useful-aside-using-shorthand-for-functions" class="level1">
<h1>A quick useful aside: Using shorthand for functions</h1>
<p>For many of the examples below, I will be using the <code>~fun(.x)</code> shorthand for writing temporary functions. If you’ve never seen this shorthand before it’s incredibly useful. As an example, here are three ways of counting the number of missing values in each column of a data frame.</p>
<p>The first approach uses the traditional <code>sapply()</code> function and temporary function syntax.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using apply and the normal temporary function syntax</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(av_survey_sample, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(x)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              id                       start_date 
                               0                                0 
                        end_date interacted_with_av_as_pedestrian 
                               0                                0 
   interacted_with_av_as_cyclist     circumstanses_of_interaction 
                               0                                5 
          approve_av_testing_pgh 
                               0 </code></pre>
</div>
</div>
<p>The second still uses the temporary function syntax, but is using the <code>map_dbl()</code> function from the <code>purrr</code> package instead of the old-school <code>sapply()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using purrr::map_dbl and the normal temporary function syntax</span></span>
<span id="cb6-2">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(x)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              id                       start_date 
                               0                                0 
                        end_date interacted_with_av_as_pedestrian 
                               0                                0 
   interacted_with_av_as_cyclist     circumstanses_of_interaction 
                               0                                5 
          approve_av_testing_pgh 
                               0 </code></pre>
</div>
</div>
<p>The third uses the <code>map_dbl()</code> function with the <code>~fun(.x)</code> syntax.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># using purrr::map_dbl and the `~fun(.x)` temporary function syntax</span></span>
<span id="cb8-2">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(.x)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              id                       start_date 
                               0                                0 
                        end_date interacted_with_av_as_pedestrian 
                               0                                0 
   interacted_with_av_as_cyclist     circumstanses_of_interaction 
                               0                                5 
          approve_av_testing_pgh 
                               0 </code></pre>
</div>
</div>
</section>
<section id="the-_if-scoped-variant-perform-an-operation-on-variables-that-satisfy-a-logical-criteria" class="level1">
<h1>The _if() scoped variant: perform an operation on variables that satisfy a logical criteria</h1>
<p><code>_if</code> allows you to perform an operation on variables that satisfy some logical criteria such as <code>is.numeric()</code> or <code>is.character()</code>.</p>
<section id="select_if" class="level2">
<h2 class="anchored" data-anchor-id="select_if">select_if()</h2>
<p>For instance, we can use <code>select_if()</code> to extract the numeric columns of the tibble only.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select_if</span>(is.numeric)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id circumstanses_of_interaction
1  260381029                            2
2  260822947                            4
3  260907069                           NA
4  261099035                            3
5  260332379                           NA
6  260355021                            1
7  260350676                           NA
8  261092370                           NA
9  260332519                            2
10 260351560                           NA</code></pre>
</div>
</div>
<p>We could also apply use more complex logical statements, for example by selecting columns that have at least one missing value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># select columns with at least one NA</span></span>
<span id="cb12-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the expression evaluates to TRUE if there is one or more missing values</span></span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select_if</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(.x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   circumstanses_of_interaction
1                             2
2                             4
3                            NA
4                             3
5                            NA
6                             1
7                            NA
8                            NA
9                             2
10                           NA</code></pre>
</div>
</div>
</section>
<section id="rename_if" class="level2">
<h2 class="anchored" data-anchor-id="rename_if">rename_if()</h2>
<p>We could rename columns that satisfy a logical expression using <code>rename_if()</code>. For instance, we can add a <code>num_</code> prefix to all numeric column names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb14-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># only rename numeric columns by adding a "num_" prefix</span></span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename_if</span>(is.numeric, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"num_"</span>, .x))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      num_id                 start_date                   end_date
1  260381029  02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2  260822947  03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3  260907069  03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4  261099035  03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5  260332379  02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  260355021 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7  260350676  02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  261092370 03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9  260332519  02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10 260351560  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST
   interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   num_circumstanses_of_interaction approve_av_testing_pgh
1                                 2                Approve
2                                 4             Disapprove
3                                NA                Approve
4                                 3       Somewhat Approve
5                                NA       Somewhat Approve
6                                 1                Approve
7                                NA                Approve
8                                NA    Somewhat Disapprove
9                                 2                Approve
10                               NA    Somewhat Disapprove</code></pre>
</div>
</div>
</section>
<section id="mutate_if" class="level2">
<h2 class="anchored" data-anchor-id="mutate_if">mutate_if()</h2>
<p>We could similarly use <code>mutate_if()</code> to mutate columns that satisfy specified logical conditions. In the example below, we mutate all columns that have at least one missing value by replacing <code>NA</code> with <code>"missing"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># only mutate columns with at least one NA</span></span>
<span id="cb16-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># replace each NA value with the character "missing"</span></span>
<span id="cb16-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_if</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(.x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb16-5">            <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(.x), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"missing"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(.x)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id                 start_date                   end_date
1  260381029  02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2  260822947  03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3  260907069  03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4  261099035  03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5  260332379  02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  260355021 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7  260350676  02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  261092370 03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9  260332519  02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10 260351560  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST
   interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   circumstanses_of_interaction approve_av_testing_pgh
1                             2                Approve
2                             4             Disapprove
3                       missing                Approve
4                             3       Somewhat Approve
5                       missing       Somewhat Approve
6                             1                Approve
7                       missing                Approve
8                       missing    Somewhat Disapprove
9                             2                Approve
10                      missing    Somewhat Disapprove</code></pre>
</div>
</div>
</section>
<section id="summarise_if" class="level2">
<h2 class="anchored" data-anchor-id="summarise_if">summarise_if()</h2>
<p>Similarly, <code>summarise_if()</code> will summarise columns that satisfy the specified logical conditions. Below, we summarise each character column by reporting the most common value (but for some reason there is no <code>mode()</code> function in R, so we need to write our own).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># function to calculate the mode (most common) observation</span></span>
<span id="cb18-2">mode <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) {</span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(x)))[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb18-4">}</span>
<span id="cb18-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># summarise character</span></span>
<span id="cb18-6">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise_if</span>(is.character, mode)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  start_date                   end_date
1 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
  interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                         Not sure                      Not sure
  approve_av_testing_pgh
1             Disapprove</code></pre>
</div>
</div>
</section>
</section>
<section id="the-_at-scoped-variant-perform-an-operation-only-on-variables-specified-by-name" class="level1">
<h1>The _at() scoped variant: perform an operation only on variables specified by name</h1>
<p><code>_at</code> allows you to perform an operation only on variables specified by name.</p>
<p>To specify which variables you want to operate on, you need to include the variable names inside the <code>vars()</code> function as the first argument. I think of as like <code>vars()</code> like <code>c()</code> to provide multiple values (in this case variable names) as a single argument. For example <code>av_survey_sample %&gt;% mutate_at(vars(start_date, end_date), mdy_hms)</code> will only mutate the <code>start_date</code> and <code>end_date</code> variables by converting them to lubridate format using the <code>mdy_hms</code> function.</p>
<p>These variables can be specified explicitly by name within the <code>vars()</code> function, or using the <strong>select_helpers</strong> within the <code>vars()</code> function.</p>
<section id="select-helpers" class="level2">
<h2 class="anchored" data-anchor-id="select-helpers">Select helpers</h2>
<p>Select helpers are functions that you can use within <code>select()</code> to help specify which variables you want to select. The options are</p>
<ul>
<li><p><code>starts_with()</code>: select all variables that start with a specified character string</p></li>
<li><p><code>ends_with()</code>: select all variables that end with a specified character string</p></li>
<li><p><code>contains()</code>: select all variables that contain a specified character string</p></li>
<li><p><code>matches()</code>: select variables that match a specified character string</p></li>
<li><p><code>one_of()</code>: selects variables that match any entries in the specified character vector</p></li>
<li><p><code>num_range()</code>: selects variables that are numbered (e.g.&nbsp;columns named <code>V1</code>, <code>V2</code>, <code>V3</code> would be selected by <code>select(num_range("V", 1:3))</code>)</p></li>
</ul>
<p>There are many ways that we could select the <code>date</code> variables using the <code>ends_with()</code> and <code>contains()</code> select helpers:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># selecting the date columns by providing their names</span></span>
<span id="cb20-2">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(start_date, end_date)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   start_date                   end_date
1   02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2   03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3   03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4   03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5   02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7   02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9   02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># selecting the columns that end with "_date"</span></span>
<span id="cb22-2">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_date"</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   start_date                   end_date
1   02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2   03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3   03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4   03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5   02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7   02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9   02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># selecting the columns that contain "date"</span></span>
<span id="cb24-2">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contains</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   start_date                   end_date
1   02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2   03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3   03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4   03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5   02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7   02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9   02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST</code></pre>
</div>
</div>
<p>If you ever find yourself wanting to provide variable names as characters, the <code>matches()</code> and <code>one_of()</code> select helpers can help you do that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># provide matches with a single character variables</span></span>
<span id="cb26-2">variable <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"start_date"</span></span>
<span id="cb26-3">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matches</span>(variable))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   start_date
1   02/24/2017 3:14:19 AM PST
2   03/03/2017 7:08:33 AM PST
3   03/06/2017 5:57:07 PM PST
4   03/08/2017 3:05:41 PM PST
5   02/23/2017 9:09:11 AM PST
6  02/23/2017 10:11:52 PM PST
7   02/23/2017 6:10:42 PM PST
8  03/08/2017 11:22:43 AM PST
9   02/23/2017 9:16:14 AM PST
10  02/23/2017 6:40:54 PM PST</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># provide one_of with a vector of character variables</span></span>
<span id="cb28-2">variables <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"start_date"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"end_date"</span>)</span>
<span id="cb28-3">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">one_of</span>(variables))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   start_date                   end_date
1   02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2   03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3   03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4   03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5   02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7   02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9   02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST</code></pre>
</div>
</div>
<p>Note that technically there does exist a <code>select_at()</code> function that requires a <code>vars()</code> input, but I can’t really think of a good use of this function…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># this is the same as av_survey_sample %&gt;% select(start_date, end_date)</span></span>
<span id="cb30-2">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb30-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(start_date, end_date))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   start_date                   end_date
1   02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2   03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3   03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4   03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5   02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7   02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9   02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST</code></pre>
</div>
</div>
<p>The syntax of this <code>select_at()</code> example though can be useful for understanding how the <code>vars()</code> function can be used in the other <code>_at()</code> functions).</p>
</section>
<section id="rename_at" class="level2">
<h2 class="anchored" data-anchor-id="rename_at">rename_at()</h2>
<p>You can rename specified variables using the <code>rename_at()</code> function. For instance, we could replace all column names that contain the character string “av” with the same column name but an uppercase “AV” instead of the original lowercase “av”.</p>
<p>To do this, we use the select helper <code>contains()</code> within the <code>vars()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use a select helper to only apply to columns whose name contains "av"</span></span>
<span id="cb32-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># then rename these columns with "AV" in place of "av"</span></span>
<span id="cb32-3">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb32-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contains</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"av"</span>)), </span>
<span id="cb32-5">            <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"av"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AV"</span>, .x))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id                 start_date                   end_date
1  260381029  02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2  260822947  03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3  260907069  03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4  261099035  03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5  260332379  02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  260355021 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7  260350676  02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  261092370 03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9  260332519  02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10 260351560  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST
   interacted_with_AV_as_pedestrian interacted_with_AV_as_cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   circumstanses_of_interaction approve_AV_testing_pgh
1                             2                Approve
2                             4             Disapprove
3                            NA                Approve
4                             3       Somewhat Approve
5                            NA       Somewhat Approve
6                             1                Approve
7                            NA                Approve
8                            NA    Somewhat Disapprove
9                             2                Approve
10                           NA    Somewhat Disapprove</code></pre>
</div>
</div>
</section>
<section id="mutate_at" class="level2">
<h2 class="anchored" data-anchor-id="mutate_at">mutate_at()</h2>
<p>To mutate only the date variables, normally we would do the <code>mdy_hms()</code> transformation to each variable separately as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use the standard (unscoped) approach</span></span>
<span id="cb34-2">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb34-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start_date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mdy_hms</span>(start_date),</span>
<span id="cb34-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end_date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mdy_hms</span>(end_date))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id          start_date            end_date
1  260381029 2017-02-24 03:14:19 2017-02-24 03:18:05
2  260822947 2017-03-03 07:08:33 2017-03-03 07:19:15
3  260907069 2017-03-06 17:57:07 2017-03-06 17:59:08
4  261099035 2017-03-08 15:05:41 2017-03-09 07:17:53
5  260332379 2017-02-23 09:09:11 2017-02-23 09:11:07
6  260355021 2017-02-23 22:11:52 2017-02-23 22:20:02
7  260350676 2017-02-23 18:10:42 2017-02-23 18:13:59
8  261092370 2017-03-08 11:22:43 2017-03-08 11:25:22
9  260332519 2017-02-23 09:16:14 2017-02-23 09:21:40
10 260351560 2017-02-23 18:40:54 2017-02-23 18:42:02
   interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   circumstanses_of_interaction approve_av_testing_pgh
1                             2                Approve
2                             4             Disapprove
3                            NA                Approve
4                             3       Somewhat Approve
5                            NA       Somewhat Approve
6                             1                Approve
7                            NA                Approve
8                            NA    Somewhat Disapprove
9                             2                Approve
10                           NA    Somewhat Disapprove</code></pre>
</div>
</div>
<p>However, using <code>mutate_at()</code> and supplying these column names as arguments to the <code>vars()</code> function, we could specify the function only once.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># specifying specific variables to apply the same function to</span></span>
<span id="cb36-2">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb36-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(start_date, end_date), mdy_hms)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id          start_date            end_date
1  260381029 2017-02-24 03:14:19 2017-02-24 03:18:05
2  260822947 2017-03-03 07:08:33 2017-03-03 07:19:15
3  260907069 2017-03-06 17:57:07 2017-03-06 17:59:08
4  261099035 2017-03-08 15:05:41 2017-03-09 07:17:53
5  260332379 2017-02-23 09:09:11 2017-02-23 09:11:07
6  260355021 2017-02-23 22:11:52 2017-02-23 22:20:02
7  260350676 2017-02-23 18:10:42 2017-02-23 18:13:59
8  261092370 2017-03-08 11:22:43 2017-03-08 11:25:22
9  260332519 2017-02-23 09:16:14 2017-02-23 09:21:40
10 260351560 2017-02-23 18:40:54 2017-02-23 18:42:02
   interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   circumstanses_of_interaction approve_av_testing_pgh
1                             2                Approve
2                             4             Disapprove
3                            NA                Approve
4                             3       Somewhat Approve
5                            NA       Somewhat Approve
6                             1                Approve
7                            NA                Approve
8                            NA    Somewhat Disapprove
9                             2                Approve
10                           NA    Somewhat Disapprove</code></pre>
</div>
</div>
<p>Moreover, we can use the select helpers to specify which columns we want to mutate, without having to write out the entire column names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use a "select helper" to specify the variables that end with "_date"</span></span>
<span id="cb38-2">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb38-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_date"</span>)), mdy_hms)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id          start_date            end_date
1  260381029 2017-02-24 03:14:19 2017-02-24 03:18:05
2  260822947 2017-03-03 07:08:33 2017-03-03 07:19:15
3  260907069 2017-03-06 17:57:07 2017-03-06 17:59:08
4  261099035 2017-03-08 15:05:41 2017-03-09 07:17:53
5  260332379 2017-02-23 09:09:11 2017-02-23 09:11:07
6  260355021 2017-02-23 22:11:52 2017-02-23 22:20:02
7  260350676 2017-02-23 18:10:42 2017-02-23 18:13:59
8  261092370 2017-03-08 11:22:43 2017-03-08 11:25:22
9  260332519 2017-02-23 09:16:14 2017-02-23 09:21:40
10 260351560 2017-02-23 18:40:54 2017-02-23 18:42:02
   interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   circumstanses_of_interaction approve_av_testing_pgh
1                             2                Approve
2                             4             Disapprove
3                            NA                Approve
4                             3       Somewhat Approve
5                            NA       Somewhat Approve
6                             1                Approve
7                            NA                Approve
8                            NA    Somewhat Disapprove
9                             2                Approve
10                           NA    Somewhat Disapprove</code></pre>
</div>
</div>
</section>
<section id="summarise_at" class="level2">
<h2 class="anchored" data-anchor-id="summarise_at">summarise_at()</h2>
<p>The <code>summarise_at()</code> scoped verb behaves very similarly to the <code>mutate_at()</code> scoped verb, in that we can easily specify <em>which</em> variables we want to apply the same summary function to.</p>
<p>For instance, the following example summarises all variables that contain the word “interacted” by counting the number of “Yes” entries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb40-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contains</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"interacted"</span>)), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yes"</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  interacted_with_av_as_pedestrian interacted_with_av_as_cyclist
1                                4                             6</code></pre>
</div>
</div>
</section>
</section>
<section id="the-_all-scoped-variant-perform-an-operation-on-all-variables-at-once" class="level1">
<h1>The _all() scoped variant: perform an operation on all variables at once</h1>
<p><code>_all</code> allows you to perform an operation on all variables at once (e.g.&nbsp;calculating the number of missing values in every column).</p>
<section id="rename_all" class="level2">
<h2 class="anchored" data-anchor-id="rename_all">rename_all()</h2>
<p>The <code>select_all()</code> would is quite redundant (it would simply return all columns). Its friend <code>rename_all()</code>, however can be very useful.</p>
<p>For instance, we could rename all variables by replacing underscores <code>_</code> with dots <code>.</code> (although I would advise against this: underscores are way better than dots!).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb42-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename_all</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span>, .x))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id                 start.date                   end.date
1  260381029  02/24/2017 3:14:19 AM PST  02/24/2017 3:18:05 AM PST
2  260822947  03/03/2017 7:08:33 AM PST  03/03/2017 7:19:15 AM PST
3  260907069  03/06/2017 5:57:07 PM PST  03/06/2017 5:59:08 PM PST
4  261099035  03/08/2017 3:05:41 PM PST  03/09/2017 7:17:53 AM PST
5  260332379  02/23/2017 9:09:11 AM PST  02/23/2017 9:11:07 AM PST
6  260355021 02/23/2017 10:11:52 PM PST 02/23/2017 10:20:02 PM PST
7  260350676  02/23/2017 6:10:42 PM PST  02/23/2017 6:13:59 PM PST
8  261092370 03/08/2017 11:22:43 AM PST 03/08/2017 11:25:22 AM PST
9  260332519  02/23/2017 9:16:14 AM PST  02/23/2017 9:21:40 AM PST
10 260351560  02/23/2017 6:40:54 PM PST  02/23/2017 6:42:02 PM PST
   interacted.with.av.as.pedestrian interacted.with.av.as.cyclist
1                               Yes                           Yes
2                                No                           Yes
3                               Yes                           Yes
4                                No                           Yes
5                                No                           Yes
6                               Yes                           Yes
7                                No                            No
8                          Not sure                      Not sure
9                               Yes                            No
10                               No                            No
   circumstanses.of.interaction approve.av.testing.pgh
1                             2                Approve
2                             4             Disapprove
3                            NA                Approve
4                             3       Somewhat Approve
5                            NA       Somewhat Approve
6                             1                Approve
7                            NA                Approve
8                            NA    Somewhat Disapprove
9                             2                Approve
10                           NA    Somewhat Disapprove</code></pre>
</div>
</div>
</section>
<section id="mutate_all" class="level2">
<h2 class="anchored" data-anchor-id="mutate_all">mutate_all()</h2>
<p>We could apply the same mutate function to every column at once using <code>mutate_all()</code>. For instance, the code below converts every column to a numeric (although this results in mostly missing values for the character variables)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_all</span>(as.numeric)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          id start_date end_date interacted_with_av_as_pedestrian
1  260381029         NA       NA                               NA
2  260822947         NA       NA                               NA
3  260907069         NA       NA                               NA
4  261099035         NA       NA                               NA
5  260332379         NA       NA                               NA
6  260355021         NA       NA                               NA
7  260350676         NA       NA                               NA
8  261092370         NA       NA                               NA
9  260332519         NA       NA                               NA
10 260351560         NA       NA                               NA
   interacted_with_av_as_cyclist circumstanses_of_interaction
1                             NA                            2
2                             NA                            4
3                             NA                           NA
4                             NA                            3
5                             NA                           NA
6                             NA                            1
7                             NA                           NA
8                             NA                           NA
9                             NA                            2
10                            NA                           NA
   approve_av_testing_pgh
1                      NA
2                      NA
3                      NA
4                      NA
5                      NA
6                      NA
7                      NA
8                      NA
9                      NA
10                     NA</code></pre>
</div>
</div>
</section>
<section id="summarise_all" class="level2">
<h2 class="anchored" data-anchor-id="summarise_all">summarise_all()</h2>
<p>We could also apply the same summary function to every column at once using <code>summarise_all()</code>. For instance, the example below calculates the number of distinct entries in each column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1">av_survey_sample <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb46-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise_all</span>(n_distinct)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id start_date end_date interacted_with_av_as_pedestrian
1 10         10       10                                3
  interacted_with_av_as_cyclist circumstanses_of_interaction
1                             3                            5
  approve_av_testing_pgh
1                      4</code></pre>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Hopefully this summary is useful to you in your data manipulation adventures!</p>


</section>

 ]]></description>
  <category>dplyr</category>
  <category>R</category>
  <category>tidyverse</category>
  <guid>https://www.rebeccabarter.com/blog/2019-01-23_scoped-verbs.html</guid>
  <pubDate>Wed, 23 Jan 2019 08:00:00 GMT</pubDate>
</item>
<item>
  <title>Which hypothesis test should I use? A flowchart</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2018-12-04_hypothesis_testing.html</link>
  <description><![CDATA[ 





<p>Many years ago I taught a stats class for which one of the topics was hypothesis testing. Many of the students had a hard time remembering what situation each test was designed for, so I made a flowchart to help piece together the wild world of hypothesis tests.</p>
<p>While the flowchart isn’t pretty (if I made it today, it would be much more attractive), I feel like it might be useful for others, so here it is:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/hypothesis_testing/Hypothesis_testing_flow_mean.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>(if you all like it - I’ll make a pretty version!)</p>



 ]]></description>
  <category>statistics</category>
  <category>hypothesis testing</category>
  <guid>https://www.rebeccabarter.com/blog/2018-12-04_hypothesis_testing.html</guid>
  <pubDate>Tue, 04 Dec 2018 08:00:00 GMT</pubDate>
</item>
<item>
  <title>Alternatives to grouped bar charts</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2018-05-29_alternatives_dodged_bars.html</link>
  <description><![CDATA[ 





<p>At some point in your life you have probably found yourself standing face-to-face with a beast known as a grouped bar chart. Perhaps it was in a research paper where the authors were trying to compare the results of several models across different datasets, or it was in a talk given by a colleague who was trying to compare the popularity of different products among distinct groups of consumers.</p>
<p>The first time you encountered a grouped bar chart you might have thought “what a neat way to put so much information in a single plot!”. However, the moment you started trying to see whether the orange bar always does better than the green bar but worse than the blue bar.</p>
<p>In the example below (made with ggplot2), I show a simple grouped bar chart comparing research funding success rates across a variety of disciplines with the data split into two categories for each discipline: males and females. This data came from Rafael Irizarry’s excellent R package, <code>dslabs</code>, containing datasets for teaching data science.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2018-05-29_alternatives_dodged_bars_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Even in this simple example, I find it really difficult to compare male and female funding success rates across genders. Are the males having more success than the females overall? It’s genuinely hard to tell unless I examine each discipline closely and see that men are doing better in the first two groups, but not the two after that, and then I think they are doing a bit better in the categories after that, but now I’m having a hard time and I really want to stop looking at this plot now…</p>
<p>Fortunately, people such as Ann K. Emery (in <a href="http://annkemery.com/clustered-bar-chart/">her post on grouped bar charts</a>) have thought about how to represent this information in a better way. Below I will show 2 alternative approaches (slope charts and horizontal dot plots).</p>
<p>While these are not necessarily “standard” plot types (as in there is no specific <code>geom_</code> for them), true freedom in visualization comes with the realization that most plots are just arrangements of circles and lines in space. When you truly embrace this idea, you can make any type of figure you want! By means of demonstration, in my <a href="../2018-05-29_getting_fancy_ggplot2/index.html">next post I show the ggplot2 R code for making each plot</a>.</p>
<section id="slope-plots" class="level1">
<h1>Slope plots</h1>
<p>The first alternative is similar to parallel coordinates plots for multi-variate data visualization. The slope plot contains two axes (or three or four, depending on how many groups you have), one for each group (male and female). The disciplines are each represented by a line connecting the male success rates to the female success rates in as coded by their y-position. This plot makes it very clear for which disciplines women have greater funding success than men (the upward sloping, darker colored lines) and it also makes it very clear which disciplines have higher funding success rates overall (Physics and Chemical sciences).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2018-05-29_alternatives_dodged_bars_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>What we see much more clearly is that the number of disciplines in which men are more successful is similar to the number of disciplines in which women are more successful. The discipline with the most similar success rates between men and women is the Chemical sciences. All of this information was very difficult to obtain from the grouped bar chart!</p>
</section>
<section id="horizontal-dot-plots" class="level1">
<h1>Horizontal dot plots</h1>
<p>Another alternative is the horizontal dot plot: In this case each discipline is again represented by a line, but instead of coding the success rates as the y-position at the end of the discipline slope, the success rate is coded as the x-position along the discipline-specific horizontal line. I have ordered the disciplines by the women’s funding success rate.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2018-05-29_alternatives_dodged_bars_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>For me, the horizontal dot plot highlights that in the disciplines with lower funding rates overall (the bottom few rows), men have higher success rates.</p>
<p>Regardless of your preference, it is fairly clear that both the slope plot and the horizontal dot plots are easier to digest than the grouped bar plot!</p>
</section>
<section id="code" class="level1">
<h1>Code</h1>
<p>My <a href="../2018-05-29_getting_fancy_ggplot2/index.html">next post</a> shows the ggplot2 code that I wrote to produce the three plots in this post.</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li><p>The research funding data comes from Rafael Irizarry’s <code>dslabs</code> R package</p></li>
<li><p>The slope and dot plot ideas for this post come from <a href="http://annkemery.com/clustered-bar-chart/">Ann K. Emery’s post</a> on the same topic.</p></li>
</ul>


</section>

 ]]></description>
  <category>R</category>
  <category>visualization</category>
  <guid>https://www.rebeccabarter.com/blog/2018-05-29_alternatives_dodged_bars.html</guid>
  <pubDate>Tue, 29 May 2018 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Getting fancy with ggplot2: code for alternatives to grouped bar charts</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2018-05-29_getting_fancy_ggplot2.html</link>
  <description><![CDATA[ 





<p>Here I provide the code I used to create the figures from my <a href="../2018-05-29_alternatives_dodged_bars/index.html">previous post on alternatives to grouped bar charts</a>. You are encouraged to play with them yourself!</p>
<p>The key to creating unique and creative visualizations using libraries such as ggplot (or even just straight SVG) is (1) to move away from thinking of data visualization only as the default plot types (bar plots, boxplots, scatterplots, etc), and (2) to realise that most visualizations are essentially lines and circles that you can arrange however you desire in space. Drawing a picture on paper before beginning to code your data viz is a great way to create customized visualizations for each dataset.</p>
<section id="bars" class="level1">
<h1>Bars</h1>
<p>First, I load in the libraries (the data comes from the <code>dslabs</code> library), and convert the data to long-form for creating the grouped bar charts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load in libraries</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dslabs)</span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># combine male and female success rates into single data frame</span></span>
<span id="cb1-5">success_rates <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(</span>
<span id="cb1-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># male success rates</span></span>
<span id="cb1-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transmute</span>(research_funding_rates, </span>
<span id="cb1-8">            discipline, </span>
<span id="cb1-9">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">success =</span> success_rates_men, </span>
<span id="cb1-10">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gender =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Male"</span>),</span>
<span id="cb1-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># female success rates</span></span>
<span id="cb1-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transmute</span>(research_funding_rates, </span>
<span id="cb1-13">            discipline, </span>
<span id="cb1-14">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">success =</span> success_rates_women, </span>
<span id="cb1-15">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gender =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Female"</span>)) </span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print the data</span></span>
<span id="cb2-2">success_rates</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            discipline success gender
1    Chemical sciences    26.5   Male
2    Physical sciences    19.3   Male
3              Physics    26.9   Male
4           Humanities    14.3   Male
5   Technical sciences    15.9   Male
6    Interdisciplinary    11.4   Male
7  Earth/life sciences    24.4   Male
8      Social sciences    15.3   Male
9     Medical sciences    18.8   Male
10   Chemical sciences    25.6 Female
11   Physical sciences    23.1 Female
12             Physics    22.2 Female
13          Humanities    19.3 Female
14  Technical sciences    21.0 Female
15   Interdisciplinary    21.8 Female
16 Earth/life sciences    14.3 Female
17     Social sciences    11.5 Female
18    Medical sciences    11.2 Female</code></pre>
</div>
</div>
<p>I used <code>geom_bar()</code> to create a grouped bar chart containing the data. I grouped by gender by setting <code>fill = gender</code> within the <code>aes()</code> function.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make grouped bar plot</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(success_rates) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add bar for each discipline colored by gender</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> discipline, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> success, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> gender),</span>
<span id="cb4-5">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodge"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># name axes and remove gap between bars and y-axis</span></span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Success Rate"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_discrete</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Discipline"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#468189"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9DBEBB"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove grey theme</span></span>
<span id="cb4-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rotate x-axis and remove superfluous axis elements</span></span>
<span id="cb4-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>, </span>
<span id="cb4-14">                                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb4-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb4-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()) </span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2018-05-29_getting_fancy_ggplot2_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="slope-plot" class="level1">
<h1>Slope plot</h1>
<p>To create the sloped chart, it ends up being easier to keep the data in its original wide form.</p>
<p>The first element I add is the slopes from men to women using <code>geom_segment()</code>. Each slope is colored based on whether men or women are more successful.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">gg_slope <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> research_funding_rates <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a variable for when men are more successful than women (for colours)</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">men_more_successful =</span> success_rates_men <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> success_rates_women) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a line segment that goes from men to women for each discipline</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb5-7">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> success_rates_men, </span>
<span id="cb5-8">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> success_rates_women,</span>
<span id="cb5-9">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> discipline,</span>
<span id="cb5-10">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> men_more_successful), </span>
<span id="cb5-11">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set the colors</span></span>
<span id="cb5-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#468189"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9DBEBB"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">guide =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove all axis stuff</span></span>
<span id="cb5-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()) </span>
<span id="cb5-20">gg_slope</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2018-05-29_getting_fancy_ggplot2_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, I add a left and right axis at the start and end of the slopes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">gg_slope <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gg_slope <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add vertical lines that act as axis for men</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb6-4">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(research_funding_rates<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>success_rates_men) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb6-5">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(research_funding_rates<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>success_rates_men) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb6-6">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey70"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add vertical lines that act as axis for women</span></span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb6-9">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(research_funding_rates<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>success_rates_men) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb6-10">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(research_funding_rates<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>success_rates_men) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb6-11">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey70"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add the words "men" and "women" above their axes</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> label),</span>
<span id="cb6-14">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb6-15">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(research_funding_rates<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>success_rates_men),</span>
<span id="cb6-16">                              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"men"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"women"</span>)),</span>
<span id="cb6-17">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey30"</span>,</span>
<span id="cb6-18">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>) </span>
<span id="cb6-19">gg_slope  </span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2018-05-29_getting_fancy_ggplot2_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I also need to add an identifier for each discipline’s slope. I do this by annotating the plot with text.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">gg_slope <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gg_slope <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add the label and success rate for each discipline next the men axis</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span>, </span>
<span id="cb7-4">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> success_rates_men, </span>
<span id="cb7-5">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(discipline, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", "</span>, </span>
<span id="cb7-6">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(success_rates_men, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%"</span>)),</span>
<span id="cb7-7">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey30"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add the success rate next to each point on the women axis</span></span>
<span id="cb7-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>, </span>
<span id="cb7-10">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> success_rates_women, </span>
<span id="cb7-11">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(success_rates_women, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%"</span>)),</span>
<span id="cb7-12">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey30"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set the limits of the x-axis so that the labels are not cut off</span></span>
<span id="cb7-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.1</span>)) </span>
<span id="cb7-15">gg_slope</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2018-05-29_getting_fancy_ggplot2_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Finally, I decide to add points (for aesthetic purposes). Behind each circle, I add a slightly larger white circle to act as a border and to give a slight “gap” look.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">gg_slope <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gg_slope <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-2">  </span>
<span id="cb8-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add the white outline for the points at each rate for men</span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb8-5">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> success_rates_men), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>,</span>
<span id="cb8-6">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add the white outline for the points at each rate for women</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb8-9">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> success_rates_women), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>,</span>
<span id="cb8-10">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-11">  </span>
<span id="cb8-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add the actual points at each rate for men</span></span>
<span id="cb8-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb8-14">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> success_rates_men), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb8-15">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey60"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add the actual points at each rate for men</span></span>
<span id="cb8-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb8-18">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> success_rates_women), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb8-19">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey60"</span>) </span>
<span id="cb8-20">gg_slope</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2018-05-29_getting_fancy_ggplot2_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="horizontal-dots" class="level1">
<h1>Horizontal dots</h1>
<p>To create the horizontal dot plot, I again keep the data in its original wide-form but I arrange the disciplines in order of women’s success rate (this will make the plot easier to read).</p>
<p>The first things I do to create the dot plot is add the horizontal discipline lines and the points for the success rates of men and women.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">gg_dot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> research_funding_rates <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rearrange the factor levels for discipline by rates for women</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(success_rates_women) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">discipline =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_inorder</span>(discipline)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-5">  </span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove axes and superfluous grids</span></span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_classic</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-12">  </span>
<span id="cb9-13">  </span>
<span id="cb9-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a dummy point for scaling purposes</span></span>
<span id="cb9-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> discipline), </span>
<span id="cb9-16">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-17">  </span>
<span id="cb9-18">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add the horizontal discipline lines</span></span>
<span id="cb9-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey80"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-20">  </span>
<span id="cb9-21">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a point for each male success rate</span></span>
<span id="cb9-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> success_rates_men, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> discipline), </span>
<span id="cb9-23">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9DBEBB"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-24">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a point for each female success rate</span></span>
<span id="cb9-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> success_rates_women, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> discipline),</span>
<span id="cb9-26">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#468189"</span>) </span>
<span id="cb9-27">gg_dot</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2018-05-29_getting_fancy_ggplot2_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Since I really like to annotate my figures with text so that the audience can work less hard, I add the success rate on top of each dot. I also prefer to annotate features my plot directly instead of using legends, so I also add a label for men and women.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">gg_dot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gg_dot <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add the text (%) for each male success rate</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> success_rates_men, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> discipline, </span>
<span id="cb10-4">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(success_rates_men, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))),</span>
<span id="cb10-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add the text (%) for each female success rate</span></span>
<span id="cb10-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> success_rates_women, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> discipline, </span>
<span id="cb10-8">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(success_rates_women, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))),</span>
<span id="cb10-9">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add a label above the first two points</span></span>
<span id="cb10-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> label, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> label),</span>
<span id="cb10-12">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">25.6</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">26.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, </span>
<span id="cb10-13">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"women"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"men"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9DBEBB"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#468189"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">guide =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-15">  </span>
<span id="cb10-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># manually specify the x-axis</span></span>
<span id="cb10-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>), </span>
<span id="cb10-18">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"15%"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"20%"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"25%"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-19">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># manually set the spacing above and below the plot</span></span>
<span id="cb10-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) </span>
<span id="cb10-21">gg_dot</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/2018-05-29_getting_fancy_ggplot2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li><p>The research funding data comes from Rafael Irizarry’s <code>dslabs</code> R package</p></li>
<li><p>The slope and dot plot ideas for this post come from <a href="http://annkemery.com/clustered-bar-chart/">Ann K. Emery’s post</a> on the same topic.</p></li>
</ul>


</section>

 ]]></description>
  <category>R</category>
  <category>visualization</category>
  <guid>https://www.rebeccabarter.com/blog/2018-05-29_getting_fancy_ggplot2.html</guid>
  <pubDate>Tue, 29 May 2018 07:00:00 GMT</pubDate>
</item>
<item>
  <title>Understanding Instrumental Variables</title>
  <dc:creator>Rebecca Barter</dc:creator>
  <link>https://www.rebeccabarter.com/blog/2018-05-23-instrumental_variables.html</link>
  <description><![CDATA[ 





<p>Suppose, as many do, that we want to estimate the effect of an action (or treatment) on an outcome. As an example, we might be interested in estimating the effect of receiving a drug vs not receiving a drug on the incidence of heart disease. In an ideal futuristic world, we would take each individual in our population and split them into two identical humans: one who receives the treatment and the other who doesn’t. Since these two humans are 100% identical in every way other than the treatment received, any difference we subsequently observe in their outcome (i.e.&nbsp;development of heart disease) must be due to the effect of the treatment alone.</p>
<p>Unfortunately, since our humble 21st-century technology does not yet posses a human-duplication machine, the natural thing to do is to split our existing population of humans <em>randomly</em> into two groups: those who are to receive the drug (the treatment group) and those who won’t (the control group).</p>
<p>Since there was nothing special about how we determined who gets the drug and who doesn’t, <em>on average</em>, there should be no difference between the treatment group and control group other than in the treatment itself. Thus, comparing the incidence of heart disease in the treatment group and in the control group should give us a reasonable estimate of the average effect of the treatment in the population.</p>
<section id="unobserved-confounding-in-observational-studies" class="level1">
<h1>Unobserved confounding in observational studies</h1>
<p>While the randomized experiment is a perfectly reasonable thing to do in many situations, unfortunately there are many more scenarios where we can’t just randomly assign the treatment. For instance in the case of the effect of organ transplants on survival, it is probably not the best idea to randomly assign transplants to people. Instead, those who receive transplants first are those who need it the most. Such a study is necessarily observational: we simply observe who happened to receive a transplant based on the existing system.</p>
<p>It is highly likely that there will be fairly extreme differences between those who receive a transplant earlier and those who receive one later; namely that those who are transplanted earlier are much sicker than those who are transplanted later. Thus, differences in survival between those who receive a transplant within a month (our definition of the treatment group) and those who receive a transplant in more than one month (our definition of the control group) cannot be attributable solely to the time of the transplant itself, but also to the fact that the earlier transplantees were sicker at the start of the study. Thus sickness is a <em>confounder</em>: something that is different between the treatment and control groups other than the treatment itself that also affects the outcome.</p>
<p>If you’d like to quickly brush up on your causal inference, the fundamental issue associated with making causal inferences, and in particular, the troubles that arise in the presence of confounding, you might like to take a peak at my <a href="../2017-07-05-confounding/index.html">earlier post</a> on this topic.</p>
<p>If a confounder is observable, you can adapt your estimator using methods such as matching or regression adjustment to obtain an unbiased treatment effect estimate. The key issue that I will explore in this post is what to do when you have <em>unobserved confounding</em>. For example, what if we cannot quantitatively measure “sickness” (the variable that determines whether you will be transplanted soon or not) and so transplants between blood-type compatible donors and recipients are assigned primarily based on sickness <em>as measured by a doctor’s intuition</em> (a fundamentally unmeasurable quantity). Note that this isn’t actually how transplants are allocated, but it will serve nicely for instrumental variables explanation purposes.</p>
</section>
<section id="what-is-an-instrument-and-can-i-play-it" class="level1">
<h1>What is an instrument and can I play it?</h1>
<p>In most situations, if you have an unobservable confounder, there isn’t too much you can do to get around it since changes in the treatment will necessarily also change the confounder (in ways we cannot measure), <em>both</em> of which will in turn change the outcome. In this case, there is no way to measure the effect of the treatment alone (i.e.&nbsp;in isolation from the confounder) on the outcome.</p>
<p>In a few situations, however, you will have an instrument. An instrument, it turns out, is not a tuba, a piano, nor a flute, but rather <strong>an instrument is a magical measurable quantity that happens to be correlated with the treatment, and is only related to the outcome via the treatment</strong> (the instrument has no influence on the outcome except via the fact that it influences the treatment which inturn influences the outcome). The second part of this definition (that the instrument is only related to the outcome via the treatment) is called the <strong>exclusion restriction</strong>.</p>
<p>In our transplant setting, a particularly nice instrument is blood type. Patients with blood type AB can receive organs from donors with any blood type (and donors with blood type AB can only donate to recipients with blood type AB), whereas patients with blood type O can only receive organs from donors with blood type O (but donors with blood type O can donate to recipients of any blood type). The result is that patients with blood type O will, in general, need to wait longer for a transplant than patients of a similar sickness level with blood type AB.</p>
<p>Since this is a lot to explain in words, below you will find a picture that demonstrates how recipients with blood type AB have a larger pool of potential donors than do recipients with blood type O. An arrow from a donor blood type to a recipient blood type implies that donors with the specified blood type can donate organs to the corresponding recipient blood type. Since we will focus only on blood types AB and O (pretending that blood types A and B don’t exist for technical convenience), these two blood types have been enclosed in a snug little box within the diagram.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/iv/abo.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The idea behind instrumental variables is that the <em>changes in treatment</em> that are <em>caused by the instrument</em> are unconfounded (since changes in the instrument will change the treatment but not the outcome or confounders) and can thus be used to estimate the treatment effect (among those individuals who are influenced by the instrument). This idea will be explained in great detail in the next section, but for now I will try to convince you that blood type is indeed an instrument.</p>
<p>Clearly blood type will affect the treatment (whether or not the patient is transplanted within a month), but for blood type to be an instrument, we also need to make sure that blood type has no effect on the outcome (other than through it’s effect on the treatment). That is, we need to check the exclusion restriction. It turns out that, unfortunately, the exclusion restriction is <strong>uncheckable</strong> (similarly to how it is impossible to check that there are no unobserved confounders). The exclusion restriction will forever remain a critical assumption that will need to be backed up by domain knowledge.</p>
<p>In the blood type case, it is easy to find faults in the exclusion restriction assumption: it is well-known that blood type and race are correlated, and that race and life-expectancy are correlated (implying that blood type and survival might be related via race). However, to keep things simple, we will define our outcome to be a binary variable corresponding to whether or not death occurs <em>within 1 year</em>. It is highly unlikely that blood type will be related to such a short term survival outcome, even via correlation with race. Moreover, blood type is more-or-less randomly assigned (given your parent’s blood type). In this case, the exclusion restriction is fairly plausible, but in many IV setups, a lot of care will need to be taken to back up the exclusion restriction assumption.</p>
<p>Now that we (hopefully) understand <em>what</em> an instrument is, the next question is how to use it (don’t worry if you have no idea why instruments are useful yet, it’s not at all obvious!).</p>
</section>
<section id="how-do-instruments-work" class="level1">
<h1>How do instruments work?</h1>
<p>Our big question is whether there is an effect of being transplanted within one month (the treatment) on death within 1 year (the outcome). However, our standard approaches to estimating the treatment effect are foiled by the presence of unobserved confounding by sickness, a feature that we cannot accurately quantify. If we could accurately measure an individual’s level of sickness then we could adjust for it using regression adjustment or matching techniques. In our case, however, sickness is defined based on doctor intuition (an unmeasurable quantity), so these traditional approaches to dealing with confounding cannot help us.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/iv/dag2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Fortunately, we have an instrument (blood type) which modifies the treatment (time to transplantation) without modifying any confounders (the exclusion restriction says that the instrument has no effect on the outcome in any way except through the treatment - this would not be true if the instrument was correlated with a confounder). The exclusion restriction is embodied by the lack of an arrow between the instrument (blood type) and the outcome (death within 1 year) in the graph below.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/iv/dag3.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Now, since the instrument affects the outcome solely through the treatment, any observed difference between the outcome (survival) between different levels of the instrument (blood types) must be due to the subsequent differences in the treatment (wait time).</p>
<p>It turns out that the effect of having blood type AB versus blood type O is that an individual is 7% less likely to die within 1 year. Since under the exclusion restriction there is no direct effect of blood type on death within 1 year (except via the treatment), this must be due to the difference in transplant wait time (the treatment) between the blood types.</p>
<p>Since patients with blood type AB are 23% more likely to be transplanted within 1 month than patients with blood type O, we can conclude that the effect of a 23% increase in the chance of being transplanted within 1 month is a 7% decrease in the chance of death within one year.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.rebeccabarter.com/blog/img/iv/dag5.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Mathematically, to scale up the effect of “being 23% more likely to be transplanted within a month” to the effect of “being 100% more likely to be transplanted within a month” (i.e.&nbsp;of being transplanted within a month vs not being transplanted within a month) is equal to</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Ctextrm%7BEffect%20of%20AB%20vs%20O%20on%20death%20in%201%20year%7D%7D%7B%5Ctextrm%7BEffect%20of%20AB%20vs%20O%20on%20transplantation%20in%201%20month%7D%7D%20=%20%5Cfrac%7B-0.07%7D%7B0.23%7D%20=%20-0.3"></p>
<p>That is, being transplanted within 1 month decreases the chance of death within 1 year by 30%!</p>
<p>It is important to note that since we are estimating the effect of changes in the treatment that were caused by the instrument only (rather than the effects of arbitrary changes in the treatment), the instrumental variables treatment effect estimate is not for the entire population, but only for those who are influenced in some way by the instrument (the “compliers”). Thus this estimate is called the Local Average Treatment Effect (LATE).</p>
<p>The estimator above is often referred to as the <strong>Wald estimator</strong> and can be written as</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctextrm%7BWald%20estimator%7D%20=%20%5Cfrac%7B%5Ctextrm%7BCov(outcome,%20instrument)%7D%7D%7B%5Ctextrm%7BCov(treatment,%20instrument)%7D%7D"></p>
<p>In practice, IV is often implemented in a two-stage lease squares (2SLS) procedure that can be shown quite easily to be equivalent to the Wald estimator in simple cases (i.e.&nbsp;when not adjusting for other variables).</p>
</section>
<section id="resources" class="level1">
<h1>Resources</h1>
<ul>
<li><p>The resource that I found to be most useful was Chapter 10.5 of Andrew Gelman and Jennifer Hill’s book <a href="http://www.stat.columbia.edu/~gelman/arm/chap10.pdf">Data Analysis Using Regression and Multilevel/Hierarchical Models</a></p></li>
<li><p>The series of YouTube videos by Ben Lambert were also really helpful https://youtu.be/NLgB2WGGKUw</p></li>
</ul>
</section>
<section id="notes" class="level1">
<h1>Notes</h1>
<ul>
<li><p>It turns out that you can quantify sickness in the context of liver transplantation using something called the MELD score (model for end-stage liver disease score). But even if we know current MELD score, <em>future</em> MELD score will still be a confounder since if your MELD rapidly increases then you are getting sicker faster and will be transplanted sooner.</p></li>
<li><p>If there is anything that is unclear in this post, please feel free to ask questions in the comments section so that I can improve it.</p></li>
</ul>


</section>

 ]]></description>
  <category>causal inference</category>
  <category>statistics</category>
  <guid>https://www.rebeccabarter.com/blog/2018-05-23-instrumental_variables.html</guid>
  <pubDate>Wed, 23 May 2018 07:00:00 GMT</pubDate>
</item>
</channel>
</rss>
